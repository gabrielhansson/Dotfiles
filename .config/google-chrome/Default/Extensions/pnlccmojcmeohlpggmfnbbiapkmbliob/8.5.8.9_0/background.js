// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
var RoboFormBase=function(){function e(){this.g_bToolbarVisible=GetSettingToolbarVisible(),this.g_popup_active=!1,this.g_ActivateTesterMode=!1,this.g_browsers={},this.g_WindowTab={}}function t(){console_output("RoboFormBase: "+format_log_args(t.caller,arguments))}return e.prototype.OnConnect=function(e,s,i,r,o,n){try{var a=s,m=this.FindTabBrowser(e),l=void 0;if(m){i&&m.m_main_frame_id&&(s=m.m_main_frame_id),l=m.m_frames[s];var _=g_issafari_appext&&l&&l.m_port==r;l&&!_&&(l.m_id,m.removeFrame(l.m_id,!1),i&&(g_issafari||g_isedge)&&m.removeAllFrames(!1),i&&g_isfirefox&&m.removeAllFrames(!1),l.attach(s,e,r,m,i,o,"initial"),l.m_id!=a&&l.postMessageToCS({name:"SetID",data:s}))}else m=this.CreateTabBrowser(e);l||(l=new CFrame).attach(s,e,r,m,i,o,"initial"),m.addFrame(l),i&&m.cleanupRemovedFrames(),l.update(o,n),l.postMessageToCS({name:"ping"}),this.g_ActivateTesterMode&&l.postMessageToCS({name:"ActivateTesterMode"})}catch(e){t("OnConnect",e),OnError(kCannotLoadExtension,e)}},e.prototype.CreateTabBrowser=function(e){var t=new CBrowser(e);return this.g_browsers[e]=t,t},e.prototype.FindTabBrowser=function(e){return this.g_browsers[e]},e.prototype.FindCreateTabBrowser=function(e,t){var s=this.FindTabBrowser(e);return s||(s=this.CreateTabBrowser(e)).addTopFrame(t),s},e.prototype.RemoveTabBrowser=function(e){delete this.g_browsers[e]},e.prototype.GetTabUrls=function(e,t){var s=this.FindTabBrowser(e);if(s){var i=[];s.forEachGoodFrame(function(e){isUrlWebCorrect(e.m_url)&&(e.m_is_top?i.unshift(e.m_url):i.push(e.m_url))}),t(i)}else t([])},e.prototype.UpdateCurrentWindowTab=function(e,t){void 0===t?delete this.g_WindowTab[e]:this.g_WindowTab[e]=t},e.prototype.GetCurrentWindowTab=function(e){return this.g_WindowTab[e]},e.prototype.OnUnload=function(e){},e.prototype.GetFillerRulesJSON=function(e,s,i,r){try{var o=e&&!g_sFillerRulesJSON,n=s&&(!g_sFillerLocalizationJSON||!g_sLanguage||void 0!==i&&i!=g_sLanguage);if(!o&&!n)return void r(g_sFillerRulesJSON,g_sFillerLocalizationJSON,g_sLanguage);this.LoadFillerRulesJSON(o,n,i,r)}catch(e){t("GetFillerRulesJSON",e),OnError(kInternalError,e)}},e}();function CFillFormsInWindowCtx(){this.EnPhases={Check_Next:0,Check_Phase1_Start:1,Check_Phase1_Return:2,Test_Fill_Start:3,Test_Fill_Return:4,Check_Phase2_Start:5,Check_Phase2_Return:6,Check_Phase3_Start:7,Check_Phase3_Return:8,Fill_Next:9,Phase4_Start:10,Clean:11},this.m_nPhaseNumber=void 0,this.m_Args={},this.m_aAcceptedFrames=[],this.EnCheckResults={accept:0,deny:1,more_checks:2},this.m_nCurrentFrameId=0,this.m_sRules=void 0,this.m_sLocalizationStrings=void 0}function CBrowser(e){this.m_tab_id=e,this.m_frames={},this.m_main_frame_id=void 0,this.m_url=void 0,this.m_save_forms_enum=new CEnumFrames,this.m_fill_submit_enum=new CEnumFrames,this.m_FillFormsInWindowCtx=void 0,this.m_FillFormsInWindowEnum=void 0,this.m_window_id=void 0,this.m_pBasicAuthPrompt=void 0,this.m_basic_auth_url=void 0,this.m_search_is_highlighted_enum=new CEnumFrames,this.m_search_highlight_enum=new CEnumFrames,this.m_nHighlightedWords=void 0,this.m_update_selection_search_enum=new CEnumFrames}CBrowser.prototype.addTopFrame=function(e){var t;t=g_ischrome?"top0":"top"+GetUniqueNum().toString(),this.m_tab_id;var s=new CFrame;s.attach(t,this.m_tab_id,void 0,this,!0,e,void 0),this.addFrame(s)},CBrowser.prototype.removeAllFrames=function(e){for(var t in this.m_tab_id,this.m_frames)this.m_frames.hasOwnProperty(t)&&this.removeFrame(t,e)},CBrowser.prototype.update=function(e,t){e&&(this.m_url=e);var s=this.m_frames[this.m_main_frame_id];s&&s.update(e,t)},CBrowser.prototype.FillSubmit=function(e){this.m_fill_submit_enum.start({browser:this,frame_msg:"FillSubmit",ctx:JSON.parse(e),end_msg:"EndFillSubmit"}),this.FillSubmitNextFrame()},CBrowser.prototype.FillSubmitNextFrame=function(){this.m_fill_submit_enum.next()},CBrowser.prototype.SaveFormsInWindow=function(){this.m_save_forms_enum.start({browser:this,frame_msg:"SaveForms",end_msg:"EndSaveForms"}),this.SaveNextUnsavedFrame()},CBrowser.prototype.SaveNextUnsavedFrame=function(){this.m_save_forms_enum.next()},CBrowser.prototype.ClearFields=function(){this.forEachGoodFrame(function(e){e.postMessageToCS({name:"ClearFields"})})},CBrowser.prototype.SetFields=function(e){var t=ParseJSON(e);this.forEachGoodFrame(function(e){e.postMessageToCS({name:"SetFields",data:t})})},CBrowser.prototype.ResetFields=function(){this.forEachGoodFrame(function(e){e.postMessageToCS({name:"ResetFields"})})},CBrowser.prototype.forEachGoodFrame=function(e){for(var t in this.m_frames)if(this.m_frames.hasOwnProperty(t)){var s=this.m_frames[t];if(s&&!s.SkipInEnumerator()&&e(s))return!0}return!1},CBrowser.prototype.FillFormsInWindow_Resume=function(){var e=this.m_FillFormsInWindowCtx;if(e)for(var t=e.m_Args,s=this.m_FillFormsInWindowEnum;;)switch(e.m_nPhaseNumber,e.m_nPhaseNumber){case e.EnPhases.Check_Next:s.next()?(e.m_nCurrentFrameId,e.m_nPhaseNumber=e.EnPhases.Check_Phase1_Start):e.m_nPhaseNumber=e.EnPhases.Check_Phase3_Start;break;case e.EnPhases.Check_Phase1_Start:if(e.m_nPhaseNumber=e.EnPhases.Check_Phase1_Return,t.m_pPasscard)return t.m_TestPhase1.m_sMainFrameURL=this.m_frames[this.m_main_frame_id].m_url,t.m_TestPhase1.m_sCurrentFrameURL=this.m_frames[e.m_nCurrentFrameId].m_url,t.m_TestPhase1.m_sMatchURL=t.m_pPasscard.m_sMatchURL,void(getProxyRfo().IsLocal()?this.FillFormsInWindow_CallDll("Phase1_CheckURLs"):this.Phase1_CheckURLs());t.m_enResult=e.EnCheckResults.accept;break;case e.EnPhases.Check_Phase1_Return:t.m_enResult==e.EnCheckResults.deny?e.m_nPhaseNumber=e.EnPhases.Check_Next:e.m_nPhaseNumber=e.EnPhases.Test_Fill_Start;break;case e.EnPhases.Test_Fill_Start:var i=this.m_frames[e.m_nCurrentFrameId];return void(e.m_Args.m_pIdentity&&!i.m_bRulesSent?getRF().GetFillerRulesJSON(!0,!1,void 0,function(t,s,r){i.m_bRulesSent=!0,e.m_sRules=t,e.m_nPhaseNumber=e.EnPhases.Test_Fill_Return,i.postMessageToCS({name:"FillFormsInWindow_CallContent",data:e})}):(e.m_nPhaseNumber=e.EnPhases.Test_Fill_Return,i.postMessageToCS({name:"FillFormsInWindow_CallContent",data:e})));case e.EnPhases.Test_Fill_Return:return e.m_nPhaseNumber=e.EnPhases.Check_Phase2_Return,void(getProxyRfo().IsLocal()?this.FillFormsInWindow_CallDll("Phase2_CheckFillingAndShowWarning"):this.Phase2_CheckFillingAndShowWarning());case e.EnPhases.Check_Phase2_Return:t.m_enResult!=e.EnCheckResults.accept||e.m_aAcceptedFrames.push(e.m_nCurrentFrameId),e.m_nPhaseNumber=e.EnPhases.Check_Next;break;case e.EnPhases.Check_Phase3_Start:return e.m_nPhaseNumber=e.EnPhases.Check_Phase3_Return,void(getProxyRfo().IsLocal()?this.FillFormsInWindow_CallDll("Phase3_OverallTestAndWarnings"):this.Phase3_OverallTestAndWarnings());case e.EnPhases.Check_Phase3_Return:t.m_enResult!=e.EnCheckResults.accept?e.m_nPhaseNumber=e.EnPhases.Clean:(e.m_nPhaseNumber=e.EnPhases.Fill_Next,s.start({browser:this,frame_ids:e.m_aAcceptedFrames,frame_msg:"FillFormsInWindow_CallContent"}));break;case e.EnPhases.Fill_Next:if(s.next(e))return;e.m_nPhaseNumber=e.EnPhases.Phase4_Start;break;case e.EnPhases.Phase4_Start:return e.m_nPhaseNumber=e.EnPhases.Clean,void(getProxyRfo().IsLocal()?this.FillFormsInWindow_CallDll("Phase4_Submit",t):this.Phase4_Submit());case e.EnPhases.Clean:return this.m_FillFormsInWindowCtx=void 0,void(this.m_FillFormsInWindowEnum=void 0);default:e.m_nPhaseNumber=e.EnPhases.Clean}},CBrowser.prototype.FillFormsInWindow_Start=function(e){this.m_FillFormsInWindowCtx;var t=this.m_FillFormsInWindowCtx=new CFillFormsInWindowCtx,s=this.m_FillFormsInWindowEnum=new CEnumFrames;if(t.m_Args=JSON.parse(e),t.m_Args.m_pIdentity){var i=this;getRF().GetFillerRulesJSON(!1,!0,t.m_Args.m_sLanguage,function(e,s,o){t.m_sLocalizationStrings=s,r(i)})}else r(this);function r(e){s.start({browser:e,frame_func:function(e){return t.m_nCurrentFrameId=e.m_id,!1}}),t.m_nPhaseNumber=t.EnPhases.Check_Next,e.FillFormsInWindow_Resume()}},CBrowser.prototype.FillFormsInWindow_CallDll=function(e){var t={phase:e,args:this.m_FillFormsInWindowCtx.m_Args};getRF().g_proxy.onMessage(this.m_tab_id,this.m_main_frame_id,"FillFormsInWindow_CallDll",JSON.stringify(t))},CBrowser.prototype.StartNextFillingStep=function(e){this.m_FillFormsInWindowCtx.m_Args.m_enResult=e;var t=this;window.setTimeout(function(){t.FillFormsInWindow_Resume()},1)},CBrowser.prototype.Phase1_CheckURLs=function(){var e=this.m_FillFormsInWindowCtx,t=e.m_Args;if(t.m_pPasscard){var s=this;Promise.all([getProxyRfo().GetDomainMatch(),getProxyRfo().GetOption("OPTIONS","FillingFromPasscardChecksDomain",!0)]).then(function(i){var r=i[0],o=i[1];t.m_TestPhase1.m_sMainFrameURL=s.m_frames[s.m_main_frame_id].m_url;var n=t.m_TestPhase1.m_sMainFrameURL.toLowerCase();t.m_TestPhase1.m_sCurrentFrameURL=s.m_frames[e.m_nCurrentFrameId].m_url;var a=t.m_TestPhase1.m_sCurrentFrameURL.toLowerCase();t.m_TestPhase1.m_sMatchURL=t.m_pPasscard.m_sMatchURL;var m=t.m_TestPhase1.m_sMatchURL.toLowerCase();t.m_TestPhase1.m_bFillingIntoDomainNotInPasscard=!1,o&&!r.UrlDomainMatch(a,m)&&(t.m_TestPhase1.m_bFillingIntoDomainNotInPasscard=!0),t.m_TestPhase1.m_bPhishing=!1,t.m_TestPhase1.m_bFillingIntoDomainNotInPasscard||0!=n.search(new RegExp("^http://|^https://","i"))||0!=a.search(new RegExp("^http://|^https://","i"))||!r.UrlDomainMatch(n,m)||r.UrlDomainMatch(a,m)||(t.m_TestPhase1.m_bPhishing=!0),t.m_TestPhase1.m_bFillingIntoDomainNotInPasscard||t.m_TestPhase1.m_bPhishing?s.StartNextFillingStep(e.EnCheckResults.more_checks):s.StartNextFillingStep(e.EnCheckResults.accept)})}else this.StartNextFillingStep(e.EnCheckResults.deny)},CBrowser.prototype.Phase2_CheckFillingAndShowWarning=function(){var e=this.m_FillFormsInWindowCtx,t=e.m_Args;if(t.m_enResult!=e.EnCheckResults.accept)if(t.m_enResult==e.EnCheckResults.more_checks&&0!=t.m_TestPhase2.m_nFieldsFilled_namenotvalue){t.m_bChecking&&this.StartNextFillingStep(e.EnCheckResults.accept);var s=this,i=RfUtils.DomainFromUrl(decodeURI(t.m_TestPhase1.m_sMatchURL),!0,!1,!1),r=RfUtils.DomainFromUrl(decodeURI(t.m_TestPhase1.m_sCurrentFrameURL),!0,!1,!1);if(t.m_TestPhase1.m_bFillingIntoDomainNotInPasscard)n(EnCommandType.PhishingWarning_FillingIntoDomainNotInPasscard,[i,r]);else{var o=RfUtils.DomainFromUrl(decodeURI(t.m_TestPhase1.m_sMainFrameURL),!0,!1,!1);n(EnCommandType.PhishingWarning_FrameDomainDoesNotMatch,[i,r,o])}}else this.StartNextFillingStep(e.EnCheckResults.deny);else this.StartNextFillingStep(e.EnCheckResults.accept);function n(t,i){getRF().UICommand(t,!0,s.m_tab_id,i,function(t){t?s.StartNextFillingStep(e.EnCheckResults.accept):s.StartNextFillingStep(e.EnCheckResults.deny)})}},CBrowser.prototype.Phase3_OverallTestAndWarnings=function(){var e=this.m_FillFormsInWindowCtx,t=e.m_Args,s=this;if(t.m_bClickLinkOnly&&t.m_max_frc!=FillRetCode.FillCodeFieldFilled){if(t.m_bAutoFillWithoutAsking)return void this.StartNextFillingStep(e.EnCheckResults.deny);if(t.m_max_frc==FillRetCode.FillCodeNoMatchingFields&&t.m_bShowPasscardTip)return void r();var i;switch(t.m_max_frc){case FillRetCode.FillCodeNoFormsFound:i=EnCommandType.MsgBoxNoFormsFound;break;case FillRetCode.FillCodeNoMatchingFields:i=EnCommandType.MsgBoxNoMatchingFields;break;case FillRetCode.FillCodeNoDifferentFields:i=EnCommandType.MsgBoxFillTheSameValues;break;case FillRetCode.FillCodeFieldNonEmpty:i=EnCommandType.MsgBoxFillEmptyOnlyOnMessage;break;default:i=EnCommandType.MsgBoxFillerUndefinedProblem}getRF().UICommand(i,!0,this.m_tab_id,[]).then(function(t){t?r():s.StartNextFillingStep(e.EnCheckResults.deny)})}else r();function r(){if(!t.m_bSDK&&t.m_bFromIdentity){var i={},r={},o=!1,n=0;if(forEachOwnProp(t.m_FieldsFilled,function(e,t){var s=t.search(":");s>=0&&(t=t.substr(0,s)),e>1&&"Email"!=t&&"State Or Province"!=t&&"Password"!=t&&"Password Question"!=t&&"Password Answer"!=t&&(!0,i[t]?i[t]++:(i[t]=1,n++)),"Card Number"!=t&&"Card Validation Code"!=t&&"Social Security Number"!=t&&"Bank Account Number"!=t||(o=!0,r[t]?r[t]++:r[t]=1)}),o){var a=[];forEachOwnProp(r,function(e,t){a.push(t)}),getRF().UICommand(EnCommandType.MsgBoxSensitiveFieldsFilled,!0,s.m_tab_id,[JSON.stringify(a)]).then(function(t){t?m():s.StartNextFillingStep(e.EnCheckResults.deny)})}else m()}else s.StartNextFillingStep(e.EnCheckResults.accept);function m(){if(!t.m_bAutoFillWithoutAsking&&t.m_button_coords&&1!=t.m_button_coords.m_nSubmitButtonsFound&&n>=3){var r=[];forEachOwnProp(i,function(e,t){r.push(t)}),getRF().UICommand(EnCommandType.MsgBoxDuplicateFieldsFilled,!0,s.m_tab_id,[JSON.stringify(r)]).then(function(t){t?s.StartNextFillingStep(e.EnCheckResults.accept):s.StartNextFillingStep(e.EnCheckResults.deny)})}else s.StartNextFillingStep(e.EnCheckResults.accept)}}},CBrowser.prototype.Phase4_Submit=function(){var e=this.m_FillFormsInWindowCtx.m_Args;e.m_bShowPasscardTip&&getRF().UICommand(EnCommandType.PasscardTip,void 0,this.m_tab_id,[e.m_path_for_tips]),this.StartNextFillingStep(this.m_FillFormsInWindowCtx.EnCheckResults.accept)};var EnCommandType={Policy_FillingIntoDomainNotInPasscard:0,PhishingWarning_FillingIntoDomainNotInPasscard:1,PhishingWarning_FrameDomainDoesNotMatch:2,MsgBoxSensitiveFieldsFilled:3,MsgBoxDuplicateFieldsFilled:4,MsgBoxNoFormsFound:5,MsgBoxNoMatchingFields:6,MsgBoxFillTheSameValues:7,MsgBoxFillEmptyOnlyOnMessage:8,MsgBoxFillerUndefinedProblem:9,MatchingPasscardChoice:10,IdentityInstancesChoice:11,CustomFieldsConflicts:12,AskPasswordForItem:13,ItemLoadError:14,CommandDisabled:15,PasscardTip:16,SubmitError:17,AutoFillDialog:18,SaveFormsMultipleFrames:19,SavePasscardDialog:20,MsgAutoSaveDisabledByPolicy:21,AutoSave:22,CancelFindFillDialog:23,CancelPasscardTip:24,ResetInactivityTimer:25,ShowOptionsDialog:26,ShowEditorForIdentities:27,ShowEditorForPasscards:28,ShowEditorForSafenotes:29,MsgSaveDisabledByPolicy:30,SettingsMenu:31,PickupObjectBadData:32,TaskbarIcon:33,ShowLoginDialog:34,ShowImportDialog:35,ShowEditorForObject:36,ShowStartPageContextMenu:37,ObjectTypeDisabled:38,SearchCardNoParametersWarning:39,AskForParameters:40,AskPasswordToEncrypt:41,ActivateProVersion:42};function GetDataItemWithUI(e,t,s,i,r,o){return getProxyRfo().RfApiGetDataItem({path:t,type:s,level:i,used:!0,pwd:o}).catch(function(n){var a=n.Code;if(!a||a!=RfErrType.RfErr_AuthRejected&&a!=RfErrType.RfErr_PermissionDenied&&a!=RfErrType.RfErr_NotLoggedIn)throw getRF().UICommand(EnCommandType.ItemLoadError,void 0,e,[RfGetDataItemPathIds(s,!1),RfGetDisplayPathStr(t),n.description]),n;if(!r)throw n;var m={item_path:t,browser_id:e,item_type:s,requested_level:i,bAskPassword:r,pwd:o};return void 0!==o&&(m.sAltPassword=o),getRF().UICommand(EnCommandType.AskPasswordForItem,void 0,e,[JSON.stringify(m)]).then(function(r){if("ok"==r.result)return function r(o){return getProxyRfo().RfApiGetDataItem({path:t,type:s,level:i,pwd:o}).catch(function(i){var n=i.Code;if(!n||n!=RfapiJS.RfErrType.RfErr_AuthRejected&&n!=RfapiJS.RfErrType.RfErr_PermissionDenied&&n!=RfapiJS.RfErrType.RfErr_NotLoggedIn)throw getRF().UICommand(getBG().EnCommandType.ItemLoadError,e,[RfGetDataItemPathIds(s,!1),RfGetDisplayPathStr(t),i.description]),i;return getRF().UICommand(EnCommandType.AskPasswordForItem,void 0,e,[JSON.stringify(m)]).then(function(e){if("ok"==e.result)return r(o);if("cancelled"==e.result)throw"cancelled"})})}(o);if("cancelled"==r.result)throw"cancelled"})})}function CFrame(){this.m_port=void 0,this.m_id=void 0,this.m_is_top=!1,this.m_tab_id=void 0,this.m_url=void 0,this.m_status=void 0,this.m_pBrowser=void 0,this.m_content_loaded=!1,this.m_bRemoved=!1,this.m_bRulesSent=!1,this.m_bDisableStartPage=!1,this.m_pGoFillFillerCachedData=void 0,this.m_pGoFillFillerCachedText="",this.m_is_rf_frame=!1,this.m_chunks=[]}CBrowser.prototype.FillFormsInWindowRfApi=function(e,t,s,i,r,o,n,a,m,l,_,h,d,u){var c=RfIsIdentity(t);getProxyRfo().LogObjectUse("fill",e,this.m_url),getProxyRfo().CancelBrowserTask();var F=this,p=void 0;if(!g_policySet.IsRoboFormEnabledOnUrl(this.m_url))return getRF().UICommand(EnCommandType.CommandDisabled,void 0,F.m_tab_id,[]),Promise.resolve();return(p=this.m_FillFormsInWindowCtx=new CFillFormsInWindowCtx).m_Args={m_sLanguage:void 0,m_pPasscard:void 0,m_pIdentity:void 0,m_bFillNonemptyFields:!1,m_bSubmit:!1,m_bSubmitDone:!1,m_max_frc:FillRetCode.FillCodeNoFormsFound,m_FieldsFilled:{},m_bDecidedToFillAsWin32:!1,m_TestPhase1:{m_sMainFrameURL:"",m_sCurrentFrameURL:"",m_sMatchURL:"",m_bFillingIntoDomainNotInPasscard:!1,m_bPhishing:!1},m_TestPhase2:{m_nFieldsFilled_namenotvalue:0},m_enResult:0,m_bClickLinkOnly:!1,m_bAutoFillWithoutAsking:!1,m_bShowPasscardTip:!1,m_bSDK:!1,m_bFromIdentity:!1,identity_or_passcard_path:"",path_for_tips:"",m_bHighLightFields:!1},p.m_Args.identity_or_passcard_path=e,p.m_Args.m_bClickLinkOnly=!1,p.m_Args.m_bAutoFillWithoutAsking=a,p.m_Args.m_bShowPasscardTip=!1,p.m_Args.m_bSDK=r,p.m_Args.m_bFromIdentity=c,GetDataItemWithUI(F.m_tab_id,e,t,RfapiJS.EnDataPresenceLevel.enExecuteOnly,!0,""!=n?n:void 0).then(function(t){var s=t;if(c)getProxyRfo().ConvertIdentityToFillerFormat(s.data,_,h,e,function(e){p.m_Args.m_pIdentity=e,p.m_Args.m_sLanguage=d||"en-english",p.m_Args.m_bSubmit=m,p.m_Args.m_bFillNonemptyFields=i,p.m_Args.m_bEmptyValuesCauseFilling=!1,p.m_Args.m_bUseEnglishSelectValues=l||!1,p.m_Args.m_bHighLightFields=u||!1;var t=!g_sFillerRulesJSON;getRF().GetFillerRulesJSON(!0,!1,void 0,function(e,s,i){if(t){var r=JSON.parse(e);RFB_COUNTRIES=r.RFB_COUNTRIES,RFB_OPTIONS=r.RFB_OPTIONS,RFB_FIELDS=r.RFB_FIELDS,RFB_RULES=r.RFB_RULES}for(var o=new CIdentity(p.m_Args.m_pIdentity.m_mOptionValues),n=0;n<p.m_Args.m_pIdentity.m_lGroups.length;++n)for(var a=p.m_Args.m_pIdentity.m_lGroups[n],m="custom"==a.m_sType.toLowerCase(),l=0;l<a.m_lFields.length;++l){var _=a.m_lFields[l];m?o.AddCustomFieldValue(_.m_sName,_.m_sMatches,_.m_sValue,!0):o.AddStandardFieldValue(_.m_sName,_.m_sValue,a.m_sName,a.m_sType)}o.m_bLoaded=!0;for(var h=o.getFields(),d=(h.GetCustomValuesCount(),!1),u={},c=0;c<h.GetCustomValuesCount();c++){var g=h.GetCustomField(c).GetFieldFormat(),f=g.GetMainMatchString();if(f.m_sdString.GetWhole()){var C=o.CustomHasNoConflicts(f);C&&(u[f.m_sdString.GetWhole()]=C,d=!0);for(var v=0;v<g.GetMatchesList().length;v++){var S=g.GetMatchesList()[v];(C=o.CustomHasNoConflicts(S))&&(u[f.m_sdString.GetWhole()]=C,d=!0)}}}d?getRF().UICommand(EnCommandType.CustomFieldsConflicts,!0,F.m_tab_id,[JSON.stringify(u)]).then(function(e){F.FillFormsInWindow_Start(JSON.stringify(p.m_Args))}):F.FillFormsInWindow_Start(JSON.stringify(p.m_Args))})});else{p.m_Args.m_bUseEnglishSelectValues=!0;var r=s.data,o=new CPasscard;o.m_lFields=r.m_lFields,p.m_Args.m_pPasscard=r,p.m_Args.m_bShowPasscardTip=o.HasLoginTip(),p.m_Args.path_for_tips=e,(p.m_Args.m_bShowPasscardTip||o.HasAnyValueHere())&&(m=!1);var n={};o.GetButtonToClick(n),p.m_Args.m_bClickLinkOnly=n.button_to_click.m_bNavOnlyLink,p.m_Args.m_bSubmit=m,p.m_Args.m_bFillNonemptyFields=i,p.m_Args.m_bHighLightFields=u||!1,p.m_Args.m_bEmptyValuesCauseFilling=!1,p.m_Args.m_bFillFirstPasswordFieldOnly=!1,F.FillFormsInWindow_Start(JSON.stringify(p.m_Args))}})},CFrame.prototype.attach=function(e,t,s,i,r,o,n){if(this.detach(),this.m_id=e,this.m_port=s,this.m_is_top=r,this.m_tab_id=t,this.m_url=o,this.m_status=n,this.m_pBrowser=i,this.m_bRemoved=!1,this.m_bRulesSent=!1,this.m_bDisableStartPage=!1,s){var a=this;s.onDisconnect.addListener(m),s.onMessage.addListener(l),this._RemoveListeners=function(){delete this._RemoveListeners,s.onDisconnect.removeListener(m),r||s.onMessage.removeListener(l)}}function m(){a.OnDisconnect()}function l(e){a.OnMessage(e)}},CFrame.prototype.detach=function(){"function"==typeof this._RemoveListeners&&this._RemoveListeners(),this.m_port=void 0},CFrame.prototype.OnDisconnect=function(){try{this.m_tab_id,this.m_id,this.detach(),this.m_bRulesSent=!1,this.m_content_loaded=!1,this.m_pBrowser.removeFrame(this.m_id,!1),(g_issafari||g_isedge)&&this.m_is_top&&this.m_pBrowser.removeAllFrames(!1)}catch(e){log("OnDisconnect",e),OnError(kInternalError,e)}},CFrame.prototype.Navigate=function(e,t){this.m_pBrowser.Navigate(e,t)},CFrame.prototype.FillFormsInFrame=function(e){try{var t=ParseJSON(e),s={name:"FillFormsInFrame",data:t};if(t.m_pIdentity){var i=!this.m_bRulesSent,r=t.m_sLanguage&&this.m_sLanguage!=t.m_sLanguage,o=this;getRF().GetFillerRulesJSON(i,r,t.m_sLanguage,function(e,n,a){i&&(s.rules=e,o.m_bRulesSent=!0,o.m_id),r&&(s.strings=n,o.m_sLanguage=t.m_sLanguage),o.postMessageToCS(s)})}else this.postMessageToCS(s);return!0}catch(e){return log("FillFormsInFrame",e),OnError(kInternalError,e),!1}},CFrame.prototype.FillFormsInWindow=function(e){this.m_pBrowser?this.m_pBrowser.FillFormsInWindow_Start(e):log("CFrame::FillFormsInWindow : no browser.")};var g_sFillerLocalizationJSON=void 0,g_sLanguage=void 0,g_sFillerRulesJSON=void 0;function CEnumFrames(){this.m_enum=new CEnum,this.init()}CFrame.prototype.GoFill0=function(){return this.postMessageToCS({name:"GoFill0"}),!0},CFrame.prototype.GoFill1=function(e){try{return this.m_pGoFillFillerCachedData&&this.m_pGoFillFillerCachedText&&this.m_pGoFillFillerCachedText==e||(this.m_pGoFillFillerCachedData=void 0,this.m_pGoFillFillerCachedData=JSON.parse(e),this.m_pGoFillFillerCachedText=e),this.postMessageToCS({name:"GoFill1",data:this.m_pGoFillFillerCachedData}),!0}catch(e){return log("GoFill1",e),OnError(kInternalError,e),!1}},CFrame.prototype.GoFill2=function(e){try{return this.m_pGoFillFillerCachedData&&this.m_pGoFillFillerCachedText&&this.m_pGoFillFillerCachedText==e||(this.m_pGoFillFillerCachedData=void 0,this.m_pGoFillFillerCachedData=JSON.parse(e),this.m_pGoFillFillerCachedText=e),this.postMessageToCS({name:"GoFill2",data:this.m_pGoFillFillerCachedData}),!0}catch(e){return log("GoFill2",e),OnError(kInternalError,e),!1}},CFrame.prototype.AutoFill=function(e){this.postMessageToCS({name:"AutoFill"})},CFrame.prototype.FillRfVer=function(e){try{var t=JSON.parse(e);return this.postMessageToCS({name:"FillRfVer",data:t}),!0}catch(e){return log("FillRfVer",e),!1}},CFrame.prototype.FillSubmit=function(e){this.m_pBrowser.FillSubmit(e)},CFrame.prototype.SaveFormsInWindow=function(){this.m_pBrowser.SaveFormsInWindow()},CFrame.prototype.SaveNextUnsavedFrame=function(){this.m_pBrowser.SaveNextUnsavedFrame()},CFrame.prototype.ActivateTesterMode=function(){g_roboform.g_ActivateTesterMode=!0},CFrame.prototype.ClearFields=function(){this.m_pBrowser.ClearFields()},CFrame.prototype.SetFields=function(e){this.m_pBrowser.SetFields(e)},CFrame.prototype.ResetFields=function(){this.m_pBrowser.ResetFields()},CFrame.prototype.isConnected=function(){return!!this.m_port},CFrame.prototype.SkipInEnumerator=function(){return!this.isConnected()||(!!this.m_is_rf_frame||(!(this.m_is_top||!IsSocialPlugin(this.m_url))||!(!g_isedge&&!g_issafari||this.m_is_top||this.m_content_loaded)))},CFrame.prototype.postMessageToCS=function(e){if(!this.isConnected())return!1;this.m_id,JSON.stringify(e);try{this.m_port.postMessage(e)}catch(e){return log("postMessageToCS",e),!1}return!0},CFrame.prototype.CallStartPage=function(e){this.m_bDisableStartPage||this.postMessageToCS({name:"CallStartPage",data:e})},CFrame.prototype.OnUpdateMatchBar=function(e){this.m_pBrowser.OnUpdateMatchBar(e)},CEnumFrames.prototype.init=function(){this.m_pBrowser=void 0,this.m_ctx=void 0,this.m_frame_msg=void 0,this.m_OnFrame=void 0,this.m_end_msg=void 0,this.m_OnEnd=void 0,this.m_window=void 0,this.m_final_timeout=void 0,this.m_enum.stop()},CEnumFrames.prototype.start=function(e){if(this.m_pBrowser=e.browser,this.m_ctx=e.ctx,this.m_OnFrame=e.frame_func,this.m_frame_msg=e.frame_msg,this.m_end_msg=e.end_msg,this.m_OnEnd=e.end_func,e.frame_ids){var t=[];for(var s in e.frame_ids)t.push(this.m_pBrowser.m_frames[e.frame_ids[s]]);this.m_enum.start(t)}else this.m_enum.start(this.m_pBrowser.m_frames)},CEnumFrames.prototype.stop=function(){this.m_final_timeout&&ClearTimeout(this.m_final_timeout,this.m_window),this.init()},CEnumFrames.prototype.next=function(e){var t=this.m_enum.next(function(e){return!e.SkipInEnumerator()});if(t){this.m_frame_msg,t.m_id;var s=!0;return this.m_OnFrame&&(s=this.m_OnFrame(t)),this.m_frame_msg&&s&&t.postMessageToCS({name:this.m_frame_msg,frame_id:t.m_id,context:this.m_ctx,data:e}),!0}if(this.m_OnEnd&&this.m_OnEnd(),this.m_end_msg){var i=this.m_end_msg,r=this.m_pBrowser.m_tab_id,o=this.m_pBrowser.m_main_frame_id,n=JSON.stringify(this.m_ctx);this.m_window=window;var a=this;this.m_final_timeout=SetTimeout(function(){a.ProcessEndMessage(r,o,i,n),a.stop()},1)}else this.stop();return!1};var m_popup_vars={};function ProcessMessageFromPopup(e,t){var i=void 0;if("args"in e){var r=e.args_type;i="string"==r?e.args:JSON.parse(e.args)}switch(e.name){case"alert":return void alert(s);case"getPopupStartSettings":return void t({"need-repair":g_need_repair,"first-start":g_first_start,"is-nm-starting":g_is_nm_starting,"is-sa-starting":g_is_sa_starting,"rf-api":getProxyRfo().IsRfApi()});case"updateExtensionMode":return g_is_nm=i["is-nm"],g_is_sa=i["is-sa"],PutSetting("internal","is-nm",g_is_nm),void PutSetting("internal","is-sa",g_is_sa);case"initUI":return void g_roboform.g_proxy.initUI();case"getProp":return g_roboform.g_proxy.getProp(i,function(e){t(e)}),!0;case"SetChromeV8Style":return g_roboform.g_proxy.SetChromeV8Style(function(){t()}),!0;case"updateNativeToolbar":return void g_roboform.g_proxy.updateNativeToolbar.apply(g_roboform.g_proxy,i);case"setCurrentBrowser":return void g_roboform.g_proxy.setCurrentBrowser(i);case"onUIEvent":return void g_roboform.g_proxy.onUIEvent.apply(g_roboform.g_proxy,[i]);case"ensureUptodate":return g_roboform.g_proxy.ensureUptodate(function(e){t(e)}),!0;case"setUIItemsInfo":return void g_roboform.g_proxy.setUIItemsInfo.apply(g_roboform.g_proxy,i);case"setPopupActive":return void(g_roboform.g_popup_active=i);case"closePopupToolbar":return void g_roboform.ClosePopupToolbar();case"getRfVersion":return void t(g_roboform.g_rf_version);case"FillFormsInWindowRfApi":return GetSelectedTab(null,function(e){if(e&&e.id){var s=g_roboform.FindTabBrowser(e.id);s&&s.FillFormsInWindowRfApi.apply(s,i).then(function(e){t()})}}),!0;case"OpenStartPage":return OpenRoboFormURL(RF_ROBOFORM_STARTPAGE_URL),void g_roboform.ClosePopupToolbar();case"PutVar":i.name&&(m_popup_vars[i.name]=i.value);break;case"GetVar":i.name&&t(m_popup_vars[i.name]),t();break;case"GetOption":for(var o=[],n=0;n<i.length;n++)o.push(getProxyRfo().GetOption(i[n].section,i[n].name,i[n].default_value));return Promise.all(o).then(function(e){t(e)}),!0;case"CheckUptodate":return i.update_status?(getProxyRfo().RfApiUpdateStatus().then(function(){t(getProxyRfo().checkUptodate(i.generation))}),!0):void t(getProxyRfo().checkUptodate(i.generation));case"GetMatchingData":return Promise.all([getProxyRfo().GetMatchingItems(),getProxyRfo().GetIdentitiesList(),getProxyRfo().RfApiGetUsageInfo({list:EnUsageInfoList.usiRecentlyUsedList,type:EnRfDataItemType.RfItemType_Login})]).then(function(e){t(e)}).catch(function(e){}),!0;case"GetServiceStatus":return void t(g_roboform.g_service_status);case"onActionButtonClick":return void("normal"!=g_roboform.g_service_status&&g_roboform.g_proxy.onActionButtonClick());default:return void JSON.stringify(e)}}var g_uniq_num_gen=1;function GetUniqueNum(){return g_uniq_num_gen++}var OnError=function(e,t,s){var i=e;t&&(i+="\n\nError: "+t),s&&null!=typeof alert&&alert(i),NotLoaded()};function logStringMessage(e,t){}
//# sourceMappingURL=background.js.map