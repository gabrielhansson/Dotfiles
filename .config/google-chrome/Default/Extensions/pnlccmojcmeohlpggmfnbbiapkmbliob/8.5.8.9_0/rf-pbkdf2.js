// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
var RfapiJS=RfapiJS||{};(function(){var t=RfapiJS.traceJS,e=(RfapiJS.SibErrType,RfapiJS.traceLevel),s=(RfapiJS.RfErrType,RfapiJS.utils),r={"SHA-1":1,"SHA-256":2,"SHA-512":3};function i(t,e,s,i){this.BlockSize=0,this.BlockIndex=1,this.BufferBytes=null,this.BufferStartIndex=0,this.BufferEndIndex=0,this.algorithm=t,this.salt=e,this.iterationCount=i,this.BlockSize=this.algorithm==r["SHA-256"]?32:64,this.BufferBytes=new Array(this.BlockSize),this.password=s}i.prototype.GetBytes=function(t,e,r,i){var o=new Array(t),a=0,f=this.BufferEndIndex-this.BufferStartIndex;if(f>0){if(t<f)return s.BlockCopy(this.BufferBytes,this.BufferStartIndex,o,0,t),this.BufferStartIndex+=t,void 0!==e&&e(100,o,r,i),o;s.BlockCopy(this.BufferBytes,this.BufferStartIndex,o,0,f),this.BufferStartIndex=this.BufferEndIndex=0,a+=f}for(;a<t;){var n=t-a;if(this.BufferBytes=this.Func(e),!(n>this.BlockSize))return s.BlockCopy(this.BufferBytes,0,o,a,n),this.BufferStartIndex=n,this.BufferEndIndex=this.BlockSize,void 0!==e&&e(100,o,r,i),o;s.BlockCopy(this.BufferBytes,0,o,a,this.BlockSize),a+=this.BlockSize}return o},i.prototype.GetBytesFromInt=function(t){var e=new Array(4);e[0]=t,e[1]=0,e[2]=0,e[3]=0;var s=new Array(4);return s[0]=e[3],s[1]=e[2],s[2]=e[1],s[3]=e[0],s},i.prototype.Func=function(i){t("Pbkdf2.prototype.Func ->","rf-pbkdf2.js",e.INFO);var o=(new Date).getTime(),a=new Array(this.salt.length+4);s.BlockCopy(this.salt,0,a,0,this.salt.length),s.BlockCopy(this.GetBytesFromInt(this.BlockIndex),0,a,this.salt.length,4);var f=void 0;if(this.algorithm==r["SHA-256"]){var n=sjcl.codec.utf8String.toBits(this.password),h=new sjcl.misc.hmac(n,sjcl.hash.sha256);f=sjcl.codec.bytes.fromBits(h.encrypt(sjcl.codec.bytes.toBits(a)))}else f=this.GetHmacHasFromByteArray(a);for(var c,B=f,y=2;y<=this.iterationCount;y++){c=f.slice(0,f.length),f=this.algorithm==r["SHA-256"]?sjcl.codec.bytes.fromBits(h.encrypt(sjcl.codec.bytes.toBits(c))):s.base64ToBytes(CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA512(CryptoJS.enc.Base64.parse(s.bytesToBase64(c)),this.password)));for(var p=0;p<this.BlockSize;p++)B[p]=B[p]^f[p]}this.BlockIndex+=1;var l=(new Date).getTime();return t("Pbkdf2.prototype.Func <- TIME="+(l-o),"rf-pbkdf2.js",e.INFO),B},i.prototype.GetHmacHasFromByteArray=function(t){var e=s.bytesToBase64(t),i=CryptoJS.enc.Base64.parse(e),o=this.algorithm==r["SHA-256"]?CryptoJS.HmacSHA256(i,this.password):CryptoJS.HmacSHA512(i,this.password),a=CryptoJS.enc.Base64.stringify(o);return s.base64ToBytes(a)},RfapiJS.Pbkdf2=i}).apply(RfapiJS);
//# sourceMappingURL=rf-pbkdf2.js.map