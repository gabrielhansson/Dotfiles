// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
var g_popup,g_bg_connector;function OnLoad(){InitStorageAsync(function(){(g_bg_connector=new PopupToBGConnector).getPopupStartSettings(function t(e){var o=e["first-start"],n=e["need-repair"],i=e["is-nm-starting"],r=e["is-sa-starting"],s=e["rf-api"];if(g_is_win||g_is_mac){var a=$("start_sa_link"),c=$("download_button"),p=$("start_nm_button");function l(){function t(t){g_issafari&&getProxyRfo().OpenPage({url:GetSetting("internal","active-server")+"/site/signup?safari-initialize",bNewWindow:!0,bActivateIfExists:!1}),getBG().StartupStandalone(OnStartup),t.preventDefault()}$("proxy_waitinit_div").style.display="none",$("setup_welcome").innerHTML=localeString("Setup_Welcome_HeaderTitle"),$("setup_notification_div").style.display="block",p.style.display="none",a.addEventListener("click",t),c.style.display="inline-block",a.style.display=g_isedge?"none":"inline-block",c.value=g_isedge?"OK":"Install now",g_isedge?c.addEventListener("click",t):c.addEventListener("click",function(){getBG().OpenRoboFormURL(RoboFormDownloadPageUrl),g_ismaxthon?window.external.mxGetRuntime().getActionByName("rfpanel").hide():setTimeout(function(){window.close()},500)}),AdjustPopupSize()}if($("proxy_waitinit_div").style.display="block",r&&o)return $("setup_description").innerHTML=g_isedge?localeString("SA_Edge_Setup_Description_First"):localeString("SA_Setup_Description_First"),void l();if(r&&n)return $("setup_description").innerHTML=localeString("SA_Setup_Description_Repair"),void l();if(!i&&!r)return void window.setTimeout(function(){g_bg_connector.getPopupStartSettings(t)},1e3)}else if(r&&o)return void getBG().StartupStandalone(OnStartup);g_bg_connector.updateExtensionMode(i,r),OnStartup(i,r,o,s)})})}function OnUnload(){g_popup&&g_popup.OnUnload(),g_bg_connector=void 0}function OnBlur(){g_popup&&g_popup.OnBlur()}function OnStartup(t,e,o,n){if($("setup_notification_div").style.display="none",$("proxy_waitinit_div").style.display="none",t)n?g_popup=new PopupNM:($("toolbar").style.display="block",g_popup=new PopupNMOld);else{if(!e)return;g_popup=new PopupStandalone}RemoveCssFile("setup.css"),g_popup.OnLoad(o)}function AdjustPopupSize(){if(g_issafari){if(document.hidden)return;if(g_issafari_appext){var t=Array.from(document.body.children).filter(function(t){return t.getClientRects().length}).map(function(t){return Array.from(t.children).filter(function(t){return t.getClientRects().length})}).reduce(function(t,e){return t.concat(e)},[]).map(function(t){return t.getBoundingClientRect()}),e=t.reduce(function(t,e){return Math.max(t,e.right)},0),o=t.reduce(function(t,e){return Math.max(t,e.bottom)},0);window.webkit.messageHandlers.rfproxy.postMessage({name:"safari_popup_size",width:e,height:o})}else{var n=document.documentElement.scrollWidth-window.innerWidth,i=document.documentElement.scrollHeight-window.innerHeight;if(n<0&&(n=0),i<0&&(i=0),n>0||i>0){var r=safari.extension.popovers.filter(function(t){return t.contentWindow==window})[0];r&&(r.width+=n,r.height+=i)}}}}window.addEventListener("load",OnLoad,!1),window.addEventListener("unload",OnUnload,!1),window.addEventListener("blur",OnBlur,!1),g_issafari&&document.addEventListener("visibilitychange",function(){if(document.hidden){var t=safari.extension.popovers.filter(function(t){return t.contentWindow==window})[0];t&&t.hide()}},!1),g_is_mac&&(g_issafari_appext||g_ischrome)&&document.addEventListener("keyup",function(t){"Escape"==t.key&&getRF().ClosePopupToolbar()},!1);var PopupBase=function(){function t(){this.g_is_V8=!1,this.g_time_stamp=void 0,this.g_clientToScreenOffsetX=void 0,this.g_clientToScreenOffsetY=void 0,this.EnRoboFormUIItemFlags={Normal:0,Hidden:1,Disabled:2,Bold:256},this.g_ui_nodes=[],this.g_match_node=void 0,this.kSearchBoxEvents=["mousedown","mouseup","mousewheel","keyup","keydown","keypress","blur"],this.g_search_box_id=void 0,this.g_timer_UpdateSearchList=void 0,this.kMinidialogButtonMouseEvents=["mousedown","mouseup"],this.kBodyHorizPadding=16,this.m_templates={},this.m_navigator=new Navigator(this.GetDefaultContainer());this.m_navigator.OnNavigate=function(){AdjustPopupSize()},this.m_tab_id=void 0,this.g_rf_version=void 0}t.prototype.OnLoad=function(){},t.prototype.OnUnload=function(){},t.prototype.OnBlur=function(){},t.prototype.GetDefaultContainer=function(){var t=$("mainscreen");return t.style.display="block",t},t.prototype.AppendItemsView=function(t,e){if(e)for(var o=0;o<t.length;o++)e.appendChild(t[o])},t.prototype.BuildItemsView=function(t,e){for(var o=[],n=0;n<t.length;n++)o.push(this.CreateUIItem(t[n],e));return o},t.prototype.CreateItemsView=function(t,e){for(var o=this.GetDefaultContainer(),n=0;n<t.length;n++){var i,r=t[n],s=r.m_sName,a=s&&$(s)||o;if(a)this.g_is_V8&&"match"==s&&(i=this.CreateMatchTitle(),this.g_ui_nodes.push(i),a.appendChild(i)),i=this.CreateUIItem(r,e),a.appendChild(i),"match"==s?this.g_match_node=i:this.g_ui_nodes.push(i)}},t.prototype.UpdateUI=function(){this.CleanupUIElements(),this.g_is_V8&&(AddClass(document.body,"body-V8"),AddClass($("toolbar"),"toolbar-V8")),document.documentElement.style.width="",RemoveClass($("ui-items"),"nowrap wrap");var t=$("layout");this.g_is_V8?t&&(t.style.display="none"):(t&&(t.style.visibility="visible"),this.SetHorizontalLayout(GetSetting("nm-settings","horizontal")))},t.prototype.EnsureUptodate=function(t){t(!1)},t.prototype.SetHorizontalLayout=function(t){var e=$("ui-items");e&&(t?ReplaceClass(e,"vlayout wrap","hlayout nowrap"):ReplaceClass(e,"hlayout nowrap","vlayout"));var o=$("layout");o&&(t?ReplaceClass(o,"vertical","horizontal"):ReplaceClass(o,"horizontal","vertical"))},t.prototype.GetButtonType=function(t){if(GetSetting("nm-settings","horizontal"))switch(t){case"0":t="1"}return t},t.prototype.CleanupUIElements=function(){this.g_ui_nodes.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}),this.g_match_node&&this.g_match_node.parentNode&&this.g_match_node.parentNode.removeChild(this.g_match_node),this.g_match_node=void 0,this.g_ui_nodes=[]},t.prototype.CheckOverflow=function(){if(!this.g_is_V8&&GetSetting("nm-settings","horizontal")){if(document.body.clientWidth+this.kBodyHorizPadding<document.body.scrollWidth){var t,e=document.body.getElementsByClassName("separator");for(t=0;t<e.length;t++){var o=e[t];this.getElementPos(o);if(o.className="hseparator",document.body.clientWidth+this.kBodyHorizPadding>=document.body.scrollWidth)break}}document.body.clientWidth+this.kBodyHorizPadding<document.body.scrollWidth&&ReplaceClass($("ui-items"),"nowrap","wrap")}},t.prototype.GetContext=function(t){return t.m_oContext},t.prototype.GetItemInfo=function(t){return t.m_oItemInfo},t.prototype.CreateUIItem=function(t,e){switch(t.m_sType){case"header-title":return this.CreateTitle();case"header-item-title":return this.CreateItemTitle(t.m_oContext);case"header-simple-title":return this.CreateSimpleTitle(t.m_oContext);case"header-list-title":return this.CreateListTitle(t.m_oContext);case"search":return this.CreateSearchBox(t);case"separator":return this.createElement("div",{class:this.g_is_V8?"separator-V8":"separator"});case"notification-footer":return this.CreateNotificationFooter();case"active-items-actions":return this.CreateActiveItemsWrapper(t);case"dialog":return this.GetTemplate(t.m_nID);case"folder-navigation":return this.CreateFolderNavigationBar(t);case"inline-buttons-wrapper":return this.CreateInlineButtonsWrapper();case"button":case"inline-button":case"menu":case"match":default:return this.CreateButton(t,e)}},t.prototype.CreateInlineButtonsRows=function(t){for(var e=[],o=[],n=0;n<t.length;){0===n%2&&o.length>0&&(e.push(this.createElement("tr",{class:"inline-buttons-wrapper-row"},o)),o=[]),o.push(this.createElement("td",{class:"inline-buttons-wrapper-col"},[t[n]])),n++}return o.length>0&&e.push(this.createElement("tr",{class:"inline-buttons-wrapper-row"},o)),e},t.prototype.CreateButton=function(t,e){var o,n,i,r=this.GetContext(t),s=this.GetItemInfo(t),a=t.m_sType,c=t.m_nID,p=t.m_sName,l=t.m_sIconData,d=t.m_sSuffix;o=this.createElement("div",{class:this.g_is_V8?"toolbar-button-V8 toolbar-button-V8-hover":"toolbar-button",id:c,name:p},[n=this.createElement("div",{class:"toolbar-button-content nowrap"})]),l&&n.appendChild(this.createElement("img",{class:"toolbar-button-icon item-icon",src:l}));var h=!1;switch(p){case"match":case"identity":case"turn-on":case"login":h=!0,i=t.m_sText||t.m_sLabel;break;default:(this.g_is_V8||"1"!=e)&&(i=t.m_sText||t.m_sLabel)}this.g_is_V8&&"match"==p&&(i&&""!=i||(o.style.display="none"));var u,f,g=t.m_nFlags||0;if(i){if(u=this.g_is_V8?"toolbar-button-text-V8":"toolbar-button-text",this.g_is_V8||h||(u+=" item-text"),f=this.createElement("div",{class:u},[this.createTextNode(i)]),0!=(g&this.EnRoboFormUIItemFlags.Bold)&&AddClass(f,"bold-text"),!this.g_is_V8){var _=t.m_nMaxWidth;_&&(f.style.maxWidth=_+"px")}n.appendChild(f)}if(d&&n.appendChild(this.createElement("div",{class:this.g_is_V8?"toolbar-button-suffix-V8":"toolbar-button-text"},[this.createTextNode(d)])),this.g_is_V8)if("menu"===a)n.parentElement.appendChild(this.createElement("div",{class:"toolbar-button-menu-icon-V8 toolbar-button-icon"}));else if("inline-button"===a)AddClass(o,"inline-buttons-wrapper-row");else switch(p){case"match":this.OnMatch(n,o,t);break;case"identity":this.OnIdMatch(n,o,t)}if(this.g_is_V8||"menu"==a&&n.appendChild(this.createElement("img",{class:"toolbar-button-menu-icon",src:"arrow.png"})),"1"==e&&(!i&&!h||s)){var m=t.m_sTooltip;m&&(o.title=m)}if(c&&0==(g&this.EnRoboFormUIItemFlags.Disabled)){var v=this;this.kMouseEvents.forEach(function(t){o.addEventListener(t,function(t){v.OnUIEvent(t)},!1)})}return r&&o.setAttribute("context",JSON.stringify(r)),s&&o.setAttribute("item_info",JSON.stringify(s)),o},t.prototype.CreateSearchBox=function(t){var e,o,n=t.m_nID,i=t.m_nMaxWidth;this.g_search_box_id=n;var r={};r.class=this.g_is_V8?"toolbar-search-V8":"toolbar-search",r.id="div_"+n;var s=this;this.g_is_V8?(o=this.createElement("div",r),e=this.createElement("div",{class:"toolbar-search-pane-V8",id:"search_pane"}),o.appendChild(e)):o=this.createElement("div",r,[e=this.createElement("div",{class:"toolbar-button-content"})]);var a=e.appendChild(this.createElement("input",{class:this.g_is_V8?"toolbar-search-edit-V8":"toolbar-search-edit",id:n,type:"search",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}));if(this.SetupSearchPlaceholder(a),this.SetupAutoFocus(a),this.g_is_V8){var c="rgb(246, 246, 246)";if(g_popup&&g_popup.getBlurBorderColor){var p=g_popup.getBlurBorderColor();p&&(c=p)}a.addEventListener("focus",function(){e.style.borderColor="rgb(48, 125, 251)"},!1),a.addEventListener("blur",function(){e.style.borderColor=c},!1);var l,d=t.m_sIconData;if(d)e.appendChild(l=this.createElement("img",{class:"toolbar-search-icon-V8 toolbar-button-icon item-icon",id:"search_icon_id",src:d})),a.addEventListener("input",function(){""===a.value?l.style.display="inline":l.style.display="none"},!1);i+=32}return i&&(this.g_is_V8?a.style.minWidth=i+"px":a.style.width=i+"px"),this.kSearchBoxEvents.forEach(function(t){a.addEventListener(t,function(t){s.OnUIEvent(t)},!1)}),a.addEventListener("input",function(){""===a.value&&s.ScheduleUpdateSearchList(!1)},!1),this.AddSearchListeners(a),o},t.prototype.AddUIItem=function(t,e,o){var n,i,r,s=t.m_sName,a=!1;if(!o||s&&$(s)){var c=this.GetDefaultContainer();n=s&&$(s)||c}else a=!0,n=o.parentNode;n&&(i=o&&this.g_ui_nodes.indexOf(o)>=0?this.g_ui_nodes.indexOf(o):this.g_ui_nodes.length,this.g_is_V8&&"match"==s&&(r=this.CreateMatchTitle(),a?n.insertBefore(r,o):n.appendChild(r),this.g_ui_nodes.splice(i,0,r),i++),r=this.CreateUIItem(t,e),a?n.insertBefore(r,o):n.appendChild(r),"match"==s?this.g_match_node=r:(a?n.insertBefore(r,o):n.appendChild(r),this.g_ui_nodes.splice(i,0,r)))},t.prototype.UpdateUIItem=function(t,e,o){var n;if("match"==t.m_sName)n=this.CreateUIItem(t,e),o.parentNode.replaceChild(n,o),this.g_match_node=n;else{var i=this.g_ui_nodes.indexOf(o);if(i<0)return;n=this.CreateUIItem(t,e),o.parentNode.replaceChild(n,o),this.g_ui_nodes[i]=n}},t.prototype.RemoveUIItem=function(t,e){if("match"==t.m_sName){if(this.g_match_node=void 0,this.g_is_V8){var o=$("match-title");if(o)(n=this.g_ui_nodes.indexOf(o))>=0&&this.g_ui_nodes.splice(n,1),o.parentNode.removeChild(o)}}else{var n;if((n=this.g_ui_nodes.indexOf(e))<0)return;this.g_ui_nodes.splice(n,1)}e.parentNode.removeChild(e)},t.prototype.OnUIEvent=function(t){var e=t.currentTarget.id,o=t.type,n="key"==o.substring(0,3);if(n)switch(t.keyCode){case VK_MENU:case VK_SHIFT:case VK_CONTROL:return}var i,r=t.key;if(n){if(!r){if(!t.charCode)switch(t.keyCode){case VK_ESCAPE:r="Esc";break;case VK_RETURN:r="Enter";break;case VK_UP:r="Up";break;case VK_DOWN:r="Down";break;case VK_PRIOR:r="PageUp";break;case VK_NEXT:r="PageDown";break;case VK_TAB:r="Tab";break;case VK_SHIFT:r="Shift";break;case VK_CONTROL:r="Control";break;case VK_MENU:r="Alt";break;default:t.keyCode>=VK_F1&&t.keyCode<=VK_F24&&(r="F"+(t.keyCode-VK_F1+1))}r||(r="Unidentified")}var s=!1;t.keyCode>=VK_F1&&t.keyCode<=VK_F24&&(s=!0)}if(o&&"mousemove"!=o&&"mouseout"!=o&&"mouseover"!=o&&"mouseleave"!=o&&"mouseenter"!=o&&(t.id,t.keyCode),e==this.g_search_box_id){var a=this.GetSearchEditBox();if(!a)return;switch(o){case"keydown":switch(r){case"Up":case"ArrowUp":case"Down":case"ArrowDown":case"PageUp":case"PageDown":o="keyup",t.preventDefault(),t.stopPropagation();break;case"Escape":if(!g_is_mac){var c=this,p=a.value;return void this.IsSearchListVisible(function(t){if(t)c.ScheduleUpdateSearchList(!1);else{if(!p)return void c.OnSearchBarEscape();a.value=""}})}break;default:return}break;case"keypress":switch(r){case"Up":case"ArrowUp":case"Down":case"ArrowDown":case"PageUp":case"PageDown":return t.preventDefault(),void t.stopPropagation()}return;case"keyup":switch(r){case"Enter":this.OnSearchBarEnter(a),t.preventDefault(),t.stopPropagation();break;case"Up":case"ArrowUp":case"Down":case"ArrowDown":case"PageUp":case"PageDown":return t.preventDefault(),void t.stopPropagation();case"Shift":case"Alt":case"Control":case"Tab":case"Escape":return;default:if(s){a.blur();break}return void this.ScheduleUpdateSearchList(!0,100)}break;case"mousedown":return this.OnSearchBarMouseDown(),void t.stopPropagation();case"mouseup":return void t.stopPropagation();case"mousewheel":return t.stopPropagation(),void t.preventDefault();case"blur":return void this.OnSearchBarBlur()}}i=e==this.g_search_box_id?this.GetSearchBoxRect():this.getElementRect(t.currentTarget);var l,d=this.getElementRect(document.body),h=this.makeScreenRect(d);n?l={id:e,type:o,key:r,char:t.char}:"mouse"==o.substring(0,5)?(!0,l={id:e,type:o,timeStamp:t.timeStamp,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,button:t.button,wheelDelta:t.wheelDelta}):l="search"==o?{id:e,type:o,value:t.currentTarget.value}:{id:e,type:o},l.item_rect=i,l.toolbar_rect=d,l.toolbar_screen_rect=h,this.PostUIEvent(l,o),"mouseup"!=o&&"mousedown"!=o||t.currentTarget.id==this.g_search_box_id||t.stopPropagation()},t.prototype.GetSearchEditBox=function(){return $(this.g_search_box_id)},t.prototype.GetSearchBoxRect=function(){var t;if(this.g_is_V8){if(t=$("search_pane")){var e=this.getElementRect(t);return e.bottom-=2,e.top+=2,e}}else if(t=this.GetSearchEditBox())return this.getElementRect(t)},t.prototype.ScheduleUpdateSearchList=function(t,e){if(this.CancelUpdateSearchList(),e){var o=this;this.g_timer_UpdateSearchList=window.setTimeout(function(){o.ShowSearchList(t)},e)}else this.ShowSearchList(t)},t.prototype.CancelUpdateSearchList=function(){this.g_timer_UpdateSearchList&&(window.clearTimeout(this.g_timer_UpdateSearchList),this.g_timer_UpdateSearchList=void 0)},t.prototype.ShowSearchList=function(t){t?this.UpdateSearchList():this.HideSearchList()},t.prototype.UpdateSelectionSearch=function(){var t=this;this.IsSearchListVisible(function(e){e||t.ScheduleUpdateSearchList(!0)})},t.prototype.makeRect=function(t){return{left:t.left,top:t.top,right:t.right,bottom:t.bottom}},t.prototype.makeScreenRect=function(t){if(g_is_mac&&(void 0===this.g_clientToScreenOffsetX||void 0===this.g_clientToScreenOffsetY))if(g_isfirefox)this.g_clientToScreenOffsetX=screenX+window.outerWidth-window.innerWidth-33,this.g_clientToScreenOffsetY=screenY+70;else if(g_issafari_appext){var e=getBG().g_popup_window_data;this.g_clientToScreenOffsetX=e.screenLeft,this.g_clientToScreenOffsetY=e.screenTop}else this.g_clientToScreenOffsetX=window.screenLeft+1,window.outerHeight<=2?this.g_clientToScreenOffsetY=window.screenTop-1:this.g_clientToScreenOffsetY=window.screenTop+window.outerHeight-window.innerHeight-1;return void 0===this.g_clientToScreenOffsetX||void 0===this.g_clientToScreenOffsetY?g_isfirefox?{left:document.body.scrollWidth+8,top:document.body.scrollHeight+6,right:document.body.scrollWidth+8,bottom:document.body.scrollHeight+6}:{left:document.body.scrollWidth,top:document.body.scrollHeight,right:document.body.scrollWidth,bottom:document.body.scrollHeight}:{left:t.left+this.g_clientToScreenOffsetX,top:t.top+this.g_clientToScreenOffsetY,right:t.right+this.g_clientToScreenOffsetX,bottom:t.bottom+this.g_clientToScreenOffsetY}},t.prototype.OnError=function(t,e){var o=t;e&&(o+="\n\nError: "+e);var n=$("message");n&&(n.textContent=o,n.style.display="block")},t.prototype.createElement=function(t,e,o){var n=document.createElement(t);return this.setElementAttrs(n,e),this.appendChildren(n,o),n},t.prototype.createTextNode=function(t){return document.createTextNode(t)},t.prototype.setElementAttrs=function(t,e){return e?(forEachOwnProp(e,function(e,o){t.setAttribute(o,e)}),t):t},t.prototype.appendChildren=function(t,e){if(!e)return t;for(var o=0;o<e.length;o++)e[o]&&t.appendChild(e[o]);return t},t.prototype.getElementRect=function(t){var e=this.getElementPos(t);return{left:e.x,top:e.y,right:e.x+t.offsetWidth,bottom:e.y+t.offsetHeight}},t.prototype.getElementPos=function(t){var e={};if(!t)return e.x=e.y=0,e;if(t.getBoundingClientRect){var o=document.documentElement,n=t.getBoundingClientRect(),i=o.scrollLeft,r=o.scrollTop;e.x=n.left+i,e.y=n.top+r}else{e.x=t.offsetLeft,e.y=t.offsetTop;for(var s,a=t.parentNode;offsetParent;){for(e.x+=offsetParent.offsetLeft,e.y+=offsetParent.offsetTop,"td"==offsetParent.tagName.toLowerCase()&&(s=this.getBorderWidth(offsetParent),e.x+=s.left,e.y+=s.top),offsetParent!=document.body&&offsetParent!=document.documentElement&&(e.x-=offsetParent.scrollLeft,e.y-=offsetParent.scrollTop);a&&offsetParent!=a;)e.x-=a.scrollLeft,e.y-=a.scrollTop,s=this.getBorderWidth(a),e.x+=s.left,e.y+=s.top,a=a.parentNode;a=offsetParent.parentNode,offsetParent=offsetParent.offsetParent}}return e},t.prototype.getBorderWidth=function(t){var e={};if(window.getComputedStyle){var o=window.getComputedStyle(t,null);e.left=parseInt(o.borderLeftWidth.slice(0,-2)),e.top=parseInt(o.borderTopWidth.slice(0,-2)),e.right=parseInt(o.borderRightWidth.slice(0,-2)),e.bottom=parseInt(o.borderBottomWidth.slice(0,-2))}else e.left=this.parseLength(t.style.borderLeftWidth),e.top=this.parseLength(t.style.borderTopWidth),e.right=this.parseLength(t.style.borderRightWidth),e.bottom=this.parseLength(t.style.borderBottomWidth);return e},t.prototype.parseLength=function(t){var e=0;if("string"==typeof t&&null!=t&&""!=t){var o=t.indexOf("px");e=o>=0?parseInt(t.substring(0,o)):-1}return e},t.prototype.LoadTemplates=function(){this.m_templates={};for(var t=$("templates"),e=t.childNodes,o=0;o<e.length;o++){var n=e[o];n.nodeType===Node.ELEMENT_NODE&&n.id&&(this.m_templates[n.id]=n)}t.parentNode.removeChild(t)},t.prototype.GetTemplate=function(t){var e=this.m_templates[t];if(e)return e.cloneNode(!0)},t.prototype.GetMainScreenItems=function(){var t=[];return t.push(new ViewItem(void 0,void 0,"header-title")),t.push(new ViewItem(ID_SEARCH,0,"search","Search","search","Enter words to search in Logins names and search engines","search.svg")),t.push(new ViewItem(ID_PASSCARD_SELECT_COMBINED,0,"menu",localeString("Cmd_Logins_Flat"),"logins","Show All Logins","login.svg")),t.push(new ViewItem(ID_BOOKMARK_SELECT_COMBINED,0,"menu",localeString("Cmd_Bookmarks_Flat"),"bookmarks","Show All Bookmarks","bookmark.svg")),t.push(new ViewItem(ID_SAFENOTE_SELECT_COMBINED,0,"menu",localeString("Cmd_Safenotes_Flat"),"safenotes","Show All Safenotes","safenote.svg")),t.push(new ViewItem(0,0,"separator")),t.push(new ViewItem("active-items-container",0,"active-items-actions")),t.push(new ViewItem(0,0,"separator")),t.push(new ViewItem(0,0,"inline-buttons-wrapper")),t.push(new ViewItem(ID_Cmd_Logoff,0,"button",localeString("Cmd_Logoff_Flat"),localeString("Cmd_Logoff_Flat"),"Logoff from account","logoff.svg")),t},t.prototype.ShowStartPage=function(){var t=this;t.m_navigator.Navigate({name:"Start Screen",views:t.BuildItemsView(t.GetMainScreenItems()),context:{},initialize:function(e){t.InitMainScreen(e)},on_navigated_to:function(e){t.OnNavigatedToMainScreen(e)},on_navigating_from:function(e){t.HideContextMenus()}}),this.m_navigator.ClearBackStack(),g_issafari&&g_bg_connector.GetVar("need_autosave",function(e){e&&(t.ManualSaveAction(),g_bg_connector.PutVar("need_autosave",!1))})},t.prototype.InitMainScreen=function(t){},t.prototype.CreateTitle=function(){var t=this,e=this.createElement("div",{class:"toolbar-title-V8"}),o=this.createElement("div",{class:"toolbar-title-icon-V8 toolbar-home-icon-V8"});o.addEventListener("click",function(){t.OnHomeButtonClick()},!1),e.appendChild(o);var n,i=this.createElement("div",{class:"toolbar-title-icon-V8 toolbar-main-settings-icon-V8",id:"chrome_settings_id"});i.addEventListener("click",function(){t.OnSettingsButtonClick()},!1),e.appendChild(i);var r=this.createElement("div",{class:"toolbar-title-text-V8"},[n=this.createTextNode("RoboForm")]);return n.data=localeString("Cmd_RoboForm_Flat"),e.appendChild(r),r.addEventListener("mousedown",function(){t.HideContextMenus()},!1),e},t.prototype.HideContextMenus=function(){},t.prototype.CreateMatchTitle=function(){return this.createElement("div",{class:"toolbar-match-title-V8",id:"match-title"},[this.createTextNode(localeString("Toolbar_Chrome_Match_Title"))])},t.prototype.CreateActiveItemsWrapper=function(t){var e=this.createElement("div",{class:"active-items-actions"});e.id=t.m_nID;var o=this.createElement("img",{class:"save_progress_img active-items-actions-img",src:"saveind.gif"}),n=this.createElement("div",{class:"active-items-actions-text"});return n.innerText="Loading...",e.appendChild(o),e.appendChild(n),e},t.prototype.SortActiveIdentities=function(t){var e=[];if(!t.length)return e;if(t.length<3){for(var o=0;o<t.length;o++)e.push(t[o]);return e}for(o=0;o<t.length;o++)RfUtils.insertToSortedArray(t[o],e,["path"],2);return e.slice(0,2)},t.prototype.SortMatchingsList=function(t,e,o){for(var n,i,r=new CRfPasscardMatchList,s={},a=0;a<t.length;a++)n=t[a],o&&n.path===o&&(i=n),s[n.path]=n,r.AddMatch(new CRfPasscardMatch(n.level,n.path,n.type,!1,n.isMainFrame,RfFieldCompare.RfFieldsNotMatch,!1));var c=r.GetUnsorted(),p=[],l=[],d=[],h={};i&&(p.push(i),h[i.path]=i);for(a=0;a<e.length;a++){var u=e[a].path;n=s[u],c[u]&&!h[u]&&n&&(n.isMainFrame?l.push(n):d.push(n),h[u]=n)}p=p.concat(l,d);var f=r.GetSorted();for(a=0;a<f.length;a++){var g=f[a];if(!h[g.m_path]){var _=s[g.m_path];_&&p.push(_)}}return p};return t}(),Navigator=function(){function t(t){this.current=void 0,this.back_stack=[],this.root_view=t,this.OnNavigate=void 0}return t.prototype.Navigate=function(t){var e=this.current;for(e&&(e.skip_navigation||this.back_stack.push(e),e.on_navigating_from&&e.on_navigating_from(e.context)),this.current=t;this.root_view.childNodes.length;)this.root_view.removeChild(this.root_view.childNodes[0]);e&&e.skip_navigation&&e.cleanup&&e.cleanup(e.context);for(var o=t.views,n=0;n<o.length;n++)this.root_view.appendChild(o[n]);t.initialize&&t.initialize(t.context),t.on_navigated_to&&t.on_navigated_to(t.context),this.OnNavigate&&this.OnNavigate()},t.prototype.CanGoBack=function(){return this.back_stack.length>0},t.prototype.GoBack=function(){if(this.CanGoBack()){var t=this.current,e=this.back_stack.pop();for(t.on_navigating_from&&t.on_navigating_from(t.context),this.current=e;this.root_view.childNodes.length;)this.root_view.removeChild(this.root_view.childNodes[0]);t.cleanup&&t.cleanup(t.context);for(var o=e.views,n=0;n<o.length;n++)this.root_view.appendChild(o[n]);e.on_navigated_to&&e.on_navigated_to(e.context)}},t.prototype.GetCurrentContext=function(){if(this.current)return this.current.context},t.prototype.SetCurrentContext=function(t){this.current&&(this.current.context=t)},t.prototype.ClearBackStack=function(){for(;this.back_stack.length;)this.RemoveBackEntry()},t.prototype.RemoveBackEntry=function(){var t=this.back_stack.pop();t.cleanup&&t.cleanup(t.context)},t}();function ViewItem(t,e,o,n,i,r,s,a,c){this.m_nID=t,this.m_nFlags=e,this.m_sType=o,this.m_sText=n,this.m_sName=i,this.m_sTooltip=r,this.m_sIconData=s,this.m_oItemInfo=a,this.m_oContext=c}function PopupToBGConnector(){this.m_port=void 0,"function"==typeof connectPopupToBG&&(this.m_port=connectPopupToBG({name:"popup"}))}ViewItem.prototype.toString=function(){return" <<ViewItem>> ID='"+this.m_nID+"'  Text='"+this.m_sText+"'"},PopupToBGConnector.prototype.sendMessage=function(t,e,o){var n={name:"MessageToBG",data:{name:t}};void 0!==e&&(n.data.args_type=typeof e,n.data.args="string"==typeof e?e:JSON.stringify(e)),postToBG(n,o)},PopupToBGConnector.prototype.alert=function(t){this.sendMessage("alert",t)},PopupToBGConnector.prototype.getPopupStartSettings=function(t){this.sendMessage("getPopupStartSettings",void 0,t)},PopupToBGConnector.prototype.updateExtensionMode=function(t,e){this.sendMessage("updateExtensionMode",{"is-nm":t,"is-sa":e})},PopupToBGConnector.prototype.initUI=function(){this.sendMessage("initUI")},PopupToBGConnector.prototype.getProp=function(t,e){this.sendMessage("getProp",t,e)},PopupToBGConnector.prototype.SetChromeV8Style=function(t){this.sendMessage("SetChromeV8Style",void 0,t)},PopupToBGConnector.prototype.updateNativeToolbar=function(t,e,o,n){this.sendMessage("updateNativeToolbar",[t,e,o,n])},PopupToBGConnector.prototype.setCurrentBrowser=function(t){this.sendMessage("setCurrentBrowser",t)},PopupToBGConnector.prototype.onUIEvent=function(t){this.sendMessage("onUIEvent",t)},PopupToBGConnector.prototype.ensureUptodate=function(t){this.sendMessage("ensureUptodate",void 0,t)},PopupToBGConnector.prototype.setUIItemsInfo=function(t,e){this.sendMessage("setUIItemsInfo",[t,e])},PopupToBGConnector.prototype.setPopupActive=function(t){this.sendMessage("setPopupActive",t)},PopupToBGConnector.prototype.closePopupToolbar=function(){this.sendMessage("closePopupToolbar")},PopupToBGConnector.prototype.getRfVersion=function(t){this.sendMessage("getRfVersion",void 0,t)},PopupToBGConnector.prototype.FillFormsInWindowRfApi=function(t,e,o,n,i,r,s,a,c,p,l,d,h,u,f){this.sendMessage("FillFormsInWindowRfApi",[t,e,o,n,i,r,s,a,c,p,l,d,h,u],f)},PopupToBGConnector.prototype.OpenStartPage=function(){this.sendMessage("OpenStartPage")},PopupToBGConnector.prototype.PutVar=function(t,e){var o={name:t,value:e};this.sendMessage("PutVar",o)},PopupToBGConnector.prototype.GetVar=function(t,e){var o={name:t};this.sendMessage("GetVar",o,e)},PopupToBGConnector.prototype.GetOption=function(t,e){this.sendMessage("GetOption",t,e)},PopupToBGConnector.prototype.CheckUptodate=function(t,e,o){this.sendMessage("CheckUptodate",{generation:t,update_status:e},o)},PopupToBGConnector.prototype.GetMatchingData=function(t){this.sendMessage("GetMatchingData",void 0,t)},PopupToBGConnector.prototype.GetServiceStatus=function(t){this.sendMessage("GetServiceStatus",void 0,t)},PopupToBGConnector.prototype.onActionButtonClick=function(){this.sendMessage("onActionButtonClick")};
//# sourceMappingURL=popup.js.map