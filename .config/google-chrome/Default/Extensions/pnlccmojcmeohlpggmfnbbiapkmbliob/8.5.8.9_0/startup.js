// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
var g_roboform,g_first_start,g_need_repair,g_HistoryMgr=void 0,g_generatedPwdList=new GeneratedPasswordsList,g_policySet=new PolicySet,g_proxy_rfo=new ProxyRfo,g_is_nm_starting=!1,g_is_sa_starting=!1,g_is_nm=!1,g_is_sa=!1,g_default_icon_path="robo32.png",g_disabled_icon_path="rfdis16.png";function StartupLegacyExtension(t,r){try{InitStorageAsync(function(){g_HistoryMgr=new CRFRecenltyUsedAdapter,Startup(t,r)})}catch(t){log("OnLoad",t),OnError(kCannotLoadExtension,t)}}function OnUnload(){g_roboform&&g_roboform.OnUnload()}ShowRoboFormStatus(!1),browser.browserAction.setTitle({title:"Loading..."}),window.addEventListener("unload",OnUnload,!0);var g_pRoboFormJSHost=g_pRoboFormJSHost||{};function Startup(t,r){ControlBrowserPasswordSaving(),FixupBrowserAutofill(),g_first_start=!0,g_first_start=GetSetting("internal","first-start",g_first_start),browser.runtime.onMessage.addListener(function(t,r,o){switch(t.name){case"MessageToBG":return ProcessMessageFromPopup(t.data,o)}}),g_proxy_rfo.Initialize(g_pRoboFormJSHost,GetBrowserType(),function(){PutSetting("internal","first-start",!1),g_is_sa_starting=!1,g_is_nm_starting=!0,Browser_StartupNM(),t()},function(){g_roboform&&(g_roboform.g_proxy_connected=!1);g_need_repair=GetSetting("internal","is-nm",!1)||GetSetting("internal","need-repair",!1),PutSetting("internal","need-repair",g_need_repair),g_is_sa_starting=!0,g_is_nm_starting=!1,ApplicationNotFound(),t()},function(){g_roboform&&(g_roboform.g_proxy_connected=!1);OnError(kInternalError)})}function NotLoaded(){ShowRoboFormStatus(!1),browser.browserAction.onClicked.addListener(function(){browser.runtime.reload()})}function ApplicationNotFound(){if(g_first_start)return browser.browserAction.setPopup({popup:"popup.html"}),void ShowRoboFormStatus(!0);Browser_StartupStandalone()}function StartupStandalone(t){g_first_start=!1,g_is_nm=!1,g_is_sa=!0,g_is_nm_starting=!1,g_is_sa_starting=!0,g_need_repair=!1,PutSettingsforSection("internal",[{"first-start":g_first_start},{"is-nm":g_is_nm},{"is-sa":g_is_sa},{"need-repair":g_need_repair}]),Browser_StartupStandalone(),t(!1,!0,!0)}function StartupNM(t){g_first_start=!1,g_is_nm=!0,g_is_sa=!1,g_is_nm_starting=!0,g_is_sa_starting=!1,g_need_repair=!1,PutSettingsforSection("internal",[{"first-start":g_first_start},{"is-nm":g_is_nm},{"is-sa":g_is_sa},{"need-repair":g_need_repair}]),Browser_StartupNM(),t(!0,!1)}function DownloadRoboForm(t){var r=g_is_win?RF_DOWNLOAD_WIN:g_is_mac?RF_DOWNLOAD_MAC:"";browser.downloads.download({url:r})}function Browser_IsCurrentTab(t){return void 0!==t.active?t.active:t.selected}function ShowRoboFormStatus(t){t?g_roboform?g_roboform.ShowRoboFormStatus(t):browser.browserAction.setIcon({path:g_default_icon_path}):browser.browserAction.setIcon({path:g_disabled_icon_path})}function ShowToolbarStatus(t){}function ShowStatusMessage(t,r,o){browser.browserAction.setBadgeText({text:t}),r&&browser.browserAction.setBadgeBackgroundColor({color:r}),o&&window.setTimeout(function(){browser.browserAction.setBadgeText({text:""})},o)}function ConfigureRoboForm(){RoboFormBase.prototype.Browser_Startup=function(){SubscribeWebNavigationEvents()},CFrame.prototype.SkipInEnumerator=function(){return!!this.m_is_rf_frame}}function SubscribeWebNavigationEvents(){}var OnError=function(t,r,o){var n=t;r&&(n+="\n\nError: "+r),browser.browserAction.setTitle({title:n}),o&&null!=typeof alert&&alert(n),NotLoaded()},g_tsstart=(new Date).getTime();function trace(){var t=(new Date).getTime()-g_tsstart;console_output(t+" BG: "+format_log_args(trace.caller,arguments))}function log(){console_output("BG: "+format_log_args(log.caller,arguments))}
//# sourceMappingURL=startup.js.map