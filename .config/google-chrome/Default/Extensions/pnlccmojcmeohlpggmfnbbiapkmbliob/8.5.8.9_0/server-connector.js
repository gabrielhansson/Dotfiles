// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
function UserAccount_OnChangedEvent(e){getProxyRfo().ResetCachedLists()}function checkLoginDataStatus_async(e,o,t){var n=e[USERNAME_PROPERTY];g_jsApiMgr.GetAccountInfo(n,function(e){if(e.syncAllowed){var n=e.oneFile;n?(g_jsApiMgr.setAccountMode(RfapiJS.accountMode.OFS),g_jsApiMgr.getAccountPwd()||g_jsApiMgr.setAccountPwd(getProxyRfo().g_accountpwd),getProxyRfo().g_masterpwd=getProxyRfo().g_accountpwd,g_jsApiMgr.setMasterPwd(getProxyRfo().g_masterpwd),g_policySet.ParseBlob(e.policies),g_policySet.g_passwordExpired=!!e.passwordExpired&&e.passwordExpired,g_policySet.g_forcePasswordChange=!!e.forcePasswordChange&&e.forcePasswordChange,g_policySet.g_passwordAgeDays=void 0!==e.passwordAgeDays?e.passwordAgeDays:-1,g_policySet.g_passwordDaysLeft=void 0!==e.passwordDaysLeft?e.passwordDaysLeft:1e4):(g_jsApiMgr.setAccountMode(RfapiJS.accountMode.MULTIFILE),g_jsApiMgr.getAccountPwd()||g_jsApiMgr.setAccountPwd(getProxyRfo().g_accountpwd)),o(e)}else{var r=getProxyRfo().GetLicenseNotificationStatus(e);e.suspended?logOffFromAccount_async(function(){t(ERR_SUSPENDED_ACCOUNT,r)},function(e,o){t(e,o)}):t(ERR_SYNC_NOT_ALLOWED,r)}},function(o){if(PreProcessError(o),o.Code===Err_NeedOTP){var n=ParseOTPDescription(o.Description);n&&(e.Channel=n),o.Description=localeString("RFO_TwoFactor_Generic_Text")}if(o.Code===Err_OTPAltChannel){ParseOTPDescription(o.Description).split(",").map(function(e){return e.trim()});o.Description=localeString("RFO_TwoFactor_Generic_Text")}401===o.Code&&(Bg_CleanUpData(),o.Description=""),400===o.Code&&(o.Description=""),t(o.Code,o.Description,e)})}function loginToAccount_async(e,o,t){var n=e[USERNAME_PROPERTY],r=e[ACCOUNTPWD_PROPERTY],i=e.otp_password,c=e.otp_memorize,a=e.otp_channel,s=(e.otp_new,g_policySet.GetOptionsValue(OptionsAutoLogoffTimeMins)),d=!1;-1===s&&(d=!0,s=GetSetting("sa-user","rf_timeout_select")),g_jsApiMgr.LoginToAccount_Scram(n,r,s,i,c,a,function(e,i){if(i.disabled)logOffFromAccount_async(function(){t(ERR_ACCESS_DENIED,"This account has been disabled for security reasons. Please contact RoboForm Support at http://support.roboform.com")},function(e,o){t(e,o)});else{var c=i.oneFile;if(g_jsApiMgr.SetUserID(n),g_jsApiMgr.setAccountMode(c?RfapiJS.accountMode.OFS:RfapiJS.accountMode.MULTIFILE),GetSetting("sa-user","rf_username")!==n&&(ClearSaSettings(),PutSetting("sa-user","rf_username",n)),getProxyRfo().g_username=n,Bg_SaveAccountPassword(r),c||(getProxyRfo().g_masterpwd=""),g_jsApiMgr.getAccountMode()===RfapiJS.accountMode.OFS&&Bg_SaveMasterPassword(r),d&&PutSetting("sa-user","rf_timeout_select",s),c&&!i.syncAllowed&&i.suspended){var a=getProxyRfo().GetLicenseNotificationStatus(i);logOffFromAccount_async(function(){t(ERR_SUSPENDED_ACCOUNT,a)},function(e,o){t(e,o)})}else o()}},function(e){(PreProcessError(e),e.Code===Err_NeedOTP)&&(GetSetting("sa-user","rf_username")!==n&&(ClearSaSettings(),PutSetting("sa-user","rf_username",n)),getProxyRfo().g_username=n,Bg_SaveAccountPassword(r),g_jsApiMgr.getAccountMode()===RfapiJS.accountMode.OFS&&Bg_SaveMasterPassword(r),d&&PutSetting("sa-user","rf_timeout_select",s));var o={otp:i};if(401===e.Code&&(i?e.Description=localeString("Android_wrong_password_error"):(Bg_CleanUpData(),e.Description=localeString("RFOError_WrongUserIDOrPassword"))),e.Code===Err_NeedOTP){var c=ParseOTPDescription(e.Description);c&&(o.Channel=c),e.Description=localeString("RFO_TwoFactor_Generic_Text"),e.HttpRequest&&null!=e.HttpRequest.getResponseHeader("x-sib-auth-alt-memorize")&&(o.Memorize=parseInt(e.HttpRequest.getResponseHeader("x-sib-auth-alt-memorize")))}t(e.Code,e.Description,o)})}function logOffFromAccount_async(e,o){g_jsApiMgr.LogOffAccount(1,function(){Bg_CleanUpData(),e()},function(e){HandleError(e,o)})}function changeAccountPassword_async(e,o,t,n){var r=e.new_password,i=e[ACCOUNTPWD_PROPERTY];g_jsApiMgr.ChangeAccountPwd(r,i,function(){Bg_SaveAccountPassword(r),g_jsApiMgr.getAccountMode()===RfapiJS.accountMode.OFS&&Bg_SaveMasterPassword(r),o()},function(e){HandleError(e,t)},n)}function getItemsInfoList_async(e,o,t,n){e[PATH_PROPERTY],e.type;var r=e[PATH_PROPERTY];r="/"===r?"":r,e[PATH_PROPERTY]=r,getProxyRfo().RfApiList(e).then(function(e){o(e.items)}).catch(function(e){HandleError(e,t)})}function getItemInfo_async(e,o,t){g_jsApiMgr.GetItemInfo(e[ITEMINFO_PATH_PROP],function(e){o(e)},function(e){t(e)},e[ITEMINFO_TYPE_PROP],e.parts,e.icon)}function getDataItem_async(e,o,t){var n=e.context,r=null==n[PWD_GEN_PWD_PROPERTY]?getProxyRfo().g_masterpwd?getProxyRfo().g_masterpwd:void 0:n[PWD_GEN_PWD_PROPERTY],i=n[ITEMINFO_PROPERTY],c=i[ITEMINFO_PATH_PROP],a=i[ITEMINFO_TYPE_PROP],s=n.cachepwd,d=n.allFields,u=n.options,g=n.used,_=n.favorite;g_jsApiMgr.GetDataItem(c,a,function(e){s&&(getProxyRfo().g_masterpwd=r,g_jsApiMgr.setMasterPwd(getProxyRfo().g_masterpwd)),o(e)},function(e){if(PreProcessError(e),1==e.Code){var o=r?e.Description:"";t(e.Code,o)}else t(e.Code,e.Description)},3,r,d,u,g,_)}function getDomainLoginsWithEquiv_async(e,o,t){var n=[];if(e.url&&e.url.length)for(var r=RfUtils.DomainFromUrl(e.url[0].trim(),!0),i=e.url,c=(void 0!==e.bExcludeShared&&e.bExcludeShared,[]),a=i.length,s=0;s<i.length;s++){var d=i[s];if(g(d))u(g_policySet.GetEqualDomains(d),function(){--a||o(n)},function(e){--a||HandleError(e,t)});else a--}else o(n);function u(o,t,c){for(var a=o.length,s=0,d=0,u=[],g=0;g<o.length;g++){var _=o[g];_.startsWith("http://")||_.startsWith("https://")||(_="http://"+_),e.url=_,getProxyRfo().RfApiGetMatchingPasscards(e).then(function(e){s++;for(var o=e[ITEMS_PROPERTY],c=0;c<o.length;c++){var g=o[c];if(g.path&&-1==u.indexOf(g.path)){var _=RfUtils.DomainFromUrl(g.gotoUrl.trim(),!0);r==_?(g.path,g.isMainFrame,g.level,i.length,n.unshift(g)):(g.isMainFrame=!1,g.path,g.isMainFrame,g.level,i.length,n.push(g)),u.push(g.path)}}s+d===a&&t()}).catch(function(e){++d===a&&c(e)})}}function g(e){e=e.trim();var o=RfUtils.DomainFromUrl(e,!0);return-1==c.indexOf(o)&&(c.push(o),!0)}}function getDomainLogins_async(e,o,t){g_jsApiMgr.GetDomainPasscards(e.url,function(e){var t=e[ITEMS_PROPERTY];o(t)},function(e){HandleError(e,t)},e.type,e.bExcludeShared)}function searchItems_async(e,o,t){g_jsApiMgr.Search(e.search,function(e){e.count,o(e)},function(e){HandleError(e,t)})}function deleteItem_async(e,o,t,n){var r=e.item;g_jsApiMgr.DeleteObject(r[ITEMINFO_PATH_PROP],r[ITEMINFO_TYPE_PROP],function(){r[ITEMINFO_TYPE_PROP],r[ITEMINFO_PATH_PROP],o()},function(e){HandleError(e,t)},n,e.bDeleteShared)}function createFolder_async(e,o,t,n){var r=e.path;g_jsApiMgr.CreateFolder(r,function(){o()},function(e){HandleError(e,t)},n)}function moveItem_async(e,o,t,n){var r=e.oldPath,i=e.oldType,c=e.newPath,a=e.newType;g_jsApiMgr.MoveObject(r,i,c,a,function(){o()},function(e){HandleError(e,t)},n)}function putDataItem_async(e,o,t,n){var r=e[ITEM_PROPERTY],i={};for(var c in r)i[c]=r[c];var a=e[RFTYPE_PROPERTY];a!==EnRfDataItemType.RfItemType_Contact&&a!==EnRfDataItemType.RfItemType_Identity||ObjectToArray(i),new Promise(function(o,t){g_jsApiMgr.PutDataItem(e[ITEMINFO_PATH_PROP],a,i,function(){o()},function(e){t(e)},e.used,e.favorite,void 0,n)}).then(function(){o()}).catch(function(e){PreProcessError(e),g_jsApiMgr.getAccountMode()!==RfapiJS.accountMode.OFS?e.Code!==NOT_LOGGED_IN?t(e.Code,e.Description):g_jsApiMgr.GetItemsCount("",function(o){e.Code===NOT_LOGGED_IN&&(e.Description="Please enter your RoboForm Master Password"),e.Code=o.protected?RFJS_TEXT_MASTPASSFORM_INVALID:ERR_CREATE_MP,t(e.Code,e.Description)},function(e){HandleError(e,t)},void 0,2,!0,!0):t(e.Code,e.Description)})}function updateSecurityScore_async(e,o,t){var n=void 0===e.email?g_jsApiMgr.GetUserID():e.email;g_jsApiMgr.UpdateSecurityScore({accountId:n,accountInfo:e,countCurrentUser:!0},function(e){o(e)},function(e){HandleError(e,t)})}function getSharedFileUsersInfo_async(e,o,t){var n=e.fileIds&&e.fileIds[0]?e.fileIds[0]:void 0;g_jsApiMgr.GetSharedFileUsersInfo(n,function(e){o(e)},function(e){HandleError(e,t)})}function getSharedFiles_async(e,o,t){var n=e.grantors,r=e.recipients,i=e.fileIds;g_jsApiMgr.GetSharedFiles(function(e){o(e)},function(e){HandleError(e,t)},n,r,i)}function acceptSharedFile_async(e,o,t){g_jsApiMgr.AcceptSharedFile({grantorId:e.accountId,fileId:e.fileId},function(e){o(e)},function(e){HandleError(e,t)})}function revokeSharedFile_async(e,o,t){g_jsApiMgr.RevokeSharedFile(e.recipient,e.fileId,function(e){o(e)},function(e){HandleError(e,t)})}function rejectSharedFile_async(e,o,t){g_jsApiMgr.RejectSharedFile(e.accountId,e.fileId,function(e){o(e)},function(e){HandleError(e,t)},e.acceptCode)}function grantSharedFile_async(e,o,t){g_jsApiMgr.GrantSharedFile(e,function(e,t){o(e,t)},function(e){HandleError(e,t)})}function acceptSharedAccount_async(e,o,t){g_jsApiMgr.AcceptSharedAccount(e.sharedAccountId,function(e,t){o(e,t)},function(e){HandleError(e,t)},e.acceptCode)}function rejectSharedAccount_async(e,o,t){g_jsApiMgr.RejectSharedAccount(e.sharedAccountId,function(e,t){o(e,t)},function(e){HandleError(e,t)},e.bKeep)}function getRecipientsForSharedAccount_async(e,o,t){g_jsApiMgr.GetRecipients(e.sharedAccountId,function(e){o(e)},function(e){HandleError(e,t)})}function getReceivedData_async(e,o,t){g_jsApiMgr.GetReceivedAccountsFiles(function(e){o(e)},function(e){HandleError(e,t)})}function revokeSharedAccount_async(e,o,t){g_jsApiMgr.RevokeAccount(e.sharedAccountId,e.recipient,function(e){o(e)},function(e){HandleError(e,t)},e.bKeep)}function grantSharedAccount_async(e,o,t){g_jsApiMgr.GrantAccount(e.recipient,e.accountId,e.isManager,e.readOnly,e.showPasswords,e.readOnly,function(e){o(e)},function(e){HandleError(e,t)},e.bHide,e.name)}function createSharedAccount_async(e,o,t){var n=void 0!==e.login?e.login:void 0,r=void 0!==e.name?e.name:void 0,i=void 0!==e.email?e.email:void 0,c=void 0!==e.phone?e.phone:void 0,a=void 0!==e.company?e.company:void 0,s=void 0!==e.readOnly?e.readOnly:void 0,d=void 0!==e.showPasswords?e.showPasswords:void 0,u=void 0!==e.serverOnly?e.serverOnly:void 0,g=void 0!==e.allowedIPRanges?e.allowedIPRanges:void 0,_=void 0!==e.policies?e.policies:void 0;g_jsApiMgr.CreateSharedAccount(function(e){o(e)},function(e){HandleError(e,t)},n,r,i,c,a,s,d,u,g,_)}function getIdenticalFiles_async(e,o,t,n){g_jsApiMgr.GetIdenticalFiles(e,function(e){o(e)},function(e){HandleError(e,t)},n)}function putIdenticalFiles_async(e,o,t,n){g_jsApiMgr.PutIdenticalFiles(e,function(e){o(e)},function(e){HandleError(e,t)},n)}function createAccount_async(e,o,t){var n=e.email,r=e[ACCOUNTPWD_PROPERTY],i=e[NAME_PROPERTY],c=e.phone,a=e.master_password,s=void 0===e.boneFile||!e.boneFile;c||(c=void 0),i||(i=void 0),g_jsApiMgr.CreateAccount(n,r,i,n,c,function(e,t){GetSetting("sa-user","rf_username")!==n&&(ClearSaSettings(),PutSetting("sa-user","rf_username",n)),getProxyRfo().g_username=n,Bg_SaveAccountPassword(r),s?(Bg_SaveMasterPassword(a),g_jsApiMgr.setMasterPwd(a)):(Bg_SaveMasterPassword(r),g_jsApiMgr.setMasterPwd(r)),o()},function(e){t(e)},void 0,void 0,void 0,void 0,void 0,void 0,void 0,!1,void 0)}function PreProcessError(e){e.Code,e.Description;var o=e.oException;if(o){var t=o.stack;t&&t}var n=e.HttpRequest;n&&403==e.Code&&("suspended-account"==(void 0!==n.getResponseHeader("x-sib-reason")?n.getResponseHeader("x-sib-reason"):"")&&(e.Code=ERR_SUSPENDED_ACCOUNT));HTTP_STATUS_CODES[e.Code]&&(410==e.Code||403==e.Code||100==e.Code||101==e.Code||(e.Description=HTTP_STATUS_CODES[e.Code])),e.Description}function HandleError(e,o){PreProcessError(e),o(e.Code,e.Description)}function ParseOTPDescription(e){var o=void 0;if(e){var t=e.split("=");o=Array.isArray(t)&&t.length>0?t[t.length-1]:void 0}return o}function Bg_CleanUpData(){getProxyRfo().ResetCachedLists(),g_HistoryMgr.clearCache(),g_generatedPwdList.clearList(),getProxyRfo().g_accountpwd="",getProxyRfo().g_masterpwd="",ClearSensitiveSettings()}
//# sourceMappingURL=server-connector.js.map