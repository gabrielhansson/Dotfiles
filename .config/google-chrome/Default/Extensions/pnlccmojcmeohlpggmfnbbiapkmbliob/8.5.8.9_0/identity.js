// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
var RfapiJS=RfapiJS||{};(function(){var t="identity.js",e=RfapiJS.traceJS,i=(RfapiJS.SibErrType,RfapiJS.traceLevel),n=RfapiJS.logJS,r={enRetCode_Succeeded:0,enRetCode_WrongGroup:1,enRetCode_NotExists:2,enRetCode_AlreadyExists:3,enRetCode_Single:4,enRetCode_Empty:5},s={valueNormal:0,valueSelect:1,valueMultiline:2,valueSectional:3},a={Literal:0,Variable:1},o={Number:0,Variable:1},u={precisionSubstring:0,precisionExact:1},m="Main",l=new RegExp("[\\u0030-\\u0039\\u0041-\\u005a\\u0061-\\u007a\\u00b0-\\u00b0\\u00b2-\\u00b3\\u00b9-\\u00ba\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u01f5\\u01fa-\\u0217\\u0250-\\u02a8\\u0386-\\u0386\\u0388-\\u038a\\u038c-\\u038c\\u038e-\\u03a1\\u03a3-\\u03ce\\u03d0-\\u03d6\\u03da-\\u03da\\u03dc-\\u03dc\\u03de-\\u03de\\u03e0-\\u03e0\\u03e2-\\u03f3\\u0401-\\u040c\\u040e-\\u044f\\u0451-\\u045c\\u045e-\\u0481\\u0490-\\u04c4\\u04c7-\\u04c8\\u04cb-\\u04cc\\u04d0-\\u04eb\\u04ee-\\u04f5\\u04f8-\\u04f9\\u0531-\\u0556\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0621-\\u063a\\u0641-\\u064a\\u0660-\\u0669\\u0671-\\u06b7\\u06ba-\\u06be\\u06c0-\\u06ce\\u06d0-\\u06d3\\u06d5-\\u06d5\\u06f0-\\u06f9\\u0905-\\u0939\\u0958-\\u0961\\u0966-\\u096f\\u0985-\\u098c\\u098f-\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2-\\u09b2\\u09b6-\\u09b9\\u09dc-\\u09dd\\u09df-\\u09e1\\u09e6-\\u09f1\\u0a05-\\u0a0a\\u0a0f-\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32-\\u0a33\\u0a35-\\u0a36\\u0a38-\\u0a39\\u0a59-\\u0a5c\\u0a5e-\\u0a5e\\u0a66-\\u0a6f\\u0a85-\\u0a8b\\u0a8d-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2-\\u0ab3\\u0ab5-\\u0ab9\\u0ae0-\\u0ae0\\u0ae6-\\u0aef\\u0b05-\\u0b0c\\u0b0f-\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32-\\u0b33\\u0b36-\\u0b39\\u0b5c-\\u0b5d\\u0b5f-\\u0b61\\u0b66-\\u0b6f\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99-\\u0b9a\\u0b9c-\\u0b9c\\u0b9e-\\u0b9f\\u0ba3-\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb5\\u0bb7-\\u0bb9\\u0be7-\\u0bf2\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c60-\\u0c61\\u0c66-\\u0c6f\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cde-\\u0cde\\u0ce0-\\u0ce1\\u0ce6-\\u0cef\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d28\\u0d2a-\\u0d39\\u0d60-\\u0d61\\u0d66-\\u0d6f\\u0e01-\\u0e4e\\u0e50-\\u0e59\\u0e81-\\u0e82\\u0e84-\\u0e84\\u0e87-\\u0e88\\u0e8a-\\u0e8a\\u0e8d-\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5-\\u0ea5\\u0ea7-\\u0ea7\\u0eaa-\\u0eab\\u0ead-\\u0eae\\u0ed0-\\u0ed9\\u0edc-\\u0edd\\u0f20-\\u0f33\\u0f40-\\u0f47\\u0f49-\\u0f69\\u0f90-\\u0f95\\u0f97-\\u0f97\\u0f99-\\u0fad\\u0fb1-\\u0fb7\\u0fb9-\\u0fb9\\u10a0-\\u10c5\\u10d0-\\u10f6\\u1100-\\u1159\\u115f-\\u11a2\\u11a8-\\u11f9\\u1e00-\\u1e9b\\u1ea0-\\u1ef9\\u1f00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59-\\u1f59\\u1f5b-\\u1f5b\\u1f5d-\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2070-\\u2070\\u2074-\\u2079\\u2080-\\u2089\\u249c-\\u24e9\\u2564-\\u2564\\u3005-\\u3005\\u3012-\\u3012\\u3041-\\u3094\\u309b-\\u309e\\u30a1-\\u30fa\\u30fc-\\u30fe\\u3105-\\u312c\\u3131-\\u318e\\u4e00-\\u9fa5\\uac00-\\ud7a3\\uf900-\\ufa2d\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1f-\\ufb36\\ufb38-\\ufb3c\\ufb3e-\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe6b-\\ufe6b\\ufe80-\\ufefc\\uff10-\\uff19\\uff20-\\uff3a\\uff41-\\uff5a\\uff66-\\uff9f\\uffa1-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc\\ufffd]");function d(t){return l.test(t)||"★"==t||"#"==t||"&"==t||"@"==t}var h=new RegExp("[\\u0009-\\u000D\\u0020\\u00A0\\u2000-\\u200B\\u3000\\uFEFF]");function _(t){return h.test(String.fromCharCode(t))}function c(t){return t.map(function(t){return t})}function p(t){return function(t){var e=[];if(null!=t)for(var i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}(function(t){var e="",i=0,n=0,r=0,s=0;for(;i<t.length;)(n=t.charCodeAt(i))<128?(e+=String.fromCharCode(n),i++):n>191&&n<224?(r=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&r),i+=2):(r=t.charCodeAt(i+1),s=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&r)<<6|63&s),i+=3);return e}(t))}function f(t,e,i,n){this.m_aBitCombination=[n||0,i||0,e||0,t||0]}f.prototype.SetBit=function(n){var r=31&n,s=1<<r,a=n>>5;this.m_aBitCombination[a]|=s,e("nBitPos:"+n+" right_part:"+r+" right_part_final:"+s+"  arr_index:"+a+"\n"+this.toString(),t,i.INFO)},f.prototype.not=function(){return new f(~this.m_aBitCombination[3],~this.m_aBitCombination[2],~this.m_aBitCombination[1],~this.m_aBitCombination[0])},f.prototype.and=function(t){return new f(this.m_aBitCombination[3]&t.m_aBitCombination[3],this.m_aBitCombination[2]&t.m_aBitCombination[2],this.m_aBitCombination[1]&t.m_aBitCombination[1],this.m_aBitCombination[0]&t.m_aBitCombination[0])},f.prototype.IsNull=function(){return 0==(this.m_aBitCombination[0]|this.m_aBitCombination[1]|this.m_aBitCombination[2]|this.m_aBitCombination[3])},f.prototype.toString=function(){return"<<TBitComb>> :"+this.m_aBitCombination},f.prototype.TestMask=function(t){for(var e=0,i=3;i>=0;--i)e|=this.m_aBitCombination[i]&t.m_aBitCombination[i];return 0!=e};var F=new f(4278190080,0,0,0),b=F.not();function S(t,e){return!b.and(t).and(e).IsNull()&&F.and(t).and(e.not()).IsNull()}function g(t){this.str=t,this.ptr=0,this.m_Id=Math.floor(10001*Math.random())}g.prototype.loadList=function(t){for(var e=[],i=this.readInt(),n=0;n<i;n++)e[n]=t(this);return e},g.prototype.readByte=function(){return this.str.charCodeAt(this.ptr++)},g.prototype.readBool=function(){return!!this.readByte()},g.prototype.readWord=function(){return(this.readByte()<<0)+(this.readByte()<<8)},g.prototype.readInt=function(){return(this.readWord()<<0)+(this.readWord()<<16)},g.prototype.read=function(t){return this.ptr+=t,this.str.substring(this.ptr-t,this.ptr)},g.prototype.readStringLength=function(){var t=this.readByte();if(t<255)return t;var e=this.readWord();if(65534==e)throw{message:"ReadStringLength: UNICODE string prefix"};return e<65535?e:this.readInt()},g.prototype.readStringUTF8Garbled=function(){var t,e=this.readStringLength();return e?(t=p(function(t){for(var e=[],i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)^37*i-85&255);return e}(this.read(e))),String.fromCharCode.apply(null,t)):""},g.prototype.loadStringList=function(){return this.loadList(function(t){return t.readStringUTF8Garbled()})},g.prototype.readBitComb=function(){for(var t=new f,e=0;e<4;e++)t.m_aBitCombination[e]=this.readInt();return t},g.prototype.toString=function(){return"<<StringFile>>  ID:"+this.m_Id+" file_POS:"+this.ptr};var C=null;function y(t,e){if(this.m_Precision=u.precisionSubstring,this.m_bReductionComputed=!1,this.m_lsSubstrings=[],this.m_lsdSubstringsReduced=[],this.m_nWordsCount=0,1!=arguments.length)return 2==arguments.length?(this.m_Precision=u.precisionSubstring,this.m_bReductionComputed=!1,this.m_nWordsCount=0,void this.InitStandard(t,e)):void 0}function I(t,e,i){if(this.m_BitComb=new f,this.m_sFieldName="",this.m_nPartNumber=0,this.m_bValueMatch=!1,this.m_lRules=[],3==arguments.length)return this.m_bValueMatch=!1,this.m_nPartNumber=e,this.m_sFieldName=t,void(this.Country=i)}y.prototype.GetWordsCount=function(){return this.m_bReductionComputed||this.ComputeReduction(),this.m_nWordsCount},y.prototype.ComputeReduction=function(){try{this.m_lsdSubstringsReduced.length=0,this.m_nWordsCount=0;for(var e=0;e<this.m_lsSubstrings.length;e++){var i=new B(this.m_lsSubstrings[e]);""!=i.GetStringData().GetWhole()&&(i.GetStringData().GetWordsCount()>this.m_nWordsCount&&(this.m_nWordsCount=i.GetStringData().GetWordsCount()),this.m_lsdSubstringsReduced[this.m_lsdSubstringsReduced.length]=i)}this.m_bReductionComputed=!0}catch(e){n("ERROR in CFieldRule::ComputeReduction "+e.message,t)}},y.prototype.GetSubstringsReduced=function(){return this.m_bReductionComputed||this.ComputeReduction(),this.m_lsdSubstringsReduced},y.prototype.GetPrecision=function(){return this.m_Precision},y.prototype.InitStandard=function(t,e){this.m_bReductionComputed=!1,this.m_Precision=e,this.m_lsSubstrings=t,this.m_lsSubstrings.length&&(this.m_lsSubstrings[0]=this.m_lsSubstrings[0].toLowerCase())},y.prototype.toString=function(){return"##CFieldRule##  m_bReductionComputed="+this.m_bReductionComputed+"  _Precision="+this.m_Precision+" m_lsSubstrings="+this.m_lsSubstrings+" m_nWordsCount="+this.m_nWordsCount+"  VALUE='"+this.m_lsSubstrings[0]+"'"},I.prototype.toString=function(){return"<<CFieldNameRules>> for  FIELD_NAME='"+this.m_sFieldName+"  m_nPartNumber="+this.m_nPartNumber+"  m_bValueMatch="+this.m_bValueMatch+" BitComb:"+this.m_BitComb+"'  RULES.COUNT:"+this.m_lRules.length};var N=null;function R(){this.m_sInternalName="",this.m_sLangCode=""}function G(){this.m_sName="",this.m_Type=0,this.m_lsVariants=[]}function O(t){var e=new R;return e.m_sInternalName=t.readStringUTF8Garbled(),e.m_sLangCode=t.readStringUTF8Garbled(),e}function v(t){var e=new G;return e.m_sName=t.readStringUTF8Garbled(),e.m_Type=t.readInt(),e.m_lsVariants=t.loadList(O),e}R.prototype.getDisplayName=function(){return this.m_sInternalName},R.prototype.toString=function(){return"<<COptionVariant>>  NAME='"+this.m_sInternalName+"' Lang_Code = "+this.m_sLangCode},G.prototype.toString=function(){return"<<COption>>  OPTION_NAME='"+this.m_sName+"' Type="+this.m_Type+"  Number of variants="+this.m_lsVariants.length};var T=null;function M(t){var e={};return e.m_sdString=function(t){var e={};return e.m_sWhole=t.readStringUTF8Garbled(),e.m_sNormalized=t.readStringUTF8Garbled(),e.m_sInsideBrackets=t.readStringUTF8Garbled(),e.m_bBracketsStructureIsCorrect=t.readByte(),e.m_bBracketsEncountered=t.readByte(),e.m_nWordsCount=t.readWord(),e}(t),e.m_sNameReduced=t.readStringUTF8Garbled(),e.m_bNameOnly=t.readBool(),e.m_bExactMatch=t.readBool(),e}function V(){this.m_nCodePage=0,this.m_BitComb=null}function L(){this.m_sName="",this.m_sDisplayName="",this.m_GroupBitComb=null,this.m_lFields=[]}function E(){if(T)return T;function n(t,e){var i=e||new L;return i.m_sName=t.readStringUTF8Garbled(),i.m_sDisplayName=t.readStringUTF8Garbled(),i.m_GroupBitComb=t.readBitComb(),i}function r(t){var e=new k;return e.m_eType=t.readByte(),e.m_sValue=t.readStringUTF8Garbled(),e.m_nSize=t.readInt(),e}function s(t){var e=new W;return e.m_eType=t.readByte(),e.m_nSize=t.readInt(),e.m_sValueName=t.readStringUTF8Garbled(),e.m_nPartNumber=t.readInt(),e}function a(t){var e={};return e.m_sMainValue=t.readStringUTF8Garbled(),e.m_lsValues=t.loadStringList(),e}function o(t){var e={};return e.m_eType=t.readByte(),e.m_sValue=t.readStringUTF8Garbled(),e.m_nPartNumber=t.readInt(),e}function u(t){var e=new A;return e.m_sCaption=t.readStringUTF8Garbled(),e.m_VType=t.readInt(),e.m_lsdMatches=t.loadList(M),e.m_nMaxLength=t.readInt(),e.m_nMaxLines=t.readInt(),e.m_nMaxLineLength=t.readInt(),e.m_lOptions=t.loadList(a),e.m_Spec=function(t){var e=new P;return e.m_fInputFormat=t.loadList(r),e.m_lPartitionings=t.loadList(function(t){return t.loadList(s)}),e}(t),e.m_sdMainMatch=M(t),e.m_bTextOnly=t.readBool(),e.m_bSelectOnly=t.readBool(),e.m_bNumberOnly=t.readBool(),e.m_lFormula=t.loadList(o),e}function m(t){var e=new D;return e.m_sGroupName=t.readStringUTF8Garbled(),e.m_nFieldIndex=t.readInt(),e.m_FieldFormat=u(t),e}"undefined"!=typeof IDENTITY_RESOURCES&&"undefined"==typeof RFB_FIELDS&&(RFB_FIELDS=IDENTITY_RESOURCES.RFB_FIELDS);var l=new g(window.atob(RFB_FIELDS));return(T={}).codePages=l.loadList(function(t){var e=new V;return e.m_nCodePage=t.readInt(),e.m_BitComb=t.readBitComb(),e}),T.fieldSet=function(n){var r=[],s=n.readInt();e("getStaticFields.loadFieldSet  number of CIdentityField's="+s,t,i.INFO);for(var a=0;a<s;a++){var o=n.readBitComb(),u=n.readStringUTF8Garbled(),l=m(n);l.FieldName=u,l.bitComb=o,r.push(l)}return r}(l),T.standardGroups=l.loadList(function(t){var e=new L;return e.m_lFields=t.loadStringList(),n(t,e),e}),T.summaryGroup=n(l),T.customGroup=n(l),T}function B(e){if(this.m_sdString=new H,this.m_sNameReduced="",this.m_bNameOnly=!1,this.m_bExactMatch=!1,1==arguments.length)try{this.m_bNameOnly=!1,this.m_bExactMatch=!1,(e=e.trim()).length>=2&&"@"==e[0]&&(this.m_bNameOnly=!0,e=(e=e.substr(1)).trimLeft()),e.length>=1&&"="==e[0]&&(this.m_bExactMatch=!0,e=(e=e.substr(1)).trimLeft()),this.m_sdString=new H(e),e=this.m_sdString.GetWhole();for(var i=0;i<e.length;i++)if(!d(e[i])){var r=e.substr(0,i),s=e.substr(i+1);e=r+s,i--}return void(this.m_sNameReduced=e)}catch(e){n("ERROR in CMatchStringData::ctor(1) "+e.toString(),t)}}function x(t,e,i,n,r,s,a,o){this.m_bValid=!1,this.m_bValueMatch=!1,this.m_nWordsCount=0,this.m_nTailLength=0,this.m_pField=null}function P(t){this.m_fInputFormat=[],this.m_lPartitionings=[]}V.prototype.toString=function(){return"<<CFieldsCodePage>>  CodePage='"+this.m_nCodePage+"' BitComb="+this.m_BitComb},L.prototype.toString=function(){return"<<CIdentityGroup>>  NAME='"+this.m_sName+"' DISPLAY='"+this.m_sDisplayName+"' FIELDS:"+this.m_lFields+" Bits:"+this.m_GroupBitComb},L.prototype.clone=function(){var t=new L;return t.m_sName=this.m_sName,t.m_sDisplayName=this.m_sDisplayName,t.m_GroupBitComb=this.m_GroupBitComb,t.m_lFields=c(this.m_lFields),t},B.prototype.GetNameReduced=function(){return this.m_sNameReduced},B.prototype.GetNameOnly=function(){return this.m_bNameOnly},B.prototype.GetExactMatch=function(){return this.m_bExactMatch},B.prototype.GetStringData=function(){return this.m_sdString},B.prototype.GetStringRepresentation=function(){var t="";return(this.m_bNameOnly||"true"==this.m_bNameOnly)&&(t+="@"),(this.m_bExactMatch||"true"==this.m_bExactMatch)&&(t+="="),t+=this.m_sdString.GetWhole()},B.prototype.Clear=function(){this.m_bNameOnly=!1,this.m_bExactMatch=!1,this.m_sNameReduced="",this.m_sdString.Clear()},B.prototype.toString=function(){return"<<CMatchStringData>>  m_bNameOnly="+this.m_bNameOnly+" m_bExactMatch="+this.m_bExactMatch+"  m_sNameReduced='"+this.m_sNameReduced+"'  m_sdString="+this.m_sdString},x.prototype.setParameters=function(n,r,a,o,u,m,l,d,h){if(this.m_bValid=!1,this.m_bValueMatch=!1,this.m_nWordsCount=0,this.m_nTailLength=0,this.m_pField=null,3==n){var _=r[0],c=[];switch(_.GetType()){case RfFieldType.RfFieldSelect:c=_.GetSelectOptions();break;case RfFieldType.RfFieldRadio:_.GetRadioTitles(c);break;default:return}var p=a.getFields(),f=o.GetCurrentInstanceName(p),F=o.GetValue(p,f,{bComputed:!1,pbEmpty:null,info:null}),b=[];if((R=o.GetFieldFormat()).GetType()==s.valueSelect)for(var S=R.GetOptions(),g=S.length,C=0;C<g;C++){var y=S[C];b[b.length]=y.m_sMainValue;for(var I=0;I<y.m_lsValues.length;I++)b.push(y.m_lsValues[I])}var N=ChooseSelectOption(F,"",b,c,!1,!0,h);return this.m_bValid=N>=0,void(this.m_bValid&&e(" CStringMatch RuleMatch byValue: nChosenOption="+N+" sMainValue="+F,t,i.INFO))}if(4==n){if(o){var R;if((R=o.GetFieldFormat()).GetIsCustom())(G=new x).InitNonReduced(R.GetMainMatchString(),m,l,d,h),G.isBetter(this)&&(this.m_bValid=G.m_bValid,this.m_bValueMatch=G.m_bValueMatch,this.m_nWordsCount=G.m_nWordsCount,this.m_nTailLength=G.m_nTailLength,this.m_pField=G.m_pField);for(C=0;C<R.GetMatchesList().length;C++){var G;(G=new x).InitNonReduced(R.GetMatchesList()[C],m,l,d,h),G.isBetter(this)&&(this.m_bValid=G.m_bValid,this.m_bValueMatch=G.m_bValueMatch,this.m_nWordsCount=G.m_nWordsCount,this.m_nTailLength=G.m_nTailLength,this.m_pField=G.m_pField)}return}if(u)return void this.Init(u.m_bReductionComputed?u.m_lsdSubstringsReduced:u.GetSubstringsReduced(),m,u.m_Precision,l,d,u.m_nWordsCount,h)}},x.prototype.IsValid=function(){return this.m_bValid},x.prototype.Init=function(t,e,i,n,r,s,a){this.m_nTailLength=-1,this.m_bValid=!0,this.m_nWordsCount=s;for(var o=t.length,u=0;u<o;++u){var m=t[u],l=0;if(n){if(m.m_bNameOnly){if(!r){this.m_bValid=!1;break}}else if(r){this.m_bValid=!1;break}l=this.StringCorresponds(m.m_sNameReduced,e.m_sNameReduced,i,n,a)}else l=this.SubstringCorresponds(m.m_sdString,e.m_sdString,i,n,a);if(l<0){this.m_bValid=!1;break}(l<this.m_nTailLength||this.m_nTailLength<0)&&(this.m_nTailLength=l)}},x.prototype.SubstringCorresponds=function(t,e,i,n,r){return this.StringCorresponds(t.m_bBracketsEncountered?t.m_sWhole:t.m_sNormalized,t.m_bBracketsEncountered?e.m_sWhole:e.m_sNormalized,i,n,r)},x.prototype.StringCorresponds=function(n,r,s,a,o){if(""==n||""==r||"$"==n[0])return-1;var m=n.toLowerCase(),l=r.toLowerCase();switch(s){case u.precisionSubstring:var h;if((h=m.indexOf("★"))>=0&&h<m.length-1){var _=!1;o&&(_=RfIsStringHieroglyph(n))&&(m=m.split(" ").join(""),l=l.split(" ").join(""));var c,p=m.substr(0,h),f=m.substr(h+1),F=-1,b=0;return(c=l.indexOf(p))>=0&&(b=l.indexOf(f,c+p.length))>=0&&(F=l.length-b,_&&(this.m_nWordsCount=b+f.length-c),e("  RuleMatch: matched '"+n+"' to '"+l+"'",t,i.INFO),e("    bNoWords="+_+" m_nWordsCount="+this.m_nWordsCount+" nBestTail="+F,t,i.INFO)),F}var S=!1,g=-1;F=-1;for(o&&(S=RfIsStringHieroglyph(n))&&(m=m.split(" ").join(""),l=l.split(" ").join(""));(g=l.indexOf(m,g+1))>=0;)(S||a||(g<=0||!d(l.charAt(g-1)))&&(g+m.length>=l.length||!d(l.charAt(g+m.length))))&&(F=l.length-g-m.length,S&&(this.m_nWordsCount=m.length));return F>=0&&(e("  RuleMatch: found '"+n+"' in "+l,t,i.INFO),e("  bNoWords1="+S+" bIsName="+a+" m_nWordsCount="+this.m_nWordsCount+" nBestTail="+F,t,i.INFO)),F;case u.precisionExact:var C=l==m?0:-1;if(C>=0){var y=!1;o&&(y=RfIsStringHieroglyph(n))&&(m=m.split(" ").join(""),l=l.split(" ").join(""),this.m_nWordsCount=m.length),e("  RuleMatch: '"+n+"' == '"+l+"' bNoWords2 = "+y+" bIsName = "+a+" m_nWordsCount = "+this.m_nWordsCount,t,i.INFO)}return C;default:return-1}return-1},x.prototype.InitNonReduced=function(e,i,r,s,a){try{var o=u.precisionSubstring;if(e.GetNameOnly()?!r||!s:r&&s)return;e.GetExactMatch()&&(o=u.precisionExact);var m=[];m.push(e),this.Init(m,i,o,r,s,e.GetStringData().GetWordsCount(),a)}catch(e){n("ERROR in CStringMatch::InitNonReduced: "+e.message,t)}},x.prototype.isBetter=function(t){return this.m_bValid&&(!t.m_bValid||!this.m_bValueMatch&&(t.m_bValueMatch||this.m_nWordsCount>t.m_nWordsCount||this.m_nWordsCount==t.m_nWordsCount&&this.m_nTailLength<t.m_nTailLength)||this.m_bValueMatch&&!t.m_bValueMatch&&!t.m_pField)},x.prototype.Clone=function(t){this.m_bValid=t.m_bValid,this.m_bValueMatch=t.m_bValueMatch,this.m_nWordsCount=t.m_nWordsCount,this.m_nTailLength=t.m_nTailLength,this.m_pField=t.m_pField},x.prototype.toString=function(){return"CStringMatch OBJECT. m_bValid="+this.m_bValid+" m_bValueMatch="+this.m_bValueMatch+"  m_nWordsCount="+this.m_nWordsCount+"  m_nTailLength="+this.m_nTailLength},P.prototype.Clear=function(){this.m_fInputFormat.length=0,this.m_lPartitionings.length=0},P.prototype.toString=function(){return"<<<CSectionSpec>>> SECTIONS="+this.m_fInputFormat.length+"\n"+this.m_fInputFormat+"\t\t\t\t\t\tPARTS="+this.m_lPartitionings.length+"\n"+this.m_lPartitionings};function k(t){if(this.m_sValue="",this.m_nSize=0,this.m_eType=0,0==arguments.length)return this.m_eType=a.Literal,void(this.m_nSize=0);1!=arguments.length||(isNaN(t)?(this.m_eType=a.Literal,this.m_nSize=0,this.m_sValue=t):(this.m_eType=a.Variable,this.m_nSize=t))}function W(t,e){return this.m_sValueName="",this.m_nPartNumber=0,this.m_nSize=0,this.m_eType=0,0==arguments.length?(this.m_eType=o.Number,this.m_nSize=0,void(this.m_nPartNumber=0)):1==arguments.length?(this.m_eType=o.Number,this.m_nSize=t,void(this.m_nPartNumber=0)):2==arguments.length?(this.m_eType=o.Variable,this.m_sValueName=t,this.m_nSize=0,void(this.m_nPartNumber=e)):void 0}function A(){this.m_VType=s.valueNormal,this.m_bIsCustom=!1,this.m_sCaption="",this.m_lsdMatches=[],this.m_bTextOnly=!1,this.m_bSelectOnly=!1,this.m_bNumberOnly=!1,this.m_nMaxLength=-1,this.m_nMaxLines=-1,this.m_nMaxLineLength=-1,this.m_lFormula=[],this.m_lOptions=[],this.m_Spec=new P,this.m_sdMainMatch=new B}k.prototype.toString=function(){return"<#CSection#>  m_sValue='"+this.m_sValue+"'  m_nSize='"+this.m_nSize+"'  m_eType='"+this.m_eType+"'\n"},W.prototype.toString=function(){return"<#CPart#>  m_sValueName='"+this.m_sValueName+"'  m_nPartNumber='"+this.m_nPartNumber+"'  m_nSize='"+this.m_nSize+"' \n"},A.prototype.toString=function(){for(var t=this.m_bTextOnly?" TEXT_ONLY ":"",e=this.m_bSelectOnly?" SELECT_ONLY ":"",i=this.m_bNumberOnly?" NUMBER_ONLY ":"",n=-1!=this.m_nMaxLength?" MAX_LENGTH:"+this.m_nMaxLength:"",r=-1!=this.m_nMaxLines?" MAX_LINES:"+this.m_nMaxLines:"",s=-1!=this.m_nMaxLineLength?" MAX_LINE_LENGTH:"+this.m_nMaxLineLength:"",a=this.m_bIsCustom?" CUSTOM ":"",o="",u=0;u<this.m_lsdMatches.length;++u)o+="\n"+this.m_lsdMatches[u];return"<<CFieldFormat>> CAPTION='"+this.m_sCaption+"'"+t+e+i+n+a+r+s+"  m_VType:"+this.m_VType+"\n\t\t\tMAIN_MATCH:"+this.m_sdMainMatch+"\n\t\t\tMATCHES:"+o+"\n\t\t\tSPECS:"+this.m_Spec},A.prototype.GetOptions=function(){return this.m_lOptions},A.prototype.Clear=function(){try{this.m_VType=s.valueNormal,this.m_bIsCustom=!1,this.m_bTextOnly=!1,this.m_bSelectOnly=!1,this.m_bNumberOnly=!1,this.m_sCaption="",this.m_lsdMatches.length=0,this.m_nMaxLength=-1,this.m_nMaxLines=-1,this.m_nMaxLineLength=-1,this.m_lOptions.length=0,this.m_lFormula.length=0,this.m_Spec.Clear(),this.m_sdMainMatch.Clear()}catch(e){n("ERROR in CFieldFormat::Clear"+e.message,t)}},A.prototype.FormatValue=function(r,s){try{if(0==this.m_Spec.m_fInputFormat.length)return e("  FormatValue: no format, value not changed: "+r,t,i.INFO),r;var o=40;if(s&&s.GetType()==RfFieldType.RfFieldText){var u=s.GetInputTextElem();if(u){var m=u.getAttribute("size");m&&""!=m||(m=u.size?u.size:-1),m>=0&&m<o&&(o=m);var l=u.getAttribute("maxLength");(l=l&&""!=l?parseInt(l):-1)>=0&&l<o&&(o=l)}}o||(o=40);var d="";if(d=this.FormatValueTry(r,!0,!1),e("  FormatValue: sValue="+r+" field_length="+o+" sResult="+d,t,i.INFO),o>=0&&d.length>o){for(var h=!1,_=0;_<this.m_Spec.m_fInputFormat.length;_++){var c=this.m_Spec.m_fInputFormat[_];c.m_eType==a.Literal&&"|"==c.m_sValue[0]&&(h=!0)}h?(d=this.FormatValueTry(r,!0,!0)).length>o&&(d=this.FormatValueTry(r,!1,!0)):d=this.FormatValueTry(r,!1,!1)}return d}catch(e){return n("ERROR in CFieldFormat::FormatValue"+e.message,t),""}},A.prototype.FormatValueTry=function(r,s,a){try{e("  FormatValueTry: sValue="+r+" bIncludeLiterals="+s+" bBreak="+a+" this.m_Spec.m_fInputFormat="+this.m_Spec.m_fInputFormat,t,i.INFO);for(var o="",u=r,m=!0,l=!0,d=0,h=!1,_=0;_<this.m_Spec.m_fInputFormat.length;_++){var c=this.m_Spec.m_fInputFormat[_],p="";switch(parseInt(c.m_eType)){case 0:if(a&&"|"==c.m_sValue[0]){h=!0;break}var f;if(s)-1!=(f=(p=c.m_sValue).indexOf("|"))&&(p=p.substring(f+1)),-1!=(f=p.indexOf("!"))&&(p=p.substring(f+1)),d=o.length;break;case 1:p=(p=u.substr(0,c.m_nSize)).trimRight();var F=Math.min(u.length,c.m_nSize);u=u.substring(F),""==p||IsSpace(p)||(l=!1,d=-1)}if(h)break;IsSpace(p)?m||(o+=p,m=!0):(o+=p,m=!1)}return l&&(o=""),d>=0&&(o=o.substr(0,d)),o}catch(e){return n("ERROR in CFieldFormat::FormatValueTry "+e.message,t),""}},A.prototype.SetMatchesList=function(t){this.m_lsdMatches=t},A.prototype.GetMatchesList=function(){return this.m_lsdMatches},A.prototype.GetType=function(){return this.m_VType},A.prototype.SetType=function(t){this.m_VType=t.m_VType,this.m_bIsCustom=t.m_bIsCustom,this.m_nMaxLength=t.m_nMaxLength,this.m_nMaxLines=t.m_nMaxLines,this.m_nMaxLineLength=t.m_nMaxLineLength,this.m_lOptions=t.m_lOptions,this.m_Spec=t.m_Spec,this.m_sdMainMatch=t.m_sdMainMatch,t.m_bTextOnly&&(this.m_bTextOnly=!0),t.m_bSelectOnly&&(this.m_bSelectOnly=!0),t.m_bNumberOnly&&(this.m_bNumberOnly=!0)},A.prototype.SetFormula=function(t){this.m_lFormula=t.m_lFormula},A.prototype.IsFormulaEmpty=function(){return 0==this.m_lFormula.length},A.prototype.GetComputable=function(){return!this.IsFormulaEmpty()},A.prototype.GetMaxLength=function(){return this.m_nMaxLength},A.prototype.SetCaption=function(t){this.m_sCaption=t},A.prototype.GetCaption=function(){return this.m_sCaption},A.prototype.GetDisplayTitle=function(t){return""==this.m_sCaption?t:this.m_sCaption},A.prototype.IsInfoField=function(t){var e=this.GetDisplayTitle(t);return e.length>=2&&(":"==e[0]||":"==e[1]||";"==e[0]||";"==e[1])},A.prototype.GetMainMatchString=function(){return this.m_sdMainMatch},A.prototype.DeleteAllMatches=function(){this.m_lsdMatches.length=0},A.prototype.AddMatch=function(t){var e=new B(t);""!=e.GetStringData().GetWhole()&&this.m_lsdMatches.push(e)},A.prototype.SetMatchesString=function(t){this.m_lsdMatches.length=0;if(t&&""!=t)for(var e=t.split(";"),i=0;i<e.length;++i)this.AddMatch(e[i])},A.prototype.SetCustom=function(t,e){this.m_bIsCustom=!0,this.m_sdMainMatch=new B(t),this.SetMatchesString(e)},A.prototype.SetTypeMultiline=function(t,e){null==t&&(t=-1),null==e&&(e=-1),this.m_VType=s.valueMultiline,this.m_nMaxLines=t,this.m_nMaxLineLength=e},A.prototype.GetIsCustom=function(){return this.m_bIsCustom},A.prototype.GetSpec=function(){return this.m_Spec},A.prototype.GetBestPartitioning=function(e){try{for(var i=this.GetSpec(),r=null,s=0,a=0;a<i.m_lPartitionings.length;a++){var o=i.m_lPartitionings[a];if(o.length>s&&o.length<=e&&(r=o,s=o.length),s==e)break}return r}catch(e){return n("ERROR in CFieldFormat::GetBestPartitioning "+e.message,t),null}},A.prototype.Satisfies=function(r,s){try{if(this.m_bTextOnly&&(r.GetType()==RfFieldType.RfFieldSelect||r.GetType()==RfFieldType.RfFieldRadio||r.GetType()==RfFieldType.RfFieldCheckbox))return!1;if(this.m_bSelectOnly&&r.GetType()!=RfFieldType.RfFieldSelect&&r.GetType()!=RfFieldType.RfFieldRadio&&r.GetType()!=RfFieldType.RfFieldCheckbox)return!1;if(r.GetType()==RfFieldType.RfFieldSelect&&(s.indexOf("Date Of Birth")>=0||s.indexOf("Card Expires")>=0)){var a=this.m_lOptions.length,o=r.GetSelectOptions().length;if(a>=12&&a<=14){if(!(o>=12&&o<=16))return e("CFieldFormat::Satisfies: Month NOT: nSelIdent="+a+" nSelOnl="+o,t,i.INFO),!1}else if(a>=31&&a<=32&&!(o>=30&&o<=36))return e("CFieldFormat::Satisfies: Month NOT: nSelIdent="+a+" nSelOnl="+o,t,i.INFO),!1}if(this.m_bNumberOnly)switch(r.GetType()){case RfFieldType.RfFieldSelect:case RfFieldType.RfFieldRadio:var u=[];r.GetType()==RfFieldType.RfFieldRadio&&r.GetRadioTitles(u);for(var m=r.GetType()==RfFieldType.RfFieldRadio?u:r.GetSelectOptions(),l=0,d=0;d<m.length;d++)if(isNaN(m[d])&&++l>1)return!1;break;case RfFieldType.RfFieldCheckbox:return!1}return!0}catch(e){return n("ERROR in CFieldFormat::Satisfies "+e.message,t),!1}},A.prototype.GetMatchesString=function(){for(var t="",e=0;e<this.m_lsdMatches.length;e++)t&&(t+="; "),t+=this.m_lsdMatches[e].GetStringRepresentation();return t},A.prototype.assign=function(t){return this.m_VType=t.m_VType,this.m_bIsCustom=t.m_bIsCustom,this.m_sCaption=t.m_sCaption,this.m_nMaxLineLength=t.m_nMaxLineLength,this.m_bTextOnly=t.m_bTextOnly,this.m_bSelectOnly=t.m_bSelectOnly,this.m_bNumberOnly=t.m_bNumberOnly,this.m_nMaxLength=t.m_nMaxLength,this.m_nMaxLines=t.m_nMaxLines,this.m_lsdMatches=c(t.m_lsdMatches),this.m_lFormula=c(t.m_lFormula),this.m_lOptions=c(t.m_lOptions),this.m_Spec=t.m_Spec,this.m_sdMainMatch=t.m_sdMainMatch,this},A.prototype.clone=function(){return(new A).assign(this)};var w=function(){this.m_bComputed=!1,this.m_bEmpty=!1,this.m_sValue="",this.m_pSelectedOption=null};function D(){this.m_sGroupName="",this.m_FieldFormat=new A,this.m_nFieldIndex=0,this.m_mFieldValues={},this.bitComb=new f,this.FieldName="",this.m_bComputing=!1,this.m_nIndex=Math.floor(10001*Math.random())}function U(a){this.CGroupInstances=function(){this.m_mInstances={},this.m_sDefaultInstanceName=m,this.m_mInstances[m]=!0,this.m_nIndex=Math.floor(10001*Math.random()),this.GetCurrentInstanceName=function(){return this.m_sDefaultInstanceName},this.SetDefaultInstanceName=function(e){try{return this.m_sDefaultInstanceName=e,r.enRetCode_Succeeded}catch(e){return n("ERROR in CGroupInstances::SetDefaultInstanceName "+e.message,t),0}},this.getInstances=function(){var t=[];for(var e in this.m_mInstances)t.push(e.toString());return t},this.toString=function(){return"<-### [CGroupInstances] OBJECT.  ID:"+this.m_nIndex+"  DEFAULT INST_NAME: "+this.m_sDefaultInstanceName+" ###->"}},this.CExtraField=function(t,e){this.m_sFieldName="",this.m_sFieldValue="",2==arguments.length&&(this.m_sFieldName=t,this.m_sFieldValue=e)};try{if(a)for(var o in a)e("*identities.js*   CIdentityFieldSet ctor \nOPTION='"+o+"'  VALUE='"+a[o]+"'",t,i.INFO);else e("*identities.js*   CIdentityFieldSet ctor NO OPTIONS!",t,i.INFO);this.m_mOptionValues=a||{},this.m_mStandardFields=[],this.m_lStandardGroups=[],this.m_summaryGroup=null,this.m_customGroup=null,this.m_aCustomFields=[],this.m_mGroupInstances={},this.m_lAllRules=[],this.m_lUnlistedValues=[],this.m_nAddIndex=0,this.m_nIndex=Math.floor(10001*Math.random()),this.mIndexes={},this.nMaxIndex=0;for(var u=this.GetRequiredBits(),l=E(),d=l.fieldSet,h=0;h<d.length;h++){if(S((R=d[h]).bitComb,u))if(this.m_mStandardFields[R.FieldName]){var _=this.m_mStandardFields[R.FieldName].clone(),c=R.m_nFieldIndex<_.m_nFieldIndex,p=c?R.clone():_.clone(),f=c?_.clone():R.clone();p.GetFieldFormat().IsFormulaEmpty()&&p.m_FieldFormat.SetFormula(f.GetFieldFormat()),""==p.GetFieldFormat().GetCaption()&&p.m_FieldFormat.SetCaption(f.GetFieldFormat().GetCaption()),p.GetFieldFormat().GetType()==s.valueNormal&&p.GetFieldFormat().GetMaxLength()<0&&p.m_FieldFormat.SetType(f.GetFieldFormat()),p.GetFieldFormat().GetMatchesList().length||p.m_FieldFormat.SetMatchesList(f.GetFieldFormat().GetMatchesList()),this.mIndexes[f.m_nFieldIndex]=void 0,this.m_mStandardFields[f.m_nFieldIndex]=void 0,this.m_mStandardFields[p.FieldName]=p,this.m_mStandardFields[p.m_nFieldIndex]=p,this.mIndexes[p.m_nFieldIndex]=p.FieldName,this.nMaxIndex<p.m_nFieldIndex&&(this.nMaxIndex=p.m_nFieldIndex)}else{var F=R.clone();F.m_nFieldIndex=R.m_nFieldIndex,this.m_mStandardFields[F.FieldName]=F,this.m_mStandardFields[F.m_nFieldIndex]=F,this.mIndexes[R.m_nFieldIndex]=R.FieldName,this.nMaxIndex<R.m_nFieldIndex&&(this.nMaxIndex=R.m_nFieldIndex)}}var b=l.standardGroups;for(h=0;h<b.length;h++){var N=b[h];S(N.m_GroupBitComb,u)&&(N=N.clone(),e("*** ADD Group to current identity:\n"+N,t,i.INFO),this.m_lStandardGroups[N.m_sName]=N,this.m_lStandardGroups.push(N),this.m_mGroupInstances[N.m_sName]=this.m_mGroupInstances[N.m_sName]||new this.CGroupInstances)}for(h=0;h<this.m_mStandardFields.length;h++){var R;(R=this.m_mStandardFields[h])&&this.m_lStandardGroups[R.m_sGroupName]&&this.m_lStandardGroups[R.m_sGroupName].m_lFields.push(R.FieldName)}S(l.summaryGroup.m_GroupBitComb,u)&&(this.m_summaryGroup=l.summaryGroup.clone()),S(l.customGroup.m_GroupBitComb,u)&&(this.m_customGroup=l.customGroup.clone());var G=function(){if(C)return C;function t(t){var e=new y;if(e.m_lsSubstrings=t.loadStringList(),e.m_Precision=t.readByte(),e.m_bReductionComputed=t.readBool(),e.m_lsdSubstringsReduced=t.loadList(M),e.m_nWordsCount=t.readInt(),e.m_Precision)for(var i=0;i<e.m_lsSubstrings.length;i++)e.m_lsSubstrings[i]="="+e.m_lsSubstrings[i];return e}"undefined"!=typeof IDENTITY_RESOURCES&&"undefined"==typeof RFB_RULES&&(RFB_RULES=IDENTITY_RESOURCES.RFB_RULES);var e=new g(window.atob(RFB_RULES));return C=e.loadList(function(e){var i=new I;return i.m_BitComb=e.readBitComb(),i.m_sFieldName=e.readStringUTF8Garbled(),i.m_nPartNumber=e.readInt(),i.m_bValueMatch=e.readBool(),i.m_lRules=e.loadList(t),i})}();this.m_lAllRules=G.filter(function(t){return S(t.m_BitComb,u)})}catch(e){n("Error in CIdentityFieldSet::constructor : "+e.message,t)}}w.prototype={assign:function(t){return this.m_bComputed=t.m_bComputed,this.m_bEmpty=t.m_bEmpty,this.m_sValue=t.m_sValue,this.m_pSelectedOption=t.m_pSelectedOption,this},clone:function(){return(new w).assign(this)}},D.prototype.assign=function(t){return this.m_sGroupName=t.m_sGroupName,this.m_nFieldIndex=t.m_nFieldIndex,this.m_FieldFormat=t.m_FieldFormat.clone(),this.m_mFieldValues=function(t){var e={};for(var i in t)e[i]=t[i].clone();return e}(t.m_mFieldValues),this.bitComb=t.bitComb,this.FieldName=t.FieldName,this.m_bComputing=t.m_bComputing,this.m_nIndex=t.m_nIndex,this},D.prototype.clone=function(){return(new D).assign(this)},D.prototype.toString=function(){return"<<CIdentityField>>  m_sGroupName='"+this.m_sGroupName+"' NAME='"+this.FieldName+"'  m_bComputing="+this.m_bComputing+" ID="+this.m_nIndex+" INDEX="+this.m_nFieldIndex+" Bits:"+this.bitComb+"\n\t\tFormat:"+this.m_FieldFormat},D.prototype.ComputeValue=function(r,a,o){try{if(this.m_bComputing)return;this.m_bComputing=!0,e("  ComputeValue: ",t,i.INFO);for(var u="",m=0;m<this.m_FieldFormat.m_lFormula.length;m++){var l=this.m_FieldFormat.m_lFormula[m];e(" type="+l.m_eType+" value="+l.m_sValue+" part="+l.m_nPartNumber,t,i.INFO);var d="";switch(l.m_eType){case 0:if(d=l.m_sValue,m>0){if(""==u&&""!=d){Array.isArray(d)||(d=[d]);d.every(not(isPunctuationSign))||(d="")}var h=this.m_FieldFormat.m_lFormula[m+1];if(!h)break;if(1==h.m_eType){if(!(p=r.LookupStandard(h.m_sValue)))continue;var c=p.GetValue(r,a,{bComputed:!1,pbEmpty:null,info:null});c&&""!=c||(e("ComputeValue: empty literal "+d,t,i.INFO),d="")}}break;case 1:!0;var p,f=l.m_sValue;if(!(p=r.LookupStandard(f))){e("VARIABLE. CANNOT FIND FIELD="+l.m_sValue,t,i.INFO);continue}if(""!=(d=p.GetValue(r,a))&&!1,l.m_nPartNumber>=0){var F=l.m_nPartNumber;if(F>=22e3){var b=22001==F||22003==F;if(F>=22002){var S=0;for(S=d.length-1;S>=0&&!_(d.charCodeAt(S));S--);if(S>0&&S<d.length&&!isNaN(d[S+1])){var g=d[S+1];parseInt(g)>=0&&parseInt(g)<=9&&(d=b?d.substr(S+1):d.substr(0,S))}}else if(""!=d&&d[0]>="0"&&d[0]<="9"){S=0;for(S=0;S<d.length&&!_(d.charCodeAt(S));S++);d=b?S+1>=d.length?"":d.substr(S+1):d.substr(0,S)}var C=(d=d.trim()).lastIndexOf(",");-1!=C&&C==d.length-1&&(d=d.substring(0,d.length-1))}else if(F>=2e4){var y=(F-2e4)%1e3,I=F>=21e3,N=d.indexOf(String.fromCharCode(y));N>=0?d=I?d.substr(N+1):d.substr(0,N):I&&(d=""),d=d.trim()}else if(F>=100){F-=100;var R=parseInt(F/100),G=parseInt(F%100);0==R&&0==G||(R<d.length?(d=d.substr(R,G),this.m_FieldFormat.m_VType==s.valueSectional&&0==R&&(d=this.m_FieldFormat.FormatValue(d,o))):d=""),d=(d=d.trim()).split(" ").join("")}else if(p.m_FieldFormat.m_VType==s.valueSectional){var O=p.m_FieldFormat.GetSpec().m_lPartitionings[0],v=!1;F>=10&&(v=!0,F-=10);for(var T=0,M=(R=0,0);M<O.length;M++){var V=O[M];if(0==V.m_eType){if(T==F){var L=v?d.length-R:V.m_nSize;d=R<d.length?d.substr(R,L):"";break}T++,R+=V.m_nSize}}d=d.trim()}}else p.m_FieldFormat.m_VType==s.valueSelect&&(d=RfStringIdToLocalized("lang-ignored",f,d,null)),p.m_FieldFormat.m_VType==s.valueSectional&&(d=p.m_FieldFormat.FormatValue(d,o))}u+=d}this.SetComputedFieldValue(a,u,!1),e("after FOR. m_sComputedValue="+u,t,i.INFO),this.m_bComputing=!1}catch(e){n("ERROR in CIdentityField::ComputeValue "+e.message,t)}},D.prototype.GetValue=function(e,i,r){try{var s=null;if(r&&(s=r.info),this.m_FieldFormat.GetComputable()){var a=this.m_mFieldValues[i.toString()];a&&a.m_bComputed||this.ComputeValue(e,i,s)}var o="",u=i||m,l=this.m_mFieldValues[u.toString()];return null!=l&&(o=l.m_sValue),o}catch(e){return n("ERROR in CIdentityField::GetValue "+e.message,t),""}},D.prototype.GetCurrentInstanceName=function(e){try{if(this.m_FieldFormat.GetIsCustom())return"";var i={sInstanceName:""};return e.GetCurrentInstanceName(this.m_sGroupName,i)!=r.enRetCode_Succeeded?"":i.sInstanceName}catch(e){return n("ERROR in CIdentityField::GetCurrentInstanceName "+e.message,t),""}},D.prototype.GetFieldFormat=function(){return this.m_FieldFormat},D.prototype.GetGroupName=function(){return this.m_sGroupName},D.prototype.Clear=function(){try{this.m_FieldFormat.Clear(),this.m_mFieldValues={},this.m_sGroupName="",this.m_bComputing=!1,this.m_nFieldIndex=0}catch(e){n("ERROR in CIdentityField::Load "+e.message,t)}},D.prototype.GetPresentValueFromScript=function(e){try{for(var i="";0<e.length;){if(-1==e.indexOf("%",0))if(-1==e.indexOf("$",0))if(-1==e.indexOf("\\",0)){i+=e.substr(0);break}i=e;break}return i}catch(e){return n("ERROR in CIdentityField::GetPresentValueFromScript "+e.message,t),""}},D.prototype.GetSelectedOption=function(t){var e=t||m,i=this.m_mFieldValues[e];return i?i.m_pSelectedOption:null},D.prototype.SetFieldValue=function(e,i,r){try{if(this.m_FieldFormat.GetComputable())return;var s=i;r&&(s=this.GetPresentValueFromScript(s)),i=i.trimLeft(),this.SetComputedFieldValue(e,s,""==s)}catch(e){n("ERROR in CIdentityField::SetFieldValue "+e.message,t)}},D.prototype.SetComputedFieldValue=function(e,i,r){try{var a=e||m,o=this.m_mFieldValues[a];o||(o=new w,this.m_mFieldValues[a.toString()]=o);this.m_mFieldValues[a.toString()];if(o.m_sValue=i,o.m_bComputed=!0,o.m_bEmpty=r,this.m_FieldFormat.m_VType==s.valueSelect){o.m_pSelectedOption=null;for(var u=0;u<this.m_FieldFormat.m_lOptions.length;u++){var l=this.m_FieldFormat.m_lOptions[u];if(l.m_sMainValue.toLowerCase()==i.toLowerCase()){o.m_pSelectedOption=l;break}}}}catch(e){n("ERROR in CIdentityField::SetComputedFieldValue "+e.message,t)}},U.prototype.logFieldSetFields=function(n,r){for(var s=n.codePages,a="",o=0;o<s.length;o++){var u=S(s[o].m_BitComb,r);a+="\n"+s[o],u&&(a+=" === MATCH ===")}e("*identities.js*  FIELDS CODEPAGES from intellect="+a,t,i.INFO);var m=n.fieldSet;for(o=0;o<m.length;o++)"App Upload"==m[o].m_sGroupName&&"\n"+m[o];var l=n.standardGroups,d="";for(o=0;o<l.length;o++)d+="\n"+l[o];e("*identities.js*  StandartGroups from intellect="+d,t,i.INFO);var h=n.summaryGroup;e("*identities.js*  SUMMARY GROUP from intellect=\n"+h,t,i.INFO);var _=n.customGroup;e("*identities.js*  CUSTOM GROUP from intellect=\n"+_,t,i.INFO)},U.prototype.ClearCustomFields=function(){this.m_aCustomFields.length=0},U.prototype.AddCustom=function(r,s,a,o){try{e("*identities.js* CIdentityFieldSet.AddCustom  sName='"+r+"' sMatchStrings='"+s+"' sFieldValue:"+a,t,i.INFO);var u=new D;u.FieldName=r;this.GetCustomGroup();return this.m_customGroup&&""!=this.m_customGroup.m_sName?(u.m_sGroupName="Custom",o&&u.m_FieldFormat.SetTypeMultiline(),u.m_FieldFormat.SetCustom(r,s),u.SetFieldValue("",a,!0)):(u.m_FieldFormat.SetCustom("",""),u.SetFieldValue("","",!0)),e("*identities.js* CIdentityFieldSet.AddCustom  RESULT=\n"+u,t,i.INFO),this.m_aCustomFields.push(u)}catch(e){n("####-Error-#### in CIdentityFieldSet::AddCustom : "+e.message,t)}},U.prototype.GetCustomGroup=function(){return this.m_customGroup},U.prototype.GetCustomValuesCount=function(){return this.m_aCustomFields.length},U.prototype.GetCustomField=function(t){return this.m_aCustomFields[t]},U.prototype.toString=function(){return"[CIdentityFieldSet] OBJECT. ID:"+this.m_nIndex},U.prototype.getCountry=function(){return this.m_mOptionValues["World Regions"]},U.prototype.setCountry=function(t){this.m_mOptionValues["World Regions"]=t},U.prototype.LookupOptionValue=function(t){return this.m_mOptionValues[t]||""},U.prototype.GetRequiredBits=function(){for(var n=new f,r=0,s=120,a=function(){if(N)return N;"undefined"!=typeof IDENTITY_RESOURCES&&"undefined"==typeof RFB_OPTIONS&&(RFB_OPTIONS=IDENTITY_RESOURCES.RFB_OPTIONS);var t=RFB_OPTIONS,e=new g(window.atob(t));return N=e.loadList(v)}(),o=0;o<a.length;o++){var u=a[o],m=this.LookupOptionValue(u.m_sName);if(e("CIdentityFieldSet.GetRequiredBits   sOptionValue:"+m+" FOR OPTION:"+u,t,i.INFO),0==u.m_Type)m&&(n.SetBit(s),e("CIdentityFieldSet.GetRequiredBits  change TBitComb:"+n+"\ncurBitYesNo="+s,t,i.INFO)),s++;else for(var l=0;l<u.m_lsVariants.length;l++)u.m_lsVariants[l].m_sInternalName==m&&(n.SetBit(r),e("CIdentityFieldSet.GetRequiredBits  change TBitComb:"+n+"\ncurBitSel="+r,t,i.INFO)),r++}return n.TestMask(b)||(n.SetBit(0),e("!!! Reading an identity without world region option, set it to default.",t,i.INFO)),n},U.prototype.Clear=function(){try{this.m_mStandardFields=[],this.m_aCustomFields.length=0,this.m_lStandardGroups=[],this.m_mGroupInstances={},this.m_lUnlistedValues=[],this.m_nAddIndex=0,this.m_SummaryGroup.Clear(),this.m_CustomGroup.Clear()}catch(e){n("ERROR in CIdentityFieldSet::Clear "+e.message,t)}},U.prototype.AddStandardFieldValue=function(r,s,a,o){try{var u=o||"",m=a||"",l=s;"Birth Day"==r&&1==l.length&&l[0]>="0"&&l[0]<="9"&&(l="0"+l);var d=this.LookupStandard(r);if(!d)return;d.m_FieldFormat.IsInfoField(r),d.m_FieldFormat.GetComputable();if(""==u)u=d.m_sGroupName;else if(u!=d.m_sGroupName)return;var h=this.m_mGroupInstances[d.m_sGroupName.toString()];if(!h)return void e("AddStandardFieldValue: can not find instances for group "+d.m_sGroupName,t,i.INFO);d.SetFieldValue(m,l,!0),h.m_mInstances[m]||(e("######### AddStandardFieldValue.   instance is not in group yet add instance as non-default: "+m,t,i.INFO),h.m_mInstances[m]=!0)}catch(e){n("ERROR in CIdentityFieldSet::AddStandardFieldValue "+e.message,t)}},U.prototype.RemoveInstanceForGroup=function(n,r){var s=this.m_mGroupInstances[n];s?delete s.m_mInstances[r]:e("CIdentityFieldSet.RemoveInstanceForGroup: can not find instances for group='"+n+"'",t,i.INFO)},U.prototype.AddInstanceForGroup=function(n,r){var s=this.m_mGroupInstances[n];s?s.m_mInstances[r]||(e("CIdentityFieldSet.AddInstanceForGroup   instance is not in group yet add instance as non-default: "+r,t,i.INFO),s.m_mInstances[r]=!0):e("CIdentityFieldSet.AddInstanceForGroup: can not find instances for group='"+n+"'",t,i.INFO)},U.prototype.GetInstancesForGroup=function(e){try{return e in this.m_mGroupInstances?this.m_mGroupInstances[e].getInstances():[]}catch(e){n("ERROR in CIdentityFieldSet::GetDefaultInstanceName "+e.message,t)}},U.prototype.SetDefaultInstanceName=function(r,s){try{r in this.m_mGroupInstances&&(e("CIdentityFieldSet.SetDefaultInstanceName. GROUP:"+r+" INSTANCE:"+s+" ID: "+this.m_nIndex,t,i.INFO),this.m_mGroupInstances[r].SetDefaultInstanceName(s))}catch(e){n("ERROR in CIdentityFieldSet::SetDefaultInstanceName "+e.message,t)}},U.prototype.GetCurrentInstanceName=function(e,i){try{var s=this.m_mGroupInstances[e.toString()];return null==s||null==s?r.enRetCode_WrongGroup:(i.sInstanceName=s.GetCurrentInstanceName(),r.enRetCode_Succeeded)}catch(e){return n("ERROR in CIdentityFieldSet::GetCurrentInstanceName "+e.message,t),0}},U.prototype.LookupStandard=function(t){return t in this.m_mStandardFields?this.m_mStandardFields[t]:null};var z=0,j=1,J=2;function Y(t){this.m_FieldSet=t?new U(t):null,this.m_nIndex=Math.floor(10001*Math.random()),this.m_sxmlData=""}function H(e){if(this.m_sWhole="",this.m_sNormalized="",this.m_sInsideBrackets="",this.m_bBracketsStructureIsCorrect=!0,this.m_bBracketsEncountered=!1,this.m_nWordsCount=0,1==arguments.length)try{this.m_bBracketsStructureIsCorrect=!0,this.m_bBracketsEncountered=!1,this.m_nWordsCount=0;var i=e?e.length:0,r=0;for(r=0;r<i&&_(e.charCodeAt(r));++r);if(r>=i)return;for(var s=!1,a=0,o=!0,u=0;r<i;){var m="";switch(0!=u?(m=u,u=0):m=e.charAt(r++).toLowerCase().charCodeAt(0),m>65118&&(m=CharNormalWidth(m)),m){case 226:case 228:case 227:case 225:case 229:case 224:case 261:m=97;break;case 233:case 232:case 234:case 281:case 283:m=101;break;case 237:case 239:case 304:case 305:m=105;break;case 243:case 244:case 248:case 333:case 246:m=111;break;case 241:case 324:m=110;break;case 250:case 252:case 367:m=117;break;case 231:case 263:case 269:m=99;break;case 322:m=108;break;case 223:m=115,u=115;break;case 253:m=121;break;case 287:m=103;break;case 345:m=114;break;case 347:case 351:case 353:m=115;break;case 378:case 380:case 382:m=122;break;case 39:if(r<i&&"s"==e.charAt(r).toLowerCase()){r++;continue}m=32}var l=String.fromCharCode(m);if(d(l)){(s||o)&&this.m_nWordsCount++,o&&(o=!1);var h=a>0?this.m_sInsideBrackets:this.m_sNormalized;s&&(""!=h&&(h+=" "),this.m_sWhole+=" ",s=!1),this.m_sWhole+=l,h+=l,a>0?this.m_sInsideBrackets=h:this.m_sNormalized=h}else switch(s=!0,l){case"(":case"[":""!=this.m_sWhole&&(this.m_sWhole+=" "),this.m_sWhole+="(",a++,this.m_bBracketsEncountered=!0;break;case")":case"]":""!=this.m_sWhole&&(this.m_sWhole+=" "),this.m_sWhole+=")",--a<0&&(this.m_bBracketsStructureIsCorrect=!1),this.m_bBracketsEncountered=!0}}s&&(this.m_sWhole+=" "),0!=a&&(this.m_bBracketsStructureIsCorrect=!1)}catch(e){n("ERROR in CTitleStringData ctor"+e,t)}}Y.prototype.GetNumberOfCustomValues=function(){return this.getFields().GetCustomValuesCount()},Y.prototype.getCountry=function(){return this.getFields().getCountry()},Y.prototype.setCountry=function(t){this.getFields().setCountry(t)},Y.prototype.setFields=function(t){this.m_FieldSet=t},Y.prototype.getFields=function(){return this.m_FieldSet},Y.prototype.toString=function(){return"<-### [CIdentity] OBJECT.  ID:"+this.m_nIndex+" COUNTRY: "+this.getCountry()+" FIELDSET: "+this.m_FieldSet+"  ###->"},Y.prototype.SetDefaultInstanceName=function(t,e){this.getFields().SetDefaultInstanceName(t,e)},Y.prototype.RemoveInstanceForGroup=function(t,e){this.getFields().RemoveInstanceForGroup(t,e)},Y.prototype.AddInstanceForGroup=function(t,e){this.getFields().AddInstanceForGroup(t,e)},Y.prototype.AddStandardFieldValue=function(t,e,i,n){this.getFields().AddStandardFieldValue(t,e,i,n)},Y.prototype.AddCustomFieldValue=function(t,e,i,n){this.getFields().AddCustom(t,e,i,n)},Y.prototype.GetPhonePrefixMode=function(){var t=this.LookupOptionValue("Phone prefix mode");return-1==t?z:"0"==t?z:"1"==t?j:"2"==t?J:z},Y.prototype.SetOptionValue=function(t,e){this.m_FieldSet.m_mOptionValues[t]=e},Y.prototype.LookupOptionValue=function(t){return void 0===this.m_FieldSet.m_mOptionValues[t]?-1:this.m_FieldSet.m_mOptionValues[t]},Y.prototype.SetPhonePrefixMode=function(t){var e=this.GetPhonePrefixMode();if(t!=e){var i="";switch(t){case z:i="0";break;case j:i="1";break;case J:i="2"}this.SetOptionValue("Phone prefix mode",i)}return e},Y.prototype.GetPhonePrefixCurrent=function(){return this.GetPhonePrefixSpecified(this.GetPhonePrefixMode())},Y.prototype.GetPhonePrefixSpecified=function(t){var e="",i="";switch(t){case j:i="National Prefix Present";break;case J:i="Country Code Present";break;default:return e}var n=this.getFields().LookupStandard(i);return n?e=n.GetValue(this.m_FieldSet,n.GetCurrentInstanceName(this.m_FieldSet)):e},Y.prototype.assign=function(t){return this.m_FieldSet=t.m_FieldSet,this.m_sxmlData=t.m_sxmlData,this},Y.prototype.clone=function(){return(new Y).assign(this)},Y.prototype.equals=function(){return!1},Y.prototype.Filling7=function(n,r,s,a,o,u,m){var l=!1,d=new x,h=new x;if(r)for(var _=this.getFields().GetCustomValuesCount(),c=0;c<_;c++){var p=this.getFields().GetCustomField(c),f=p.GetFieldFormat().GetMainMatchString();""!=f.GetStringData().GetWhole()&&(h.setParameters(4,null,null,p,null,s,a,n,m),h.isBetter(d)&&(u.sFieldName=f.GetStringRepresentation(),d.Clone(h),u.pResult=p,l=!0))}else for(var F=this.getFields(),b=F.m_lAllRules,S=b.length,g=0;g<S;g++)for(var C=b[g],y=!1,I=C.m_lRules,N=I.length,R=C.m_sFieldName,G=F.LookupStandard(R),O=0;O<N;){if(0!=O||y)h.setParameters(4,null,null,null,I[O],s,a,n,m),O++;else{if(y=!0,!C.m_bValueMatch||a||!G)continue;h.setParameters(3,o,this,G,null,null,!1,!1,m)}if(h.m_bValid){if(G&&!this.Correspond(G,R,o)){e("  --BetterMatch killed by Correspond\n",t,i.INFO);continue}h.m_pField=G,h.isBetter(d)?(d.Clone(h),l=!0,u.sFieldName=R,u.pResult=G,e("    $$BetterRule: field_name="+R+" rule="+R,t,i.INFO)):e("    ..NotBetter\n",t,i.INFO)}}return l},Y.prototype.Correspond=function(n,r,a){var o=n.GetFieldFormat(),u=o.GetType();switch(e("    CIdentity::Correspond: type="+u+" sFieldName="+r,t,i.INFO),u){case s.valueNormal:case s.valueSelect:var m=a[0];if(!o.Satisfies(m,r))return!1;break;case s.valueMultiline:for(var l=0;l<a.length;l++){m=a[l];if(!o.Satisfies(m,r))return!1}break;case s.valueSectional:var d=o.GetBestPartitioning(a.length);if(!d){if(!o.Satisfies(a[0],r))return!1;break}for(var h=0;h<d.length;h++){m=a[h];var _=d[h];switch(_.m_eType){case 0:if(!o.Satisfies(m,r))return!1;if(m.GetType()==RfFieldType.RfFieldTextArea)return!1;break;case 1:var c=this.getFields().LookupStandard(_.m_sValueName);if(!c||!c.GetFieldFormat().Satisfies(m,r))return!1;if(m.GetType()==RfFieldType.RfFieldTextArea)return!1}}}return!0},Y.prototype.Filling=function(r,s,a){try{e("+++ CIdentity.Filling: trying to find rule for name='"+r.GetName()+"'",t,i.INFO);var o=r.GetName(),u=new B(o),m=RfIsStringHieroglyph(o);if(this.Filling7(!0,!0,u,!0,s,a,m))return e("+++ CIdentity.Filling: 1 STEP Filling7 returns = TRUE",t,i.INFO),!0;e("+++ CIdentity.Filling: 1 STEP Filling7 returns FALSE. CUSTOM=TRUE, NAME_ONLY=FALSE, sFieldName="+o,t,i.INFO);var l=r.GetTitle(),d=this.getFields().GetCustomValuesCount();if(e("Filling: title to match='"+l+"'",t,i.INFO),d>0){var h=new B(l),_=RfIsStringHieroglyph(l);if(this.Filling7(!1,!0,h,!1,s,a,_)||this.Filling7(!1,!0,u,!0,s,a,m))return e("+++ CIdentity.Filling: CUSTOM_FIELDS STEP Filling7 returns = TRUE",t,i.INFO),!0;e("+++ CIdentity.Filling: CUSTOM_FIELDS STEP Filling7 returns = FALSE",t,i.INFO)}var c=new B(l=RfTranslateWords(l)),p=RfIsStringHieroglyph(l);if(e("Filling: translated title='"+l+"'",t,i.INFO),this.Filling7(!1,!1,c,!1,s,a,p))return e("+++ CIdentity.Filling: 3 STEP Filling7 returns = TRUE",t,i.INFO),!0;var f=o.lastIndexOf("/");f>=0&&(o=o.substr(f+1),e("Filling: field are shortened to='"+o+"'",t,i.INFO)),(f=o.lastIndexOf("."))>=0&&(o=o.substr(f+1),e("Filling: field are shortened to='"+o+"'",t,i.INFO));var F=new B(o=RfTranslateWords(o));m=RfIsStringHieroglyph(o);var b=this.Filling7(!1,!1,F,!0,s,a,m);return e("+++ CIdentity.Filling: 4 STEP Filling7 returns = "+b,t,i.INFO),b}catch(e){return n("ERROR in CIdentity::Filling "+e.message,t),!1}},H.prototype.Clear=function(){this.m_sWhole="",this.m_sNormalized="",this.m_sInsideBrackets="",this.m_bBracketsStructureIsCorrect=!0,this.m_bBracketsEncountered=!1,this.m_nWordsCount=0},H.prototype.GetNormalized=function(){return this.m_sNormalized},H.prototype.GetInsideBrackets=function(){return this.m_sInsideBrackets},H.prototype.GetWhole=function(){return this.m_sWhole},H.prototype.GetWordsCount=function(){return this.m_nWordsCount},H.prototype.GetBracketsEncountered=function(){return this.m_bBracketsEncountered},H.prototype.GetBracketsStructureIsCorrect=function(){return this.m_bBracketsStructureIsCorrect},H.prototype.toString=function(){return"<<CTitleStringData>>  WHOLE='"+this.m_sWhole+"'  \nNormalized="+this.m_sNormalized+" InsideBrackets ="+this.m_sInsideBrackets+"\nWORDS="+this.m_nWordsCount+"  BracketsEncountered = "+this.m_bBracketsEncountered+"  BracketsStructureIsCorrect="+this.m_bBracketsStructureIsCorrect},H.prototype.DeleteAllSpaces=function(){this.m_sWhole=RfDeleteSpaces(this.m_sWhole),this.m_sNormalized=RfDeleteSpaces(this.m_sNormalized),this.m_sInsideBrackets=RfDeleteSpaces(this.m_sInsideBrackets)},RfapiJS.CIdentity=Y}).apply(RfapiJS);
//# sourceMappingURL=identity.js.map