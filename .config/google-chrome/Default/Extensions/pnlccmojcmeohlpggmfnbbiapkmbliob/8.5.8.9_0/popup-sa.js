// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
var ITEM_NAME_PROP="n",FIELD_CAPTION_PROP="c",FIELD_VALUE_PROP="v",FIELD_TYPE_PROP="t",ITEM_ISDEFAULT_PROP="d",FIELD_ORDER_JSON="i",FIELD_ID_JSON="id",ID_OPTIONS_PROP="o",ID_GROUPS_PROP="g",ID_INSTANCES_PROP="i",ITEMDATA_FIELDS_PROP="f",GROUP_CUSTOMFIELDS="Custom",MAX_CUSTOM_FIELDS_COUNT=25,MIN_CUSTOM_FIELDS_COUNT=5,SYMBOL_WIDTH=7,IDFIELD_NAME_ATTR="field-name",IDFIELD_VALUE_ATTR="field-value",IDFIELD_GROUPTYPE_ATTR="group-type",IDFIELD_INSTANCE_ATTR="instance-name",IDFIELD_CUSTOM_ATTR="isCustom",IDFIELD_INDEX_ATTR="field-index",IMG_GR_INSTANCE="gr_inst.png",RFNAME_NOTE_SPECIAL="note$",SPECIAL_PCARD_FIELDS=["prompt$",RFNAME_NOTE_SPECIAL],EDITPASS_INPUT_CLASSNAME="rf_passcard_table_input",EDITPASS_TEXTAREA_CLASSNAME="rf_passcard_table_area",IMG_SWITCH_PWD=GetLocalURL("show_password_tc.png"),IMG_SAFENOTE_48=GetLocalURL("safenote48.png"),IMG_IDENTITY_48=GetLocalURL("identity48.png"),IMG_CONTACT_48=GetLocalURL("Contact48.png"),NAME_MAXLENGHT=255,PASSWORD_CHAR_LIMIT=99,trace_filename="popup-sa.js",g_tsstart=(new Date).getTime(),PopupStandalone=function(){function e(){PopupBase.call(this),this.g_is_V8=!0,this.searchValue="",this.kMouseEvents=["mousedown","mouseup","mouseover","mousemove","mouseout","mousewheel","click","mouseenter","mouseleave"],this.skipGlobalListener=!1,this.m_bFirstStart=!1,this.m_bAllowOnlyCreate=!1,this.base=PopupBase.prototype,this.ID_OBJECT_SELECT_FIRST=1e3,this.m_nNextIndex=this.ID_OBJECT_SELECT_FIRST,this.EnObjectAction={Edit:0,Rename:1,Delete:2,Goto:3,GoFill:4,LoginSameWindow:5,LoginNewWindow:6,FillForms_ID:7,FillSubmit_ID:8,CreateFolder:9,Save:10,CreateSafenote:11,CreateContact:12,CreateIdentity:13,GotoSameTab:15,GotoNewTab:16,Sharing:17,SearchNewTab:18,SearchSameTab:19,Send:20,ShareFolder:21},this.yahooSearchLink="http://search.yahoo.com/search?fr=robo&p=",this.googleSearchLink="http://www.google.com/search?ie=UTF-8&oe=UTF-8&q=",this.bingSearchLink="https://www.bing.com/search?q=",this.ebaySearchLink="http://www.ebay.com/sch/items/?_nkw=",this.amazonSearchLink="https://www.amazon.com/s/field-keywords=",this.MAX_CHARS_CAPTION=30,this.n_closeexpireInter=0,this.EXPIRE_DLG_CLOSE_SECONDS=5,this.n_expdlg_close_seconds=this.EXPIRE_DLG_CLOSE_SECONDS,this.g_ff_selectedtabid="",this.local_tabs_arr=[],this.timeoutContextMenu=0,this.m_oAccountInfo=null,this.m_bExpiredLicense=!1,this.m_bTrialLicense=!1,this.m_bEnterprise=!1,this.m_bEnterpriseLicenseActive=!1,window.oncontextmenu=function(){return!1}}e.prototype=Object.create(PopupBase.prototype),e.prototype.OnLoad=function(e){this.base.OnLoad.call(this);var t=this;try{this.m_bFirstStart=e,window.addEventListener("unload",function(){t.OnUnload()},!1),document.documentElement.style.width="",this.AddStyleSheets(),this.AddJsFiles(),this.LocalizeGlobalText(),this.LoadTemplates(),this.CreateMainScreenContextMenu(),this.AddGlobalListeners();var n=new ViewItem("strip_loader_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Load Screen",views:[i],skip_navigation:!0}),this.m_bFirstStart?this.ShowCreateAccountDialog():this.CheckUserStatus()}catch(e){Q(e),this.OnError(kCannotLoadExtension,e)}browser.runtime.onMessage.addListener(function(e,n,i){return t.OnMessageFromBG(e,n,i)})},e.prototype.OnMessageFromBG=function(e,t,n){switch(e.name){case"AskPasswordForItem":return this.AskPasswordForItem(e.params,n)}},e.prototype.AskPasswordForItem=function(e,t){var n=JSON.parse(e[0]),i=(n.item_path,n.item_type,n.requested_level,n.bAskPassword,n.sAltPassword,this);return this.ShowMasterPasswordDialog({callback:function(e){t(e?{result:"ok",password:e}:{result:"cancelled"}),i.m_navigator.GoBack()}}),!0},e.prototype.SetupAutoFocus=function(e){e.setAttribute("autofocus","")},e.prototype.OnMatch=function(e,t,n){n.m_sName;var i,o=this;t.appendChild(i=this.createElement("div",{class:"toolbar-minidialog-icon-V8"})),i.addEventListener("click",function(e){var t=$("match_dialog_div");"none"==t.style.display||t.getAttribute("hidden")?(o.HideContextMenus(),o.ShowMatchingLoginsDialog(e)):o.HideContextMenus(),e.preventDefault(),e.stopPropagation()},!1),this.kMinidialogButtonMouseEvents.forEach(function(e){i.addEventListener(e,function(e){e.stopImmediatePropagation()},!1)}),i.addEventListener("mouseover",function(e){RemoveClass(t,"toolbar-button-V8-hover")},!1),i.addEventListener("mouseout",function(e){AddClass(t,"toolbar-button-V8-hover")},!1)},e.prototype.OnIdMatch=function(e,t){var n,i=this;t.appendChild(n=this.createElement("div",{class:"toolbar-minidialog-icon-V8"})),n.addEventListener("click",function(e){var n=t.getAttribute(ITEMINFO_PROPERTY),o=$("identity_minidialog_div");n&&("none"==o.style.display||o.getAttribute("hidden"))?(i.HideContextMenus(),i.ShowIdentityMiniDialog(n,this.parentElement.offsetTop,!1)):i.HideContextMenus(),e.preventDefault(),e.stopPropagation()},!1),this.kMinidialogButtonMouseEvents.forEach(function(e){n.addEventListener(e,function(e){e.stopImmediatePropagation()},!1)}),n.addEventListener("mouseover",function(){RemoveClass(t,"toolbar-button-V8-hover")},!1),n.addEventListener("mouseout",function(){AddClass(t,"toolbar-button-V8-hover")},!1)},e.prototype.PopupOnKeyUp=function(e){var t=e.key;parseInt(e.id)===ID_SEARCH&&("ArrowUp"===t||"Up"===t?this.SearchBoxSelectPrevious():"ArrowDown"!==t&&"Down"!==t||this.SearchBoxSelectNext())},e.prototype.PostUIEvent=function(e,t){"click"==t?this.Popup_MenuItemClick(e):"mouseup"==t?this.Popup_OnMouseUp(e):"keyup"==t&&this.PopupOnKeyUp(e)},e.prototype.OnUIEvent=function(e){this.skipGlobalListener?this.skipGlobalListener=!1:this.base.OnUIEvent.call(this,e)},e.prototype.AddStyleSheets=function(){AddCssFile("popup-sa.css"),g_isedge&&AddCssFile("details-shim.min.css")},e.prototype.AddJsFiles=function(){g_isedge&&AddJsFile("details-shim.min.js")},e.prototype.CheckDisableNonGroupData=function(){return!!this.m_oAccountInfo.oneFile&&(!!this.m_bEnterprise&&(!CheckIsCompanyAdmin(this.m_oAccountInfo)&&getBG().g_policySet.GetConfigValue(ConfigDisableNonGroupData)))},e.prototype.CheckLicenseIsExpired=function(){return this.m_bEnterprise?!this.m_bEnterpriseLicenseActive:!!this.m_bExpiredLicense},e.prototype.CheckRecievedData=function(e){var t=this,n=void 0!==e.enterprise&&e.enterprise;if(t.CheckMasterPasswordCorrect(n)){t.m_oAccountInfo=e,t.m_bExpiredLicense=void 0!==e.licenseExpired&&e.licenseExpired,t.m_bTrialLicense=void 0!==e.licenseTrial&&e.licenseTrial,t.m_bEnterprise=void 0!==e.enterprise&&e.enterprise,t.m_bEnterpriseLicenseActive=void 0!==e.enterpriseLicenseActive&&e.enterpriseLicenseActive;var i=e.oneFile;t.CheckContextMenuItemsForAccountType(),getBG().broadcast_message_to_auto_save_dialog({name:"AutoSaveUserLoggedIn"}),i?t.CheckCompanyInvitations(function(){a()},function(e){t.ShowCompanyInviteDialog(e,function(){a()})}):t.ShowStartPage()}function o(){getBG().g_policySet.GetConfigValue(ConfigDisableEmergencyAccess)?t.ShowStartPage():t.CheckEmergencyAccessInvitations(function(){t.ShowStartPage()},function(e){t.ShowHandleEAInviteDialog(e)})}function a(){t.CheckReceivedAccountsFiles(function(){o()},function(e,n){if(e.length)t.ShowReceivedAccountsDialog(e,n,function(){o()});else{for(var i=!1,a=!1,r=0;r<n.length;r++)n[r].hash?i=!0:a=!0;i?t.ShowReceivedFilesDialog(n,function(){a?t.ShowSendFilesDialog(n,function(){o()}):o()}):a?t.ShowSendFilesDialog(n,function(){o()}):o()}},function(e){})}},e.prototype.CheckUserStatus=function(){var e=this;getProxyRfo().CheckUserStatus().then(function(t){var n=JSON.parse(t);e.CheckRecievedData(n.accountInfo)}).catch(function(t){var n=t[JSON_MSG_CODE],i=t[JSON_MSG_DESCRIPTION];400==n&&g_issafari&&getProxyRfo().OpenPage({url:GetSetting("internal","active-server")+"/site/signup?safari-initialize",bNewWindow:!0,bActivateIfExists:!1}),401!=n&&n!=ERR_ACCESS_DENIED&&503!=n?n!=Err_NeedOTP?e.ShowAccountLoginDialog({description:i}):setTimeout(function(){var n=getProxyRfo().GetUserName(),i=getProxyRfo().GetAccountPassword();n&&i?e.ShowOTPDialog(t.params,!1):e.CheckCachedUserId()},200):e.CheckCachedUserId(i)})},e.prototype.CheckMasterPasswordCorrect=function(e){if(getProxyRfo().g_accountpwd){if(!e)return!0;var t=getProxyRfo().IsMasterPasswordCorrect(getProxyRfo().g_accountpwd),n=getBG().g_policySet;if(1!=t.result||n.g_passwordExpired||n.g_forcePasswordChange){var i=n.g_passwordAgeDays,o=n.g_passwordDaysLeft;if(this.ShowChangeMasterPasswordDialog(),$("change_master_password_error_div").innerHTML="",$("change_master_password_header_text").innerHTML=localeString("Android_pref_set_master_password_title"),1!=t.result&&($("change_master_password_error_div").innerHTML=t.reason,$("change_master_password_error_title").innerHTML="RoboForm Policies were changed for this account:"),n.g_passwordExpired)if(!i&&o<0)$("change_master_password_header_text").innerHTML=localeString("Android_pref_set_master_password_title"),$("change_master_password_error_title").innerHTML="You have to change your temporary password for security reasons";else if(0!=i&&o<0){$("change_master_password_header_text").innerHTML=localeString("Android_pref_set_master_password_title"),$("change_master_password_error_title").innerHTML="You have to change your password for security reasons";var a=n.GetConfigValue(ConfigMPRotationTimeDays);a&&($("change_master_password_error_div").innerHTML="You must change your Master Password each "+a+" days")}else $("change_master_password_header_text").innerHTML=localeString("MasterPass_Expired");return!1}return!0}this.CheckCachedUserId()},e.prototype.CheckCachedUserId=function(e){var t=this;setTimeout(function(){var n=getProxyRfo().GetUserName();if(n){var i={description:e,user_id:n};t.ShowAccountPasswordDialog(i)}else t.ShowAccountLoginDialog({description:e})},0)},e.prototype.LogOff=function(){this.searchValue="";var e=this;setTimeout(function(){getProxyRfo().LogOffAccount(function(t){e.ResponseLogOff(t)})},0)},e.prototype.ResponseLogOff=function(e){if(void 0!==JSON.parse(e)){var t=this;setTimeout(function(){getBG().broadcast_message_to_auto_save_dialog({name:"AutoSaveUserLoggedOff"}),t.CheckCachedUserId()},0)}},e.prototype.ClosePopup=function(e){g_ismaxthon?window.external.mxGetRuntime().getActionByName("rfpanel").hide():setTimeout(function(){g_issafari&&safari.extension.popovers.filter(function(e){return e.contentWindow==window})[0].hide();window.close()},e)},e.prototype.MainScreen_OnScroll=function(){this.HideContextMenu()},e.prototype.Popup_Dialog_CheckNameValid=function(e,t){$(e).innerHTML="";var n=this.m_navigator.GetCurrentContext(),i=n&&n.item_info&&n.item_info.Shared,o=$(t).value;if(!o||!CheckNameIsValid(o))return $(e).innerHTML=localeString("NameInvalidCharacter_Error2"),$(t).focus(),!1;if(i){if(o.length>60)return $(e).innerHTML="Name length must be 1-60 symbols",$(t).focus(),!1}else if(o.length>NAME_MAXLENGHT)return $(e).innerHTML=localeString("SA_WrongObjectName_Error"),$(t).focus(),!1;return!0},e.prototype.GetScrollPosition=function(e){e.scrollTop=$("listscrolldiv")?$("listscrolldiv").scrollTop:0},e.prototype.SetScrollPosition=function(e){$("listscrolldiv")&&($("listscrolldiv").scrollTop=e.scrollTop)},e.prototype.FillIdentity=function(e,t,n,i,o){var a;if(void 0===i&&(i=GetSetting("sa-settings","rf_fill_empty_fields_chk")),o=void 0===o?void 0:o.length?o:void 0){a={};for(var r=0;r<o.length;r++){var s=o[r];for(var l in s)a[l]=s[l]}}var c=this;g_bg_connector.FillFormsInWindowRfApi(e.path,e.type,!0,!i,!1,!0,"",!1,t,!1,a,void 0,void 0,GetSetting("sa-settings","rf_highlight_filledflds_chk"),function(){c.ClosePopup(500)})},e.prototype.Response_NavigateFillSubmitAction=function(e){var t=JSON.parse(e);this.CheckGlobalErrorResponse(t)||this.ClosePopup(500)},e.prototype.ShowItemsListScreen=function(e,t,n,i,o){var a=this,r={};r[PATH_PROPERTY]=t,r[RFTYPE_PROPERTY]=e,r.parts=EnDataItemInfoParts.enUrls|EnDataItemInfoParts.enIcon,r.icon=!0,r.match=o,e.join(),getProxyRfo().GetItemsForFolder(JSON.stringify(r),function(e){var t=JSON.parse(e);t.context.title=n,a.Response_GetItemsList(t,i)})},e.prototype.Response_GetItemsList=function(e,t){try{var n=this;setTimeout(function(){if(!n.CheckGlobalErrorResponse(e)){var i=e.context,o=e.items,a=i.type,r=i.path,s=i.title,l=n.GetViewItems(o,a),c=i.match;i={types:a,path:r,title:s,editCallback:t,match:c};var _=n.BuildItemsScrollView(l),d=new ViewItem(void 0,void 0,"header-list-title");d.m_oContext={title:s};var E=n.CreateUIItem(d),u=new ViewItem(void 0,void 0,"folder-navigation");u.m_oContext={path:r};var p=n.CreateUIItem(u),m=n.m_navigator.GetCurrentContext(),g=m?m.scrollTop:0;n.m_navigator.Navigate({name:"Item List",views:[E,p,_],context:i,initialize:function(e){n.InitItemsListScreen(e),e.scrollTop=g,n.SetScrollPosition(e),e.editCallback&&e.editCallback()},on_navigating_from:function(e){n.GetScrollPosition(e),g=e.scrollTop,n.HideContextMenus()},on_navigated_to:function(e){n.SetScrollPosition(e)}})}},0)}catch(e){Q("EXCEPTION in Response_GetList:"+e.toString())}},e.prototype.GetViewItems=function(e,t){for(var n=[],i=[],o=0;o<e.length;++o){var a=e[o],r=this.m_nNextIndex++,s=a[PATH_PROPERTY],l=a[ITEMINFO_TYPE_PROP],c=getTextForItem(a),_=null;a.gotoUrl&&(m=a.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))||(_=a.error?"":getImageForType(a));var d={};d.types=t;var E=new ViewItem(ITEM_INFO_VIEW_ITEM_PREFIX+r,0,l==EnRfDataItemType.RfItemType_Folder?"menu":"button",c,s,s,_,a,d);l==EnRfDataItemType.RfItemType_Folder?i.unshift(E):n.push(E)}for(var u=0;u<i.length;++u)n.unshift(i[u]);return n},e.prototype.ItemInfoClick=function(e){var t=$(e),n=-1!=e.indexOf(MENU_MATCHLOGINS),i=t.getAttribute(ITEMINFO_PROPERTY);if(i){var o=JSON.parse(i);switch(o[ITEMINFO_TYPE_PROP]){case EnRfDataItemType.RfItemType_Folder:var a=t.getAttribute("context");if(!a)return;var r=JSON.parse(a).types,s=(_=this.m_navigator.GetCurrentContext()).title,l=[];for(var c in r)l.push(r[c]);this.ShowItemsListScreen(l,o[ITEMINFO_PATH_PROP],s,void 0,_.match);break;case EnRfDataItemType.RfItemType_Login:case EnRfDataItemType.RfItemType_Bookmark:var _=this.m_navigator.GetCurrentContext();n=n||!(!_||!_.match);var d=!0,E=GetSetting("sa-settings","rf_match_fillsubmitaction"),u=!n||E,p=!1;o[ITEMINFO_TYPE_PROP]==EnRfDataItemType.RfItemType_Bookmark&&(d=u=p=!1);var m={};m.bNewWindow=p,m.bSubmit=u,m.bFill=d,m.bNavigate=!n,m.item_info=o,m.action=this.EnObjectAction.GoFill;var g=this,I=JSON.stringify(m);getProxyRfo().NavigateFillSubmitAction(I,function(e){g.Response_NavigateFillSubmitAction(e)});break;case EnRfDataItemType.RfItemType_Contact:case EnRfDataItemType.RfItemType_Safenote:case EnRfDataItemType.RfItemType_SearchCard:case EnRfDataItemType.RfItemType_BlockingPasscard:this.EditItem(o);break;case EnRfDataItemType.RfItemType_Identity:var T=GetSetting("sa-settings","rf_identity_fillsubmitaction"),S=isNaN(parseInt(e))?parseInt(e.substr(10)):parseInt(e),f=S>=ID_IDENTITY_MATCH_FIRST&&S<=ID_IDENTITY_MATCH_LAST;if(this.HideContextMenus(),f){var h=T?this.EnObjectAction.FillSubmit_ID:this.EnObjectAction.FillForms_ID;this.FillIdentity(o,h!=this.EnObjectAction.FillForms_ID,h)}else this.ShowIdentityMiniDialog(JSON.stringify(o),window.event.clientY,!0)}}},e.prototype.Popup_MenuItemClick=function(e){try{var t=e.id,n=parseInt(t);if(t.startsWith(ITEM_INFO_VIEW_ITEM_PREFIX)||!isNaN(n)&&n>=ID_IDENTITY_MATCH_FIRST&&n<=ID_IDENTITY_MATCH_LAST)return void this.ItemInfoClick(t);switch(t){case MENU_MATCHLOGINS:case MENU_MATCHLOGINS+"0":case MENU_MATCHLOGINS+"1":case MENU_MATCHLOGINS+"2":case MENU_MATCHLOGINS+"3":this.ItemInfoClick(t)}}catch(e){Q("EXCEPTION in Popup_MenuItemClick:"+(e.description?e.description:e.stack))}},e.prototype.ShowLocalHelp=function(){var e={bNewWindow:!1,url:"localhelp.html",bActivateIfExists:!0};getProxyRfo().OpenPage(e),this.ClosePopup(100)},e.prototype.ResponseGetRecentlyUsedItems=function(e){var t,n=e.context.types,i=this,o=[];ArrayInclude(n,EnRfDataItemType.RfItemType_Login)?t=LOGIN_IMAGE:ArrayInclude(n,EnRfDataItemType.RfItemType_Bookmark)?t=BOOKMARK_IMAGE:ArrayInclude(n,EnRfDataItemType.RfItemType_Contact)?t=CONTACT_IMAGE:ArrayInclude(n,EnRfDataItemType.RfItemType_Identity)?t=IDENTITY_IMAGE:ArrayInclude(n,EnRfDataItemType.RfItemType_Safenote)&&(t=SAFENOTE_IMAGE);var a=new ViewItem(void 0,void 0,"header-simple-title");a.m_oContext={image_data:t,title:localeString("StartPage_RecentlyUsed")};for(var r=i.CreateUIItem(a),s=e[ITEMS_PROPERTY],l=0;l<s.length;l++){var c=s[l];if(void 0!==c[PATH_PROPERTY]){var _=this.m_nNextIndex++,d=c[PATH_PROPERTY],E=getTextForItem(c),u=null;c.gotoUrl&&(m=c.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))||(u=c.error?"":getImageForType(c));var p=new ViewItem(ITEM_INFO_VIEW_ITEM_PREFIX+_,0,"button",E,d,d,u,c,{});o.push(p)}}var g=new ViewItem(0,0,"separator");o.push(g);var I=new ViewItem(MENU_RECENTLY_CLEARALL,0,"button",localeString("Cmd_ClearList_Key"),MENU_RECENTLY_CLEARALL,"",RECENTLYCLEAR_IMAGE,void 0,{});o.push(I);var T={types:n},S=i.BuildItemsScrollView(o,1);i.m_navigator.Navigate({name:"Recently Used",context:T,views:[r,S],initialize:function(e){i.InitRecentlyUsedScreen(e)},on_navigating_from:function(e){i.HideContextMenus()}})},e.prototype.InitRecentlyUsedScreen=function(e){var t=this;$(MENU_RECENTLY_CLEARALL).addEventListener("click",function(){var e=t.m_navigator.GetCurrentContext().types,n={};n.types=e,getProxyRfo().ClearHistoryList(JSON.stringify(n),function(e){t.ResponseGetRecentlyUsedItems(JSON.parse(e))})},!1)},e.prototype.GetObjectAction=function(e){switch(e){case"contextmenu_edit_tr":return this.EnObjectAction.Edit;case"contextmenu_rename_tr":return this.EnObjectAction.Rename;case"contextmenu_delete_tr":return this.EnObjectAction.Delete;case"contextmenu_loginsame_tr":return this.EnObjectAction.LoginSameWindow;case"contextmenu_loginnew_tr":return this.EnObjectAction.LoginNewWindow;case"contextmenu_gofill_tr":return this.EnObjectAction.GoFill;case"contextmenu_goto_tr":return this.EnObjectAction.Goto;case"contextmenu_fillformsid_tr":return this.EnObjectAction.FillForms_ID;case"contextmenu_fillsubmitid_tr":return this.EnObjectAction.FillSubmit_ID;case"contextmenu_createfolder_tr":return this.EnObjectAction.CreateFolder;case"contextmenu_createsafenote_tr":return this.EnObjectAction.CreateSafenote;case"contextmenu_createcontact_tr":return this.EnObjectAction.CreateContact;case"contextmenu_createidentity_tr":return this.EnObjectAction.CreateIdentity;case"contextmenu_gotonew_tr":return this.EnObjectAction.GotoNewTab;case"contextmenu_gotosame_tr":return this.EnObjectAction.GotoSameTab;case"contextmenu_sharing_tr":return this.EnObjectAction.Sharing;case"contextmenu_search_new_tr":return this.EnObjectAction.SearchNewTab;case"contextmenu_search_this_tr":return this.EnObjectAction.SearchSameTab;case"contextmenu_send_tr":return this.EnObjectAction.Send;case"contextmenu_createsharedaccount_tr":return this.EnObjectAction.ShareFolder}},e.prototype.CheckGlobalErrorResponse2=function(e){if(!e)return!1;var t=e.Code;e.Description;return 401!=t||(this.ShowSessionExpiredDialog(),!1)},e.prototype.CheckGlobalErrorResponse=function(e){var t=e[JSON_MSG_ERROR];if(!t)return!1;var n=e.context,i=t[JSON_MSG_CODE],o=t[JSON_MSG_DESCRIPTION];return n.description=o,401==i&&this.ShowSessionExpiredDialog(),i==ERR_SUSPENDED_ACCOUNT&&this.ShowAccountSuspendedDialog(n),i==RFJS_TEXT_MASTPASSFORM_INVALID&&(n&&n.accountMode&&1==n.accountMode?this.CheckCachedUserId(o):this.ShowMasterPasswordDialog(n)),i==ERR_CREATE_MP&&this.ShowCreateMasterPasswordDialog(n),!0},e.prototype.GlobalInputKeyHandler=function(e){var t=(e=e||window.event).target?e.target:e.scrElement;if((e.charCode?e.charCode:e.which?e.which:e.keyCode)!=VK_ENTER_KEY)return!0;var n=t.getAttribute("id");return n==CREATEFLD_DLG_INPUT_ID?this.SubmitCreateFolderDialog():n==MASTERPWDCREATE_DLG_INPUT_ID?$(MASTERPWDCREATE_CONFIRM_ID).focus():n==MASTERPWDCREATE_CONFIRM_ID?this.SubmitCreateMasterPasswordDialog():n==MASTERPWDENTER_DLG_INPUT_ID?this.SubmitMasterPasswordDialog():n==OTP_SECTION_PWD_TXTBOX_ID?this.SubmitOTPDialog():n==LOGINDLG_USER_TXTBOX?this.AccountLoginDlg_NextClick():n==RENAMEFLD_DLG_INPUT_ID?this.SubmitRenameItemDialog():n==SIGNUP_DLG_STEP1_MAIL_TXT?$(SIGNUP_DLG_STEP1_MASTERPWD_TXT).focus():n==SIGNUP_DLG_STEP1_MASTERPWD_TXT?this.SignUpDlg_NextClicked_Step1():"enteraccountpwd_pwd_txt"==n?this.SubmitAccountPasswordDialog():n==CONFIRMPWD_DLG_PWDINPUT_ID?this.ConfirmPwdDlg_NextClicked():n==LOGINPWD_DLG_PWD_TXTBOX?this.AccountLoginPwdDlg_NextClick():n==CHANGEMASTPWD_CURRENTPWD_ID?$(CHANGEMASTPWD_NEWPWD_ID).focus():n==CHANGEMASTPWD_NEWPWD_ID?$(CHANGEMASTPWD_CONFIRMPWD_ID).focus():n==CHANGEMASTPWD_CONFIRMPWD_ID&&this.ChangeMasterPasswordClick(),!1},e.prototype.AddGlobalListeners=function(){var e=this;$("identitymini_submit_btn").addEventListener("click",function(){e.SubmitIdentityMiniDialog()},!1),$("identitymini_fill_btn").addEventListener("click",function(){e.FillIdentityMiniDialog()},!1),$("identitymini_edit_btn").addEventListener("click",function(){e.EditIdentityMiniDialog()},!1),$("identitymini_showall_link").addEventListener("click",function(t){e.ShowAllIdentityMiniDialog(),t.preventDefault()},!1),$("rfmatch_edit_btn").addEventListener("click",function(){e.MatchingLoginsDialogEditClick()},!1),$("rfmatch_fill_btn").addEventListener("click",function(){e.MatchingLoginsDialogFillClick()},!1),$("rfmatch_submit_btn").addEventListener("click",function(){e.MatchingLoginsDialogFillSubmitClick()},!1),$("rfmatch_showall_link").addEventListener("click",function(t){e.ShowAllLoginsClick(),t.preventDefault()},!1);var t=$("rfmatch_logins_fieldset");t&&t.addEventListener("scroll",function(t){e.HideContextMenu()},!1),$("match_dialog_div").addEventListener("mousedown",function(){e.HideContextMenu()},!1);for(var n=$("contextmenu_table"),i=0;i<n.rows.length;i++)!function(){var t=n.rows[i];t.getAttribute("id")&&(t.addEventListener("click",function(){e.ContextMenuItem_OnClick(t)},!1),t.addEventListener("mousedown",function(t){e.ContextMenuItem_OnMouseDown(t)},!1),t.addEventListener("mouseup",function(t){e.ContextMenuItem_OnMouseUp(t)},!1))}()},e.prototype.LocalizeGlobalText=function(){$(IMPORTDLG_IMPORT_BTN_ID).value=localeString("Import_ImportButton_Text"),$(IMPORTDLG_CANCEL_BTN_ID).value=localeString("Cmd_Close_Flat"),$("importbookmarks_done_btn").value=localeString("Cmd_Done_Flat"),$("add_EAContact_singleuser_label").textContent=localeString("EmergencyAccess_AddContact_Banner"),$("add_EAContact_selectuser_label").textContent=localeString("EmergencyAccess_AddContact_Banner"),$("add_EAContact_timeout_label").textContent=localeString("EmergencyAccess_AddContact_Timeout_Caption"),$("add_EAContact_add_btn").value=localeString("EmergencyAccess_SendInvite_Text"),$("add_EAContact_cancel_btn").value=localeString("EmergencyAccess_Cancel_Text"),$("edit_EAContact_timeout_label").textContent=localeString("EmergencyAccess_AddContact_Timeout_Caption"),$("edit_EAContact_edit_btn").value=localeString("EmergencyAccess_Save_Text"),$("edit_EAContact_cancel_btn").value=localeString("EmergencyAccess_Cancel_Text"),$("i_EAContactFor_tablecaption_user").textContent=localeString("EmergencyAccess_Name_Title"),$("i_EAContactFor_tablecaption_status").textContent=localeString("EmergencyAccess_Status_Title"),$("i_EAContactFor_close_btn").value=localeString("SharedFileSettings_Close"),$("my_EAContacts_top_hint_label").textContent=localeString("EmergencyAccess_Help_Hint"),$("my_EAContacts_add_btn").value="Add Contact",$("my_EAContacts_close_btn").value=localeString("SharedFileSettings_Close"),$("my_EAContacts_tablecaption_user").textContent=localeString("EmergencyAccess_Name_Title"),$("my_EAContacts_tablecaption_status").textContent=localeString("EmergencyAccess_Status_Title"),$("identicalfiles_cancel_btn").value="Don't Apply",$("identicalfiles_update_btn").value="Apply",$("sharingFile_access_lbl").innerText=localeString("SharedFileSettings_SharedWith"),$(SHAREFILE_CLOSEDLG_BTN_ID).value=localeString("SharedFileSettings_Close"),$("sharingFile_addrecipient_lbl").innerText=localeString("SharedFolderSettings_AddRecipient_Title"),$("sharing_access_lbl").innerText=localeString("SharedFolderSettings_SharedWith_Title"),$(SHARING_DELETEACCOUNT_BTN_ID).value=localeString("SharedFolderSettings_DeleteSharedFolder"),$(SHARING_CLOSEDLG_BTN_ID).value=localeString("SharedFileSettings_Close"),$(SHARING_CANCELCHANGES_BTN_ID).value=localeString("Cmd_Cancel_Flat"),$(SHARING_APPLYCHANGES_BTN_ID).value=localeString("Cmd_ApplyChanges_Flat"),$(SHARING_STOPSHARING_BTN_ID).value=localeString("SharedFolderSettings_StopSharingFolder"),$("sharing_addrecipient_lbl").innerText=localeString("SharedFolderSettings_AddRecipient_Title"),$("sharing_addrecipient_emaillbl_td").innerHTML=localeString("SharedFolderSettings_RecipientEmail_Caption"),$("sharing_addrecipient_rolelbl_td").innerHTML=localeString("SharedFolderSettings_RecipientRole_Caption"),$(SHARING_ADDRECIPIENT_EMAILINPUT_ID).setAttribute("placeholder",localeString("SharedFolderSettings_AddRecipientBanner")),$(SHAREFILE_ADDRECIPIENT_EMAILINPUT_ID).setAttribute("placeholder",localeString("SharedFolderSettings_AddRecipientBanner")),$(SHARING_ADDRECIPIENT_BTN_ID).value=localeString("SharedFolderSettings_SendInvite"),$(SHAREFILE_ADDRECIPIENT_BTN_ID).value=localeString("SharedFolderSettings_SendInvite"),$("sharing_roles_option_regular").innerHTML=localeString("SharedFolderSettings_RoleRegularUser"),$("sharing_roles_option_regular").setAttribute("title",localeString("SharedFolderSettings_RoleRegularUser_Tip")),$("sharing_roles_option_limited").innerHTML=localeString("SharedFolderSettings_RoleLimitedUser"),$("sharing_roles_option_limited").setAttribute("title",localeString("SharedFolderSettings_RoleLimitedUser_Tip")),$("revokeshared_cancelbtn").value=localeString("Cmd_Cancel_Flat"),$("stopshared_cancelbtn").value=localeString("Cmd_Cancel_Flat"),$("save-save-button").value=localeString("Cmd_SaveForms_Flat"),$("save-cancel-button").value=localeString("Cmd_Cancel_Flat"),$("unblock-autosave").value=localeString("SaveDlg_Unblock_Key"),$("save-question-div").textContent=localeString("SaveDlg_SaveLoginQuestion_Text"),$("save-objectname-div").textContent=localeString("SaveDlg_Name_Text"),$("save-folder-div").textContent=localeString("SaveDlg_Folder_Text"),$("create-folder-button").value=localeString("SaveDlg_NewFolder_Text"),$("switch-login-button").textContent=localeString("SaveDlg_SaveAs_Login_Text"),$("switch-bookmark-button").textContent=localeString("SaveDlg_SaveAs_Bookmark_Text"),$("new-folder-cancel").setAttribute("title",localeString("Cmd_Cancel_Flat")),$("unblock-auto-save-roboform").innerHTML=localeString("DeleteBlockingPass_Title"),$("do-not-show-again-unblock-lbl").innerHTML=localeString("CheckedRunMB_CheckButton"),$("unblock-auto-save-confirmation-yes").value=localeString("Install_Yes"),$("unblock-auto-save-confirmation-no").value=localeString("Install_No"),$("unblock-auto-save-confirmation-message").innerText=localeString("DeleteBlockingPass__WebExt_Confirm"),$("logineditor_fields_legend").innerText=localeString("PassCards_Cmd_Fields_Flat"),$("rfIdentitysection_CancelBtn").value=localeString("Cmd_Cancel_Flat"),$("logineditor_cancel_btn").value=localeString("Cmd_Cancel_Flat"),$("logineditor_notelbl_td").textContent=localeString("PassCards_Note"),$("change_master_password_current_label").innerText=localeString("MasterPass_Prompt_TypeOld").replace(new RegExp("&","g"),""),$("change_master_password_new_label").innerText=localeString("MasterPass_Prompt_TypeNew").replace(new RegExp("&","g"),""),$("change_master_password_confirm_label").innerText=localeString("Install_ConfirmRoboFormMasterPassword2"),$(COMPANYINVITE_ACCEPTBTN_ID).value=localeString("Android_accept"),$(COMPANYINVITE_REJECTBTN_ID).value=localeString("SharedFolderSettings_RejectSharedFolder"),$(COMPANYINVITE_CANCELBTN_ID).value=localeString("SharedFolderSettings_CancelChanges"),$(COMPANYINVITE_TOPTEXT1_ID).textContent=localeString("Install_OnlineSetup_Title2"),$(EA_INVITE_ACCEPTBTN_ID).value=localeString("Android_accept"),$(EA_INVITE_REJECTBTN_ID).value=localeString("SharedFolderSettings_RejectSharedFolder"),$(EA_INVITE_CANCELBTN_ID).value=localeString("SharedFolderSettings_CancelChanges"),$(EA_INVITE_TOPTEXT1_ID).textContent=localeString("EmergencyAccess_Title"),$(ACCEPTACCOUNTS_TOPTEXT1_ID).textContent=localeString("SharedFileSettings_Title"),$("receiveAccounts_td_sharing_text").innerText=localeString("SharedFoldersConfirmation_Title"),$(ACCEPTACCOUNTS_ACCEPTBTN_ID).value=localeString("Android_accept"),$(ACCEPTACCOUNTS_REJECTBTN_ID).value=localeString("SharedFolderSettings_RejectSharedFolder"),$(ACCEPTACCOUNTS_CANCELBTN_ID).value=localeString("SharedFolderSettings_CancelChanges"),$(ACCEPTFILES_ACCEPTBTN_ID).value=localeString("Android_accept"),$(ACCEPTFILES_REJECTBTN_ID).value=localeString("SharedFolderSettings_RejectSharedFolder"),$(ACCEPTFILES_CANCELBTN_ID).value=localeString("SharedFolderSettings_CancelChanges"),$("receiveFiles_td_maintext1").innerHTML=localeString("SharedFileSettings_Title"),$("receiveFiles_td_sharing_text").innerText=localeString("SharedFilesConfirmation_Title"),$("contextmenu_send_td").innerText=localeString("Cmd_SendFile_Key").replace(new RegExp("&","g"),""),$("contextmenu_sharing_td").innerText=localeString("Cmd_SharedFolderSettings_Key"),$("contextmenu_delete_td").innerText=localeString("Cmd_Delete_Flat"),$("contextmenu_rename_td").innerText=localeString("Cmd_Rename_Flat"),$("contextmenu_fillformsid_td").innerText=localeString("Cmd_FillForms_Flat"),$("contextmenu_goto_td").innerText=localeString("Cmd_Goto_Flat"),$("contextmenu_edit_td").innerText=localeString("Cmd_Edit_Flat"),$("contextmenu_fillsubmitid_td").innerText=localeString("ContextMenuAndShortcuts_FillSubmit_Text"),$("contextmenu_loginsametab_td").innerText=localeString("Cmd_LoginSameTab_Flat"),$("contextmenu_loginnewtab_td").innerText=localeString("Cmd_LoginNewTab_Flat"),$("contextmenu_gotosametab_td").innerText=localeString("Cmd_GotoSameTab_Flat"),$("contextmenu_gotonewtab_td").innerText=localeString("Cmd_GotoNewTab_Flat"),$("contextmenu_gofill_td").innerText=localeString("Cmd_GoFill_Flat"),$(RENAMEFLD_DLG_CNCL_BTN).value=localeString("Cmd_Cancel_Flat"),$(RENAMEFLD_DLG_LABEL_ID).innerText=localeString("Cmd_Rename_Name_Prompt"),$("renamefolder_overwrite_lbl").innerText=localeString("OvrCfm_Overwrite_Text")+"?",$("pwd_number_smbl_lbl").textContent=localeString("PassGen_CharNumber_Text").replace(new RegExp("&","g"),""),$("pwd_generate_copy_lbl").textContent=localeString("PassGen_Copy_Tip"),$("rf_passgen_similar_label").textContent=localeString("PassGen_ExcludeSimilar").replace(new RegExp("&","g"),""),$("rf_passgen_hex_label").textContent=localeString("PassGen_UseHexChars").replace(new RegExp("&","g"),""),$("rf_passgen_advanced").textContent=localeString("PassGen_ShowAdvanced"),$(PWGGEN_GENERATE_BTN_ID).value=localeString("PassGen_Generate").replace(new RegExp("&","g"),""),$(PWDGEN_COPYBTN_ID).value=localeString("PassGen_Copy").replace(new RegExp("&","g"),""),$(PWDGEN_FILLBTN_ID).value=localeString("PassGen_Fill").replace(new RegExp("&","g"),""),$("pwd_copy_lbl").innerHTML=localeString("PassGen_helptext1")+"<br />"+localeString("PassGen_helptext2")+"<br />"+localeString("PassGen_helptext3"),$("identitymini_topcaption_td").innerHTML=localeString("Android_menu_title_web_fill_identity"),$("identitymini_showall_link").innerText=localeString("FillDlg_All_Identities_Key"),$("identitymini_fillempty_lbl").innerText=localeString("Cmd_FillEmptyOnly_Key").replace(new RegExp("&","g"),""),$("identitymini_edit_btn").value=localeString("FillDlg_Edit_Key"),$("identitymini_fill_btn").value=localeString("FillDlg_FillForms_Key").replace(new RegExp("&","g"),""),$("identitymini_submit_btn").value=localeString("FillDlg_FillSubmit_Key").replace(new RegExp(" &","g")," "),$("rfmatch_fillempty_lbl").innerText=localeString("Cmd_FillEmptyOnly_Key").replace(new RegExp("&","g"),""),$("rfmatch_edit_btn").value=localeString("FillDlg_Edit_Key"),$("rfmatch_fill_btn").value=localeString("FillDlg_FillForms_Key").replace(new RegExp("&","g"),""),$("rfmatch_submit_btn").value=localeString("FillDlg_FillSubmit_Key").replace(new RegExp(" &","g")," "),$("rfmatch_topcaption_td").innerHTML=localeString("Android_matching_dialog_title"),$("rfmatch_showall_link").innerText=localeString("FillDlg_All_Passcards_Key"),$(CREATEFLD_DLG_CNCL_BTN).value=localeString("Cmd_Cancel_Flat"),$("rf_createobj_overwrite_lbl").innerText=localeString("OvrCfm_Overwrite_Text")+"?",$(CREATEFLD_DLG_LABEL_ID).innerText=localeString("Cmd_NewFolder_Prompt").replace(new RegExp("&","g"),""),$("createfolder_lbl").textContent=localeString("NewSharedFolder_Title"),$(DELETEOBJ_DLG_CNCL_BTN).value=localeString("Cmd_Cancel_Flat"),$("rfloginsection_userid_td").innerHTML=localeString("RFOSetup_EnterAccountId"),$(LOGIN_CREATENEWACC_LINK_ID).innerHTML=localeString("RFOSetup_CreateNewAccount"),$(LOGIN_EMAILDG_BACK_BTN_ID).value=localeString("Install_Back"),$(LOGIN_EMAILDG_NEXT_BTN_ID).value=localeString("Install_Next"),$("enteraccountpwd_topcaption_lbl").innerText=localeString("AutoSaveBar_PasswordEdit_Cuebanner"),$("enteraccountpwd_foraccount_lbl").innerText=localeString("Passw_Account_Title"),$("enteraccountpwd_login_btn").value=localeString("Cmd_Login_Flat"),$(ACCOUNTPWD_CHANGELINK_ID).innerText=localeString("Passw_ChangeAccount"),$("login_pwdsection_entertxt_td").innerHTML=localeString("RFOSetup_EnterPasswordForAccount"),$("tdloginsection_session_txt").innerHTML=localeString("Setup_LoginWithExistingAccount_Prompt"),g_isedge&&($("tdloginsection_session_txt").innerHTML+="<a href='#' id='rfloginsection_setupcookies_link'> How to setup...</a>"),$(LOGINPWD_DLG_NEXTBTN_ID).value=localeString("Install_Next"),$(LOGINPWD_DLG_BACKBTN_ID).value=localeString("Install_Back"),$("confirm_td_maintext1").innerHTML=localeString("Setup_Welcome_HeaderTitle"),$("confirm_accountpwd_emaillabel").innerHTML=localeString("Install_Email"),$("confirm_td_maintext2").innerHTML=localeString("Setup_MasterPassword_HeaderSubtitle"),$("confirm_accountpwd_confirmpwdtitle").innerHTML=localeString("Setup_ConfirmMasterPassword_Title"),$("confirm_accountpwd_pwdlabel").innerHTML=localeString("Setup_ConfirmMasterPassword_Password_Text"),$("confirm_accountpwd_confirmpwdnotetxt").innerHTML=localeString("Setup_ConfirmMasterPassword_Prompt"),$(CONFIRMPWD_DLG_NEXTBTN_ID).value=localeString("Install_Next"),$(CONFIRMPWD_DLG_BACKBTN_ID).value=localeString("Install_Back"),$("rfsignupsection_middletable_step1_toptxt_td").innerHTML=localeString("Setup_Welcome_Title"),$("rfsignupsection_middletable_step1_emailtd").innerHTML=localeString("Install_Email"),$("rf_sign_td_step1_pwd").innerHTML=localeString("Setup_ConfirmMasterPassword_Password_Text"),$("rf_sign_step1_text").innerHTML=localeString("Install_CreateMasterPassword_Prompt"),$("rfsignupsection_bottom_loginlink").innerHTML=localeString("Setup_LoginWithExistingAccount_Text"),$(SIGNUP_DLG_STEP1_NEXTBTN_ID).value=localeString("Install_Next"),$("rfsignupsection_cancelbtn").value=localeString("Install_Back"),$("mastpwdEnter_maintext_div").innerHTML=localeString("MasterPwdEnterDlg_Text3"),$("mastpwdEnter_pwd_label").innerText=localeString("FillDlg_Pwd_Prompt"),$("rf_cache_mp_lbl").innerHTML=localeString("MasterPwdEnterDlg_CacheUntilLogoff"),$(MASTERPWDENTER_DLG_CANCELBTN_ID).value=localeString("Cmd_Cancel_Flat"),$(MASTERPWDCREATE_PWDLBL_ID).innerHTML=localeString("Setup_ConfirmMasterPassword_Password_Text"),$(MASTERPWDCREATE_CANCELBTN_ID).value=localeString("Cmd_Cancel_Flat"),$(MASTERPWDCREATE_CONFIRMLBL_ID).innerHTML=localeString("Install_ConfirmRoboFormMasterPassword2"),$(MASTERPWDCREATE_TEXT_ID).innerHTML=localeString("MasterPwdEnterDlg_CreatePwd_Text"),$("rf_createobj_notelbl_td").innerText=localeString("PassCards_Note"),$("rf_createobj_countrieslbl_td").innerText=localeString("RI_Country"),$(CREATEOBJ_DLG_CANCELBTN_ID).value=localeString("Cmd_Cancel_Flat"),$("rf_otp_memorize_lbl").innerHTML=localeString("RFO_OTP_Memorize_Device"),$("rf_otp_caption_lbl").innerHTML=localeString("RFO_TwoFactorCaption_Text"),$("rf_otp_pwd_lbl").innerHTML=localeString("RFO_EnterOTP_Text2"),$("rf_otp_toptext_lbl").innerText=localeString("RFO_TwoFactorIsOn_Text2"),$("rf_otp_checkmail_lbl").innerHTML=localeString("RFO_TwoFactor_Generic_Text"),$("rf_otp_cancelbtn").value=localeString("Cmd_Cancel_Flat"),$("session_expire_lbl").innerHTML=localeString("SessionExpireDlg_Text"),$(SESSIONEXP_DLG_CLOSEBTN_ID).value=localeString("Cmd_Close_Flat"),$("account_suspended_closebtn").value=localeString("Cmd_Close_Flat")},e.prototype.OnSettingsButtonClick=function(){this.HideContextMenu(),this.HideMatchingLoginDialog(),this.HideIdentityDialog(),this.HideSearchList();var e=$("settingsDialog");e&&"block"!=e.style.display&&(e.style.display="block")},e.prototype.OnHomeButtonClick=function(){getProxyRfo().LoginToRFOAccount(!0),this.ClosePopup(500)},e.prototype.OnBackButtonClick=function(){this.ShowStartPage()},e.prototype.CreateItemTitle=function(e){var t=this,n=this.createElement("div",{class:"toolbar-title-V8"}),i=this.createElement("div",{class:"toolbar-title-icon-V8 toolbar-back-icon-V8"});i.addEventListener("click",function(){t.m_navigator.GoBack()},!1),n.appendChild(i);var o=[],a=e.image_data;if(a){var r=this.createElement("img",{class:"toolbar-item-title-image-V8 toolbar-button-icon item-icon",src:a});o.push(r)}var s=this.createTextNode("RoboForm");o.push(s);var l=this.createElement("div",{class:"toolbar-item-title-text-V8"},o),c=this.createElement("div",{class:"toolbar-title-text-V8"},[l]),_=e?e.title:void 0;return s.data=_||"RoboForm",n.appendChild(c),n},e.prototype.CreateSimpleTitle=function(e){var t=this,n=this.createElement("div",{class:"toolbar-title-V8"}),i=this.createElement("div",{class:"toolbar-title-icon-V8 toolbar-back-icon-V8"});i.addEventListener("click",function(){t.OnBackButtonClick()},!1),n.appendChild(i);var o=[],a=e.image_data;if(a){var r=this.createElement("img",{class:"toolbar-item-title-image-V8 toolbar-button-icon item-icon",src:a});o.push(r)}var s=this.createTextNode("RoboForm");o.push(s);var l=this.createElement("div",{class:"toolbar-item-title-text-V8"},o),c=this.createElement("div",{class:"toolbar-title-text-V8"},[l]),_=e?e.title:void 0;return s.data=_||"RoboForm",n.appendChild(c),n},e.prototype.CreateListTitle=function(e){var t=this,n=this.createElement("div",{class:"toolbar-title-V8"});n.addEventListener("mousedown",function(e){t.HideContextMenus()},!1);var i=this.createElement("div",{class:"toolbar-title-icon-V8 toolbar-back-icon-V8"});i.addEventListener("click",function(){t.OnBackButtonClick()},!1),n.appendChild(i);var o,a=this.createElement("div",{class:"toolbar-title-icon-V8 toolbar-main-settings-icon-V8",id:"chrome_settings_id"});a.addEventListener("click",function(){t.OnSettingsButtonClick()},!1),n.appendChild(a);var r=this.createElement("div",{class:"toolbar-title-text-V8"},[o=this.createTextNode("RoboForm")]),s=e?e.title:void 0;return o.data=s||"RoboForm",n.appendChild(r),r.addEventListener("mousedown",function(e){t.HideContextMenus()},!1),n},e.prototype.CreateSettingsMenuItem=function(e,t,n,i){var o=this.createElement("div",{class:t});o.id=e,o.innerText=n;var a=this;return o.addEventListener("mousedown",function(e){a.ContextMenuItem_OnMouseDown(e)},!1),o.addEventListener("mouseup",function(e){a.ContextMenuItem_OnMouseUp(e)},!1),o.addEventListener("click",i,!1),o},e.prototype.CheckContextMenuItemsForAccountType=function(){this.HideContextMenu(),this.CreateMainScreenContextMenu();var e=getBG().g_policySet,t=this.m_oAccountInfo&&this.m_oAccountInfo.oneFile,n=CheckIsCompanyAdmin(this.m_oAccountInfo);n||$("settingsDialog").removeChild(document.getElementById("settingsDialogNewGroup")),(!t||e.GetConfigValue(ConfigDisableSharing)||n)&&$("settingsDialog").removeChild(document.getElementById("settingsDialogNewSharedFolder")),e.GetConfigValue(ConfigDisableCreateContacts)&&!n&&$("settingsDialog").removeChild(document.getElementById("settingsDialogNewContact")),e.GetConfigValue(ConfigDisableCreateSafenotes)&&!n&&$("settingsDialog").removeChild(document.getElementById("settingsDialogNewSafenote")),e.GetConfigValue(ConfigDisableCreateIdentities)&&!n&&$("settingsDialog").removeChild(document.getElementById("settingsDialogNewIdentity")),t&&!e.GetConfigValue(ConfigDisableEmergencyAccess)||$("settingsDialog").removeChild(document.getElementById("settingsDialogEmergency")),t||$("settingsDialog").removeChild(document.getElementById("settingsDialogSecurityCenter"))},e.prototype.SetContextMenuItemsVisibility=function(e){this.HideContextMenu();for(var t=$("settingsDialog").getElementsByClassName("contextmenu_item_normal"),n=0;n<t.length;n++){var i=t[n];if(i.nodeType===Node.ELEMENT_NODE){for(var o="none",a=0;a<e.length;a++)if(HasClass(i,e[a])){o="block";break}i.style.display=o}}},e.prototype.CreateMainScreenContextMenu=function(){var e=this;$("settingsDialog")&&document.body.removeChild($("settingsDialog"));var t=this.CreateSettingsMenuItem("settingsDialogNewContact","contextmenu_contact_page contextmenu_item_normal",localeString("Identities_Cmd_New_Contact_Title"),function(){var t="/",n=e.m_navigator.GetCurrentContext();n&&n.path&&(t=n.path),e.ShowCreateItemDialog({type:EnRfDataItemType.RfItemType_Contact,path:t})}),n=this.CreateSettingsMenuItem("settingsDialogNewIdentity","contextmenu_identity_page contextmenu_item_normal",localeString("Identities_Cmd_New_Title"),function(){var t="/",n=e.m_navigator.GetCurrentContext();n&&n.path&&(t=n.path),e.ShowCreateItemDialog({type:EnRfDataItemType.RfItemType_Identity,path:t})}),i=this.CreateSettingsMenuItem("settingsDialogNewSafenote","contextmenu_safenote_page contextmenu_item_normal",localeString("SafeNotes_Cmd_New_Title"),function(){var t="/",n=e.m_navigator.GetCurrentContext();n&&n.path&&(t=n.path),e.ShowCreateItemDialog({type:EnRfDataItemType.RfItemType_Safenote,path:t})}),o=this.CreateSettingsMenuItem("settingsDialogNewFolder","contextmenu_list_page contextmenu_item_normal",localeString("Cmd_NewFolder_Title"),function(){var t="/",n=e.m_navigator.GetCurrentContext();n&&n.path&&(t=n.path),e.ShowCreateFolderDialog({type:EnRfDataItemType.RfItemType_Folder,path:t})}),a=this.CreateSettingsMenuItem("settingsDialogNewSharedFolder","contextmenu_list_page contextmenu_item_normal",localeString("Cmd_CreateSharedFolder_Key"),function(){e.ShowCreateFolderDialog({type:EnRfDataItemType.RfItemType_Folder,path:"/",bShared:!0})}),r=this.CreateSettingsMenuItem("settingsDialogNewGroup","contextmenu_list_page contextmenu_item_normal",localeString("Cmd_CreateGroup_Key"),function(){e.ShowCreateFolderDialog({type:EnRfDataItemType.RfItemType_Folder,path:"/",bShared:!0,bGroup:!0})}),s=this.CreateSettingsMenuItem("settingsDialogIdentities","contextmenu_start_page contextmenu_item_normal",localeString("Cmd_Identities_Flat"),function(){e.SetContextMenuItemsVisibility(["contextmenu_identity_page","contextmenu_list_page","contextmenu_common"]),e.ShowItemsListScreen([EnRfDataItemType.RfItemType_Identity,EnRfDataItemType.RfItemType_Folder],RF_ROOT_FOLDER_URL,localeString("Cmd_Identities_Flat"))}),l=this.CreateSettingsMenuItem("settingsDialog_contacts_tr","contextmenu_start_page contextmenu_item_normal",localeString("Cmd_Contacts_Flat"),function(){e.SetContextMenuItemsVisibility(["contextmenu_contact_page","contextmenu_list_page","contextmenu_common"]),e.ShowItemsListScreen([EnRfDataItemType.RfItemType_Contact,EnRfDataItemType.RfItemType_Folder],RF_ROOT_FOLDER_URL,localeString("Cmd_Contacts_Flat"))}),c=this.CreateSettingsMenuItem("settingsDialogRecent","contextmenu_list_page contextmenu_item_normal",localeString("StartPage_RecentlyUsed"),function(){var t=e.m_navigator.GetCurrentContext().types,n={};n.types=t,getProxyRfo().GetHistoryList(JSON.stringify(n),function(t){var n=JSON.parse(t);e.ResponseGetRecentlyUsedItems(n)})}),_=this.CreateSettingsMenuItem("settingsDialogTools","contextmenu_common contextmenu_item_normal contextmenu_item_submenu",localeString("Android_setting_category_tools_title"),function(){e.ShowToolsScreen()}),d=this.CreateSettingsMenuItem("settingsDialogEmergency","contextmenu_common contextmenu_item_normal",localeString("EmergencyAccess_Title"),function(){e.ShowEmergencyAccessScreen()}),E=this.CreateSettingsMenuItem("settingsDialogSecurityCenter","contextmenu_common contextmenu_item_normal",localeString("Cmd_PasswordAuditRun_Key"),function(){e.ShowSecurityCenterScreen()}),u=this.CreateSettingsMenuItem("settingsDialogOptions","contextmenu_common contextmenu_item_normal",localeString("Cmd_Options_Flat"),function(){if(g_issafari){var t=safari.extension.popovers.filter(function(e){return"popup"==e.identifier})[0];t.width=640,t.height=480,window.location=GetLocalURL("options.html")}else getProxyRfo().OpenPage({url:GetLocalURL("options.html"),bNewWindow:!0,bActivateIfExists:!0}),e.ClosePopup(100)}),p=this.CreateSettingsMenuItem("settingsDialogHelp","contextmenu_common contextmenu_item_normal contextmenu_item_submenu",localeString("Cmd_Help_Flat"),function(){e.ShowHelpScreen()}),m=[o,a,r,t,s,n,i,l,c,_,d,E,u];m.push(p);var g=this.CreateSettingsMenuItem("settingsDialogAbout","contextmenu_common contextmenu_item_normal",localeString("Cmd_About_Key").replace(new RegExp("&","g"),""),function(){g_issafari?window.location=GetLocalURL("about.html"):e.HelpScreenOpenUrl(GetLocalURL("about.html"),!0,!0)});m.push(g);var I=this.createElement("div",{id:"settingsDialog",class:"contextmenu"},m);I.style.display="none",document.body.appendChild(I)},e.prototype.CreateFolderNavigationItem=function(e,t,n){var i=this,o=this.createElement("li");if(o.addEventListener("click",function(e){var n=i.m_navigator.GetCurrentContext(),o=n.types,a=n.title,r=n.match;i.ShowItemsListScreen(o,t,a,void 0,r),e.preventDefault()}),n)o.innerText=e;else{var a=this.createElement("a");a.href="#",a.innerText=e,o.appendChild(a)}return o},e.prototype.CreateFolderNavigationBar=function(e){var t=e.m_oContext;if(!t)return this.createElement("ul",{class:"breadcrumb"});for(var n=t.path.split("/").filter(function(e){return e}),i="",o=[this.CreateFolderNavigationItem("Home","/",0===n.length)],a=0;a<n.length;a++){var r=n[a];i+="/"+r,o.push(this.CreateFolderNavigationItem(r,i,n.length-1===a))}var s=this.createElement("ul",{class:"breadcrumb"},o),l=this;return s.addEventListener("mousedown",function(e){l.HideContextMenus()},!1),s},e.prototype.CreateInlineButtonsWrapper=function(){var e=[],t=CheckIsCompanyAdmin(this.m_oAccountInfo);return this.m_oAccountInfo&&this.m_oAccountInfo.oneFile&&!t&&getBG().g_policySet.GetConfigValue(ConfigDisableCreateLogins)&&getBG().g_policySet.GetConfigValue(ConfigDisableCreateBookmarks)||e.push(this.CreateUIItem(new ViewItem(ID_SAVE_FORMS,0,"inline-button",localeString("Cmd_SaveForms_Flat"),"save","Save Login",MANUALSAVE_IMAGE))),e.push(this.CreateUIItem(new ViewItem(ID_FillGenPassword,0,"inline-button",localeString("Cmd_RunPassGen_Flat"),"generate","Generate new Password",PWD_GENERATOR_IMAGE))),this.createElement("table",{id:"inline-buttons-wrapper",class:"inline-buttons-wrapper"},this.CreateInlineButtonsRows(e))},e.prototype.CreateNotificationFooter=function(){var e=this.createElement("div",{class:"info-footer"}),t=this.createElement("img",{class:"info-footer-img",src:"i.png"});return t.addEventListener("click",function(){getBG().OpenRoboFormURL(RoboFormDownloadPageUrl),setTimeout(function(){console.trace("click window.close"),window.close()},500)}),e.appendChild(t),e},e.prototype.AddSearchListeners=function(e){var t=this;e.addEventListener("focus",function(){t.HideContextMenu(),t.HideMatchingLoginDialog(),t.HideIdentityDialog(),getProxyRfo().GetSearchItemsInfo(),"string"==typeof e.value&&e.value.length>0&&t.ScheduleUpdateSearchList(!0,300)},!1)},e.prototype.OnSearchBarBlur=function(){var e=this;this.IsSearchListFocused(function(t){t||(e.ScheduleUpdateSearchList(!1),getProxyRfo().ClearSearchItemsInfo())})},e.prototype.OnSearchBarMouseDown=function(){},e.prototype.OnSearchBarEnter=function(e){if(this.selected_search_item){var t=document.createEvent("MouseEvents");t.initEvent("mousedown",!0,!0),this.selected_search_item.dispatchEvent(t)}},e.prototype.OnSearchBarEscape=function(){this.ClosePopup(0)},e.prototype.SetupSearchPlaceholder=function(e){e.placeholder=localeString("Search_Combo_Title")},e.prototype.IsSearchListVisible=function(e){e("none"!==window.getComputedStyle($(SEARCH_BAR_DROPDOWN_DIV)).display)},e.prototype.IsSearchListFocused=function(e){e(document.activeElement==$(SEARCH_BAR_DROPDOWN_DIV))},e.prototype.ScheduleUpdateSearchList=function(e,t){var n=this.GetSearchEditBox();e=e&&""!==n.value,this.base.ScheduleUpdateSearchList.call(this,e,t)},e.prototype.UpdateSearchList=function(){this.SearchBox_DropdownUpdate()},e.prototype.HideSearchList=function(){this.SearchBox_DropdownHide()},e.prototype.Popup_OnMouseUp=function(e){if(this.HideContextMenu(),2===e.button){var t=e.id;if(t.startsWith(ITEM_INFO_VIEW_ITEM_PREFIX)||t.startsWith(MENU_MATCHLOGINS)&&t!==MENU_MATCHLOGINS_MORE||!isNaN(t)&&t>=ID_IDENTITY_MATCH_FIRST&&t<=ID_IDENTITY_MATCH_LAST){var n=$(t);this.ShowContextMenu(n,!1,e.clientY,e.clientX)}}},e.prototype.ShowContextMenu=function(e,t,n,i){e.id,this.HideIdentityDialog();var o=EnRfDataItemType.RfItemType_Undefined,a={},r=!e.getAttribute(ITEMINFO_PROPERTY);if(!r){var s=e.getAttribute(ITEMINFO_PROPERTY);o=(a=JSON.parse(s))[RFTYPE_PROPERTY]}var l=e.getAttribute("search_link"),c=!(!a||!a.Shared),_=!a||!a.isShared,d=!(!a||!a.s),E=!(!a||!a.readOnly),u=!!a.company,p=!(!a||!a.isAdmin&&!a.isManager),m=!(!this.m_oAccountInfo||!this.m_oAccountInfo.oneFile);$("contextmenu_edit_td").innerText=E?localeString("Editor_Menu_View").replace(new RegExp("&","g"),""):localeString("Cmd_Edit_Flat");for(var g,I,T=$("contextmenu_table"),S="table-row",f=0;f<T.rows.length;f++){var h=T.rows[f],C=h.getAttribute("id");if(C){var v=this.GetObjectAction(C),R="table-row";switch(h.setAttribute(ITEMINFO_PROPERTY,JSON.stringify(a)),v){case this.EnObjectAction.ShareFolder:R="none",o==EnRfDataItemType.RfItemType_Folder&&m&&!u&&!c&&_&&(a[PATH_PROPERTY].lastIndexOf("/")||getBG().g_policySet.GetConfigValue(ConfigDisableSharing)||(R=S));break;case this.EnObjectAction.Send:R="none",o!=EnRfDataItemType.RfItemType_Safenote&&o!=EnRfDataItemType.RfItemType_Bookmark&&o!=EnRfDataItemType.RfItemType_Contact&&o!=EnRfDataItemType.RfItemType_Identity&&o!=EnRfDataItemType.RfItemType_Login||(R=u||!_||!m||d&&!p?"none":S);break;case this.EnObjectAction.Edit:R=o==EnRfDataItemType.RfItemType_Login||o==EnRfDataItemType.RfItemType_SearchCard||o==EnRfDataItemType.RfItemType_BlockingPasscard||o==EnRfDataItemType.RfItemType_Bookmark||o==EnRfDataItemType.RfItemType_Contact||o==EnRfDataItemType.RfItemType_Identity||o==EnRfDataItemType.RfItemType_Safenote?S:"none";break;case this.EnObjectAction.Sharing:R="none",o==EnRfDataItemType.RfItemType_Folder&&(R=c?S:"none"),o!=EnRfDataItemType.RfItemType_Safenote&&o!=EnRfDataItemType.RfItemType_Bookmark&&o!=EnRfDataItemType.RfItemType_Contact&&o!=EnRfDataItemType.RfItemType_Identity&&o!=EnRfDataItemType.RfItemType_Login||(R=!u&&_&&m?S:"none");break;case this.EnObjectAction.Rename:R=o==EnRfDataItemType.RfItemType_Folder?u?E?"none":p?S:c?"none":S:S:o==EnRfDataItemType.RfItemType_Login||o==EnRfDataItemType.RfItemType_SearchCard||o==EnRfDataItemType.RfItemType_BlockingPasscard||o==EnRfDataItemType.RfItemType_Bookmark||o==EnRfDataItemType.RfItemType_Contact||o==EnRfDataItemType.RfItemType_Identity||o==EnRfDataItemType.RfItemType_Safenote?E?d?S:"none":S:"none";break;case this.EnObjectAction.Delete:R=o==EnRfDataItemType.RfItemType_Folder?u?E?"none":p?S:c?"none":S:S:o==EnRfDataItemType.RfItemType_Login||o==EnRfDataItemType.RfItemType_Bookmark||o==EnRfDataItemType.RfItemType_SearchCard||o==EnRfDataItemType.RfItemType_BlockingPasscard||o==EnRfDataItemType.RfItemType_Contact||o==EnRfDataItemType.RfItemType_Identity||o==EnRfDataItemType.RfItemType_Safenote?S:"none";break;case this.EnObjectAction.LoginSameWindow:case this.EnObjectAction.LoginNewWindow:case this.EnObjectAction.GoFill:case this.EnObjectAction.Goto:R=o==EnRfDataItemType.RfItemType_Login?S:"none";break;case this.EnObjectAction.FillForms_ID:R=o==EnRfDataItemType.RfItemType_Contact||o==EnRfDataItemType.RfItemType_Identity||o==EnRfDataItemType.RfItemType_Login&&!t?S:"none";break;case this.EnObjectAction.GotoSameTab:case this.EnObjectAction.GotoNewTab:R=o==EnRfDataItemType.RfItemType_Bookmark?S:"none";break;case this.EnObjectAction.SearchNewTab:case this.EnObjectAction.SearchSameTab:R=o==EnRfDataItemType.RfItemType_Undefined&&l?S:"none",h.removeAttribute(ITEMINFO_PROPERTY),h.setAttribute("search_link",l);break;case this.EnObjectAction.FillSubmit_ID:R="none"}h.style.display=R}}if(t)$(CONTEXTMENU_DIV).style.display="block",$(CONTEXTMENU_DIV).style.top=n-$(CONTEXTMENU_DIV).clientHeight+"px",$(CONTEXTMENU_DIV).style.left="115px";else if(r){g=n,$(CONTEXTMENU_DIV).style.top=g+"px",$(CONTEXTMENU_DIV).style.display=c?"none":"block";var D=$(CONTEXTMENU_DIV).clientHeight;g+D>400&&(g-=D,$(CONTEXTMENU_DIV).style.top=g+"px")}else{g=e.offsetTop+25;var A=e.parentElement,y=$("listscrolldiv");if(A&&A.id==SEARCH_BAR_DROPDOWN_DIV)g=g+A.offsetTop-A.scrollTop;else{var N=e.getAttribute("topOffset")?parseInt(e.getAttribute("topOffset")):0;g=y?g-y.scrollTop:g,g+=N}$(CONTEXTMENU_DIV).style.top=g+"px",$(CONTEXTMENU_DIV).style.display="block";var L=$(CONTEXTMENU_DIV).clientHeight;if(L<15)return void($(CONTEXTMENU_DIV).style.display="none");g+L>document.body.clientHeight&&(g=(g-=15)-L>=0?g-L:0,$(CONTEXTMENU_DIV).style.top=g+"px"),I=i;var P=document.body.clientWidth,O=$(CONTEXTMENU_DIV).clientWidth;I+O>P&&(I-=O),$(CONTEXTMENU_DIV).style.left=I+"px",$(CONTEXTMENU_DIV).setAttribute("activeItem",e.id),AddClass(e,"toolbar-listitem-active")}},e.prototype.HideContextMenus=function(){this.base.HideContextMenus.call(this),this.HideContextMenu(),this.HideMatchingLoginDialog(),this.HideIdentityDialog(),this.HideSearchList()},e.prototype.HideContextMenu=function(){this.timeoutContextMenu&&window.clearTimeout(this.timeoutContextMenu);var e=$(CONTEXTMENU_DIV).style.display;if("none"!=e){$(CONTEXTMENU_DIV).style.display="none";var t=$(CONTEXTMENU_DIV).getAttribute("activeItem");t&&$(t)&&RemoveClass($(t),"toolbar-listitem-active")}"none"!=(e=$("settingsDialog").style.display)&&($("settingsDialog").style.display="none")},e.prototype.ContextMenuItem_OnClick=function(e){EnRfDataItemType.RfItemType_Undefined;var t={},n=e.getAttribute("id"),i=this.GetObjectAction(n);if(!!e.getAttribute(ITEMINFO_PROPERTY)){var o=e.getAttribute(ITEMINFO_PROPERTY);return t=JSON.parse(o),void this.PerformItemAction(t,i)}var a=e.getAttribute("search_link");a&&(getBG().Bg_OpenPage(a,i===this.EnObjectAction.SearchNewTab),this.ClosePopup(0))},e.prototype.PerformItemAction=function(e,t){var n=this,i={};switch(i.item_info=e,i.action=t,t){case this.EnObjectAction.ShareFolder:this.ShowShareExistingFolderDialog(e);break;case this.EnObjectAction.Send:this.ShowSendFileDialog(e);break;case this.EnObjectAction.Sharing:e.Shared?this.ShowShareFolderDialog(e):this.ShowShareFileDialog(e);break;case this.EnObjectAction.Edit:this.EditItem(e);break;case this.EnObjectAction.Rename:this.ShowRenameItemDialog(e);break;case this.EnObjectAction.Delete:e.Shared?this.ShowShareFolderDialog(e):this.ShowDeleteItemDialog(e);break;case this.EnObjectAction.FillForms_ID:case this.EnObjectAction.FillSubmit_ID:if(this.HideContextMenus(),e[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Identity||e[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Contact)this.ShowIdentityMiniDialog(JSON.stringify(e),window.event.clientY,!0);else if(e[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Login){i.bFill=!0,i.bFillOnlyEmptyFields=!0,i.bNewWindow=!1,i.bNavigate=!1,i.bSubmit=!1;var o=JSON.stringify(i);getProxyRfo().NavigateFillSubmitAction(o,function(e){n.Response_NavigateFillSubmitAction(e)})}break;case this.EnObjectAction.GotoNewTab:case this.EnObjectAction.GotoSameTab:i.bFill=!1,i.bNavigate=!0,i.bSubmit=!1,i.bNewWindow=t==this.EnObjectAction.GotoNewTab;o=JSON.stringify(i);getProxyRfo().NavigateFillSubmitAction(o,function(e){n.Response_NavigateFillSubmitAction(e)});break;case this.EnObjectAction.LoginSameWindow:case this.EnObjectAction.LoginNewWindow:case this.EnObjectAction.GoFill:case this.EnObjectAction.Goto:i.bFill=t!=this.EnObjectAction.Goto,i.bFillOnlyEmptyFields=!0,i.bNewWindow=t==this.EnObjectAction.LoginNewWindow,i.bNavigate=!0,i.bSubmit=t==this.EnObjectAction.LoginSameWindow||t==this.EnObjectAction.LoginNewWindow;o=JSON.stringify(i);getProxyRfo().NavigateFillSubmitAction(o,function(e){n.Response_NavigateFillSubmitAction(e)});break;case this.EnObjectAction.CreateFolder:this.ShowCreateFolderDialog(e);break;case this.EnObjectAction.CreateSafenote:e[RFTYPE_PROPERTY]=EnRfDataItemType.RfItemType_Safenote,n.ShowCreateItemDialog(e);break;case this.EnObjectAction.CreateContact:e[RFTYPE_PROPERTY]=EnRfDataItemType.RfItemType_Contact,n.ShowCreateItemDialog(e);break;case this.EnObjectAction.CreateIdentity:e[RFTYPE_PROPERTY]=EnRfDataItemType.RfItemType_Identity,n.ShowCreateItemDialog(e)}},e.prototype.ContextMenuItem_OnMouseDown=function(e){e.stopPropagation(),this.HideSearchList()},e.prototype.ContextMenuItem_OnMouseUp=function(e){e.stopPropagation()},e.prototype.ShowProgressIndicator=function(e){$("loading_circle").style.display="block",$("progress_text_div").innerText=e+"%",visibilityEffect($(MAINSCREEN_DIV),[5])},e.prototype.ShowSendFilesDialog=function(e,t){var n=this,i=new ViewItem("receiveFiles_div",void 0,"dialog"),o=n.CreateUIItem(i),a={};a.files=e,a.send=!0,a.callback=t,n.m_navigator.Navigate({name:"Receive Files",views:[o],context:a,initialize:function(e){n.InitReceivedFilesDialog(e)}})},e.prototype.ShowServerWarning=function(e){var t=GetSetting("internal","active-server");-1!=(t=t.toLowerCase()).indexOf("roboform.com")?(e.innerHTML="&nbsp;",e.style.color="black"):-1!=t.indexOf("roboform.us")?(e.innerHTML="US TEST",e.setAttribute("title",t),e.style.color="red"):-1!=t.indexOf("accounts.roboform.eu")?(e.innerHTML="EU server",e.setAttribute("title",t),e.style.color="black"):-1!=t.indexOf("stage.roboform.eu")?(e.innerHTML="EU TEST",e.setAttribute("title",t),e.style.color="red"):(e.innerHTML=t,e.style.color="red")},e.prototype.ShowReceivedFilesDialog=function(e,t){var n=this,i=new ViewItem("receiveFiles_div",void 0,"dialog"),o=n.CreateUIItem(i),a={};a.files=e,a.callback=t,n.m_navigator.Navigate({name:"Receive Files",views:[o],context:a,initialize:function(e){n.InitReceivedFilesDialog(e)}})},e.prototype.InitReceivedFilesDialog=function(e){this.AddReceivedFilesListeners();var t=this,n=!!e.send;t.ShowServerWarning($(ACCEPTFILES_TOPTEXT2_ID)),$("receiveFiles_td_maintext1").innerHTML=n?"RoboForm":localeString("SharedFileSettings_Title"),$("receiveFiles_td_sharing_text").innerText=n?localeString("SendFilesConfirmation_Title"):localeString("SharedFilesConfirmation_Title"),$(ACCEPTFILES_PROGRESSDIV_ID).style.display="none",$(ACCEPTFILES_ERRORMSG_ID).innerHTML="";var i=e.files,o=!n&&t.CheckLicenseIsExpired();$("receiveFiles_LicenseBtn_td").style.display=o?"table-cell":"none",$("receiveFiles_AcceptBtn_td").style.display=o?"none":"table-cell",$("receiveFiles_RejectBtn_td").style.textAlign=o?"right":"left";var a,r,s=$(ACCEPTFILES_FILESTABLE_ID);RemoveChilds(ACCEPTFILES_FILESTABLE_ID);for(var l=0;l<i.length;l++){var c=i[l];if(n){if(c.hash)continue}else if(!c.hash)continue;var _=c.name,d=c.grantorName?c.grantorName:c.grantor,E=c.id;a=t.createElement("tr",{});var u=t.createElement("td",{}),p=t.createElement("input",{type:"checkbox",fileId:E,account_id:c.grantor,checked:"checked"}),m=t.createElement("div",{class:"receiveAccounts_text_label",title:_+" from "+d});m.innerText="'"+_+"' from "+d,u.appendChild(p),u.appendChild(m),a.appendChild(u),s.appendChild(a)}var g=s.getElementsByTagName("input");for(r=0;r<g.length;r++){g[r].addEventListener("click",function(){t.GetCheckedFiles().length?($(ACCEPTFILES_ACCEPTBTN_ID).removeAttribute("disabled"),$(ACCEPTFILES_REJECTBTN_ID).removeAttribute("disabled")):($(ACCEPTFILES_ACCEPTBTN_ID).setAttribute("disabled","disabled"),$(ACCEPTFILES_REJECTBTN_ID).setAttribute("disabled","disabled"))})}o&&($("receiveFiles_LicenseBtn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$(ACCEPTFILES_ERRORMSG_ID).innerHTML=t.m_bTrialLicense?localeString("LicenseExpirationWarning_TrialExpired_Title"):localeString("LicenseExpirationWarning_LicenseExpired_Title"),$("receiveFiles_LicenseBtn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($(ACCEPTFILES_ERRORMSG_ID))},!1),$(ACCEPTFILES_ERRORMSG_ID).style.fontSize="13px")},e.prototype.AddReceivedFilesListeners=function(){var e=this;$(ACCEPTFILES_ACCEPTBTN_ID).addEventListener("click",function(){e.AcceptReceivedFilesOnClick()},!1),$(ACCEPTFILES_REJECTBTN_ID).addEventListener("click",function(){e.RejectReceivedFilesOnClick()},!1),$(ACCEPTFILES_CANCELBTN_ID).addEventListener("click",function(t){e.UpdateReceivedAndNextStepCheck(!1)},!1)},e.prototype.GetCheckedFiles=function(){var e=[],t=$(ACCEPTFILES_FILESTABLE_ID).getElementsByTagName("input");for(i=0;i<t.length;i++)if(t[i].checked){var n={};n.fileId=t[i].getAttribute("fileId"),n.account_id=t[i].getAttribute("account_id"),e.push(n)}return e},e.prototype.AcceptRejectReceivedFiles=function(e){var t=this;function n(t,n,i){var o={};o.accountId=t.account_id,o.fileId=t.fileId;var a=JSON.stringify(o);e?getProxyRfo().AcceptSharedFile(a,function(e){var t=JSON.parse(e);t.error?i(t.error):n(t)}):getProxyRfo().RejectSharedFile(a,function(e){var t=JSON.parse(e);t.error?i(t.error):n(t)})}q(!0,ACCEPTFILES_PROGRESSDIV_ID,[ACCEPTFILES_ACCEPTBTN_ID,ACCEPTFILES_REJECTBTN_ID,ACCEPTFILES_CANCELBTN_ID],ACCEPTFILES_CANCELBTN_ID),$(ACCEPTFILES_ERRORMSG_ID).innerHTML="";for(var i=t.GetCheckedFiles(),o=i.length,a=0;a<i.length;a++){n(i[a],function(e){--o||t.UpdateReceivedAndNextStepCheck(!1)},function(e){o--,$(ACCEPTFILES_ERRORMSG_ID).innerHTML=e.description,o||t.UpdateReceivedAndNextStepCheck(!1)})}},e.prototype.AcceptReceivedFilesOnClick=function(){this.AcceptRejectReceivedFiles(!0)},e.prototype.RejectReceivedFilesOnClick=function(){this.AcceptRejectReceivedFiles(!1)},e.prototype.UpdateReceivedAndNextStepCheck=function(e){var t=this,n=JSON.stringify({});getProxyRfo().GetReceivedData(n,function(n){var i=JSON.parse(n);if(t.CheckGlobalErrorResponse(i)){var o=i[JSON_MSG_ERROR];e?$(ACCEPTACCOUNTS_ERRORMSG_ID).innerHTML=o.description:$(ACCEPTFILES_ERRORMSG_ID).innerHTML=o.description}else{t.m_oAccountInfo.receivedData=i.receivedData,e?q(!1,ACCEPTACCOUNTS_PROGRESSDIV_ID,[ACCEPTACCOUNTS_ACCEPTBTN_ID,ACCEPTACCOUNTS_REJECTBTN_ID,ACCEPTACCOUNTS_CANCELBTN_ID],void 0):q(!1,ACCEPTFILES_PROGRESSDIV_ID,[ACCEPTFILES_ACCEPTBTN_ID,ACCEPTFILES_REJECTBTN_ID,ACCEPTFILES_CANCELBTN_ID],void 0),t.m_navigator.GetCurrentContext().callback()}})},e.prototype.NeedToShowReceivedFilesDialog=function(){var e=this.m_navigator.GetCurrentContext();e.files.length?e.callback():this.UpdateReceivedAndNextStepCheck(!0)},e.prototype.CheckReceivedAccountsFiles=function(e,t,n){var i=[],o=[];function a(n){if(i.length||n.length){for(var a=0;a<n.length;a++){var r=n[a];(void 0===r.accepted||!r.accepted)&&o.push(r)}i.length||o.length?t(i,o):e()}else e()}if(this.m_oAccountInfo){var r=this.m_oAccountInfo.receivedData;if(r){var s=r.accounts;if(s){var l=r.receivedFiles;s.length||l.length?s.length?function(e,t){function n(e,t,n){var i={};i.sharedAccountId=e;var o=JSON.stringify(i);getProxyRfo().AcceptSharedAccount(o,function(e){var i=JSON.parse(e);i.error?n(i.error):t(i)})}for(var o=[],r=0;r<e.length;r++){var s=e[r];(void 0===s.accepted||!s.accepted)&&(s.company?o.push(s):i.push(s))}if(o.length){var l=o.length;for(r=0;r<o.length;r++)n(o[r].accountId,function(e){--l||a(t)},function(e){--l||a(t)})}else a(t)}(s,l):a(l):e()}else e()}else e()}else e()},e.prototype.ShowReceivedAccountsDialog=function(e,t,n){var i=this,o=new ViewItem("receiveAccounts_div",void 0,"dialog"),a=i.CreateUIItem(o),r={};r.accounts=e,r.files=t,r.callback=n,i.m_navigator.Navigate({name:"Receive Accounts",views:[a],context:r,initialize:function(e){i.InitReceivedAccountsDialog(e)}})},e.prototype.InitReceivedAccountsDialog=function(e){this.AddReceivedAccountsListeners();var t=this;this.ShowServerWarning($(ACCEPTACCOUNTS_TOPTEXT2_ID)),$(ACCEPTACCOUNTS_PROGRESSDIV_ID).style.display="none",$(ACCEPTACCOUNTS_ERRORMSG_ID).innerHTML="";var n=t.CheckLicenseIsExpired();$("receiveAccounts_LicenseBtn_td").style.display=n?"table-cell":"none",$("receiveAccounts_AcceptBtn_td").style.display=n?"none":"table-cell",$("receiveAccounts_RejectBtn_td").style.textAlign=n?"right":"left";var i,o,a=e.accounts,r=(e.files,$(ACCEPTACCOUNTS_ACCOUNTSTABLE_ID));RemoveChilds(ACCEPTACCOUNTS_ACCOUNTSTABLE_ID);for(var s=0;s<a.length;s++){var l=a[s],c=l.name?l.name:l.accountId,_=l.senderName?l.senderName:l.sender,d=l.accountId;i=t.createElement("tr",{});var E=t.createElement("td",{}),u=t.createElement("input",{type:"checkbox",accountId:d,checked:"checked"}),p=t.createElement("div",{class:"receiveAccounts_text_label",title:c+" from "+_});p.innerText="'"+c+"' from "+_,E.appendChild(u),E.appendChild(p),i.appendChild(E),r.appendChild(i)}var m=r.getElementsByTagName("input");for(o=0;o<m.length;o++){m[o].addEventListener("click",function(){t.GetCheckedAccounts().length?($(ACCEPTACCOUNTS_ACCEPTBTN_ID).removeAttribute("disabled"),$(ACCEPTACCOUNTS_REJECTBTN_ID).removeAttribute("disabled")):($(ACCEPTACCOUNTS_ACCEPTBTN_ID).setAttribute("disabled","disabled"),$(ACCEPTACCOUNTS_REJECTBTN_ID).setAttribute("disabled","disabled"))})}n&&($("receiveAccounts_LicenseBtn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$(ACCEPTACCOUNTS_ERRORMSG_ID).innerHTML=t.m_bTrialLicense?localeString("LicenseExpirationWarning_TrialExpired_Title"):localeString("LicenseExpirationWarning_LicenseExpired_Title"),$("receiveAccounts_LicenseBtn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($(ACCEPTACCOUNTS_ERRORMSG_ID))},!1),$(ACCEPTACCOUNTS_ERRORMSG_ID).style.fontSize="13px")},e.prototype.GetServerLicenseUrlandNavigate=function(e){var t=this,n=t.m_bTrialLicense?EnPUMSUserAction.enPUMSAction_Buy:EnPUMSUserAction.enPUMSAction_Renew;getProxyRfo().GetLicenseUrl({action:n,email:t.m_oAccountInfo.email}).then(function(n){if(n&&n.url)return getBG().Bg_OpenPage(n.url,!0),void t.ClosePopup(0);e.textContent="Internal error."}).catch(function(n){t.CheckGlobalErrorResponse2(n)&&e&&(e.innerHTML=n.Description)})},e.prototype.AddReceivedAccountsListeners=function(){var e=this;$(ACCEPTACCOUNTS_ACCEPTBTN_ID).addEventListener("click",function(){e.AcceptReceivedAccountsOnClick()},!1),$(ACCEPTACCOUNTS_REJECTBTN_ID).addEventListener("click",function(){e.RejectReceivedAccountsOnClick()},!1),$(ACCEPTACCOUNTS_CANCELBTN_ID).addEventListener("click",function(t){e.NeedToShowReceivedFilesDialog()},!1)},e.prototype.GetCheckedAccounts=function(){var e=[],t=$(ACCEPTACCOUNTS_ACCOUNTSTABLE_ID).getElementsByTagName("input");for(i=0;i<t.length;i++)t[i].checked&&e.push(t[i].getAttribute("accountId"));return e},e.prototype.AcceptRejectReceivedAccounts=function(e){var t=this;if($(ACCEPTACCOUNTS_ERRORMSG_ID).textContent="",e&&this.CheckDisableNonGroupData())$(ACCEPTACCOUNTS_ERRORMSG_ID).textContent=localeString("Policy_DisableNonGroupData_Message");else{q(!0,ACCEPTACCOUNTS_PROGRESSDIV_ID,[ACCEPTACCOUNTS_ACCEPTBTN_ID,ACCEPTACCOUNTS_REJECTBTN_ID,ACCEPTACCOUNTS_CANCELBTN_ID],ACCEPTACCOUNTS_CANCELBTN_ID);for(var n=t.GetCheckedAccounts(),i=n.length,o=0;o<n.length;o++){a(n[o],function(e){--i||t.NeedToShowReceivedFilesDialog()})}}function a(n,i,o){var a={};a.sharedAccountId=n;var r=JSON.stringify(a);e?getProxyRfo().AcceptSharedAccount(r,function(e){var n=JSON.parse(e);if(t.CheckGlobalErrorResponse(n))return q(!1,ACCEPTACCOUNTS_PROGRESSDIV_ID,[ACCEPTACCOUNTS_ACCEPTBTN_ID,ACCEPTACCOUNTS_REJECTBTN_ID,ACCEPTACCOUNTS_CANCELBTN_ID],void 0),void($(ACCEPTACCOUNTS_ERRORMSG_ID)&&($(ACCEPTACCOUNTS_ERRORMSG_ID).innerHTML=n.error.description));i(n)}):getProxyRfo().RejectSharedAccount(r,function(e){var n=JSON.parse(e);if(t.CheckGlobalErrorResponse(n))return q(!1,ACCEPTACCOUNTS_PROGRESSDIV_ID,[ACCEPTACCOUNTS_ACCEPTBTN_ID,ACCEPTACCOUNTS_REJECTBTN_ID,ACCEPTACCOUNTS_CANCELBTN_ID],void 0),void($(ACCEPTACCOUNTS_ERRORMSG_ID)&&($(ACCEPTACCOUNTS_ERRORMSG_ID).innerHTML=n.error.description));i(n)})}},e.prototype.RejectReceivedAccountsOnClick=function(){this.AcceptRejectReceivedAccounts(!1)},e.prototype.AcceptReceivedAccountsOnClick=function(){this.AcceptRejectReceivedAccounts(!0)},e.prototype.CheckCompanyInvitations=function(e,t){if(this.m_oAccountInfo){var n=this.m_oAccountInfo.receivedData;if(n){var i=n.companyInvitations;i&&i.length?t(i):e()}else e()}else e()},e.prototype.ShowCompanyInviteDialog=function(e,t){var n=this,i=new ViewItem("receiveCompanyInvite_div",void 0,"dialog"),o=n.CreateUIItem(i),a={};a.invites=e,a.callback=t,n.m_navigator.Navigate({name:"Company Invitation",views:[o],context:a,initialize:function(e){n.AddReceivedInviteListeners(),n.InitReceivedInviteDialog(e)}})},e.prototype.InitReceivedInviteDialog=function(e){this.ShowServerWarning($(COMPANYINVITE_TOPTEXT2_ID)),$(COMPANYINVITE_PROGRESSDIV_ID).style.display="none",$(COMPANYINVITE_ERRORMSG_ID).innerHTML="";var t=e.invites[0],n=t.name?t.name:t.companyId;$(COMPANYINVITE_INVITETEXT_ID).innerHTML="Company <b>"+n+"</b> "+localeString("CompanyInvitationConfirmation_Title2")},e.prototype.NeedToShowOtherInviteDialog=function(){var e=this.m_navigator.GetCurrentContext();e.invites.splice(0,1),e.invites.length?this.InitReceivedInviteDialog(e):e.callback()},e.prototype.AddReceivedInviteListeners=function(){var e=this;$(COMPANYINVITE_ACCEPTBTN_ID).addEventListener("click",function(){e.AcceptReceivedInviteOnClick()},!1),$(COMPANYINVITE_REJECTBTN_ID).addEventListener("click",function(){e.RejectReceivedInviteOnClick()},!1),$(COMPANYINVITE_CANCELBTN_ID).addEventListener("click",function(){e.NeedToShowOtherInviteDialog()},!1)},e.prototype.AcceptRejectReceivedInvite=function(e){var t=this;q(!0,COMPANYINVITE_PROGRESSDIV_ID,[COMPANYINVITE_ACCEPTBTN_ID,COMPANYINVITE_REJECTBTN_ID,COMPANYINVITE_CANCELBTN_ID],COMPANYINVITE_CANCELBTN_ID),$(COMPANYINVITE_ERRORMSG_ID).innerHTML="";var n=t.m_navigator.GetCurrentContext().invites[0];e?getProxyRfo().JoinCompany({companyId:n.companyId}).then(function(e){var n=t.m_navigator.GetCurrentContext();n.invites=[],n.callback()}).catch(function(e){if(t.CheckGlobalErrorResponse2(e))return q(!1,COMPANYINVITE_PROGRESSDIV_ID,[COMPANYINVITE_ACCEPTBTN_ID,COMPANYINVITE_REJECTBTN_ID,COMPANYINVITE_CANCELBTN_ID],void 0),void($(COMPANYINVITE_ERRORMSG_ID)&&($(COMPANYINVITE_ERRORMSG_ID).innerHTML=e.Description))}):getProxyRfo().LeaveCompany({companyId:n.companyId}).then(function(e){t.NeedToShowOtherInviteDialog()}).catch(function(e){if(t.CheckGlobalErrorResponse2(e))return q(!1,COMPANYINVITE_PROGRESSDIV_ID,[COMPANYINVITE_ACCEPTBTN_ID,COMPANYINVITE_REJECTBTN_ID,COMPANYINVITE_CANCELBTN_ID],void 0),void($(COMPANYINVITE_ERRORMSG_ID)&&($(COMPANYINVITE_ERRORMSG_ID).innerHTML=e.Description))})},e.prototype.RejectReceivedInviteOnClick=function(){this.AcceptRejectReceivedInvite(!1)},e.prototype.AcceptReceivedInviteOnClick=function(){this.AcceptRejectReceivedInvite(!0)},e.prototype.ShowSendFileDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-item-title");n.m_oContext={image_data:getImageForType(e),title:getTextForItem(e)};var i=t.CreateUIItem(n),o=new ViewItem("sharingFile_div",void 0,"dialog"),a=t.CreateUIItem(o);e.Shared={},e.Shared.sender=this.m_oAccountInfo.accountId,e.Shared.senderName="You",e.Shared.senderEmail=this.m_oAccountInfo.email,e.Shared.isManager=!0,e.Shared.readOnly=!1,t.m_navigator.Navigate({name:"Send File Dialog",views:[i,a],context:{item_info:e,send:!0},initialize:function(e){t.InitShareFileDialog(e)},on_navigated_to:function(e){t.OnNavigatedToShareFileDialog(e)}})},e.prototype.ShowShareFileDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-item-title");n.m_oContext={image_data:getImageForType(e),title:getTextForItem(e)};var i=t.CreateUIItem(n),o=new ViewItem("sharingFile_div",void 0,"dialog"),a=t.CreateUIItem(o),r=e.s;if(r){if(e.Shared={},e.granted)e.Shared.sender=this.m_oAccountInfo.accountId,e.Shared.senderName="You",e.Shared.senderEmail=this.m_oAccountInfo.email;else{var s=r.substr(1),l=this.ShareFileGetGrantorByFileId(s);e.Shared.sender=l.grantor,e.Shared.senderName=l.grantorName,e.Shared.senderEmail=l.grantorEmail}e.Shared.isManager=!!e.granted,e.Shared.readOnly=!!e.readOnly&&e.readOnly}else e.Shared={},e.Shared.sender=this.m_oAccountInfo.accountId,e.Shared.senderName="You",e.Shared.senderEmail=this.m_oAccountInfo.email,e.Shared.isManager=!0,e.Shared.readOnly=!1;t.m_navigator.Navigate({name:"Share File Dialog",views:[i,a],context:{item_info:e},initialize:function(e){t.InitShareFileDialog(e)},on_navigated_to:function(e){t.OnNavigatedToShareFileDialog(e)}})},e.prototype.OnNavigatedToShareFileDialog=function(e){var t=this,n=e.item_info,i=n.Shared,o=e.send;$(SHAREFILE_ERRORMSG_TD_ID).innerHTML="",$(SHAREFILE_ADDRECIPIENT_EMAILINPUT_ID).value="";var a=getBG().g_policySet.GetConfigValue(ConfigDisableSharingOutsideCompany);if($(SHAREFILE_ADDRECIPIENT_EMAILSELECT_ID).style.display=a?"block":"none",$(SHAREFILE_ADDRECIPIENT_EMAILINPUT_ID).style.display=a?"none":"block",e.message&&($(SHAREFILE_ERRORMSG_TD_ID).innerHTML=e.message),!i.readOnly){var r=n.s;r&&!o?setTimeout(function(){var e=JSON.stringify({});getProxyRfo().GetSharedFileUsers(e,function(e){var n=JSON.parse(e);t.CheckGlobalErrorResponse(n)?n.error.description:s(n.items)})},10):s([])}function s(i){function s(){t.CheckLicenseIsExpired()&&($("sharingFile_license_btn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$(SHAREFILE_ERRORMSG_TD_ID).innerHTML=t.m_bTrialLicense?localeString("LicenseExpirationWarning_TrialExpired_Title"):localeString("LicenseExpirationWarning_LicenseExpired_Title"),$(SHAREFILE_ERRORMSG_TD_ID).style.color="red")}function l(e,n){for(var i=t.m_oAccountInfo.receivedData,o=i.accounts,a=0;a<o.length;a++)if(o[a].accepted&&o[a].senderEmail&&o[a].senderEmail==e)return!0;var r=i.receivedFiles;for(a=0;a<r.length;a++)if(r[a].accepted&&r[a].grantorEmail&&r[a].grantorEmail==e)return!0;for(a=0;a<n.length;a++)if(n[a].accepted&&n[a].recipientEmail&&n[a].recipientEmail==e)return!0;return!1}var c=$(SHAREFILE_RECIPIENTS_TABLE_ID);if(RemoveChilds(SHAREFILE_RECIPIENTS_TABLE_ID),a&&function(){for(;$(SHAREFILE_ADDRECIPIENT_EMAILSELECT_ID).options.length>0;)$(SHAREFILE_ADDRECIPIENT_EMAILSELECT_ID).remove(0);getProxyRfo().GetUserCompaniesMembers().then(function(e){for(var n=0;n<e.length;n++){var i=e[n];i.id!=t.m_oAccountInfo.accountId&&t.CreateInviteEmergencyContactOption($(SHAREFILE_ADDRECIPIENT_EMAILSELECT_ID),i.id,i.id)}}).catch(function(e){})}(),!o){var _,d;$("sharingFile_access_tr").style.display="",$("sharingFile_access_separator_tr").style.display="";for(var E=r?r.substr(1):"",u=i.grantedFiles?i.grantedFiles:[],p=[],m=0;m<u.length;m++){var g=u[m];g.id==E&&p.push(g)}if(e.recipients=p,!p.length)return delete n.s,void s();for(var I=0;I<p.length;I++){var T=p[I],S=T.recipientName?T.recipientName:T.recipientEmail?T.recipientEmail:T.recipient,f=T.recipientEmail?T.recipientEmail:T.recipient,h=!!T.accepted&&T.accepted,C=!T.hash,v=l(f,u),R={};R[ITEMINFO_PROPERTY]=JSON.stringify(T),_=t.createElement("tr",R);var D=t.createElement("td",{class:"sharing_email_td"}),A=t.createElement("table",{class:"sharing_nameemail_table"}),y=t.createElement("tr",{}),N=t.createElement("td",{class:"sharing_name_innertd"}),L=t.createElement("label",{class:"sharing_name_lbl",title:v?S:f});L.innerText=S,N.appendChild(L),y.appendChild(N),A.appendChild(y),y=t.createElement("tr",{class:"sharing_email_innertr"}),N=t.createElement("td",{class:"sharing_email_innertd"}),(L=t.createElement("label",{class:"sharing_email_lbl",title:f})).innerText=f,N.appendChild(L),y.appendChild(N),A.appendChild(y),D.appendChild(A),_.appendChild(D);var P=t.createElement("td",{class:"sharing_accepted_td"}),O=t.createElement("label",{class:"sharing_accepted_lbl"});O.innerText=h?"":C?"Sent, not received":"Granted, not accepted",P.appendChild(O),_.appendChild(P);var b=t.createElement("td",{class:"sharing_revoke_td",align:"right"}),G=t.createElement("div",{class:"sharing_revoke_div",title:localeString("SharedFileSettings_Revoke_Tip"),recipient:JSON.stringify(T)});G.style.background="url('"+ACCOUNT_REVOKE_IMAGE+"') no-repeat",b.appendChild(G),_.appendChild(b),c.appendChild(_)}var M=c.getElementsByTagName("div");for(d=0;d<M.length;d++)!function(){var e=M[d];e.addEventListener("click",function(){t.ShareFileOnRevokeClick(e)},!1)}();s()}}},e.prototype.ShareFileOnRevokeClick=function(e){var t=e.getAttribute("recipient");t=JSON.parse(t);var n={};this.m_navigator.GetCurrentContext();n.fileId=t.id,n.accountName=t.name,n.recipient=t.recipient,this.ShowRevokeFileFolderDialog(n)},e.prototype.InitShareFileDialog=function(e){var t=e.send;this.AddShareFileListeners(e);var n=!t&&this.CheckLicenseIsExpired();$("sharingFile_license_btn_td").style.display=n?"table-cell":"none",n?$(SHAREFILE_ADDRECIPIENT_BTN_ID).setAttribute("disabled","disabled"):$(SHAREFILE_ADDRECIPIENT_BTN_ID).removeAttribute("disabled"),n?$(SHAREFILE_ADDRECIPIENT_EMAILINPUT_ID).setAttribute("disabled","disabled"):$(SHAREFILE_ADDRECIPIENT_EMAILINPUT_ID).removeAttribute("disabled"),n?$(SHAREFILE_ADDRECIPIENT_EMAILSELECT_ID).setAttribute("disabled","disabled"):$(SHAREFILE_ADDRECIPIENT_EMAILSELECT_ID).removeAttribute("disabled");var i=e.item_info.Shared,o=!!i.isManager,a=(i.sender,i.senderName),r=i.senderEmail,s=(i.readOnly,this.m_oAccountInfo.email==r?"You":a?a+" <"+r+">":r);$("sharingFile_sentby_lbl").innerText=this.m_oAccountInfo.email==r?"":format(localeString("SharedFileSettings_SentBy"),s);var l=this.m_oAccountInfo.email==r?"":localeString("SharedFileSettings_InfoDescription");$("sharingFile_canbeedit_lbl").innerText=l,$("sharingFile_access_tr").style.display="none",$("sharingFile_access_separator_tr").style.display="none",$("sharingFile_addrecipienttitle_tr").style.display=o?"":"none",$("sharingFile_addrecipient_separator_tr").style.display=o?"":"none",$("sharingFile_addrecipient_main_tr").style.display=o?"":"none",$(SHAREFILE_ADDRECIPIENT_BTN_ID).value=t?localeString("Cmd_SendFile_Flat"):localeString("SharedFolderSettings_SendInvite"),$("sharingFile_addrecipient_lbl").innerText=t?format(localeString("SharedFileSettings_SendOneItem_Title"),"file"):localeString("SharedFolderSettings_AddRecipient_Title")},e.prototype.AddShareFileListeners=function(e){var t=this;$(SHAREFILE_CLOSEDLG_BTN_ID).addEventListener("click",function(){t.RenameDeleteRefreshItemsList()},!1),$(SHAREFILE_ADDRECIPIENT_BTN_ID).addEventListener("click",function(){t.ShareFileOnAddRecipient(e)},!1),$("sharingFile_license_btn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($(SHAREFILE_ERRORMSG_TD_ID))},!1)},e.prototype.ShareFileGetGrantorByFileId=function(e){for(var t=this.m_oAccountInfo.receivedData.receivedFiles,n=0;n<t.length;n++)if(e==t[n].id)return t[n]},e.prototype.ShareFileOnAddRecipient=function(e){var t=this;$(SHAREFILE_ERRORMSG_TD_ID).innerHTML="";var n=getBG().g_policySet.GetConfigValue(ConfigDisableSharingOutsideCompany),i=n?$(SHAREFILE_ADDRECIPIENT_EMAILSELECT_ID):$(SHAREFILE_ADDRECIPIENT_EMAILINPUT_ID),o=n?i.options[i.selectedIndex].value:i.value;if(!(o=o.trimLeft().trimRight()))return $(SHAREFILE_ERRORMSG_TD_ID).innerHTML=localeString("EmailIncorrect_Error"),void i.focus();if(o==t.m_oAccountInfo.email)return $(SHAREFILE_ERRORMSG_TD_ID).innerHTML="Forbidden: recipient cannot be the same account as current.",void i.focus();if(getBG().g_policySet.GetConfigValue(ConfigDisableSharing))$(SHAREFILE_ERRORMSG_TD_ID).innerHTML=localeString("Policy_CommandDisabled_Message");else{var a=e.item_info,r=e.send;!function(){var n=a.s?a.s.substr(1):"",i={};i.recipient=o,i.fileId=n,i.fileName=a.path,i.skipHash=!!r;var s=JSON.stringify(i);getProxyRfo().GrantFile(s,function(i){var a=JSON.parse(i);if(t.CheckGlobalErrorResponse(a))return a.error.description,void($(SHAREFILE_ERRORMSG_TD_ID).innerHTML=404==a.error.code?"Forbidden: recipient not found":a.error.description);!n&&a.fileId&&(e.item_info.s="G"+a.fileId),r&&(e.message="Data was sent to "+o),t.OnNavigatedToShareFileDialog(e)})}()}},e.prototype.ShowShareExistingFolderDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-item-title");n.m_oContext={title:"Share existing folder"};var i=t.CreateUIItem(n),o=new ViewItem("sharefolder_div",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Share Existing Folder Dialog",views:[i,a],context:{item_info:e},initialize:function(e){t.InitShareExistingFolderDialog(e)}})},e.prototype.AddShareExistingFolderListeners=function(){var e=this;$("sharefolder_closebtn").addEventListener("click",function(){e.m_navigator.GoBack()},!1)},e.prototype.InitShareExistingFolderDialog=function(e){var t=this,n=t.m_navigator.GetCurrentContext().item_info;t.AddShareExistingFolderListeners(),$("sharefolder_err_msg").innerHTML="";var i=t.CheckLicenseIsExpired();$("sharefolder_license_btn_td").style.display=i?"table-cell":"none",i?(setTimeout(function(){$("sharefolder_license_btn").focus()},200),$("sharefolder_license_btn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$("sharefolder_license_btn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($("sharefolder_err_msg"))},!1),$("sharefolder_err_msg").innerHTML=t.m_bTrialLicense?localeString("LicenseExpirationWarning_TrialExpired_Title"):localeString("LicenseExpirationWarning_LicenseExpired_Title"),$("sharefolder_err_msg").style.color="red",$("sharefolder_lbl").innerHTML="License is expired"):(q(!0,void 0,["sharefolder_closebtn"],"sharefolder_pr_indicator"),t.ShareExistingFolder(n))},e.prototype.ShareExistingFolder=function(e){var t=this,n={};CheckIsCompanyAdmin(this.m_oAccountInfo)&&(n.company=GetAdminCompanyName(this.m_oAccountInfo)),n.name=e.path,setTimeout(function(){var e=JSON.stringify(n);getProxyRfo().CreateSharedAccount(e,function(e){t.ResponseShareExistingFolder(e)})},10)},e.prototype.ResponseShareExistingFolder=function(e){q(!1,void 0,["sharefolder_closebtn"],"sharefolder_lbl");var t=JSON.parse(e);if(this.CheckGlobalErrorResponse(t))return $("sharefolder_lbl").innerHTML="Error",void($("sharefolder_err_msg").innerHTML=t.error.description);var n=this;setTimeout(function(){n.m_navigator.GoBack();var e=n.m_navigator.GetCurrentContext(),t=e.types,i=e.path,o=e.title,a=e.match;n.m_navigator.RemoveBackEntry(),n.ShowItemsListScreen(t,i,o,void 0,a)},100)},e.prototype.ShowShareFolderDialog=function(e){var t=this,n=(e.type,new ViewItem(void 0,void 0,"header-item-title"));n.m_oContext={image_data:getImageForType(e),title:getTextForItem(e)};var i=t.CreateUIItem(n),o=new ViewItem("sharing_div",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Share Folder Dialog",views:[i,a],context:{item_info:e},initialize:function(e){t.InitShareFolderDialog(e)},on_navigated_to:function(e){t.OnNavigatedToShareFolderDialog(e)}})},e.prototype.OnNavigatedToShareFolderDialog=function(e){var t=this,n=e.item_info.Shared,i=!!n.company,o=!!n.isAdmin,a=!!n.isManager,r=n.sender,s=t.m_oAccountInfo.email==r,l=i?[localeString("SharedFolderSettings_RoleManager"),localeString("SharedFolderSettings_RoleRegularUser"),localeString("SharedFolderSettings_RoleLimitedUser")]:[localeString("SharedFolderSettings_Permissions_FullControl"),localeString("SharedFolderSettings_Permissions_ReadWrite"),localeString("SharedFolderSettings_Permissions_UseOnly")],c=i?[localeString("SharedFolderSettings_RoleManager_Tip"),localeString("SharedFolderSettings_RoleRegularUser_Tip"),localeString("SharedFolderSettings_RoleLimitedUser_Tip")]:[localeString("SharedFolderSettings_Permissions_FullControl_Tip"),localeString("SharedFolderSettings_Permissions_ReadWrite_Tip"),localeString("SharedFolderSettings_Permissions_UseOnly_Tip")];i?$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[0].setAttribute("label",localeString("SharedFolderSettings_RoleManager")):$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[0].setAttribute("label",localeString("SharedFolderSettings_Permissions_FullControl")),$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[0].innerText=i?localeString("SharedFolderSettings_RoleManager"):localeString("SharedFolderSettings_Permissions_FullControl"),i?$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[0].setAttribute("title",localeString("SharedFolderSettings_RoleManager_Tip")):$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[0].setAttribute("title",localeString("SharedFolderSettings_Permissions_FullControl_Tip")),i?$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[1].setAttribute("label",localeString("SharedFolderSettings_RoleRegularUser")):$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[1].setAttribute("label",localeString("SharedFolderSettings_Permissions_ReadWrite")),$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[1].innerText=i?localeString("SharedFolderSettings_RoleRegularUser"):localeString("SharedFolderSettings_Permissions_ReadWrite"),i?$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[1].setAttribute("title",localeString("SharedFolderSettings_RoleRegularUser_Tip")):$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[1].setAttribute("title",localeString("SharedFolderSettings_Permissions_ReadWrite_Tip")),i?$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[2].setAttribute("label",localeString("SharedFolderSettings_RoleLimitedUser")):$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[2].setAttribute("label",localeString("SharedFolderSettings_Permissions_UseOnly")),$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[2].innerText=i?localeString("SharedFolderSettings_RoleLimitedUser"):localeString("SharedFolderSettings_Permissions_UseOnly"),i?$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[2].setAttribute("title",localeString("SharedFolderSettings_RoleLimitedUser_Tip")):$(SHARING_ADDRECIPIENT_ROLESELECT_ID).options[2].setAttribute("title",localeString("SharedFolderSettings_Permissions_UseOnly_Tip")),$("sharing_addrecipient_rolelbl_td").innerHTML=i?localeString("SharedFolderSettings_RecipientRole_Caption"):localeString("SharedFolderSettings_RecipientPermissions_Caption"),$(SHARING_ERRORMSG_TD_ID).innerHTML="",$(SHARING_ADDRECIPIENT_EMAILINPUT_ID).value="",this.ShareFolderSwitchButtons(!1);var _=getBG().g_policySet.GetConfigValue(ConfigDisableSharingOutsideCompany);$(SHARING_ADDRECIPIENT_EMAILSELECT_ID).style.display=_?"block":"none",$(SHARING_ADDRECIPIENT_EMAILINPUT_ID).style.display=_?"none":"block";var d=$(SHARING_RECIPIENTS_TABLE_ID);RemoveChilds(SHARING_RECIPIENTS_TABLE_ID),(i||!i&&(s||o||a))&&(_&&function(){for(;$(SHARING_ADDRECIPIENT_EMAILSELECT_ID).options.length>0;)$(SHARING_ADDRECIPIENT_EMAILSELECT_ID).remove(0);getProxyRfo().GetUserCompaniesMembers().then(function(e){for(var n=0;n<e.length;n++){var i=e[n];i.id!=t.m_oAccountInfo.accountId&&t.CreateInviteEmergencyContactOption($(SHARING_ADDRECIPIENT_EMAILSELECT_ID),i.id,i.id)}}).catch(function(e){})}(),setTimeout(function(){var o={};o.sharedAccountId=n.accountId;var a=JSON.stringify(o);getProxyRfo().GetRecipientsForSharedAccount(a,function(o){var a=JSON.parse(o);if(t.CheckGlobalErrorResponse(a))a.error.description;else{$("sharing_access_tr").style.display="",$("sharing_access_separator_tr").style.display="";var r=a.items.accounts;e.recipients=r;for(var s=!1,_=0;_<r.length;_++)if(!((m=(p=r[_]).accountId==t.m_oAccountInfo.accountId)||p.disabled&&p.disabled)){var E=!!p.isManager&&p.isManager,u=!!p.isAdmin&&p.isAdmin;if(E||u){s=!0;break}}for(_=0;_<r.length;_++){var p,m=(p=r[_]).accountId==t.m_oAccountInfo.accountId,g=p.recipientName,I=p.recipientEmail;g=g||I;var T=!!p.accepted&&p.accepted,S=(E=!!p.isManager&&p.isManager,!!p.readOnly&&p.readOnly);if(u=!!p.isAdmin&&p.isAdmin,(!p.disabled||!p.disabled)&&(1!=r.length||!m)&&(s||!m)){var f={};f[ITEMINFO_PROPERTY]=JSON.stringify(p);var h=t.createElement("tr",f),C=t.createElement("td",{class:"sharing_email_td"}),v=t.createElement("table",{class:"sharing_nameemail_table"}),R=t.createElement("tr",{}),D=t.createElement("td",{class:"sharing_name_innertd"}),A=t.createElement("div",{class:"sharing_name_lbl",title:g});A.innerText=m?g+" (You)":g,D.appendChild(A),R.appendChild(D),v.appendChild(R),R=t.createElement("tr",{class:"sharing_email_innertr"}),D=t.createElement("td",{class:"sharing_email_innertd"}),(A=t.createElement("div",{class:"sharing_email_lbl",title:I})).innerText=I,D.appendChild(A),R.appendChild(D),v.appendChild(R),C.appendChild(v),h.appendChild(C);var y=t.createElement("td",{class:"sharing_accepted_td"}),N=t.createElement("label",{class:"sharing_accepted_lbl"});N.innerText=T?"":"Not Received",y.appendChild(N),h.appendChild(y);var L=t.createElement("td",{class:"sharing_roles_td"}),P=!!u;if(!m){for(var O=t.createElement("select",{class:"sharing_roles_select"}),b=0;b<l.length;b++){var G=b?l[b]:i?u?localeString("SharedFolderSettings_RoleAdmin"):localeString("SharedFolderSettings_RoleManager"):localeString("SharedFolderSettings_Permissions_FullControl"),M=b?c[b]:i?localeString("SharedFolderSettings_RoleManager_Tip"):localeString("SharedFolderSettings_Permissions_FullControl_Tip"),w=t.createElement("option",{class:"sharing_roles_option",label:G,title:M,value:b});w.text=G,O.add(w,null)}L.appendChild(O),P&&O.setAttribute("disabled","disabled");var x=E||u?0:S?2:1;O.selectedIndex=x,O.setAttribute("initial",x),O.setAttribute("recipient",p.accountId)}h.appendChild(L);var F=t.createElement("td",{class:"sharing_revoke_td",align:"right"});if(!(u||m&&i)){var k=t.createElement("div",{class:"sharing_revoke_div",title:localeString("SharedFolderSettings_Revoke_Tip"),recipient:JSON.stringify(p),accountId:n.accountId});k.style.background="url('"+ACCOUNT_REVOKE_IMAGE+"') no-repeat",F.appendChild(k),h.appendChild(F)}m?d.insertBefore(h,d.firstChild):d.appendChild(h)}}for(var B=d.getElementsByTagName("div"),H=0;H<B.length;H++)!function(){var e=B[H];if(e.getAttribute("accountId")){if(t.CheckLicenseIsExpired())return void e.setAttribute("disabled","disabled");e.addEventListener("click",function(){t.ShareFolderOnRevokeClick(e)},!1)}}();for(var U=d.getElementsByTagName("select"),W=0;W<U.length;W++)!function(){var e=U[W];t.CheckLicenseIsExpired()?e.setAttribute("disabled","disabled"):e.addEventListener("change",function(){t.ShareFolderOnChangeRole(e)},!1)}();i?$("sharing_addrecipient_prompt_td").innerHTML="":($("sharing_addrecipient_prompt_td").innerHTML=localeString("SharedFolderSettings_Permissions_ReadWrite_Prompt"),$("sharing_addrecipient_roleselect").addEventListener("change",function(e){switch(e.currentTarget.selectedIndex){case 0:$("sharing_addrecipient_prompt_td").innerHTML=localeString("SharedFolderSettings_Permissions_FullControl_Prompt");break;case 1:$("sharing_addrecipient_prompt_td").innerHTML=localeString("SharedFolderSettings_Permissions_ReadWrite_Prompt");break;case 2:$("sharing_addrecipient_prompt_td").innerHTML=localeString("SharedFolderSettings_Permissions_UseOnly_Prompt")}},!1))}})},10)),t.CheckLicenseIsExpired()&&($("sharing_license_btn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$("sharing_license_btn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($(SHARING_ERRORMSG_TD_ID))},!1),$(SHARING_ERRORMSG_TD_ID).innerHTML=t.m_bTrialLicense?localeString("LicenseExpirationWarning_TrialExpired_Title"):localeString("LicenseExpirationWarning_LicenseExpired_Title"),$(SHARING_ERRORMSG_TD_ID).style.color="red")},e.prototype.InitShareFolderDialog=function(e){this.AddShareFolderListeners(e);var t=this.CheckLicenseIsExpired();$("sharing_license_btn_td").style.display=t?"table-cell":"none",t?$(SHARING_ADDRECIPIENT_BTN_ID).setAttribute("disabled","disabled"):$(SHARING_ADDRECIPIENT_BTN_ID).removeAttribute("disabled"),t?$(SHARING_ADDRECIPIENT_ROLESELECT_ID).setAttribute("disabled","disabled"):$(SHARING_ADDRECIPIENT_ROLESELECT_ID).removeAttribute("disabled"),t?$(SHARING_ADDRECIPIENT_EMAILINPUT_ID).setAttribute("disabled","disabled"):$(SHARING_ADDRECIPIENT_EMAILINPUT_ID).removeAttribute("disabled"),t?$(SHARING_ADDRECIPIENT_EMAILSELECT_ID).setAttribute("disabled","disabled"):$(SHARING_ADDRECIPIENT_EMAILSELECT_ID).removeAttribute("disabled");var n=e.item_info.Shared,i=!!n.isManager,o=!!n.isAdmin,a=!!n.company,r=n.sender,s=n.senderName,l=n.senderEmail,c=n.readOnly,_=this.m_oAccountInfo.email==r,d=_?"You":s?s+" <"+l+">":l;$("sharing_sentby_lbl").innerText=_?localeString("SharedFolderSettings_CreatedByMe_Text"):format(localeString("SharedFolderSettings_SentBy_Text"),d);var E=c?localeString("SharedFolderSettings_LimitedDescription2"):i||o?localeString("SharedFolderSettings_ManagerDescription"):localeString("SharedFolderSettings_RegularDescription");$("sharing_canbeedit_lbl").innerText=E,$("sharing_access_tr").style.display="none",$("sharing_access_separator_tr").style.display="none",$("sharing_addrecipient_separator_tr").style.display=i||o?"":"none",$("sharing_addrecipient_main_tr").style.display=i||o?"":"none",$("sharing_addrecipienttitle_tr").style.display=i||o?"":"none",$(SHARING_DELETEACCOUNT_BTN_ID).style.display=a?o?"":"none":"",$(SHARING_STOPSHARING_BTN_ID).style.display=a?o?"":"none":_||o||i?"":"none",$(SHARING_DELETEACCOUNT_BTN_ID).value=a?localeString("SharedFolderSettings_DeleteSharedFolder"):_||o||i?localeString("SharedFolderSettings_DeleteSharedFolder"):localeString("SharedFolderSettings_RejectSharedFolder")},e.prototype.AddShareFolderListeners=function(e){var t=this;$(SHARING_CLOSEDLG_BTN_ID).addEventListener("click",function(){t.m_navigator.GoBack()},!1),$(SHARING_STOPSHARING_BTN_ID).addEventListener("click",function(){t.ShowStopSharingFolderDialog(e.item_info)},!1),$(SHARING_DELETEACCOUNT_BTN_ID).addEventListener("click",function(){t.ShowDeleteItemDialog(e.item_info)},!1),$(SHARING_ADDRECIPIENT_BTN_ID).addEventListener("click",function(){t.ShareFolderOnAddRecipient(e)},!1),$(SHARING_CANCELCHANGES_BTN_ID).addEventListener("click",function(){t.ShareFolderOnCancelChanges(e)},!1),$(SHARING_APPLYCHANGES_BTN_ID).addEventListener("click",function(){t.ShareFolderOnApplyChanges(e)},!1)},e.prototype.ShareFolderOnApplyChanges=function(e){var t=this,n=e.item_info.Shared.accountId,i=[];function o(e,t,i,o,a){var r={};r.accountId=n,r.recipient=e,r.isManager=t,r.readOnly=i;var s=JSON.stringify(r);getProxyRfo().GrantSharedAccount(s,function(e){var t=JSON.parse(e);t.error?a(t.error):o(t)})}!function(){var e=$(SHARING_RECIPIENTS_TABLE_ID).getElementsByTagName("select");for(ind=0;ind<e.length;ind++)e[ind].selectedIndex!=e[ind].getAttribute("initial")&&i.push({recipient:e[ind].getAttribute("recipient"),role:e[ind].selectedIndex});!function(){for(var e=i.length,n=0;n<i.length;n++){var a=i[n].recipient,r=i[n].role;o(a,!r,2==r,function(n){--e||t.ShareFolderSwitchButtons(!1)},function(n){e--,$(SHARING_ERRORMSG_TD_ID).innerHTML=n.description,e||t.ShareFolderSwitchButtons(!1)})}}()}()},e.prototype.ShareFolderOnCancelChanges=function(){var e=$(SHARING_RECIPIENTS_TABLE_ID).getElementsByTagName("select");for(ind=0;ind<e.length;ind++)e[ind].selectedIndex=e[ind].getAttribute("initial");this.ShareFolderSwitchButtons(!1)},e.prototype.ShareFolderOnAddRecipient=function(e){var t=this;$(SHARING_ERRORMSG_TD_ID).innerHTML="";var n=getBG().g_policySet.GetConfigValue(ConfigDisableSharingOutsideCompany),i=n?$(SHARING_ADDRECIPIENT_EMAILSELECT_ID):$(SHARING_ADDRECIPIENT_EMAILINPUT_ID),o=n?i.options[i.selectedIndex].value:i.value;if(!(o=o.trimLeft().trimRight()))return $(SHARING_ERRORMSG_TD_ID).innerHTML=localeString("EmailIncorrect_Error"),void i.focus();if(o==t.m_oAccountInfo.email)return $(SHARING_ERRORMSG_TD_ID).innerHTML="Forbidden: recipient cannot be the same account as current.",void i.focus();if(!!e.item_info.Shared.company||!getBG().g_policySet.GetConfigValue(ConfigDisableSharing)){var a=$(SHARING_ADDRECIPIENT_ROLESELECT_ID).selectedIndex,r=!a,s=2==a,l={};l.accountId=e.item_info.Shared.accountId,l.recipient=o,l.isManager=r,l.readOnly=s;var c=JSON.stringify(l);getProxyRfo().GrantSharedAccount(c,function(n){var i=JSON.parse(n);if(t.CheckGlobalErrorResponse(i))return i.error.description,void($(SHARING_ERRORMSG_TD_ID).innerHTML=i.error.description);t.OnNavigatedToShareFolderDialog(e)})}else $(SHARING_ERRORMSG_TD_ID).innerHTML=localeString("Policy_CommandDisabled_Message")},e.prototype.ShareFolderSwitchButtons=function(e){$(SHARING_ERRORMSG_TD_ID).innerHTML="",$(SHARING_APPLYCHANGES_BTN_ID).style.display=e?"":"none",$(SHARING_CANCELCHANGES_BTN_ID).style.display=e?"":"none",$(SHARING_CLOSEDLG_BTN_ID).style.display=e?"none":""},e.prototype.ShareFolderOnRevokeClick=function(e){var t=e.getAttribute("accountId"),n=e.getAttribute("recipient");n=JSON.parse(n);var i={},o=this.m_navigator.GetCurrentContext();i.recipient=n.accountId,i.accountId=t,i.accountName=n.name,i.recipients=o.recipients,i.sender=o.item_info.Shared.sender,this.ShowRevokeFileFolderDialog(i)},e.prototype.ShareFolderOnChangeRole=function(e){var t=!1,n=$(SHARING_RECIPIENTS_TABLE_ID).getElementsByTagName("select");for(ind=0;ind<n.length;ind++)if(n[ind].selectedIndex!=n[ind].getAttribute("initial")){t=!0;break}this.ShareFolderSwitchButtons(t)},e.prototype.ShowStopSharingFolderDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-item-title");n.m_oContext={image_data:getImageForType({type:EnRfDataItemType.RfItemType_Folder}),title:"RoboForm Warning"};var i=t.CreateUIItem(n),o=new ViewItem("stopshared_div",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Stop Sharing Dialog",views:[i,a],context:e,initialize:function(e){t.InitStopSharingFolderDialog(e)}})},e.prototype.InitStopSharingFolderDialog=function(e){this.AddStopSharingFolderListeners();var t=format(localeString("StopSharingFolder_WarningMessage"),e.Shared.name);$("stopshared_dlgtext").innerHTML=t,$("stopshared_err_msg").innerHTML="",$("stopshared_okbtn").focus()},e.prototype.AddStopSharingFolderListeners=function(){var e=this;$("stopshared_cancelbtn").addEventListener("click",function(){e.m_navigator.GoBack()},!1),$("stopshared_okbtn").addEventListener("click",function(){e.SubmitStopSharingFolderDialog()},!1)},e.prototype.SubmitStopSharingFolderDialog=function(){var e=this.m_navigator.GetCurrentContext();if(e){var t=this;$("stopshared_err_msg").innerHTML="",q(!0,"stopshared_progress_div",["stopshared_cancelbtn","stopshared_okbtn"],"stopshared_okbtn");var n={};n[ITEM_PROPERTY]=JSON.stringify(e),n.bDeleteShared=!1;var i=JSON.stringify(n);getProxyRfo().DeleteItem(i,function(e){q(!1,"stopshared_progress_div",["stopshared_cancelbtn","stopshared_okbtn"],void 0);var n=JSON.parse(e);if(visibilityEffect($(MAINSCREEN_DIV),[7,10]),$("loading_circle").style.display="none",t.CheckGlobalErrorResponse(n))$("stopshared_err_msg").innerHTML=n.error.description;else{t.m_navigator.RemoveBackEntry(),t.m_navigator.GoBack();var i=t.m_navigator.GetCurrentContext();if(i){var o=i.types,a=i.path,r=i.title;t.ShowItemsListScreen(o,a,r)}}},t.ShowProgressIndicator)}},e.prototype.ShowRevokeFileFolderDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-item-title");n.m_oContext={image_data:getImageForType({type:EnRfDataItemType.RfItemType_Folder}),title:"RoboForm Warning"};var i=t.CreateUIItem(n),o=new ViewItem("revokeshared_div",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Revoke Item Dialog",views:[i,a],context:e,initialize:function(e){t.InitRevokeFileFolderDialog(e)}})},e.prototype.InitRevokeFileFolderDialog=function(e){this.AddRevokeFileFolderListeners();var t=this.m_oAccountInfo.email!=e.recipient,n=(this.m_oAccountInfo.email,e.recipient,!!e.fileId),i=t?n?format(localeString("SharedFile_Revoke_Confirmation"),e.accountName,e.recipient):format(localeString("SharedFolder_Revoke_Confirmation"),e.accountName,e.recipient):format(localeString("RejectFolder_Caption"),e.accountName);$("revokeshared_dlgtext").innerHTML=i,$("revokeshared_err_msg").innerHTML="",$("revokeshared_okbtn").focus()},e.prototype.AddRevokeFileFolderListeners=function(){var e=this;$("revokeshared_cancelbtn").addEventListener("click",function(){e.m_navigator.GoBack()},!1),$("revokeshared_okbtn").addEventListener("click",function(){e.SubmitRevokeFileFolderDialog()},!1)},e.prototype.SubmitRevokeFileFolderDialog=function(){var e=this.m_navigator.GetCurrentContext();if(e){$("revokeshared_err_msg").innerHTML="",q(!0,"revokeshared_progress_div",["revokeshared_cancelbtn","revokeshared_okbtn"],"revokeshared_okbtn");var t=this,n=!!e.fileId;setTimeout(function(){n?function(){var n={};n.recipient=e.recipient,n.fileId=e.fileId;var i=JSON.stringify(n);getProxyRfo().RevokeSharedFile(i,function(e){q(!1,"revokeshared_progress_div",["revokeshared_cancelbtn","revokeshared_okbtn"],void 0);var n=JSON.parse(e);t.CheckGlobalErrorResponse(n)?$("revokeshared_err_msg").innerHTML=n.error.description:(t.m_navigator.GetCurrentContext(),t.m_navigator.GoBack())})}():function(){var n={};n.recipient=e.recipient,n.sharedAccountId=e.accountId;var i=JSON.stringify(n);getProxyRfo().RevokeSharedAccount(i,function(e){q(!1,"revokeshared_progress_div",["revokeshared_cancelbtn","revokeshared_okbtn"],void 0);var n=JSON.parse(e);if(t.CheckGlobalErrorResponse(n))$("revokeshared_err_msg").innerHTML=n.error.description;else{var i=t.m_navigator.GetCurrentContext(),o=i.recipients;if(o&&1==o.length){if(i.sender==o[0].sender){t.m_navigator.RemoveBackEntry(),t.m_navigator.GoBack();var a=t.m_navigator.GetCurrentContext();if(a){var r=a.types,s=a.path,l=a.title;t.ShowItemsListScreen(r,s,l)}}}else t.m_navigator.GoBack()}})}()},10)}},e.prototype.ShowDeleteItemDialog=function(e){var t=this,n=(e.type,new ViewItem(void 0,void 0,"header-item-title"));n.m_oContext={image_data:getImageForType(e),title:getTextForItem(e)};var i=t.CreateUIItem(n),o=new ViewItem("rfobject_delete_section_div",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Delete Item Dialog",views:[i,a],context:{item_info:e},initialize:function(e){t.InitDeleteItemDialog(e)}})},e.prototype.AddDeleteItemListeners=function(){var e=this;$(DELETEOBJ_DLG_CNCL_BTN).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(DELETEOBJ_DLG_OK_BTN).addEventListener("click",function(){e.SubmitDeleteItemDialog()},!1)},e.prototype.InitDeleteItemDialog=function(e){this.AddDeleteItemListeners();var t=e.item_info,n=t.Shared,i=getTextForItem(t),o=i.substring(i.lastIndexOf("/")+1),a=" "+fileTypeToText(t[RFTYPE_PROPERTY])+" ";if($(DELETEOBJ_DLG_LABEL_ID).innerHTML=localeString("SharedFileSettings_Loading"),t[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Folder)if(n){n.company;var r=!!n.isManager,s=!!n.isAdmin,l=n.sender,c=this.m_oAccountInfo.email==l;$(DELETEOBJ_DLG_LABEL_ID).innerHTML=c||r||s?format(localeString("DeleteSharedFolder_ManagerCaption"),o):format(localeString("RejectSharedFolder_WarningMessage"),o)}else getProxyRfo().GetFolderStats(t[ITEMINFO_PATH_PROP]).then(function(e){if($(DELETEOBJ_DLG_LABEL_ID).innerText=format(localeString("Cmd_Delete_Confirm"),a,o),e){function t(t){return 0==e[t]?0:e[t]?e[t]:"?"}var n=t(EnRfDataItemType.RfItemType_Identity),i=t(EnRfDataItemType.RfItemType_Login),r=t(EnRfDataItemType.RfItemType_Safenote),s=t(EnRfDataItemType.RfItemType_Generic);$(DELETEOBJ_DLG_LABEL_ID).innerText=format(localeString("Uninstall_UserDataErase_Text"),o,n,i,r,s)}}).catch(function(e){var t=e&&e.Description;t&&($(DELETEOBJ_DLG_LABEL_ID).innerText=t)});else $(DELETEOBJ_DLG_LABEL_ID).style.width=$(DELETEOBJ_DLG_LABEL_ID).parentElement.clientWidth-5+"px",$(DELETEOBJ_DLG_LABEL_ID).innerHTML=format(localeString("Cmd_Delete_Confirm"),a,o);$(DELETEOBJ_DLG_ERRLBL_ID).innerHTML="",$(DELETEOBJ_DLG_OK_BTN).focus()},e.prototype.SubmitDeleteItemDialog=function(){var e=this.m_navigator.GetCurrentContext();if(e){var t=e.item_info;if(t){$(DELETEOBJ_DLG_ERRLBL_ID).innerHTML="";var n=this;q(!0,void 0,[DELETEOBJ_DLG_OK_BTN,DELETEOBJ_DLG_CNCL_BTN],DELETEOBJ_DLG_LABEL_ID);var i=n.m_oAccountInfo&&n.m_oAccountInfo.oneFile,o=t[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Folder;i&&!o?function(){var e={};e[ITEMINFO_PROPERTY]=JSON.stringify(t);var i=JSON.stringify(e);getProxyRfo().GetDataItem(i,function(e){var t=JSON.parse(e);if(n.CheckGlobalErrorResponse(t))return q(!1,void 0,[DELETEOBJ_DLG_OK_BTN,DELETEOBJ_DLG_CNCL_BTN],DELETEOBJ_DLG_LABEL_ID),void($(DELETEOBJ_DLG_ERRLBL_ID).innerHTML=t.error.description);a(t.item_data)})}():a()}}function a(e){setTimeout(function(){var i={};i[ITEM_PROPERTY]=JSON.stringify(t),e&&(i.fileData=JSON.stringify(e)),i.bDeleteShared=!0;var o=JSON.stringify(i);getProxyRfo().DeleteItem(o,function(e){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none",n.ResponseDeleteItem(e)},n.ShowProgressIndicator)},10)}},e.prototype.ResponseDeleteItem=function(e){q(!1,void 0,[DELETEOBJ_DLG_OK_BTN,DELETEOBJ_DLG_CNCL_BTN],DELETEOBJ_DLG_LABEL_ID);var t=JSON.parse(e);if(this.CheckGlobalErrorResponse(t))$(DELETEOBJ_DLG_ERRLBL_ID).innerHTML=t.error.description;else{var n=this;setTimeout(function(){var e=n.m_navigator.GetCurrentContext().item_info;if(e.Shared)return n.m_navigator.RemoveBackEntry(),void n.RenameDeleteRefreshItemsList();var i,o,a=n.m_oAccountInfo&&n.m_oAccountInfo.oneFile,r=e[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Folder;a&&!r?(i=JSON.parse(t[CONTEXT_PROPERTY].fileData),(o={}).fileData=i,o[PATH_PROPERTY]=e[PATH_PROPERTY],setTimeout(function(){var e=JSON.stringify(o);getProxyRfo().GetIdenticalFiles(e,function(e){var t=JSON.parse(e);if(n.CheckGlobalErrorResponse(t))$(DELETEOBJ_DLG_ERRLBL_ID).innerHTML=t.error.description;else{var i=t.items;i&&i.length?(n.m_navigator.GoBack(),n.ShowIdenticalFilesDialog(t.items,void 0,n.EnObjectAction.Delete)):n.RenameDeleteRefreshItemsList()}})},10)):n.RenameDeleteRefreshItemsList()},10)}},e.prototype.ShowRenameItemDialog=function(e){var t=this,n=(e.type,new ViewItem(void 0,void 0,"header-item-title"));n.m_oContext={image_data:getImageForType(e),title:getTextForItem(e)};var i=t.CreateUIItem(n),o=new ViewItem("rffolder_rename_div",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Rename Item",views:[i,a],context:{item_info:e},initialize:function(e){t.InitRenameItemDialog(e)}})},e.prototype.AddRenameItemListeners=function(){var e=this;$(RENAMEFLD_DLG_CNCL_BTN).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(RENAMEFLD_DLG_OK_BTN).addEventListener("click",function(){e.SubmitRenameItemDialog()},!1),$(RENAMEFLD_DLG_INPUT_ID).addEventListener("keyup",function(t){e.InputOnChange($(RENAMEFLD_DLG_INPUT_ID),$(RENAMEFLD_DLG_OK_BTN),$(RENAMEFLD_DLG_ERR_LBL_ID))&&e.GlobalInputKeyHandler(t)},!1)},e.prototype.InputOnChange=function(e,t,n){t.removeAttribute("disabled"),n.innerText="",$(RENAMEFLD_DLG_ERR_OVERWRITE_ID).style.display="none";var i=e.value;if(!i)return t.setAttribute("disabled","disabled"),!1;var o=this.m_navigator.GetCurrentContext().item_info,a=o[PATH_PROPERTY],r=RfapiJS.utils.FileTypeToExt(o[RFTYPE_PROPERTY]),s=a.substr(0,a.lastIndexOf("/"));return a!=s+"/"+i+r||(t.setAttribute("disabled","disabled"),!1)},e.prototype.InitRenameItemDialog=function(e){this.AddRenameItemListeners();var t=e.item_info,n=getTextForItem(t);$(RENAMEFLD_DLG_ERR_LBL_ID).innerHTML="",$(RENAMEFLD_DLG_ERR_OVERWRITE_ID).style.display="none",$(RENAMEFLD_DLG_INPUT_ID).value=n,$(RENAMEFLD_DLG_ERR_OVERWRITE_CHK).checked=!1,$(RENAMEFLD_DLG_INPUT_ID).select(),q(!1,RENAMEFLD_DLG_PRGINDTOR_ID,[RENAMEFLD_DLG_OK_BTN,RENAMEFLD_DLG_CNCL_BTN],null),setTimeout(function(){$(RENAMEFLD_DLG_INPUT_ID).focus()},200),$(RENAMEFLD_DLG_OK_BTN).setAttribute("disabled","disabled")},e.prototype.SubmitRenameItemDialog=function(){if($(RENAMEFLD_DLG_ERR_OVERWRITE_ID).style.display="none",this.Popup_Dialog_CheckNameValid(RENAMEFLD_DLG_ERR_LBL_ID,RENAMEFLD_DLG_INPUT_ID)){var e=this.m_navigator.GetCurrentContext().item_info,t=$(RENAMEFLD_DLG_INPUT_ID).value,n=e[PATH_PROPERTY],i=RfapiJS.utils.FileTypeToExt(e[RFTYPE_PROPERTY]),o=n.substr(0,n.lastIndexOf("/"))+"/"+t+i,a=!!$(RENAMEFLD_DLG_ERR_OVERWRITE_CHK).checked,r=this;!function(){q(!0,void 0,[RENAMEFLD_DLG_OK_BTN,RENAMEFLD_DLG_CNCL_BTN],RENAMEFLD_DLG_LABEL_ID);var t={};t.oldPath=n,t.oldType=e[RFTYPE_PROPERTY],t.newPath=o,t.newType=e[RFTYPE_PROPERTY],t.bOverwrite=a,t[ITEMINFO_PROPERTY]=e,setTimeout(function(){var e=JSON.stringify(t);getProxyRfo().MoveItem(e,function(e){visibilityEffect($(MAINSCREEN_DIV),[7,10]),$("loading_circle").style.display="none",r.ResponseRenameItem(e)},r.ShowProgressIndicator)},10)}()}else $(RENAMEFLD_DLG_INPUT_ID).focus()},e.prototype.RenameDeleteRefreshItemsList=function(){var e=this;e.m_navigator.GoBack();var t=e.m_navigator.current.name,n=e.m_navigator.GetCurrentContext();if("Recently Used"==t){var i=n.types,o={};o.types=i,getProxyRfo().GetHistoryList(JSON.stringify(o),function(t){e.ResponseGetRecentlyUsedItems(JSON.parse(t))})}else if("Search Results"==t){var a={};a.search=n.query;var r=JSON.stringify(a);getProxyRfo().Search_Items(r,function(t){e.Response_Search_Items(JSON.parse(t))})}else if("Start Screen"==t);else if(n){var s=n.types,l=n.path,c=n.title;e.m_navigator.RemoveBackEntry(),e.ShowItemsListScreen(s,l,c)}},e.prototype.ResponseRenameItem=function(e){var t=this,n=JSON.parse(e),i=n.context,o=i[ITEMINFO_PROPERTY];if(q(!1,void 0,[RENAMEFLD_DLG_OK_BTN,RENAMEFLD_DLG_CNCL_BTN],RENAMEFLD_DLG_LABEL_ID),this.CheckGlobalErrorResponse(n)){var a=n[JSON_MSG_ERROR];return $(RENAMEFLD_DLG_ERR_LBL_ID).innerHTML=a[JSON_MSG_DESCRIPTION],void(a[JSON_MSG_CODE]&&a[JSON_MSG_CODE]==ERR_OBJECT_ALREADY_EXISTS&&i&&i.oldType!=EnRfDataItemType.RfItemType_Folder&&($(RENAMEFLD_DLG_ERR_OVERWRITE_ID).style.display="inline"))}var r=this.m_oAccountInfo&&this.m_oAccountInfo.oneFile,s=i.oldType==EnRfDataItemType.RfItemType_Folder;r&&!s?function(){var e={};o[PATH_PROPERTY]=i.newPath,e[ITEMINFO_PROPERTY]=JSON.stringify(o);var n=JSON.stringify(e);getProxyRfo().GetDataItem(n,function(e){var n,o,a=JSON.parse(e);t.CheckGlobalErrorResponse(a)||(n=a.item_data,(o={}).fileData=n,o[PATH_PROPERTY]=i.oldPath,setTimeout(function(){var e=JSON.stringify(o);getProxyRfo().GetIdenticalFiles(e,function(e){var n=JSON.parse(e);if(t.CheckGlobalErrorResponse(n))$(RENAMEFLD_DLG_ERR_OVERWRITE_ID).innerHTML=n.error.description;else{var o=n.items;if(!o||!o.length||1==o.length&&o[0].current)t.RenameDeleteRefreshItemsList();else{t.m_navigator.GoBack();var a=i.newPath.substr(i.newPath.lastIndexOf("/")+1);a=a.substr(0,a.lastIndexOf(".")),t.ShowIdenticalFilesDialog(n.items,a,t.EnObjectAction.Rename,!0)}}})},10))})}():t.RenameDeleteRefreshItemsList()},e.prototype.InitMainScreen=function(e){this.base.InitMainScreen.call(this,e);var t=this;$(ID_PASSCARD_SELECT_COMBINED).addEventListener("click",function(){t.MainScreenLoginsSelectClick()},!1),$(ID_BOOKMARK_SELECT_COMBINED).addEventListener("click",function(){t.MainScreenBookmarksSelectClick()},!1),$(ID_SAFENOTE_SELECT_COMBINED).addEventListener("click",function(){t.MainScreenSafenotesSelectClick()},!1);var n=$(ID_SAVE_FORMS);n&&n.addEventListener("click",function(){t.MainScreenSaveButtonClick()},!1),$(ID_FillGenPassword).addEventListener("click",function(){t.MainScreenGenerateButtonClick()},!1),$(ID_Cmd_Logoff).addEventListener("click",function(){t.MainScreenLogoffButtonClick()},!1)},e.prototype.MainScreenLoginsSelectClick=function(e){this.SetContextMenuItemsVisibility(["contextmenu_list_page","contextmenu_common"]),this.ShowItemsListScreen([EnRfDataItemType.RfItemType_Login,EnRfDataItemType.RfItemType_SearchCard,EnRfDataItemType.RfItemType_Folder],RF_ROOT_FOLDER_URL,localeString("Cmd_Logins_Flat"))},e.prototype.MainScreenBookmarksSelectClick=function(e){this.SetContextMenuItemsVisibility(["contextmenu_list_page","contextmenu_common"]),this.ShowItemsListScreen([EnRfDataItemType.RfItemType_Bookmark,EnRfDataItemType.RfItemType_Folder],RF_ROOT_FOLDER_URL,localeString("Cmd_Bookmarks_Flat"))},e.prototype.MainScreenSafenotesSelectClick=function(e){this.SetContextMenuItemsVisibility(["contextmenu_safenote_page","contextmenu_list_page","contextmenu_common"]),this.ShowItemsListScreen([EnRfDataItemType.RfItemType_Safenote,EnRfDataItemType.RfItemType_Folder],RF_ROOT_FOLDER_URL,localeString("Cmd_Safenotes_Flat"))},e.prototype.MainScreenSaveButtonClick=function(e){this.ManualSaveAction()},e.prototype.MainScreenGenerateButtonClick=function(e){this.ShowPasswordGeneratorDialog()},e.prototype.MainScreenLogoffButtonClick=function(e){this.LogOff()},e.prototype.OnNavigatedToMainScreen=function(e){this.SetContextMenuItemsVisibility(["contextmenu_start_page","contextmenu_common"]),this.LoadMainScreenData(e)},e.prototype.LoadMainScreenData=function(e){var t=this,n={};n.types=[EnRfDataItemType.RfItemType_Login],getProxyRfo().GetHistoryList(JSON.stringify(n),function(n){g_bg_connector.GetMatchingData(function(i){var o=i[0][ITEMS_PROPERTY];t.m_tab_id=i[0].tab_id;var a=i[1],r=JSON.parse(n)[ITEMS_PROPERTY];e.matchings=o,e.identities=a,e.recent=r,t.UpdateMatch()})})},e.prototype.GetMainScreenItems=function(){var e=this.base.GetMainScreenItems.call(this);return g_is_linux||g_isedge||e.push(new ViewItem(0,0,"notification-footer")),e},e.prototype.BuildItemsScrollView=function(e,t){var n=this,i=this.createElement("div",{id:"listscrolldiv"});i.addEventListener("scroll",function(){n.MainScreen_OnScroll()},!1),i.addEventListener("mousedown",function(e){n.HideContextMenus()},!1),t=t||0;for(var o=this.BuildItemsView(e,t),a=0;a<e.length;a++){var r=e[a].m_oItemInfo;if(r&&r.gotoUrl&&(m=r.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))){var s=r.type==EnRfDataItemType.RfItemType_Login?"rfp.ico":"rfb.ico",l=this.GetIconUrl(m[2],s),c=o[a].childNodes[0];(E=n.createElement("div",{class:"toolbar-image-div"})).style.backgroundImage="url('"+l+"')";var _=calcSharedIconOverlayClass(r);if(_){var d=n.createElement("div",{class:"toolbar-sharedimage-div icon-sharedFile-"+_});E.appendChild(d)}c.insertBefore(E,c.firstChild)}else if(r&&r.error){AddClass(o[a],"toolbar-button-text-V8-erroritem");var E;c=o[a].childNodes[0];(E=n.createElement("div",{class:"toolbar-image-div"})).style.backgroundImage="url('"+OBJECT_WRONGFORMAT+"')",c.insertBefore(E,c.firstChild)}}return this.AppendItemsView(o,i),i},e.prototype.InitItemsListScreen=function(e){},e.prototype.ShowAccountPasswordDialog=function(e){var t=this,n=new ViewItem("enteraccountpwd_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Account Password",views:[i],context:e,initialize:function(e){t.InitAccountPasswordDialog(e)},on_navigating_from:function(e){t.OnNavigatingFromAccountPasswordDialog(e)}})},e.prototype.AddEnterPasswordListeners=function(){var e=this;$(ACCOUNTPWD_LOGINBTN_ID).addEventListener("click",function(){e.SubmitAccountPasswordDialog()},!1),$(ACCOUNTPWD_CHANGELINK_ID).addEventListener("click",function(t){$(ACCOUNTPWD_ERRLBL_ID).innerText="",e.ShowAccountLoginDialog(),t.preventDefault()},!1),$("enteraccountpwd_pwd_txt").addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1)},e.prototype.InitAccountPasswordDialog=function(e){this.AddEnterPasswordListeners();var t=e.description,n=e.user_id;$(ACCOUNTPWD_USERLBL_ID).innerText=n,$(ACCOUNTPWD_LOADING_TR_ID).style.display="none",$(ACCOUNTPWD_PASSINPUT_TR_ID).style.display="table-row",$(ACCOUNTPWD_LOGINBTN_ID).removeAttribute("disabled"),this.ShowServerWarning($("enteraccountpwd_rfus_test_lbl")),$(ACCOUNTPWD_ERRLBL_ID).innerText=t||"",$("enteraccountpwd_pwd_txt").value="",setTimeout(function(){$("enteraccountpwd_pwd_txt").focus()},250)},e.prototype.OnNavigatingFromAccountPasswordDialog=function(){$("enteraccountpwd_pwd_txt").value=""},e.prototype.SubmitAccountPasswordDialog=function(){var e=$("enteraccountpwd_pwd_txt"),t=$(ACCOUNTPWD_ERRLBL_ID),n=e.value;if(t.innerHTML="",!n)return e.focus(),void(t.innerText="Password cannot be empty");$(ACCOUNTPWD_LOADING_TR_ID).style.display="table-row",$(ACCOUNTPWD_PASSINPUT_TR_ID).style.display="none",$(ACCOUNTPWD_LOGINBTN_ID).setAttribute("disabled","true");var i=this;setTimeout(function(){var e={};e[USERNAME_PROPERTY]=$(ACCOUNTPWD_USERLBL_ID).innerText,e[ACCOUNTPWD_PROPERTY]=n,e.otp_channel="-";var t=JSON.stringify(e);getProxyRfo().LoginToAccount(t,function(e){i.Response_AccountPasswordEnter(e)})},100)},e.prototype.Response_AccountPasswordEnter=function(e){try{var t=this,n=JSON.parse(e);if(!n)return;$(ACCOUNTPWD_LOADING_TR_ID).style.display="none",$(ACCOUNTPWD_PASSINPUT_TR_ID).style.display="table-row",$(ACCOUNTPWD_LOGINBTN_ID).removeAttribute("disabled");var i=void 0===n[JSON_MSG_ERROR],o=$("enteraccountpwd_pwd_txt"),a=$(ACCOUNTPWD_ERRLBL_ID);if(!i){var r=n[JSON_MSG_ERROR][JSON_MSG_CODE],s=n[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION];return r==Err_NeedOTP?void this.ShowOTPDialog(n.params,!0):(a.innerHTML=s,o.value="",void o.focus())}a.innerHTML="",o.value="",setTimeout(function(){t.CheckRecievedData(n.accountInfo)},0)}catch(e){Q("EXCEPTION in Response_AccountPasswordEnter:"+e.toString(),trace_filename)}},e.prototype.AddAccountLoginListeners=function(){var e=this;$(LOGINDLG_USER_TXTBOX).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(LOGINDLG_USER_TXTBOX).addEventListener("input",function(t){e.AccountLoginDlg_OnInput(t)},!1),$(LOGIN_EMAILDG_NEXT_BTN_ID).addEventListener("click",function(){e.AccountLoginDlg_NextClick()},!1),$(LOGIN_EMAILDG_BACK_BTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(LOGIN_CREATENEWACC_LINK_ID).addEventListener("click",function(t){e.ShowCreateAccountDialog({only_create:!0}),t.preventDefault()},!1);var t=$("rfloginsection_setupcookies_link");t&&t.addEventListener("click",function(){e.ShowLocalHelp()},!1)},e.prototype.InitAccountLoginDialog=function(e){var t=this;setTimeout(function(){t.AddAccountLoginListeners();var n="",i="";e&&(n=e.email?e.email:"",i=e.description?e.description:""),$(LOGINDLG_USER_TXTBOX).value=n,$(LOGINDLG_ERRMSG_TD).innerHTML=i,$("login_emailsection_backtd").style.display=t.m_navigator.CanGoBack()?"inline":"none",$("rflogin_td_maintext1").innerHTML=this.m_bFirstStart?localeString("Setup_Welcome_HeaderTitle"):localeString("Install_OnlineSetup_Title2"),t.ShowServerWarning($("rflogin_td_maintext2")),$(LOGINDLG_USER_TXTBOX).focus()},0)},e.prototype.ShowAccountLoginDialog=function(e){var t=this,n=new ViewItem("rfloginsection_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Account Login",views:[i],context:e,initialize:function(e){t.InitAccountLoginDialog(e)}})},e.prototype.AccountLoginDlg_NextClick=function(){var e=$(LOGINDLG_USER_TXTBOX),t=$(LOGINDLG_ERRMSG_TD);t.innerHTML="";var n=e.value;if(!n)return e.focus(),void(t.innerHTML="User ID cannot be empty");var i=this.m_navigator.GetCurrentContext();i||(i={}),i.email=n,this.m_navigator.SetCurrentContext(i),this.ShowAccountLoginPasswordDialog({email:n})},e.prototype.AccountLoginDlg_OnInput=function(){$(LOGINDLG_USER_TXTBOX).value?$(LOGIN_EMAILDG_NEXT_BTN_ID).removeAttribute("disabled"):$(LOGIN_EMAILDG_NEXT_BTN_ID).setAttribute("disabled","true")},e.prototype.AddAccountLoginPasswordListeners=function(){var e=this;$(LOGINPWD_DLG_BACKBTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(LOGINPWD_DLG_NEXTBTN_ID).addEventListener("click",function(){e.AccountLoginPwdDlg_NextClick()},!1),$(LOGINPWD_DLG_PWD_TXTBOX).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(LOGINPWD_DLG_PWD_TXTBOX).addEventListener("input",function(t){e.AccountLoginPwdDlg_OnInput(t)},!1)},e.prototype.InitAccountLoginPasswordDialog=function(e){this.AddAccountLoginPasswordListeners();var t="";e&&(t=e.email?e.email:""),$(LOGINPWD_DLG_PRGIND_ID).style.display="none",$("entercreate_accountpwd_maintext1").innerHTML=this.m_bFirstStart?localeString("Setup_Welcome_HeaderTitle"):localeString("Install_OnlineSetup_Title2"),this.ShowServerWarning($("entercreate_accountpwd_maintext2")),$("login_pwdsection_emailtxt_td").innerHTML=t,$(LOGINPWD_DLG_ERRMSG_TD).innerHTML="",$(LOGINPWD_DLG_PWD_TXTBOX).value="",$(LOGINPWD_DLG_NEXTBTN_ID).setAttribute("disabled","true"),$(LOGINPWD_DLG_PWD_TXTBOX).focus()},e.prototype.ShowAccountLoginPasswordDialog=function(e){var t=this,n=new ViewItem("login_pwdsection_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Account Login Password",views:[i],context:e,initialize:function(e){t.InitAccountLoginPasswordDialog(e)}})},e.prototype.AccountLoginPwdDlg_NextClick=function(){var e=this.m_navigator.GetCurrentContext(),t="";e&&(t=e.email?e.email:"");var n=$(LOGINPWD_DLG_PWD_TXTBOX),i=$(LOGINPWD_DLG_ERRMSG_TD),o=n.value;if(i.innerHTML="",!o)return n.focus(),void(i.innerHTML="Password cannot be empty");q(!0,LOGINPWD_DLG_PRGIND_ID,[LOGINPWD_DLG_BACKBTN_ID,LOGINPWD_DLG_NEXTBTN_ID],LOGINPWD_DLG_NEXTBTN_ID);var a=this;setTimeout(function(){var e={};e[USERNAME_PROPERTY]=t,e[ACCOUNTPWD_PROPERTY]=o,e.otp_channel="-";var n=JSON.stringify(e);getProxyRfo().LoginToAccount(n,function(e){a.Response_AccountLogin(e)})},50)},e.prototype.AccountLoginPwdDlg_OnInput=function(){$(LOGINPWD_DLG_PWD_TXTBOX).value?$(LOGINPWD_DLG_NEXTBTN_ID).removeAttribute("disabled"):$(LOGINPWD_DLG_NEXTBTN_ID).setAttribute("disabled","true")},e.prototype.Response_AccountLogin=function(e){try{var t=this,n=JSON.parse(e);if(!n)return;q(!1,LOGINPWD_DLG_PRGIND_ID,[LOGINPWD_DLG_BACKBTN_ID,LOGINPWD_DLG_NEXTBTN_ID],null);var i=void 0===n[JSON_MSG_ERROR],o=$(LOGINPWD_DLG_PWD_TXTBOX),a=$(LOGINPWD_DLG_ERRMSG_TD);if(!i){var r=n[JSON_MSG_ERROR][JSON_MSG_CODE],s=n[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION];return r==Err_NeedOTP?void this.ShowOTPDialog(n.params,!0):(a.innerHTML=s,o.value="",void o.focus())}a.innerHTML="",o.value="",setTimeout(function(){t.CheckRecievedData(n.accountInfo)},0)}catch(e){Q("EXCEPTION in Response_AccountLogin:"+e.toString(),trace_filename)}},e.prototype.AddConfirmMasterPasswordListeners=function(){var e=this;$(CONFIRMPWD_DLG_NEXTBTN_ID).addEventListener("click",function(){e.ConfirmPwdDlg_NextClicked()},!1),$(CONFIRMPWD_DLG_BACKBTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(CONFIRMPWD_DLG_PWDINPUT_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(CONFIRMPWD_DLG_PWDINPUT_ID).addEventListener("input",function(t){e.ConfirmPwdDlgPwd_OnInput(t)},!1)},e.prototype.InitConfirmMasterPasswordListeners=function(e){this.AddConfirmMasterPasswordListeners();var t="";e&&(t=e.email?e.email:""),$(CONFIRMPWD_DLG_EMAILTXT_ID).innerHTML=t,$(CONFIRMPWD_DLG_ERR_TD).innerHTML="",$(CONFIRMPWD_DLG_PWDINPUT_ID).value="",$(CONFIRMPWD_DLG_PWDINPUT_ID).focus()},e.prototype.ShowConfirmPasswordDialog=function(e){var t=this,n=new ViewItem("confirm_accountpwd_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Confirm Password",views:[i],context:e,initialize:function(e){t.InitConfirmMasterPasswordListeners(e)}})},e.prototype.ConfirmPwdDlg_NextClicked=function(){var e=$(CONFIRMPWD_DLG_ERR_TD);e.innerHTML="";var t=this.m_navigator.GetCurrentContext(),n=t.email,i=t.password,o=$(CONFIRMPWD_DLG_PWDINPUT_ID);if(!o.value)return e.innerHTML=localeString("Install_PasswordTooShort"),void o.focus();if(i!=o.value)return e.innerHTML=localeString("ConfirmMasterPassword_Incorrect_Text"),void o.focus();q(!0,CONFIRMPWD_DLG_PROGRESS,[CONFIRMPWD_DLG_BACKBTN_ID,CONFIRMPWD_DLG_NEXTBTN_ID],CONFIRMPWD_DLG_NEXTBTN_ID);var a=this;setTimeout(function(){var e={};e.email=n,e[ACCOUNTPWD_PROPERTY]=i,e.master_password=i,e.boneFile=!0;var t=JSON.stringify(e);getProxyRfo().CreateAccount(t,function(e){a.Response_CreateAccountConfirm(e)})},100)},e.prototype.Response_CreateAccountConfirm=function(e){var t=JSON.parse(e);q(!1,CONFIRMPWD_DLG_PROGRESS,[CONFIRMPWD_DLG_BACKBTN_ID,CONFIRMPWD_DLG_NEXTBTN_ID],CONFIRMPWD_DLG_PWDINPUT_ID);var n=t[JSON_MSG_ERROR];if($(CONFIRMPWD_DLG_DIV_ID).style.display="none",n){var i=this.m_navigator.GetCurrentContext().email;return this.m_navigator.RemoveBackEntry(),this.m_navigator.GoBack(),void this.ShowCreateAccountDialog({email:i,only_create:this.m_bAllowOnlyCreate,description:n[JSON_MSG_DESCRIPTION]})}this.ShowStartPage()},e.prototype.ConfirmPwdDlgPwd_OnInput=function(){$(CONFIRMPWD_DLG_PWDINPUT_ID).value?$(CONFIRMPWD_DLG_NEXTBTN_ID).removeAttribute("disabled"):$(CONFIRMPWD_DLG_NEXTBTN_ID).setAttribute("disabled","true")},e.prototype.AddCreateAccountListeners=function(){var e=this;$(SIGNUP_DLG_STEP1_NEXTBTN_ID).addEventListener("click",function(){e.SignUpDlg_NextClicked_Step1()},!1),$("rfsignupsection_cancelbtn").addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(SIGNUP_DLG_STEP1_MAIL_TXT).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(SIGNUP_DLG_STEP1_MASTERPWD_TXT).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(SIGNUP_DLG_STEP1_MASTERPWD_TXT).addEventListener("input",function(t){e.SignUpDlgStep1Pwd_OnInput(t)},!1),$("rfsignupsection_bottom_loginlink").addEventListener("click",function(t){e.SignUpDlg_LoginExistingAccountClicked(),t.preventDefault()},!1)},e.prototype.InitCreateAccountDialog=function(e){var t,n;this.AddCreateAccountListeners();var i="";e&&(t=e.only_create,n=e.description,i=e.email?e.email:""),this.m_bFirstStart,this.m_bAllowOnlyCreate=t,$(SIGNUP_DLG_TOPTEXT).innerHTML=this.m_bFirstStart?localeString("Setup_Welcome_HeaderTitle"):localeString("Install_OnlineSetup_Title2"),this.ShowServerWarning($(SIGNUP_DLG_TOPTEXT2)),$("rfsignupsection_backtd_step1").style.display=this.m_bFirstStart?"none":"inline",$("rfsignupsection_linktd_step1").style.textAlign=this.m_bFirstStart?"left":"center",$(SIGNUP_DLG_STEP1_MAIL_TXT).value=i,$("rf_sign_step1_pwd").value="",PassGenDlg_Show_PwdStrength($(SIGNUP_DLG_STEP1_MASTERPWD_TXT).value,$("rfsignupsection_strength_img"),$("rfsignupsection_strength_lbl"),$("rfsignupsection_strength_div")),$(SIGNUP_DLG_STEP1_PROGRESS).style.display="none",$(SIGNUP_DLG_STEP1_ERR_TD).innerHTML=n||"",$(SIGNUP_DLG_STEP1_MAIL_TXT).focus()},e.prototype.OnNavigatingFromCreateAccountDialog=function(){$("rf_sign_step1_pwd").value=""},e.prototype.ShowCreateAccountDialog=function(e){var t=this,n=new ViewItem("rfsignupsection_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Create Account",views:[i],context:e,initialize:function(e){t.InitCreateAccountDialog(e)},on_navigating_from:function(e){t.OnNavigatingFromCreateAccountDialog(e)}})},e.prototype.SignUpDlg_NextClicked_Step1=function(){var e=$(SIGNUP_DLG_STEP1_ERR_TD);e.innerHTML="";var t=$(SIGNUP_DLG_STEP1_MAIL_TXT);if(!t.value)return e.innerHTML=localeString("EmailIncorrect_Error"),void t.focus();var n=$(SIGNUP_DLG_STEP1_MASTERPWD_TXT);if(!n.value)return e.innerHTML=localeString("Install_PasswordTooShort"),void n.focus();if(n.value.length<MPDLG_PWD_CHARLIMIT_MIN||n.value.length>MPDLG_PWD_CHARLIMIT_MAX)return e.innerHTML=localeString("MasterPwdEnterDlg_Limit_Text"),void n.focus();var i=getProxyRfo().IsMasterPasswordCorrect(n.value);if(1!=i.result)return e.innerHTML=i.reason,void n.focus();q(!0,SIGNUP_DLG_STEP1_PROGRESS,[SIGNUP_DLG_STEP1_NEXTBTN_ID,"rfsignupsection_cancelbtn"],SIGNUP_DLG_STEP1_NEXTBTN_ID);var o=this;setTimeout(function(){var e={};e[USERNAME_PROPERTY]=t.value,e[ACCOUNTPWD_PROPERTY]=n.value,e.otp_channel="-";var i=JSON.stringify(e);getProxyRfo().LoginToAccount(i,function(e){o.Response_SignUpDlgStep1(e)})},100)},e.prototype.Response_SignUpDlgStep1=function(e){var t=JSON.parse(e);q(!1,SIGNUP_DLG_STEP1_PROGRESS,[SIGNUP_DLG_STEP1_NEXTBTN_ID,"rfsignupsection_cancelbtn"],SIGNUP_DLG_STEP1_MAIL_TXT);var n=t[JSON_MSG_ERROR];if(n){var i=n[JSON_MSG_CODE];n[JSON_MSG_DESCRIPTION];return i==Err_NeedOTP?void this.ShowOTPDialog(t.params,!0):void this.ShowConfirmPasswordDialog({email:$(SIGNUP_DLG_STEP1_MAIL_TXT).value,password:$(SIGNUP_DLG_STEP1_MASTERPWD_TXT).value})}if(this.m_bFirstStart&&!this.m_bAllowOnlyCreate){this.m_bFirstStart=!1,$("rfsignupsection_div").style.display="none";var o=this;setTimeout(function(){o.CheckRecievedData(t.accountInfo)},0)}else this.ShowConfirmPasswordDialog({email:$(SIGNUP_DLG_STEP1_MAIL_TXT).value,password:$(SIGNUP_DLG_STEP1_MASTERPWD_TXT).value})},e.prototype.SignUpDlgStep1Pwd_OnInput=function(){var e=$(SIGNUP_DLG_STEP1_MASTERPWD_TXT).value;PassGenDlg_Show_PwdStrength(e,$("rfsignupsection_strength_img"),$("rfsignupsection_strength_lbl"),$("rfsignupsection_strength_div")),e?$(SIGNUP_DLG_STEP1_NEXTBTN_ID).removeAttribute("disabled"):$(SIGNUP_DLG_STEP1_NEXTBTN_ID).setAttribute("disabled","true")},e.prototype.SignUpDlg_LoginExistingAccountClicked=function(){this.ShowAccountLoginDialog()},e.prototype.Popup_SearchItems=function(e){this.HideSearchList();var t={};t.search=e;var n=JSON.stringify(t),i=this;getProxyRfo().Search_Items(n,function(e){i.Response_Search_Items(JSON.parse(e))})},e.prototype.Response_Search_Items=function(e){var t=this;if(!this.CheckGlobalErrorResponse(e)){var n={query:e.context.search},i=new ViewItem(void 0,void 0,"header-simple-title");i.m_oContext={title:localeString("Search_Combo_Title")+": "+e.context.search};var o=t.CreateUIItem(i),a=[],r=e[ITEMS_PROPERTY];r.length;for(var s=0;s<r.length;s++){var l=r[s],c=this.m_nNextIndex++,_=l[PATH_PROPERTY],d=getTextForItem(l),E=null;if(l.gotoUrl&&(m=l.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))){var u=l.type==EnRfDataItemType.RfItemType_Login?"rfp.ico":"rfb.ico";this.GetIconUrl(m[2],u)}else E=getImageForType(l);var p=new ViewItem(ITEM_INFO_VIEW_ITEM_PREFIX+c,0,"button",d,_,_,E,l,{});a.unshift(p)}var g=t.BuildItemsScrollView(a),I=t.m_navigator.GetCurrentContext(),T=I?I.scrollTop:0;t.m_navigator.Navigate({name:"Search Results",views:[o,g],context:n,initialize:function(e){t.InitItemsListScreen(e),e.scrollTop=T,t.SetScrollPosition(e)},on_navigating_from:function(e){t.GetScrollPosition(e),T=e.scrollTop,t.HideContextMenus()},on_navigated_to:function(e){t.SetScrollPosition(e)}})}},e.prototype.FixScrollPosition=function(e,t){var n=t.clientHeight,i=t.scrollTop,o=e.offsetTop,a=e.clientHeight;n+i<o+a&&(t.scrollTop=o+a-n),o<i&&(t.scrollTop=o)},e.prototype.SearchBoxSelectNext=function(){var e,t=$(SEARCH_BAR_DROPDOWN_DIV);this.selected_search_item&&(e=this.selected_search_item.nextElementSibling),e||(e=t.firstElementChild),this.SearchBoxClearSelection(),AddClass(e,"search_dropdown_item_wrapper_hover"),this.selected_search_item=e,this.FixScrollPosition(e,t)},e.prototype.SearchBoxSelectPrevious=function(){var e,t=$(SEARCH_BAR_DROPDOWN_DIV);this.selected_search_item&&(e=this.selected_search_item.previousElementSibling),e||(e=t.lastElementChild),this.SearchBoxClearSelection(),AddClass(e,"search_dropdown_item_wrapper_hover"),this.selected_search_item=e,this.FixScrollPosition(e,t)},e.prototype.SearchBoxClearSelection=function(){for(var e=$(SEARCH_BAR_DROPDOWN_DIV).getElementsByClassName("search_dropdown_item_wrapper_hover"),t=0;t<e.length;t++)RemoveClass(e[t],"search_dropdown_item_wrapper_hover");this.selected_search_item=null},e.prototype.SearchBoxAddDefaultItem=function(e,t,n){var i=$(SEARCH_BAR_DROPDOWN_DIV);n||(n="search.png");var o=this.createElement("img",{src:n,class:"toolbar-search-result"}),a=this.createElement("div",{id:e,class:"search_dropdown_item"});a.innerHTML=format(formatQuery(localeString("SearchAction_Search_In"),this.searchValue),t);var r=this.createElement("div",{id:e+"_wrapper",class:"search_dropdown_item_wrapper"},[o,a]);i.lastElementChild?i.insertBefore(r,i.lastElementChild):i.appendChild(r)},e.prototype.SearchBoxDefaultItemMouseDown=function(e,t,n){if(this.skipGlobalListener=!0,this.HideContextMenu(),2===n.button)return e.setAttribute("search_link",t),this.ShowContextMenu(e,!1,n.clientY,n.clientX),void n.stopImmediatePropagation();getBG().Bg_OpenPage(t,!0),this.ClosePopup(0)},e.prototype.SearchBox_DropdownUpdate=function(){var e=this,t=this.GetSearchEditBox(),n=(this.getElementRect(document.body),$(SEARCH_BAR_DROPDOWN_DIV));if(n.getAttribute("init")||this.SearchBox_DropdownInit(),n.style.display="block",visibilityEffect($(MAINSCREEN_DIV),[10,9,8,7,6],["div_rfsearch"]),this.searchValue!==t.value){this.searchValue=t.value;for(var i=n.getElementsByClassName("search_dropdown_item_wrapper"),o=i.length,a=0;a<o;a++)n.removeChild(i[0]);GetSetting("sa-search","rf_search_bing_chk")&&(this.SearchBoxAddDefaultItem("search_bar_bing","Bing"),$("search_bar_bing_wrapper").addEventListener("mousedown",function(n){e.SearchBoxDefaultItemMouseDown(this,e.bingSearchLink+t.value,n)},!1)),GetSetting("sa-search","rf_search_google_chk")&&(this.SearchBoxAddDefaultItem("search_bar_google","Google"),$("search_bar_google_wrapper").addEventListener("mousedown",function(n){e.SearchBoxDefaultItemMouseDown(this,e.googleSearchLink+t.value,n)},!1)),GetSetting("sa-search","rf_search_yahoo_chk")&&(this.SearchBoxAddDefaultItem("search_bar_yahoo","Yahoo"),$("search_bar_yahoo_wrapper").addEventListener("mousedown",function(n){e.SearchBoxDefaultItemMouseDown(this,e.yahooSearchLink+t.value,n)},!1)),GetSetting("sa-search","rf_search_ebay_chk")&&(this.SearchBoxAddDefaultItem("search_bar_ebay","eBay"),$("search_bar_ebay_wrapper").addEventListener("mousedown",function(n){e.SearchBoxDefaultItemMouseDown(this,e.ebaySearchLink+t.value,n)},!1)),GetSetting("sa-search","rf_search_amazon_chk")&&(this.SearchBoxAddDefaultItem("search_bar_amazon","Amazon"),$("search_bar_amazon_wrapper").addEventListener("mousedown",function(n){e.SearchBoxDefaultItemMouseDown(this,e.amazonSearchLink+t.value,n)},!1)),$(SEARCH_BAR_OPTIONS_DIV).innerHTML=localeString("Toolbar_Search_Customize_Text");var r={};r.search=t.value;var s=JSON.stringify(r);getProxyRfo().UpdateSearchList(s,function(t){var n=JSON.parse(t);if(Array.isArray(n)){n.length;var i=$(SEARCH_BAR_DROPDOWN_DIV);i.addEventListener("mousedown",function(t){t.stopImmediatePropagation(),e.HideContextMenu(),e.HideMatchingLoginDialog(),e.HideIdentityDialog()},!1),i.addEventListener("scroll",function(t){t.stopImmediatePropagation(),e.HideContextMenu(),e.HideMatchingLoginDialog(),e.HideIdentityDialog()},!1),n.forEach(function(t){var n,o=e.createElement("img",{class:"toolbar-search-result"}),a=e.createElement("div",{class:"search_dropdown_item"});switch(t.type){case EnRfDataItemType.RfItemType_Login:var r=null;r=t.gotoUrl&&(m=t.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))?e.GetIconUrl(m[2],"&def=rfp.ico"):t.error?OBJECT_WRONGFORMAT:"login.png",o.setAttribute("src",r),a.innerHTML=localeString("Search_Def_Action_Passcard"),n=e.EnObjectAction.LoginSameWindow;break;case EnRfDataItemType.RfItemType_Bookmark:o.setAttribute("src","bookmark.svg"),a.innerHTML=localeString("Search_Def_Action_Bookmark"),n=e.EnObjectAction.Goto;break;case EnRfDataItemType.RfItemType_Identity:o.setAttribute("src","identity.svg"),a.innerHTML=localeString("Search_Def_Action_Identity_Toolbar"),n=e.EnObjectAction.FillForms_ID;break;case EnRfDataItemType.RfItemType_Contact:o.setAttribute("src","contact.png"),a.innerHTML=localeString("Search_Def_Action_Contact"),n=e.EnObjectAction.Edit;break;case EnRfDataItemType.RfItemType_Safenote:o.setAttribute("src","safenote_new.png"),a.innerHTML=localeString("Search_Def_Action_Safenote"),n=e.EnObjectAction.Edit}var s=getTextForItem(t,!0);a.innerHTML=format(a.innerHTML,s),a.setAttribute("title",s);var l={class:"search_dropdown_item_wrapper"};l[ITEMINFO_PROPERTY]=JSON.stringify(t),l.action=n,l.topOffset=28,l.id=e.m_nNextIndex++;var c=e.createElement("div",l,[o,a]);c.addEventListener("mousedown",function(i){if(e.skipGlobalListener=!0,e.HideContextMenu(),2==i.button)return e.ShowContextMenu(c,!1,i.clientY,i.clientX),void i.stopImmediatePropagation();e.PerformItemAction(t,n),e.HideSearchList()},!1),i.insertBefore(c,i.firstElementChild)}),e.SearchBoxClearSelection(),AddClass(i.firstElementChild,"search_dropdown_item_wrapper_hover"),e.selected_search_item=i.firstElementChild}})}},e.prototype.SearchBox_DropdownHide=function(){var e=$(SEARCH_BAR_DROPDOWN_DIV);"none"!=e.style.display&&(e.style.display="none",visibilityEffect($(MAINSCREEN_DIV),[7,9,10],["div_rfsearch"]))},e.prototype.SearchBox_DropdownInit=function(){$(SEARCH_BAR_DROPDOWN_DIV).setAttribute("init","true");var e=this;$("search_bar_options_wrapper").addEventListener("mousedown",function(t){if(2==t.button)e.SearchBox_DropdownHide();else if(g_issafari){var n=safari.extension.popovers.filter(function(e){return"popup"==e.identifier})[0];n.width=640,n.height=480,window.location=GetLocalURL("options.html?tab=search")}else getBG().Bg_OpenPage(GetLocalURL("options.html?tab=search"),!0),e.ClosePopup(0)},!1)},e.prototype.NewIdentityClick=function(){var e={};e[RFTYPE_PROPERTY]=EnRfDataItemType.RfItemType_Identity,e[PATH_PROPERTY]="/",this.ShowCreateItemDialog(e)},e.prototype.ShowIdentityMiniDialog=function(e,t,n){var i=this,o=$("identity_minidialog_div");o.setAttribute(ITEMINFO_PROPERTY,e);for(var a=$("identity_actions_groups");a.hasChildNodes();)a.removeChild(a.lastChild);$("identitymini_topcaption_td").innerHTML=n?"Fill Forms: "+getTextForItem(JSON.parse(e),!1):localeString("Android_menu_title_web_fill_identity");var r={};r.item_info=e,r.action=this.EnObjectAction.Edit;var s=JSON.stringify(r);getProxyRfo().GetDataItem(s,function(e){var n=JSON.parse(e);if(!i.CheckGlobalErrorResponse(n)){visibilityEffect($(MAINSCREEN_DIV),[10,9,8,7,6]);for(var r=i.GetGroupsWithMultiInstances(n.item_data),s=0;s<r.length;s++){var l=i.GetLastSelectedInstanceName(r[s].n,n.list);a.appendChild(i.GetMultiInstanceGroupView(r[s],l)),s!=r.length-1&&a.appendChild(i.createElement("div",{class:"separator-V8"}))}$("identity_bottomseparator_div").style.display=r.length?"":"none";var c=r.length?183:93,_=c+t+20,d=document.body.clientHeight;o.style.top=_>d?d-c-10+"px":t+20+"px",o.style.display="block",o.removeAttribute("hidden")}})},e.prototype.GetSelectedGroupInstances=function(){for(var e=$("identity_actions_groups").getElementsByTagName("*"),t=[],n=0;n<e.length;n++){var i=e[n];if(i.checked){var o={},a=i.getAttribute("instance-name"),r=i.getAttribute("is-default");o[i.getAttribute("name")]="true"==r?"":a,t.push(o)}}return t},e.prototype.GetLastSelectedInstanceName=function(e,t){if(!t||!t.length)return"";for(var n=0;n<t.length;n++)if(t[n].group==e)return t[n].instance;return""},e.prototype.GetMultiInstanceGroupView=function(e,t){for(var n=e.n,i=e.i,o=this.createElement("div",{"group-name":n,class:"group-view"}),a=0;a<i.length;a++){var r=i[a].n,s=i[a].d,l=this.createElement("img",{src:this.GetGroupIcon(n),class:"flat-item-icon flat-radio-label-icon"}),c=this.createElement("label",{class:"flat-item-label",for:n+"##"+r});c.appendChild(l),c.innerHTML=c.innerHTML+r;var _=this.createElement("input",{id:n+"##"+r,type:"radio",name:n,"instance-name":r,"is-default":s,class:"flat-radio"});t?t==r&&this.setElementAttrs(_,{checked:"checked"}):s&&this.setElementAttrs(_,{checked:"checked"});var d=this.createElement("div",{class:"group-instance-view"});d.appendChild(c),d.appendChild(_),o.appendChild(d)}return o},e.prototype.GetGroupsWithMultiInstances=function(e){for(var t=[],n=e.g,i=0;i<n.length;i++){var o=n[i],a=o.i;if(a.length>1){var r={};r.n=o.n,r.i=[];for(var s=0;s<a.length;s++){var l={};l.n=a[s].n,l.d=!!a[s].d,r.i.push(l)}t.push(r)}}return t},e.prototype.GetGroupLocaleText=function(e){switch(e){case"Person":return localeString("RI_Group_Person");case"App Upload":return"App Upload";case"Default Password":return localeString("RI_Group_Default_Password");case"Credit Card":return localeString("RI_Group_Credit_Card");case"Car":return localeString("RI_Group_Car");case"Business":return localeString("RI_Group_Business");case"Passport":return localeString("RI_Group_Passport");case"Bank Account":return localeString("RI_Group_Bank_Account");case"Location":return localeString("RI_Group_Location");case"Custom":return localeString("RI_Group_Custom")}},e.prototype.GetGroupIcon=function(e){switch(e){case"Person":return"group_person16.png";case"App Upload":return"group_app16.png";case"Default Password":return"group_default_password16.png";case"Credit Card":return"group_credit_card16.png";case"Car":return"group_car16.png";case"Business":return"group_business16.png";case"Passport":return"group_passport16.png";case"Bank Account":return"group_bank_account16.png";case"Location":return"group_location16.png"}},e.prototype.HideIdentityDialog=function(){var e=$("identity_minidialog_div");e.removeAttribute(ITEMINFO_PROPERTY),"block"==e.style.display&&(e.setAttribute("hidden","hidden"),e.style.display="none",visibilityEffect($(MAINSCREEN_DIV),[7,9,10]))},e.prototype.SubmitIdentityMiniDialog=function(){var e=$("identitymini_fillempty_check").checked,t=$("identity_minidialog_div").getAttribute(ITEMINFO_PROPERTY),n=JSON.parse(t),i=this.EnObjectAction.FillSubmit_ID,o=this.GetSelectedGroupInstances();this.FillIdentity(n,i!=this.EnObjectAction.FillForms_ID,i,e,o)},e.prototype.FillIdentityMiniDialog=function(){var e=$("identitymini_fillempty_check").checked,t=$("identity_minidialog_div").getAttribute(ITEMINFO_PROPERTY),n=JSON.parse(t),i=this.EnObjectAction.FillForms_ID,o=this.GetSelectedGroupInstances();this.FillIdentity(n,i!=this.EnObjectAction.FillForms_ID,i,e,o)},e.prototype.EditIdentityMiniDialog=function(){var e=$("identity_minidialog_div").getAttribute(ITEMINFO_PROPERTY),t=JSON.parse(e);this.EditItem(t)},e.prototype.ShowAllIdentityMiniDialog=function(){this.HideMatchingLoginDialog(),this.SetContextMenuItemsVisibility(["contextmenu_identity_page","contextmenu_list_page","contextmenu_common"]),this.ShowItemsListScreen([EnRfDataItemType.RfItemType_Identity,EnRfDataItemType.RfItemType_Folder],RF_ROOT_FOLDER_URL,localeString("Cmd_Identities_Flat"))};e.prototype.UpdateMatch=function(){var e=this,t=e.m_navigator.GetCurrentContext(),n=t.matchings,i=t.identities,o=t.recent;g_bg_connector.GetVar("selected_matchings",function(t){var a;t&&e.m_tab_id&&(a=t[e.m_tab_id]);var r=e.SortMatchingsList(n,o,a),s=[];if(r.length>0){for(var l={},c=0;c<r.length&&c<4;c++){var _=r[c],d=getTextForItem(_).toLowerCase();l[d]?l[d]++:l[d]=1}for(c=0;c<r.length&&c<4;c++){var E;_=r[c],l[(d=getTextForItem(_)).toLowerCase()]>1&&(d=GetDisplayPath(_.path)),E=_.gotoUrl&&(m=_.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))?e.GetIconUrl(m[2],"&def=rfp.ico"):MATCHLOGINS_IMAGE,s.push(new ViewItem(MENU_MATCHLOGINS+c,0,"button",d,"match","Fill Forms from "+d,E,_))}r.length>4&&s.push(new ViewItem(MENU_MATCHLOGINS_MORE,0,"button",format(localeString("Editor_Indicator_Show_NMatch"),r.length),"match_new",void 0,void 0,r))}if(0===i.length)s.push(new ViewItem(ID_IDENTITY_CREATE,0,"button",localeString("Toolbar_Identity_Create_Flat"),"new-identity",localeString("Toolbar_Identity_Create_Tip"),IDENTITY_IMAGE));else{for(c=0;c<i.length&&c<2;c++){var u=i[c];s.push(new ViewItem(ID_IDENTITY_MATCH_FIRST+c,0,"button",getTextForItem(u),"identity",localeString("Toolbar_Identity_Fill_HelpMsg_HeaderText"),IDENTITY_IMAGE,u))}i.length>2&&s.push(new ViewItem(MENU_IDENTITIES_MORE,0,"button",format(localeString("Editor_Indicator_Show_AllIdentities"),i.length),"identities_new",void 0,void 0,i))}var p=e.BuildItemsView(s,1);RemoveChilds("active-items-container"),e.AppendItemsView(p,$("active-items-container")),0===i.length&&$(ID_IDENTITY_CREATE).addEventListener("click",function(){e.NewIdentityClick()},!1),r.length>4&&$(MENU_MATCHLOGINS_MORE).addEventListener("click",function(t){e.ShowMatchingLoginsDialog(t)},!1),i.length>2&&$(MENU_IDENTITIES_MORE).addEventListener("click",function(t){e.ShowAllIdentityMiniDialog(t)},!1),AdjustPopupSize()})},e.prototype.HideMatchingLoginDialog=function(){this.HideContextMenu();var e=$("match_dialog_div");"block"===e.style.display&&(e.style.display="none",e.setAttribute("hidden","hidden"),visibilityEffect($(MAINSCREEN_DIV),[7,9,10]))},e.prototype.ShowMatchingLoginsDialog=function(e){var t=e||window.event;this.HideIdentityDialog();var n=t.currentTarget,i=n.getAttribute("item_info")?n:n.parentElement,o=i.getAttribute("item_info");if(o){var a=JSON.parse(o);if(a){var r=[],s=a instanceof Array;if(s)for(var l=0;l<a.length;l++)r.push(a[l]);else r.push(a);var c=this;g_bg_connector.GetVar("selected_matchings",function(e){var t;e&&c.m_tab_id&&(t=e[c.m_tab_id]),c.RenderMatchingLoginsDialog(r,t);var n=$("match_dialog_div"),o=s&&r.length>1?191:146,a=o+i.offsetTop+20,l=document.body.clientHeight;n.style.top=a>l?l-o-10+"px":i.offsetTop+24+"px",n.style.display="block",n.removeAttribute("hidden"),visibilityEffect($(MAINSCREEN_DIV),[10,9,8,7,6])})}}},e.prototype.RenderMatchingLoginsDialog=function(e,t){var n,i=this,o=$("rfmatch_loginstable");RemoveChilds("rfmatch_loginstable");for(var a=0;a<e.length;a++){var r=e[a],s=getPathTextForItem(r),l=this.m_nNextIndex++,c={};c.itemId=l,c[ITEMINFO_PROPERTY]=JSON.stringify(r);var _,d=this.createElement("tr",c),E=this.createElement("td",{class:"rfmatch_login_text_td"}),u=this.createElement("input",{type:"radio",itemId:l,id:"radio"+l,name:"rf_match_radio",class:"rfmatch_login_radio"});a||(n=u),t&&r[PATH_PROPERTY]&&t===r[PATH_PROPERTY]&&(n=u);var p=RfapiJS.RfUrlMatchLevel.RF_MATCH_TYPE_URL_EXACT==r.level?"rfmatch_login_lbl_bold":"rfmatch_login_lbl",m=this.createElement("label",{for:"radio"+l,class:p,title:s});m.innerText=s,E.appendChild(u),E.appendChild(m);var g=this.createElement("td",{align:"right"});g.style.width="25px";var I=this.createElement("div",{itemId:l,id:"div"+l,class:"match-minidialog-details-V8 toolbar-minidialog-details-icon-normal"});this.kMinidialogButtonMouseEvents.forEach(function(e){I.addEventListener(e,function(e){e.stopImmediatePropagation()},!1)}),_=a?"hidden":"visible",I.style.visibility=_,g.appendChild(I),d.appendChild(E),d.appendChild(g),o.appendChild(d)}this.setElementAttrs(n,{checked:"checked"});for(var T=o.getElementsByTagName("div"),S=0;S<T.length;S++)!function(){var e=T[S];e.addEventListener("mouseover",function(){ReplaceClass(e,"toolbar-minidialog-details-icon-normal","toolbar-minidialog-details-icon-hover")},!1),e.addEventListener("mouseout",function(){ReplaceClass(e,"toolbar-minidialog-details-icon-hover","toolbar-minidialog-details-icon-normal")},!1),e.addEventListener("click",function(e){i.ShowContextMenu(i.GetSelectedMatchingLogin(),!0,e.clientY,e.clientX)},!1),e.addEventListener("mouseup",function(e){2===e.button&&i.ShowContextMenu(i.GetSelectedMatchingLogin(),!0,e.clientY,e.clientY)},!1)}();var f,h=o.getElementsByTagName("tr");for(S=0;S<h.length;S++)!function(){var e=h[S];e.getAttribute("itemId")&&e.addEventListener("click",function(){i.MatchingLoginsDialogRowClick(e)},!1)}();f=1==e.length?"30px":2==e.length?"50px":"75px";var C=$("rfmatch_logins_fieldset");C.style.height=C.style.maxHeight=f,$("rfmatch_topcaption_td").innerHTML=e.length>1?localeString("Android_matching_dialog_title"):"Fill from"},e.prototype.MatchingLoginsDialogEditClick=function(){var e=this.GetSelectedMatchingLogin().getAttribute(ITEMINFO_PROPERTY),t=JSON.parse(e);this.EditItem(t)},e.prototype.MatchingLoginsDialogFillClick=function(){var e=$("rfmatch_fillempty_check").checked,t=this.GetSelectedMatchingLogin().getAttribute(ITEMINFO_PROPERTY),n=JSON.parse(t),i=this;g_bg_connector.FillFormsInWindowRfApi(n.path,n.type,!0,!e,!1,!0,"",!1,!1,!1,void 0,void 0,void 0,GetSetting("sa-settings","rf_highlight_filledflds_chk"),function(){i.ClosePopup(500)})},e.prototype.MatchingLoginsDialogFillSubmitClick=function(){var e=$("rfmatch_fillempty_check").checked,t=this.GetSelectedMatchingLogin().getAttribute(ITEMINFO_PROPERTY),n=JSON.parse(t),i=this;g_bg_connector.FillFormsInWindowRfApi(n.path,n.type,!0,!e,!1,!0,"",!1,!0,!1,void 0,void 0,void 0,GetSetting("sa-settings","rf_highlight_filledflds_chk"),function(){i.ClosePopup(500)})},e.prototype.GetSelectedMatchingLogin=function(){for(var e=$("rfmatch_loginstable"),t=0;t<e.rows.length;t++){var n=e.rows[t];if(n.cells[0].children[0].checked)return n}},e.prototype.MatchingLoginsDialogRowClick=function(e){var t=this,n=e.getAttribute("itemId");if(n){n=parseInt(n);for(var i=$("rfmatch_loginstable"),o=0;o<i.rows.length;o++)!function(){var e=i.rows[o],a=JSON.parse(e.getAttribute(ITEMINFO_PROPERTY)),r=e.cells[0].children[0],s=parseInt(r.getAttribute("itemId")),l=a[PATH_PROPERTY];s==n?(r.setAttribute("checked","true"),r.checked=!0,l&&g_bg_connector.GetVar("selected_matchings",function(e){e||(e={}),e[t.m_tab_id]=l,g_bg_connector.PutVar("selected_matchings",e),t.UpdateMatch()})):(r.removeAttribute("checked"),r.checked=!1),e.cells[1].children[0].style.visibility=s==n?"visible":"hidden"}()}},e.prototype.ShowAllLoginsClick=function(){this.HideMatchingLoginDialog(),this.SetContextMenuItemsVisibility(["contextmenu_list_page","contextmenu_common"]),this.ShowItemsListScreen([EnRfDataItemType.RfItemType_Login,EnRfDataItemType.RfItemType_SearchCard,EnRfDataItemType.RfItemType_Folder],RF_ROOT_FOLDER_URL,localeString("Cmd_Logins_Flat"),void 0,!0)},e.prototype.AddOTPListeners=function(){var e=this;$(OTP_SECTION_CANCEL_BTN_ID).addEventListener("click",function(){e.CancelOTPDialog()},!1),$(OTP_SECTION_PWD_TXTBOX_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(OTP_SECTION_SUBMIT_BTN_ID).addEventListener("click",function(){e.SubmitOTPDialog()},!1),$("rf_otp_sendbyemail_link").addEventListener("click",function(){e.ResendOTPByMailDialog()},!1)},e.prototype.ResendOTPByMailDialog=function(){try{var e=this;$(OTP_SECTION_ERRMSG_ID).innerHTML="",$("rf_otp_sendbyemail_div").style.display="none",$(OTP_SECTION_PWD_TXTBOX_ID).setAttribute("channel","email"),setTimeout(function(){var t={};t[USERNAME_PROPERTY]=getProxyRfo().GetUserName(),t[ACCOUNTPWD_PROPERTY]=getProxyRfo().GetAccountPassword(),t.otp_password=void 0,t.otp_memorize=void 0,t.otp_channel="email",t.otp_new=1;var n=JSON.stringify(t);getProxyRfo().LoginToAccount(n,function(t){e.ResponseOTPLogin(t)})},0)}catch(e){Q("ERROR in ResendOTPByMailDialog: "+e.toString())}},e.prototype.InitOTPDialog=function(e){var t=e.params.Channel,n=e.request_server,i=e.params.Memorize;this.AddOTPListeners(),$(OTP_SECTION_PWD_TXTBOX_ID).value="",$(OTP_SECTION_ERRMSG_ID).innerHTML="",$("rf_otp_sendbyemail_div").style.display=t&&"email"!=t?"block":"none";var o=void 0!==i?i:getBG().g_policySet.GetConfigValue(ConfigEnrollNewDevice);$("rf_otp_memorize_div").style.display=-1==o?"block":"none",$(OTP_SECTION_PWD_TXTBOX_ID).setAttribute("channel",t),setTimeout(function(){$(OTP_SECTION_PWD_TXTBOX_ID).focus()},100);var a=this;setTimeout(function(){if(n){var e=getProxyRfo().GetAccountPassword();if(e){var i={};i[USERNAME_PROPERTY]=getProxyRfo().GetUserName(),i[ACCOUNTPWD_PROPERTY]=e,i.otp_channel=t;var o=JSON.stringify(i);getProxyRfo().LoginToAccount(o,function(e){a.ResponseSendOTPRequest(e)})}}else $(OTP_SECTION_ERRMSG_ID).innerText="undefined"==t?localeString("RFO_TwoFactor_ByEmail_Text2"):"totp"==t?"OTP will be generated in your Google Authenticator App":"sms"==t?localeString("RFO_TwoFactor_BySMS_Text2"):localeString("RFO_TwoFactor_ByEmail_Text2")},100)},e.prototype.ShowOTPDialog=function(e,t){var n=this,i={params:e,request_server:t},o=new ViewItem("rf_otp_section_div",void 0,"dialog"),a=this.CreateUIItem(o);n.m_navigator.Navigate({name:"One Time Password",views:[a],context:i,initialize:function(e){n.InitOTPDialog(e)},skip_navigation:!0})},e.prototype.ResponseSendOTPRequest=function(e){if(JSON.parse(e)){var t=$(OTP_SECTION_PWD_TXTBOX_ID).getAttribute("channel");$(OTP_SECTION_ERRMSG_ID).innerText="undefined"==t?localeString("RFO_TwoFactor_ByEmail_Text2"):"totp"==t?"OTP will be generated in your Google Authenticator App":"sms"==t?localeString("RFO_TwoFactor_BySMS_Text2"):localeString("RFO_TwoFactor_ByEmail_Text2")}},e.prototype.SubmitOTPDialog=function(){try{var e=this.m_navigator.GetCurrentContext().params.Memorize,t=$(OTP_SECTION_PWD_TXTBOX_ID).value;if($(OTP_SECTION_ERRMSG_ID).innerHTML="",!t)return $(OTP_SECTION_PWD_TXTBOX_ID).focus(),void($(OTP_SECTION_ERRMSG_ID).innerHTML=localeString("RFOError_PasswordIsEmpty"));var n=$("rf_otp_memorize_chk").checked?1:0,i=void 0!==e?e:getBG().g_policySet.GetConfigValue(ConfigEnrollNewDevice);n=-1==i?n:i?1:0;var o=$(OTP_SECTION_PWD_TXTBOX_ID).getAttribute("channel");q(!0,OTP_SECTION_PRGIND_ID,[OTP_SECTION_SUBMIT_BTN_ID],OTP_SECTION_SUBMIT_BTN_ID);var a=this;setTimeout(function(){var e={};e[USERNAME_PROPERTY]=getProxyRfo().GetUserName(),e[ACCOUNTPWD_PROPERTY]=getProxyRfo().GetAccountPassword(),e.otp_password=t,e.otp_memorize=n,e.otp_channel=o,e.otp_new="";var i=JSON.stringify(e);getProxyRfo().LoginToAccount(i,function(e){a.ResponseOTPLogin(e)})},50)}catch(e){Q("ERROR in SubmitOTPDialog: "+e.toString())}},e.prototype.ResponseOTPLogin=function(e){try{var t=JSON.parse(e);if(!t)return;if(q(!1,OTP_SECTION_PRGIND_ID,[OTP_SECTION_SUBMIT_BTN_ID],null),!(void 0===t[JSON_MSG_ERROR])){t[JSON_MSG_ERROR][JSON_MSG_CODE];var n=t[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION];return void($(OTP_SECTION_ERRMSG_ID).innerText=n)}var i=this;setTimeout(function(){i.CheckRecievedData(t.accountInfo)},0)}catch(e){Q("EXCEPTION in ResponseOTPLogin:"+e.toString())}},e.prototype.CancelOTPDialog=function(){this.CheckCachedUserId()},e.prototype.ShowToolsScreen=function(){var e=this,t=[],n=new ViewItem(void 0,void 0,"header-simple-title");n.m_oContext={title:localeString("Android_setting_category_tools_title")},t.push(n);var i=this.m_oAccountInfo&&this.m_oAccountInfo.oneFile,o=CheckIsCompanyAdmin(this.m_oAccountInfo),a=getBG().g_policySet;if(i&&!g_isedge&&!g_issafari&&(!a.GetConfigValue(ConfigDisableCreateBookmarks)||o)){var r=new ViewItem(MENU_TOOLS_IMPORT,0,"button",localeString("Import_ImportButton_Text"),MENU_TOOLS_IMPORT,"",IMPORT_IMAGE);t.push(r);var s=new ViewItem(0,0,"separator");t.push(s)}var l=new ViewItem(MENU_TOOLS_RESETFIELDS,0,"button",localeString("Cmd_ResetFields_Flat"),MENU_TOOLS_RESETFIELDS,"",RESETFIELDS_IMAGE);t.push(l);var c=new ViewItem(MENU_TOOLS_SETFIELDS,0,"button",localeString("Cmd_SetFields_Flat"),MENU_TOOLS_SETFIELDS,"",SETFIELDS_IMAGE);t.push(c);var _=new ViewItem(MENU_TOOLS_CLEARFIELDS,0,"button",localeString("Cmd_ClearFields_Flat"),MENU_TOOLS_CLEARFIELDS,"",CLEARFIELDS_IMAGE);t.push(_);var d=e.BuildItemsScrollView(t);e.m_navigator.Navigate({name:"Tools",views:[d],initialize:function(t){e.InitToolsScreen(t)}})},e.prototype.InitToolsScreen=function(){var e=this;$(MENU_TOOLS_IMPORT)&&$(MENU_TOOLS_IMPORT).addEventListener("click",function(){e.ShowImportBookmarksDialog()},!1),$(MENU_TOOLS_SETFIELDS).addEventListener("click",function(e){getProxyRfo().SetFields()},!1),$(MENU_TOOLS_CLEARFIELDS).addEventListener("click",function(e){getProxyRfo().ClearFields()},!1),$(MENU_TOOLS_RESETFIELDS).addEventListener("click",function(e){getProxyRfo().ResetFields()},!1)},e.prototype.ShowImportBookmarksDialog=function(){var e=this,t=new ViewItem(void 0,void 0,"header-item-title"),n=localeString("Options_ImportFrame_Text");t.m_oContext={title:n};var i=e.CreateUIItem(t),o=new ViewItem("importbookmarks_section_div",void 0,"dialog"),a=e.CreateUIItem(o);e.m_navigator.Navigate({name:"Import Bookmarks",views:[i,a],context:{},initialize:function(t){e.InitImportBookmarksDialog(t)}})},e.prototype.InitImportBookmarksDialog=function(e){this.AddImportBookmarksListeners(),$(IMPORTDLG_PROGRESSDIV_ID).style.display="none",$(IMPORTDLG_ERRORMSG_ID).textContent="";var t=g_ischrome?"Google Chrome":g_isfirefox?"Firefox":"Opera";$(IMPORTDLG_MAINTXT_ID).textContent=localeString("Import_BookmarkFrom_Title")+t,this.ImportBookmarksButtonsState(!0)},e.prototype.ImportBookmarksButtonsState=function(e){$(IMPORTDLG_DONE_BTN_ID).style.display=e?"none":"",$(IMPORTDLG_IMPORT_BTN_ID).style.display=e?"":"none",$(IMPORTDLG_CANCEL_BTN_ID).style.display=e?"":"none"},e.prototype.ImportBookmarksShowReport=function(e){if(q(!1,IMPORTDLG_PROGRESSDIV_ID,[IMPORTDLG_IMPORT_BTN_ID,IMPORTDLG_CANCEL_BTN_ID],void 0),$(IMPORTDLG_MAINTXT_ID).textContent=localeString("Import_Succeeded_Title"),this.ImportBookmarksButtonsState(!1),e){var t=format(localeString("Import_ReportBookmarks_Text"),e.report.BookmarksAdded,e.report.BookmarksExists);$(IMPORTDLG_MAINTXT_ID).textContent=t}},e.prototype.ImportBookmarksOnClick=function(){$(IMPORTDLG_ERRORMSG_ID).textContent="";var e=this;function t(e,t){var n=e.dateAdded?Math.round(new Date(e.dateAdded)/1e3):Math.round(new Date/1e3),i=g_ischrome?"Google Chrome":g_isfirefox?"Firefox":"Opera",o={i:{}};if(o.i.m=n,o.i.c=n,t){var a={};a.g=e.url,a.n="Imported from "+i+".";var r=JSON.stringify(a);o.b=r,o.i.s=r.length;var s=function(e,t){var n=e;return n||(n=RfUtils.DomainFromUrl(t.trim(),!0)),(n=(n=(n=SibReplaceInvalidFileNameChars(n)).replace(new RegExp("/","g"),"_")).replace(new RegExp("\\\\","g"),"_")).length>NAME_MAXLENGHT&&(n=n.substr(0,NAME_MAXLENGHT)),n}(e.title,e.url);o.i.n=s+RfapiJS.utils.FileTypeToExt(EnRfDataItemType.RfItemType_Bookmark)}else o.c=[],o.i.s=0,o.i.F=!0,o.i.n=e.title;return o}e.CheckDisableNonGroupData()?$(IMPORTDLG_ERRORMSG_ID).textContent=localeString("Policy_DisableNonGroupData_Message"):(q(!0,IMPORTDLG_PROGRESSDIV_ID,[IMPORTDLG_IMPORT_BTN_ID,IMPORTDLG_CANCEL_BTN_ID],IMPORTDLG_CANCEL_BTN_ID),$(IMPORTDLG_MAINTXT_ID).textContent="",browser.bookmarks.getTree(function(n){var i=n[0];if(i){var o,a={c:[],i:{}};a.i.F=!0,a.i.n="root",function e(n,i){var o=n.children;if(o)for(var a=0;a<o.length;a++){var r=o[a],s=t(r,void 0===r.children&&void 0!==r.url);i.c.push(s),void 0!==r.children&&e(r,s)}}(i,a),a.c.length?(o=a,getProxyRfo().PutDataToFolder({data:o,path:""}).then(function(t){e.ImportBookmarksShowReport(t)}).catch(function(e){})):e.ImportBookmarksShowReport()}else e.ImportBookmarksShowReport()}))},e.prototype.AddImportBookmarksListeners=function(){var e=this;$(IMPORTDLG_IMPORT_BTN_ID).addEventListener("click",function(){e.ImportBookmarksOnClick()},!1),$(IMPORTDLG_CANCEL_BTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(IMPORTDLG_DONE_BTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1)},e.prototype.HelpScreenOpenUrl=function(e,t,n){getProxyRfo().OpenPage({bNewWindow:t,url:e,bActivateIfExists:n}),this.ClosePopup(100)},e.prototype.InitHelpScreen=function(){var e=this;$(MENU_HELP_RFONLINE).addEventListener("click",function(){getProxyRfo().LoginToRFOAccount(!0),e.ClosePopup(100)},!1),$(MENU_HELP_ENTIREFAQ).addEventListener("click",function(t){e.HelpScreenOpenUrl(RF_ENTIRE_FAQ_URL,!1,!1)},!1),$(MENU_HELP_SUPPORT).addEventListener("click",function(t){getProxyRfo().LoginToRFOAccount(!1),e.ClosePopup(100)},!1),$(MENU_HELP_ABOUT).addEventListener("click",function(t){e.HelpScreenOpenUrl(GetLocalURL("about.html"),!0,!0)},!1)},e.prototype.ShowHelpScreen=function(){var e=this,t=[],n=new ViewItem(void 0,void 0,"header-simple-title");n.m_oContext={title:localeString("Cmd_Help_Flat")},t.push(n);var i=new ViewItem(MENU_HELP_RFONLINE,0,"button",localeString("Cmd_Sync_RoboFormAccount_Key").replace(new RegExp("&","g"),""),MENU_HELP_RFONLINE,"",HELP_RFONLINE_IMAGE);t.push(i);var o=new ViewItem(MENU_HELP_ENTIREFAQ,0,"button",localeString("Cmd_Help_FaqAll_Key").replace(new RegExp("&","g"),""),MENU_HELP_ENTIREFAQ,"",HELP_FAQ_IMAGE);t.push(o);var a=new ViewItem(MENU_HELP_SUPPORT,0,"button",localeString("Activate_VisitSupportLink_Text"),MENU_HELP_SUPPORT,"",HELP_SUPPORT_IMAGE);t.push(a);var r=new ViewItem(0,0,"separator");t.push(r);var s=new ViewItem(MENU_HELP_ABOUT,0,"button",localeString("Cmd_About_Key").replace(new RegExp("&","g"),""),MENU_HELP_ABOUT,"",HELP_ABOUT_IMAGE);t.push(s);var l=e.BuildItemsScrollView(t);e.m_navigator.Navigate({name:"Help",views:[l],initialize:function(t){e.InitHelpScreen(t)}})},e.prototype.CheckEmergencyAccessInvitations=function(e,t){getProxyRfo().GetTestators().then(function(n){var i=n.testators.filter(function(e){return void 0===e.status||e.status===EnEmergencyStatus.invited});i.length>0?t(i):e()}).catch(function(t){e()})},e.prototype.ShowHandleEAInviteDialog=function(e){var t=this,n=new ViewItem("receiveEAInvite_div",void 0,"dialog"),i=t.CreateUIItem(n),o={};o.testators=e,t.m_navigator.Navigate({name:"Accept Emergency Account",views:[i],context:o,initialize:function(e){t.AddHadleEAInviteListeners(),t.InitHadleEAInviteDialog(e)}})},e.prototype.InitHadleEAInviteDialog=function(e){this.ShowServerWarning($(EA_INVITE_TOPTEXT2_ID)),$(EA_INVITE_PROGRESSDIV_ID).style.display="none",$(EA_INVITE_ERRORMSG_ID).innerHTML="",$("receiveEAInvite_LicenseBtn_td").style.display="none";var t=e.testators[0],n=t.email?t.email:t.accountId;$(EA_INVITE_INVITETEXT_ID).innerHTML="User <b>'"+n+"'</b> invites you to be an emergency contact for his account."},e.prototype.AddHadleEAInviteListeners=function(){var e=this;$(EA_INVITE_ACCEPTBTN_ID).addEventListener("click",function(){e.AcceptHandleEAInviteOnClick()},!1),$(EA_INVITE_REJECTBTN_ID).addEventListener("click",function(){e.RejectHandleEAInviteOnClick()},!1),$(EA_INVITE_CANCELBTN_ID).addEventListener("click",function(){e.NeedToShowOtherHandleEAInviteDialog()},!1)},e.prototype.NeedToShowOtherHandleEAInviteDialog=function(){var e=this.m_navigator.GetCurrentContext();e.testators.splice(0,1),e.testators.length?this.InitHadleEAInviteDialog(e):this.ShowStartPage()},e.prototype.AcceptRejectHandleEAInvite=function(e){var t=this;q(!0,EA_INVITE_PROGRESSDIV_ID,[EA_INVITE_ACCEPTBTN_ID,EA_INVITE_REJECTBTN_ID,EA_INVITE_CANCELBTN_ID],EA_INVITE_CANCELBTN_ID),$(EA_INVITE_ERRORMSG_ID).innerHTML="";var n=t.m_navigator.GetCurrentContext().testators[0],i=n.email?n.email:n.accountId;e?getProxyRfo().AcceptEmergencyContactInvitation({testator:i}).then(function(e){t.NeedToShowOtherHandleEAInviteDialog()}).catch(function(e){if(t.CheckGlobalErrorResponse2(e))return q(!1,EA_INVITE_PROGRESSDIV_ID,[EA_INVITE_ACCEPTBTN_ID,EA_INVITE_REJECTBTN_ID,EA_INVITE_CANCELBTN_ID],void 0),void($(EA_INVITE_ERRORMSG_ID)&&($(EA_INVITE_ERRORMSG_ID).innerHTML=e.Description))}):getProxyRfo().RejectEmergencyContactInvitation({testator:i}).then(function(e){t.NeedToShowOtherHandleEAInviteDialog()}).catch(function(e){if(t.CheckGlobalErrorResponse2(e))return q(!1,EA_INVITE_PROGRESSDIV_ID,[EA_INVITE_ACCEPTBTN_ID,EA_INVITE_REJECTBTN_ID,EA_INVITE_CANCELBTN_ID],void 0),void($(EA_INVITE_ERRORMSG_ID)&&($(EA_INVITE_ERRORMSG_ID).innerHTML=e.Description))})},e.prototype.RejectHandleEAInviteOnClick=function(){this.AcceptRejectHandleEAInvite(!1)},e.prototype.AcceptHandleEAInviteOnClick=function(){this.AcceptRejectHandleEAInvite(!0)},e.prototype.ShowSecurityCenterScreen=function(){var e=this,t=new ViewItem(void 0,void 0,"header-item-title"),n=localeString("Cmd_PasswordAuditRun_Key");t.m_oContext={title:n};var i=e.CreateUIItem(t),o=new ViewItem("SecurCenter_maindiv",void 0,"dialog"),a=e.CreateUIItem(o);e.m_navigator.Navigate({name:"Security Center",views:[i,a],initialize:function(t){e.InitSecurityCenterScreen(t)},on_navigated_to:function(t){e.OnNavigatedToSecurityCenterScreen(t)}})},e.prototype.InitSecurityCenterScreen=function(e){var t=this;$("SecurCenter_loading_div").innerHTML=localeString("Android_s_oreg_wait");for(var n=$("SecurCenter_maindiv").getElementsByClassName("tabcontent"),i=0;i<n.length;i++)n[i].style.display="none";$("all_SecurCenter_tabBtn").addEventListener("click",function(e){t.OpenSecuritySection(e,"all")},!1),$("reused_SecurCenter_tabBtn").addEventListener("click",function(e){t.OpenSecuritySection(e,"reused")},!1),$("duplicates_SecurCenter_tabBtn").addEventListener("click",function(e){t.OpenSecuritySection(e,"duplicates")},!1),$("all_SecurCenter_text_span").innerHTML=localeString("PassAud_TabAllPasswords_Title"),$("reused_SecurCenter_text_span").innerHTML=localeString("PassAud_TabReusedkPasswords_Title"),$("duplicates_SecurCenter_text_span").innerHTML=localeString("Android_audit_duplicates_title"),$("all_security_name_header_span").innerText=localeString("PassAud_ItemName_Title"),$("all_security_pwd_header_span").innerText=localeString("PassAud_ItemPassword_Title"),$("all_security_strength_header_span").innerText=localeString("PassAud_ItemPasswordStrength_Title"),$("all_security_age_header_span").innerText=localeString("PassAud_ItemAge_Title"),$("security_name_usedheader").innerText=localeString("PassAud_ItemName_Title"),$("security_url_usedheader").innerText=localeString("PassAud_ItemUrl_Title"),$("reused_security_pwd_header_span").innerText=localeString("PassAud_ItemPassword_Title"),$("security_age_usedheader").innerText=localeString("PassAud_ItemAge_Title"),$("security_name_duplicatesheader").innerText=localeString("PassAud_ItemName_Title"),$("security_location_duplicatesheader").innerText=localeString("PassAud_ItemLocation_Title");var o=$("SecurCenter_maindiv").getElementsByClassName("password_click");for(i=0;i<o.length;i++)o[i].addEventListener("click",function(e){t.ClickSecurityTableHeader(e),e.stopPropagation()},!1);$("all_security_name_header").addEventListener("click",function(e){t.SortSecurityTableColumn(e)},!1),$("all_security_age_header").addEventListener("click",function(e){t.SortSecurityTableColumn(e)},!1),$("all_security_strength_header").addEventListener("click",function(e){t.SortSecurityTableColumn(e)},!1),$("all_security_pwd_header").addEventListener("click",function(e){t.SortSecurityTableColumn(e)},!1)};function t(){var e;"switch-login-button"==this.id?(e=$("switch-bookmark-button"),$("save-question-div").innerHTML=localeString("SaveDlg_SaveLoginQuestion_Text")):(e=$("switch-login-button"),$("save-question-div").innerHTML=localeString("SaveDlg_SaveBookmarkQuestion_Text")),this.className="switch-round-button",e.className="switch-round-text",this.removeEventListener("click",t,!1),e.addEventListener("click",t,!1),v()}function n(){return HasClass($("switch-login-button"),"switch-round-button")?EnRfDataItemType.RfItemType_Login:EnRfDataItemType.RfItemType_Bookmark}e.prototype.OnNavigatedToSecurityCenterScreen=function(e){var t=this;function n(e,t){switch(t.setAttribute("strength",e),e){case 0:case 1:t.innerText=localeString("PassAud_PwdStrengthWeak"),AddClass(t,"level_weak");break;case 2:t.innerText=localeString("PassAud_PwdStrengthMedium"),AddClass(t,"level_medium");break;case 3:t.innerText=localeString("PassAud_PwdStrengthGood"),AddClass(t,"level_good");break;case 4:t.innerText=localeString("PassAud_PwdStrengthStrong"),AddClass(t,"level_strong")}}function i(e){return e.substring(0,e.lastIndexOf("/"))}function o(e,o,a,r,s){for(var l=0;l<e.length;l++){var c,_=o.cloneNode(!0),d=e[l],E=_.cells[0].lastElementChild,u=t.m_oAccountInfo.email!==d.accountInfo.email?"/"+d.accountInfo.name:"";E.setAttribute("title",u+d.path),c=d.gotoUrl&&(m=d.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))?t.GetIconUrl(m[2],"&def=rfp.ico"):LOGIN_IMAGE,E.style.backgroundImage="url('"+c+"')",E.innerText=(p=d.path,g=void 0,g="",g=-1==(g=p.substring(p.lastIndexOf("/")+1)).lastIndexOf(".")?g:g.substr(0,g.lastIndexOf("."))),E.addEventListener("click",function(e){var n=e.currentTarget.getAttribute("title"),i={type:1};i.path=n,t.EditItem(i)},!1),"all"==r?((E=_.cells[1].lastElementChild).innerText=d.password.replace(new RegExp(".","g"),"*"),E.setAttribute("pwd",d.password),n(d.pwdStrength,_.cells[2]),_.cells[3].innerText=d.modTime?Math.floor((Date.now()/1e3-d.modTime)/86400):""):"duplicates"==r?((E=_.cells[1].lastElementChild).innerText=u+i(d.path),E.setAttribute("title",u+i(d.path)),_.setAttribute("tab-type",r),AddClass(_,"group-id"+s)):"reused"==r&&((E=_.cells[1].lastElementChild).innerText=d.gotoUrl,E.setAttribute("title",d.gotoUrl),(E=_.cells[2].lastElementChild).innerText=d.password.replace(new RegExp(".","g"),"*"),E.setAttribute("pwd",d.password),_.cells[3].innerText=d.modTime?Math.floor((Date.now()/1e3-d.modTime)/86400):"",_.setAttribute("tab-type",r),AddClass(_,"group-id"+s)),AddClass(_,"security_row_td"),RemoveClass(_,"_row_hidden"),a.appendChild(_)}var p,g}function a(e,t){var n=$(e+"_SecurCenter_main_tbody"),i=n.rows[0];if(i=i.cloneNode(!0),"all"!=e){var a=n.rows[1];for(a=a.cloneNode(!0);n.rows.length>2;)n.deleteRow(-1)}else for(;n.rows.length>1;)n.deleteRow(-1);if("all"==e)o(t,i,n,e);else{for(var r=0;r<t.length;r++){var s=t[r],l=a.cloneNode(!0);l.setAttribute("group-id",r),l.setAttribute("tab-type",e),l.cells[0].lastElementChild.lastElementChild.innerText="duplicates"==e?s.gotoUrl:localeString("PassAud_ReusedGroup_Title"),RemoveClass(l,"_group_hidden"),AddClass(l,"_group_collapse"),l.getElementsByClassName("rfoicon-expand")[0].innerHTML="&#9654;",n.appendChild(l),o(s.items,i,n,e,r)}!function(e){for(var t=$(e).getElementsByClassName("_group_collapse"),n=0;n<t.length;n++)t[n].addEventListener("click",function(e){e.currentTarget;for(var t=e.currentTarget.getAttribute("group-id"),n=e.currentTarget.getAttribute("tab-type"),i=$(n+"_SecurCenter_main_tbody").getElementsByClassName("group-id"+t),o=0;o<i.length;o++)i[o].style.display=""==i[o].style.display||"table-row"==i[o].style.display?"none":"table-row";e.currentTarget.getElementsByClassName("rfoicon-expand")[0].innerHTML=""==i[0].style.display||"table-row"==i[0].style.display?"&#9654;":"&#9660;"},!1)}(e+"_SecurCenter_main_tbody")}}getProxyRfo().GetSecurityInfo({accountId:t.m_oAccountInfo.email,countReceivedFiles:!0,countGroups:!0,countRegularSharedFolders:!0}).then(function(e){var t=JSON.stringify(e),n=JSON.parse(t);$("all_SecurCenter_tabBtn").click(),$("SecurCenter_loading_div").style.display="none",$("SecurCenter_head_div").style.display="block",$("all_SecurCenter_counter_span").innerHTML=n.items.all.length,$("reused_SecurCenter_counter_span").innerHTML=n.items.reused.length,$("duplicates_SecurCenter_counter_span").innerHTML=n.items.duplicates.length,$("SecurCenter_title_div").innerHTML=localeString("PassAud_SummaryScore"),a("all",n.items.all),a("reused",n.items.reused),a("duplicates",n.items.duplicates),function(e){var t=e.score;$("SecurCenter_scoreimage_div").innerText=t+"%";var n,i=$("SecurCenter_topBtns_table").getElementsByClassName("badge"),o=$("SecurCenter_topBtns_table").getElementsByClassName("SecurCenter_switchBtn");t>75?($("SecurCenter_scoretitle_div").innerText=localeString("PassAud_GoodSafetyLevel_Tittle"),$("SecurCenter_scoretext_div").innerText=localeString("PassAud_GoodSafetyLevel_Text"),n="_good"):t>50?($("SecurCenter_scoretitle_div").innerText=localeString("PassAud_MediumSafetyLevel_Tittle"),$("SecurCenter_scoretext_div").innerText=localeString("PassAud_MediumSafetyLevel_Text"),n="_medium"):t>25?($("SecurCenter_scoretitle_div").innerText=localeString("PassAud_AverageSafetyLevel_Tittle"),$("SecurCenter_scoretext_div").innerText=localeString("PassAud_AverageSafetyLevel_Text"),n="_average"):t>0?($("SecurCenter_scoretitle_div").innerText=localeString("PassAud_BadSafetyLevel_Tittle"),$("SecurCenter_scoretext_div").innerText=localeString("PassAud_BadSafetyLevel_Text"),n="_bad"):($("SecurCenter_scoreimage_div").innerText="N/A",$("SecurCenter_scoretitle_div").innerText="",$("SecurCenter_scoretext_div").innerText=localeString("PassAud_NA_Text"),n="_none");for(var a=0;a<i.length;a++)AddClass(i[a],"badge"+n);for(a=0;a<o.length;a++)AddClass(o[a],"button"+n);$("SecurCenter_head_div").setAttribute("class","div"+n),$("SecurCenter_scoreimage_div").setAttribute("class","scoreimage_div"+n)}(n.securityStats)}).catch(function(e){$("SecurCenter_loading_div").style.display="block",$("SecurCenter_head_div").style.display="none",t.CheckGlobalErrorResponse2(e)&&($("SecurCenter_loading_div").innerHTML=e.Description)})},e.prototype.SortSecurityTableColumn=function(e){function t(e,t,n,i){for(var o=e.offsetParent.tBodies[0],a=[],r=o.rows,s=0;s<r.length;s++){var l=r[s];if(-1==l.getAttribute("class").indexOf("_row_hidden")){var c=l.getElementsByClassName(n),_="strength"==i?c[0].getAttribute("strength"):"password"==i?c[0].getAttribute("pwd"):c[0].innerHTML;a.push([_,l])}}for(var d=0,E=(a=a.sort(function(e,n){var o,a;switch(i){case"password":case"alpha":o=e[0].toLowerCase(),a=n[0].toLowerCase();break;case"numeric":case"strength":o=""==e[0]?-1:parseInt(e[0]),a=""==n[0]?-1:parseInt(n[0])}return o<a?t?-1:1:o>a?t?1:-1:0})).length;d<E;d++)o.appendChild(a[d][1]);a=null}for(var n=e.currentTarget,i=n.getAttribute("sort"),o=n.getElementsByClassName("header_span_sort"),a=n.getAttribute("sorted_element"),r=n.getAttribute("sorted_type"),s=n.offsetParent.tHead.getElementsByClassName("header_span_sort"),l=0;l<s.length;l++)s[l].innerHTML="";i&&"desc"!=i?(t(n,!1,a,r),n.setAttribute("sort","desc"),o[0].innerHTML="&#9660;"):(t(n,!0,a,r),n.setAttribute("sort","asc"),o[0].innerHTML="&#9650;")},e.prototype.ClickSecurityTableHeader=function(e){for(var t=e.currentTarget.getAttribute("tab_type"),n=$(t+"_SecurCenter_main_tbody").getElementsByClassName(t+"_security_pwd_div"),i=0;i<n.length;i++){var o=n[i].getAttribute("symbols"),a=n[i].getAttribute("pwd");if(a){var r=n[i].innerHTML.replace(new RegExp(".","g"),"*");o&&"0"!=o?(n[i].innerHTML=r,n[i].setAttribute("symbols","0")):(n[i].innerHTML=a,n[i].setAttribute("symbols","1"))}}},e.prototype.OpenSecuritySection=function(e,t){for(var n=document.getElementsByClassName("tabcontent"),i=0;i<n.length;i++)n[i].style.display="none";$(t+"_SecurCenter_section_div").style.display="block";var o=document.getElementsByClassName("SecurCenter_switchBtn");for(i=0;i<o.length;i++)RemoveClass(o[i],"button_active");AddClass(e.currentTarget,"button_active");var a=document.getElementsByClassName("badge");for(i=0;i<a.length;i++)RemoveClass(a[i],"badge_active");var r=document.getElementsByClassName("badge "+t);AddClass(r[0],"badge_active")},e.prototype.ShowEmergencyAccessScreen=function(){var e=this,t=new ViewItem(void 0,void 0,"header-item-title"),n=localeString("EmergencyAccess_Title");t.m_oContext={title:n};var i=e.CreateUIItem(t),o=new ViewItem("EAContacts_maindiv",void 0,"dialog"),a=e.CreateUIItem(o);e.m_navigator.Navigate({name:"Emergency Access",views:[i,a],initialize:function(t){e.InitEmergencyAccessScreen(t)},on_navigated_to:function(t){e.OnNavigatedToEmergencyAccessScreen(t)}})},e.prototype.InitEmergencyAccessScreen=function(e){var t=this;$("my_EAContacts_tabBtn").addEventListener("click",function(e){t.OpenEmergencyAccess(e,"my_EAContacts_section_div")},!1),$("i_EAContactFor_tabBtn").addEventListener("click",function(e){t.OpenEmergencyAccess(e,"i_EAContactFor_section_div")},!1),$("my_EAContacts_tabBtn").click(),$("my_EAContacts_add_btn").addEventListener("click",function(e){t.ShowInviteEmergencyContactScreen()},!1),$("my_EAContacts_close_btn").addEventListener("click",function(){t.m_navigator.GoBack()},!1),$("i_EAContactFor_close_btn").addEventListener("click",function(){t.m_navigator.GoBack()},!1);var n=t.CheckLicenseIsExpired();$("my_EAContacts_top_hint_label").textContent=localeString("EmergencyAccess_Help_Hint"),$("i_EAContactFor_top_hint_label").textContent=localeString("EmergencyAccess_Help_Add_Hint"),n?$("my_EAContacts_add_btn").setAttribute("disabled","disabled"):$("my_EAContacts_add_btn").removeAttribute("disabled"),n&&($("i_EAContactFor_License_btn").style.display="block",$("i_EAContactFor_License_btn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$("i_EAContactFor_License_btn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($("i_EAContactFor_top_hint_label"))},!1),$("my_EAContacts_License_btn").style.display="block",$("my_EAContacts_License_btn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$("my_EAContacts_License_btn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($("my_EAContacts_top_hint_label"))},!1))},e.prototype.OnNavigatedToEmergencyAccessScreen=function(e){var t=this;Promise.all([getProxyRfo().GetEmergencyContacts(),getProxyRfo().GetTestators()]).then(function(e){var n=e[0].contacts,i=e[1].testators.filter(function(e){return e.status!==EnEmergencyStatus.rejected});$("my_EAContacts_tabBtn").innerHTML=format(localeString("EmergencyAccess_ContactsCount_Title"),n.length),$("i_EAContactFor_tabBtn").innerHTML=format(localeString("EmergencyAccess_TestatorsCount_Title"),i.length),t.BuildEmergencyContactsUI(n),t.BuildEmergencyTestatorsUI(i)}).catch(function(e){})},e.prototype.BuildEmergencyContactsUI=function(e){var t=this,n=$("my_EAContacts_data_scrolltable_body");n.innerHTML="";for(var i=0;i<e.length;i++)!function(){var o=e[i],a=n.insertRow(n.rows.length),r=a.insertCell(0);r.setAttribute("class","my_EAContacts-name-maintd");var s=o.email?o.email:o.accountId,l=o.accountId,c=o.name?o.name:"",_=t.createElement("a");if(_.setAttribute("class","my_EAContacts-name-alink"),_.href="#",_.innerText=c||s,_.setAttribute("title",c||s),_.addEventListener("click",function(){t.ShowEditEmergencyContactPage(l,o.timeoutSecs)},!1),c&&c!=s){var d=t.createElement("table");d.setAttribute("cellpadding","0"),d.setAttribute("cellspacing","0");var E=d.insertRow(d.rows.length).insertCell(0);E.appendChild(_),(E=d.insertRow(d.rows.length).insertCell(0)).setAttribute("class","my_EAContacts-name-bottomtd"),E.innerText=s,r.appendChild(d)}else r.appendChild(_);var u=a.insertCell(1);u.setAttribute("class","my_EAContacts-data-status-td");var p=void 0===o.status?EnEmergencyStatus.invited:o.status,m=void 0===o.accessStatus?EnEmergencyAccessStatus.no_access:o.accessStatus,g=t.GetAccountTextImage(p,m),I=a.insertCell(2);I.setAttribute("class","my_EAContacts-data-actions-td"),t.CreateContactActionButtons(p,m,s,o.timeoutSecs,u,I,g);var T=a.insertCell(3);T.setAttribute("class","my_EAContacts-data-revoke-td"),T.appendChild(t.createElement("img",{class:"EASection-revokeaccess-img",src:ACCOUNT_REVOKE_IMAGE,title:localeString("EmergencyAccess_Revoke_Tip")})),T.addEventListener("click",function(){t.ShowConfirmationDialog({title:localeString("EmergencyAccess_Revoke_Tip"),text:format(localeString("EmergencyAccess_Revoke_Question"),s),confirm_text:localeString("EmergencyAccess_RevokeAccess_Text"),ok_callback:function(){getProxyRfo().RevokeEmergencyContact({contact:s}).then(function(){t.m_navigator.GoBack()}).catch(function(e){t.ProcessConfirmationError(e)})}})},!1)}()},e.prototype.CreateContactActionButtons=function(e,t,n,i,o,a,r){var s=this;if(o.innerHTML=r.text,o.setAttribute("title",r.text),o.style.color=r.color,o.style.background="url('"+r.image+"') no-repeat left center",e!==EnEmergencyStatus.invited){var l=(s=this).createElement("button"),c=s.createElement("button");e===EnEmergencyStatus.accepted?t===EnEmergencyAccessStatus.access_requested?(l.innerText=localeString("EmergencyAccess_GrantAccess_Text"),l.setAttribute("class","my_EAContact_grantbtn"),l.setAttribute("title",localeString("EmergencyAccess_GrantAccess_Title")),l.addEventListener("click",function(){s.ShowConfirmationDialog({title:localeString("EmergencyAccess_GrantAccess_Title"),text:format(localeString("EmergencyAccess_GrantAccess_Question"),n),confirm_text:localeString("EmergencyAccess_GrantAccess_Text"),ok_callback:function(){getProxyRfo().GrantEmergencyAccess({contact:n}).then(function(){s.m_navigator.GoBack()}).catch(function(e){s.ProcessConfirmationError(e)})}})},!1),a.appendChild(l),c.innerText=localeString("EmergencyAccess_DenyAccess_Button_Text"),c.setAttribute("class","my_EAContact_denybtn"),c.setAttribute("title",localeString("EmergencyAccess_DenyAccess_Text")),c.addEventListener("click",function(){s.ShowConfirmationDialog({title:localeString("EmergencyAccess_DenyAccess_Text"),text:format(localeString("EmergencyAccess_DenyAccess_Question"),n),confirm_text:localeString("EmergencyAccess_DenyAccess_Button_Text"),ok_callback:function(){getProxyRfo().RevokeEmergencyAccess({contact:n}).then(function(){s.m_navigator.GoBack()}).catch(function(e){s.ProcessConfirmationError(e)})}})},!1),a.appendChild(c)):t===EnEmergencyAccessStatus.access_granted?(l.innerText=localeString("EmergencyAccess_RevokeAccess_Text"),l.setAttribute("class","my_EAContact_denybtn"),l.setAttribute("title",localeString("EmergencyAccess_RevokeAccess_Button_Text")),l.addEventListener("click",function(){s.ShowConfirmationDialog({title:localeString("EmergencyAccess_RevokeAccess_Button_Text"),text:format(localeString("EmergencyAccess_RevokeAccess_Question"),n),ok_callback:function(){getProxyRfo().RevokeEmergencyAccess({contact:n}).then(function(){s.m_navigator.GoBack()}).catch(function(e){s.ProcessConfirmationError(e)})}})},!1),a.appendChild(l)):EnEmergencyAccessStatus.no_access:e===EnEmergencyStatus.rejected&&(l.innerText=localeString("EmergencyAccess_InviteContact_Text"),l.setAttribute("class","my_EAContact_grantbtn"),l.addEventListener("click",function(){s.ShowConfirmationDialog({title:localeString("EmergencyAccess_InviteContact_Text"),text:format(localeString("EmergencyAccess_InviteAgain_Question"),n),ok_callback:function(){getProxyRfo().InviteEmergencyContact({contact:n,timeoutSecs:i,invite:!1}).then(function(){s.m_navigator.GoBack()}).catch(function(e){s.ProcessConfirmationError(e)})}})},!1),a.appendChild(l))}},e.prototype.BuildEmergencyTestatorsUI=function(e){var t=this,n=$("i_EAContactFor_data_scrolltable_body");n.innerHTML="";for(var i=0;i<e.length;i++)!function(){var o=e[i],a=n.insertRow(n.rows.length),r=a.insertCell(0);r.setAttribute("class","i_EAContactFor_name_maintd");var s=o.email?o.email:o.accountId,l=(o.accountId,o.name?o.name:""),c=t.createElement("a");if(c.innerText=l||s,c.setAttribute("title",l||s),c.setAttribute("class","i_EAContactFor_name_alink"),l&&l!=s){var _=t.createElement("table");_.setAttribute("class","i_EAContactFor_name_table"),_.setAttribute("cellpadding","0"),_.setAttribute("cellspacing","0");var d=_.insertRow(_.rows.length).insertCell(0);d.appendChild(c),(d=_.insertRow(_.rows.length).insertCell(0)).setAttribute("class","i_EAContactFor_name_bottomtd"),d.innerText=s,r.appendChild(_)}else r.appendChild(c);var E=a.insertCell(1);E.setAttribute("class","i_EAContactFor_status_td");var u=void 0===o.status?EnEmergencyStatus.invited:o.status,p=void 0===o.accessStatus?EnEmergencyAccessStatus.no_access:o.accessStatus,m=t.GetAccountTextImage(u,p),g=a.insertCell(2);g.setAttribute("class","i_EAContactFor_actions_td"),t.CreateTestatorsActionButtons(u,p,s,E,g,m,o);var I=a.insertCell(3);I.setAttribute("class","i_EAContactFor_decline_td");var T=t.createElement("input",{class:"i_EAContactFor_declinebtn",type:"button",value:"Decline",title:localeString("EmergencyAccess_Reject_Invitation_Text")});I.appendChild(T),T.addEventListener("click",function(){t.ShowConfirmationDialog({title:localeString("EmergencyAccess_Reject_Title"),text:format(localeString("EmergencyAccess_RejectInvitation_Question"),s),confirm_text:localeString("EmergencyAccess_RejectAccess_Text"),ok_callback:function(){getProxyRfo().RejectEmergencyContactInvitation({testator:s}).then(function(){t.m_navigator.GoBack()}).catch(function(e){t.ProcessConfirmationError(e)})}})},!1)}()},e.prototype.CreateTestatorsActionButtons=function(e,t,n,i,o,a,r){var s=this;i.innerText=a.text,i.setAttribute("title",a.text),i.style.color=a.color,i.style.background="url('"+a.image+"') no-repeat 0px 5px";var l=s.createElement("button");if(e===EnEmergencyStatus.invited&&(l.innerText=localeString("EmergencyAccess_Accept_Invitation_Text"),l.setAttribute("class","i_EAContactFor_acceptbtn"),l.addEventListener("click",function(){s.ShowConfirmationDialog({title:localeString("EmergencyAccess_Accept_Invitation_Text"),text:format(localeString("EmergencyAccess_Accept_Invitation_Question"),n),ok_callback:function(){getProxyRfo().AcceptEmergencyContactInvitation({testator:n}).then(function(){s.m_navigator.GoBack()}).catch(function(e){s.ProcessConfirmationError(e)})}})},!1),o.appendChild(l)),e===EnEmergencyStatus.accepted)if(t===EnEmergencyAccessStatus.no_access)l.innerText="Request",l.setAttribute("class","i_EAContactFor_getdatabtn"),l.setAttribute("title",localeString("EmergencyAccess_Request_Access_Text")),l.addEventListener("click",function(){s.ShowConfirmationDialog({title:localeString("EmergencyAccess_Request_Access_Text"),text:format(localeString("EmergencyAccess_RequestAccess_Question"),n),ok_callback:function(){getProxyRfo().RequestEmergencyAccess({owner:n}).then(function(){s.m_navigator.GoBack()}).catch(function(e){s.ProcessConfirmationError(e)})}})},!1),o.appendChild(l);else if(t===EnEmergencyAccessStatus.access_requested){var c=Math.round(new Date/1e3),_=r.accessRequestedTime,d=r.timeoutSecs;if(_&&d){var E=parseInt(d-(c-_)),u=parseInt(E/3600),p=parseInt(E/86400);p>0&&u>0?i.setAttribute("title",format(localeString("EmergencyAccess_AccessRequestedDaysHours_Status"),p,u)):p>0?i.setAttribute("title",format(localeString("EmergencyAccess_AccessRequestedDays_Status"),p)):i.setAttribute("title",format(localeString("EmergencyAccess_AccessRequestedHours_Status"),u))}}else t===EnEmergencyAccessStatus.access_granted&&(l.innerText="Get Data",l.setAttribute("class","i_EAContactFor_getdatabtn"),l.addEventListener("click",function(){s.ShowConfirmationDialog({title:localeString("EmergencyAccess_GetData_Request_Text"),text:format(localeString("EmergencyAccess_GetData_Request_Question"),n),ok_callback:function(){s.CheckDisableNonGroupData()?s.ProcessConfirmationError({Code:ERR_NOT_ALLOWED,Description:localeString("Policy_DisableNonGroupData_Message")}):(q(!0,"EA_confirm_prg_ind",["EA_confirm_ok_btn","EA_confirm_cancel_btn"],void 0),getProxyRfo().GetTrustedUserData({owner:n}).then(function(e){getProxyRfo().PutDataToFolder({data:e,path:"/Emergency Access/"+n}).then(function(e){q(!1,"EA_confirm_prg_ind",["EA_confirm_ok_btn","EA_confirm_cancel_btn"],void 0),s.m_navigator.GoBack()}).catch(function(e){s.ProcessConfirmationError(e)})}).catch(function(e){s.ProcessConfirmationError(e)}))}})},!1),o.appendChild(l))},e.prototype.OpenEmergencyAccess=function(e,t){var n,i,o;for(i=document.getElementsByClassName("tabcontent"),n=0;n<i.length;n++)i[n].style.display="none";for(o=document.getElementsByClassName("EASection_switchBtn"),n=0;n<o.length;n++)o[n].className=o[n].className.replace(" active","");$(t).style.display="block",e.currentTarget.className+=" active"},e.prototype.ShowInviteEmergencyContactScreen=function(){var e=this,t=new ViewItem(void 0,void 0,"header-item-title"),n=localeString("EmergencyAccess_AddContact_Title");t.m_oContext={title:n};var i=e.CreateUIItem(t),o=new ViewItem("add_EAContact_section_div",void 0,"dialog"),a=e.CreateUIItem(o);e.m_navigator.Navigate({name:"Add Emergency Access Contact",views:[i,a],initialize:function(t){e.InitInviteEmergencyContactScreen(t)},on_navigated_to:function(t){e.OnNavigatedToInviteEmergencyContactScreen(t)}})},e.prototype.CreateInviteEmergencyContactOption=function(e,t,n,i){var o=this.createElement("option",{value:t});o.text=n,i&&(o.selected=!0),e.appendChild(o)},e.prototype.InitInviteEmergencyContactScreen=function(e){var t=this,n=$("add_EAContact_timeout_select");this.CreateInviteEmergencyContactOption(n,0,localeString("EmergencyAccess_TimeoutImmediately_Text")),this.CreateInviteEmergencyContactOption(n,43200,localeString("EmergencyAccess_Timeout12hours_Text")),this.CreateInviteEmergencyContactOption(n,86400,localeString("EmergencyAccess_Timeout24hours_Text")),this.CreateInviteEmergencyContactOption(n,172800,localeString("EmergencyAccess_Timeout2days_Text")),this.CreateInviteEmergencyContactOption(n,259200,localeString("EmergencyAccess_Timeout3days_Text")),this.CreateInviteEmergencyContactOption(n,604800,localeString("EmergencyAccess_Timeout7days_Text")),this.CreateInviteEmergencyContactOption(n,1209600,localeString("EmergencyAccess_Timeout14days_Text")),this.CreateInviteEmergencyContactOption(n,2592e3,localeString("EmergencyAccess_Timeout30days_Text")),$("add_EAContact_add_btn").addEventListener("click",function(){t.AddEmergencyContactClick()},!1),$("add_EAContact_cancel_btn").addEventListener("click",function(){t.m_navigator.GoBack()},!1)},e.prototype.OnNavigatedToInviteEmergencyContactScreen=function(e){var t=this,n=getBG().g_policySet.GetConfigValue(ConfigAllowedEmergencyAccessUsers),i=0===n;$("add_EAContact_singleuser_label").style.display=i?"block":"none",$("add_EAContact_user_input").style.display=i?"block":"none",i&&$("add_EAContact_user_input").focus();var o=$("add_EAContact_user_select");switch($("add_EAContact_selectuser_label").style.display=i?"none":"block",o.style.display=i?"none":"block",n){case 0:break;case 1:getProxyRfo().GetUserCompaniesMembers().then(function(e){for(var n=0;n<e.length;n++){var i=e[n];i.id!=t.m_oAccountInfo.accountId&&t.CreateInviteEmergencyContactOption(o,i.id,i.id)}}).catch(function(e){});break;case 2:getProxyRfo().GetUserCompaniesMembers().then(function(e){for(var n=0;n<e.length;n++){var i=e[n];i.isManager&&i.id!=t.m_oAccountInfo.accountId&&t.CreateInviteEmergencyContactOption(o,i.id,i.id)}}).catch(function(e){});break;case 3:getProxyRfo().GetUserCompaniesMembers().then(function(e){for(var n=0;n<e.length;n++){var i=e[n];i.is_admin&&i.id!=t.m_oAccountInfo.accountId&&t.CreateInviteEmergencyContactOption(o,i.id,i.id)}}).catch(function(e){})}},e.prototype.AddEmergencyContactClick=function(){var e=this,t=$("add_EAContact_result_error");t.innerText="";var n=$("add_EAContact_timeout_select"),i=n.options[n.selectedIndex].value,o=$("add_EAContact_user_input").value;if(0!==getBG().g_policySet.GetConfigValue(ConfigAllowedEmergencyAccessUsers)){var a=$("add_EAContact_user_select");o=a.options[a.selectedIndex].value}if(!o)return t.innerText=localeString("EmergencyAccess_Email_Is_Empty"),void(t.style.display="block");getProxyRfo().InviteEmergencyContact({contact:o,timeoutSecs:i,invite:!0}).then(function(){e.m_navigator.GoBack()}).catch(function(e){e&&e.Description&&(t.innerHTML=e.Description)})},e.prototype.ShowEditEmergencyContactPage=function(e,t){var n=this,i=new ViewItem(void 0,void 0,"header-item-title"),o=format(localeString("EmergencyAccess_EditContact_Title"),e);i.m_oContext={title:o};var a=n.CreateUIItem(i),r=new ViewItem("edit_EAContact_section_div",void 0,"dialog"),s=n.CreateUIItem(r),l={contact:e,timeout:t};n.m_navigator.Navigate({name:"Edit Emergency Access Contact",views:[a,s],context:l,initialize:function(e){n.InitEditEmergencyContactScreen(e)}})},e.prototype.InitEditEmergencyContactScreen=function(e){var t=this,n=$("edit_EAContact_timeout_select");this.CreateInviteEmergencyContactOption(n,0,localeString("EmergencyAccess_TimeoutImmediately_Text"),0===e.timeout),this.CreateInviteEmergencyContactOption(n,43200,localeString("EmergencyAccess_Timeout12hours_Text"),43200===e.timeout),this.CreateInviteEmergencyContactOption(n,86400,localeString("EmergencyAccess_Timeout24hours_Text"),86400===e.timeout),this.CreateInviteEmergencyContactOption(n,172800,localeString("EmergencyAccess_Timeout2days_Text"),172800===e.timeout),this.CreateInviteEmergencyContactOption(n,259200,localeString("EmergencyAccess_Timeout3days_Text"),259200===e.timeout),this.CreateInviteEmergencyContactOption(n,604800,localeString("EmergencyAccess_Timeout7days_Text"),604800===e.timeout),this.CreateInviteEmergencyContactOption(n,1209600,localeString("EmergencyAccess_Timeout14days_Text"),1209600===e.timeout),this.CreateInviteEmergencyContactOption(n,2592e3,localeString("EmergencyAccess_Timeout30days_Text"),2592e3===e.timeout),$("edit_EAContact_edit_btn").addEventListener("click",function(){t.EditEmergencyContactClick(e.contact)},!1),$("edit_EAContact_cancel_btn").addEventListener("click",function(){t.m_navigator.GoBack()},!1)},e.prototype.EditEmergencyContactClick=function(e){var t=this;$("edit_EAContact_result_error").innerText="";var n=$("edit_EAContact_timeout_select"),i=n.options[n.selectedIndex].value;getProxyRfo().UpdateEmergencyContact({contact:e,timeoutSecs:i}).then(function(){t.m_navigator.GoBack()}).catch(function(e){e&&e.Description&&($("edit_EAContact_result_error").innerHTML=e.Description)})},e.prototype.ShowConfirmationDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-item-title");n.m_oContext={title:e.title?e.title:localeString("GenericConfirmDialog_Title")};var i=t.CreateUIItem(n),o=new ViewItem("EA_confirm_dialog_div",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Confirmation Dialog",views:[i,a],initialize:function(n){$("EA_confirm_dialog_text").innerHTML=e.text?e.text:"",$("EA_confirm_dialog_error").innerHTML="",q(!1,"EA_confirm_prg_ind",["EA_confirm_ok_btn","EA_confirm_cancel_btn"],void 0);var i=$("EA_confirm_ok_btn");i.value=e.confirm_text?e.confirm_text:localeString("GenericConfirmDialog_Ok"),i.addEventListener("click",function(){$("EA_confirm_dialog_error").innerHTML="",e.ok_callback?e.ok_callback():t.m_navigator.GoBack()},!1);var o=$("EA_confirm_cancel_btn");o.value=e.reject_text?e.reject_text:localeString("GenericConfirmDialog_Cancel"),o.addEventListener("click",function(){e.cancel_callback?e.cancel_callback():t.m_navigator.GoBack()},!1)},skip_navigation:!0})},e.prototype.ProcessConfirmationError=function(e){q(!1,"EA_confirm_prg_ind",["EA_confirm_ok_btn","EA_confirm_cancel_btn"],void 0),e&&e.Description?$("EA_confirm_dialog_error").innerHTML=e.Description:this.m_navigator.GoBack()},e.prototype.GetTimeoutName=function(e){switch(e){case 0:return localeString("EmergencyAccess_TimeoutImmediately_Text");case 43200:return localeString("EmergencyAccess_Timeout12hours_Text");case 86400:return localeString("EmergencyAccess_Timeout24hours_Text");case 172800:return localeString("EmergencyAccess_Timeout2days_Text");case 259200:return localeString("EmergencyAccess_Timeout3days_Text");case 604800:return localeString("EmergencyAccess_Timeout7days_Text");case 1209600:return localeString("EmergencyAccess_Timeout14days_Text");case 2592e3:return localeString("EmergencyAccess_Timeout30days_Text");default:return e}},e.prototype.GetStatusName=function(e){switch(e){case EnEmergencyStatus.invited:return localeString("EmergencyAccess_ContactInvited_Status");case EnEmergencyStatus.accepted:return localeString("EmergencyAccess_ContactAccepted_Status");case EnEmergencyStatus.rejected:return localeString("EmergencyAccess_ContactRejected_Status");default:return e}},e.prototype.GetAccountTextImage=function(e,t){if(e==EnEmergencyStatus.invited)return{text:localeString("EmergencyAccess_ContactInvited_Status"),color:"blue",image:CONTACT_INVITED};if(e==EnEmergencyStatus.accepted){if(t==EnEmergencyAccessStatus.no_access)return{text:localeString("EmergencyAccess_ContactAccepted_Status"),color:"green",image:CONTACT_ACCEPTED};if(t==EnEmergencyAccessStatus.access_requested)return{text:localeString("EmergencyAccess_AccessRequested_Status"),color:"blue",image:ACCESS_REQUESTED};if(t==EnEmergencyAccessStatus.access_granted)return{text:localeString("EmergencyAccess_AccessGranted_Status"),color:"green",image:ACCESS_GRANTED}}else if(e==EnEmergencyStatus.rejected)return{text:localeString("EmergencyAccess_ContactRejected_Status"),color:"gray",image:CONTACT_REJECTED}},e.prototype.ShowChangeMasterPasswordDialog=function(){var e=this,t=new ViewItem("change_master_password_div",void 0,"dialog"),n=this.CreateUIItem(t);e.m_navigator.Navigate({name:"Change Master Password",views:[n],initialize:function(t){e.InitChangeMasterPasswordDialog(t)},skip_navigation:!0})},e.prototype.InitChangeMasterPasswordDialog=function(){this.AddChangeMasterPasswordListeners(),$(CHANGEMASTPWD_CURRENTPWD_ID).value="",$(CHANGEMASTPWD_NEWPWD_ID).value="",$(CHANGEMASTPWD_CONFIRMPWD_ID).value="",setTimeout(function(){$(CHANGEMASTPWD_CURRENTPWD_ID).focus()},100)},e.prototype.AddChangeMasterPasswordListeners=function(){var e=this;$(CHANGEMASTPWD_OKBTN_ID).addEventListener("click",function(){e.ChangeMasterPasswordClick()},!1),$(CHANGEMASTPWD_CANCELBTN_ID).addEventListener("click",function(){e.m_navigator.GoBack(),e.LogOff()},!1),$(CHANGEMASTPWD_CURRENTPWD_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(CHANGEMASTPWD_NEWPWD_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(CHANGEMASTPWD_CONFIRMPWD_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1)},e.prototype.ChangeMasterPasswordClick=function(){var e=this,t=$("change_master_password_error_div");t.innerHTML="";var n=$(CHANGEMASTPWD_CURRENTPWD_ID).value,i=$(CHANGEMASTPWD_NEWPWD_ID).value,o=$(CHANGEMASTPWD_CONFIRMPWD_ID).value;if(!n||!i||!o)return t.innerHTML=localeString("Install_PasswordTooShort"),void(n?i?$(CHANGEMASTPWD_CONFIRMPWD_ID).focus():$(CHANGEMASTPWD_NEWPWD_ID).focus():$(CHANGEMASTPWD_CURRENTPWD_ID).focus());if(getProxyRfo().GetUserName()){if(n==i)return t.innerHTML=localeString("MasterPass_New_TheSameAsPrevious_Error"),$(CHANGEMASTPWD_NEWPWD_ID).focus(),$(CHANGEMASTPWD_CONFIRMPWD_ID).value="",void($(CHANGEMASTPWD_NEWPWD_ID).value="");if(i!=o)return t.innerHTML=localeString("ConfirmMasterPassword_Incorrect_Text"),void $(CHANGEMASTPWD_CONFIRMPWD_ID).focus();q(!0,CHANGEMASTPWD_PROGRESS_ID,[CHANGEMASTPWD_OKBTN_ID,CHANGEMASTPWD_CANCELBTN_ID],CHANGEMASTPWD_OKBTN_ID);var a={};a[USERNAME_PROPERTY]=getProxyRfo().GetUserName(),a[ACCOUNTPWD_PROPERTY]=n,a.otp_channel="-",getProxyRfo().LoginToAccount(JSON.stringify(a),function(o){if(JSON.parse(o)[JSON_MSG_ERROR])return t.innerText=localeString("Android_wrong_password_error"),q(!1,CHANGEMASTPWD_PROGRESS_ID,[CHANGEMASTPWD_OKBTN_ID,CHANGEMASTPWD_CANCELBTN_ID],null),void $(CHANGEMASTPWD_CURRENTPWD_ID).focus();setTimeout(function(){var o=getProxyRfo().IsMasterPasswordCorrect(i);if(1!=o.result)return t.innerHTML=o.reason,q(!1,CHANGEMASTPWD_PROGRESS_ID,[CHANGEMASTPWD_OKBTN_ID,CHANGEMASTPWD_CANCELBTN_ID],null),$(CHANGEMASTPWD_NEWPWD_ID).focus(),$(CHANGEMASTPWD_NEWPWD_ID).value="",void($(CHANGEMASTPWD_CONFIRMPWD_ID).value="");q(!1,CHANGEMASTPWD_PROGRESS_ID,[CHANGEMASTPWD_OKBTN_ID,CHANGEMASTPWD_CANCELBTN_ID],null);var a={};a.new_password=i,a[ACCOUNTPWD_PROPERTY]=n,a[USERNAME_PROPERTY]=getProxyRfo().GetUserName(),getProxyRfo().ChangeAccountPassword(JSON.stringify(a),function(t){setTimeout(function(){visibilityEffect($(MAINSCREEN_DIV),[10]),$("loading_circle").style.display="none",getBG().broadcast_message_to_auto_save_dialog({name:"AutoSaveUserLoggedIn"}),e.ShowStartPage()},0)},function(e){$(CHANGEMASTPWD_NEWPWD_ID).focus(),$(CHANGEMASTPWD_NEWPWD_ID).value="",$(CHANGEMASTPWD_CONFIRMPWD_ID).value="";var n=JSON.parse(e);if(n){var i=n.error;if(i){var o=i.code,a=i.description;t.innerHTML=1==o?localeString("Android_wrong_password_error"):a||format(localeString("SA_ChangeAccountPwd_Error"),o)}}$("loading_circle").style.display="none",setTimeout(function(){visibilityEffect($(MAINSCREEN_DIV),[5,7,10])},100)},e.ShowProgressIndicator)},100)})}else t.innerText=localeString("Change_Account_Password_Login_First")},e.prototype.ShowCreateMasterPasswordDialog=function(e){var t=this,n=new ViewItem("rfcreate_mpsection_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Create Master Password",views:[i],context:e,initialize:function(e){t.InitCreateMasterPasswordDialog(e)},skip_navigation:!0})},e.prototype.AddCreateMasterPasswordListeners=function(){var e=this;$(MASTERPWDCREATE_OKBTN_ID).addEventListener("click",function(){e.SubmitCreateMasterPasswordDialog()},!1),$(MASTERPWDCREATE_CANCELBTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(MASTERPWDCREATE_DLG_INPUT_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1),$(MASTERPWDCREATE_CONFIRM_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1)},e.prototype.InitCreateMasterPasswordDialog=function(e){this.AddCreateMasterPasswordListeners();e.item_info,e.action;var t=e.description;$(MASTERPWDCREATE_ERRMSG_ID).innerHTML=t||"",q(!1,MASTERPWDCREATE_PRG_IND_ID,[MASTERPWDCREATE_OKBTN_ID,MASTERPWDCREATE_CANCELBTN_ID],null);var n=$(MASTERPWDCREATE_DLG_INPUT_ID);n.value="",n.focus()},e.prototype.SubmitCreateMasterPasswordDialog=function(){try{var e=$(MASTERPWDCREATE_DLG_INPUT_ID),t=$(MASTERPWDCREATE_CONFIRM_ID),n=$(MASTERPWDCREATE_ERRMSG_ID);n.innerHTML="";var i=e.value,o=t.value;if(!i)return n.innerHTML=localeString("Install_PasswordTooShort"),e.focus(),!1;if(i.length<MPDLG_PWD_CHARLIMIT_MIN||i.length>MPDLG_PWD_CHARLIMIT_MAX)return n.innerHTML=localeString("MasterPwdEnterDlg_Limit_Text"),e.focus(),!1;if(!o)return n.innerHTML=localeString("Install_PasswordTooShort"),t.focus(),!1;if(o!=i)return n.innerHTML=localeString("ConfirmMasterPassword_Incorrect_Text"),e.focus(),!1;var a=this.m_navigator.GetCurrentContext(),r=a.action,s=a.item_info;if(s||((s={})[PATH_PROPERTY]=a[PATH_PROPERTY],s[RFTYPE_PROPERTY]=a[RFTYPE_PROPERTY]),q(!0,MASTERPWDCREATE_PRG_IND_ID,[MASTERPWDCREATE_OKBTN_ID,MASTERPWDCREATE_CANCELBTN_ID],MASTERPWDCREATE_CONFIRM_ID),r==this.EnObjectAction.Save||r==this.EnObjectAction.CreateSafenote||r==this.EnObjectAction.CreateContact||r==this.EnObjectAction.CreateIdentity){var l={};l[RFTYPE_PROPERTY]=s[RFTYPE_PROPERTY],l[PATH_PROPERTY]=s[PATH_PROPERTY],l[ITEM_PROPERTY]=a[ITEM_PROPERTY],l[ITEM_PROPERTY][ISPROTECTED_PROPERTY]=!0,l[ITEM_PROPERTY][PWD_GEN_PWD_PROPERTY]=i,l.item_info=s,l.action=r;var c=this,_=JSON.stringify(l);setTimeout(function(){getProxyRfo().PutDataItem(_,function(e){c.ResponseCreateMasterPassword(e)})},100)}}catch(e){return Q("ERROR in SubmitCreateMasterPasswordDialog: "+e.toString()),!1}},e.prototype.ResponseCreateMasterPassword=function(e){var t=this,n=JSON.parse(e);q(!1,MASTERPWDCREATE_PRG_IND_ID,[MASTERPWDCREATE_OKBTN_ID,MASTERPWDCREATE_CANCELBTN_ID],null),t.CheckGlobalErrorResponse(n)||setTimeout(function(){var e=n.context,i=e.action;switch(getBG().Bg_SaveMasterPassword(e[ITEM_PROPERTY][PWD_GEN_PWD_PROPERTY]),i){case t.EnObjectAction.CreateSafenote:case t.EnObjectAction.CreateContact:case t.EnObjectAction.CreateIdentity:case t.EnObjectAction.Save:t.ShowStartPage();break;default:t.m_navigator.GoBack()}},10)},e.prototype.ShowMasterPasswordDialog=function(e){var t=this,n=new ViewItem("mastpwdEnter_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Enter Master Password",views:[i],context:e,initialize:function(e){t.InitMasterPasswordDialog(e)},skip_navigation:!0})},e.prototype.AddEnterMasterPasswordListeners=function(){var e=this;$(MASTERPWDENTER_DLG_CANCELBTN_ID).addEventListener("click",function(){e.CancelMasterPasswordDialog()},!1),$(MASTERPWDENTER_DLG_SUBMITBTN_ID).addEventListener("click",function(){e.SubmitMasterPasswordDialog()},!1),$(MASTERPWDENTER_DLG_INPUT_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t,!0)},!1)},e.prototype.InitMasterPasswordDialog=function(e){this.AddEnterMasterPasswordListeners();e.item_info,e.action;var t=e.description;$(MASTERPWDENTER_DLG_ERR_TD_ID).innerHTML=t||"",q(!1,MASTERPWDENTER_DLG_PRG_IND_DIV,[MASTERPWDENTER_DLG_SUBMITBTN_ID,MASTERPWDENTER_DLG_CANCELBTN_ID],null),$(MASTERPWDENTER_DLG_INPUT_ID).value="",$(MASTERPWDENTER_DLG_INPUT_ID).focus()},e.prototype.CancelMasterPasswordDialog=function(){var e=this.m_navigator.GetCurrentContext().callback;e&&e(void 0),this.m_navigator.GoBack()},e.prototype.SubmitMasterPasswordDialog=function(){try{$(MASTERPWDENTER_DLG_ERR_TD_ID).innerHTML="";var e=$(MASTERPWDENTER_DLG_INPUT_ID).value;if(!e)return $(MASTERPWDENTER_DLG_INPUT_ID).focus(),void($(MASTERPWDENTER_DLG_ERR_TD_ID).innerHTML="Empty password");var t=!!$(MASTERPWDENTER_DLG_CACHEPWD_ID).checked;t&&getBG().Bg_SaveMasterPassword(e);var n=this.m_navigator.GetCurrentContext(),i=n.action;q(!0,MASTERPWDENTER_DLG_PRG_IND_DIV,[MASTERPWDENTER_DLG_SUBMITBTN_ID,MASTERPWDENTER_DLG_CANCELBTN_ID],MASTERPWDENTER_DLG_CACHEPWD_ID);var o=n.callback;if(o)return void o(e);var a={};a.pwd=e,a.action=i,a.cachepwd=t;var r={};r.type=n.type,r.path=n.path,a.item_info=n.item_info||r;var s=this;switch(i){case this.EnObjectAction.CreateSafenote:case this.EnObjectAction.CreateContact:case this.EnObjectAction.CreateIdentity:case this.EnObjectAction.Save:var l={};l.type=n.type,l.path=n.path,l.action=i,l[ITEM_PROPERTY]=n[ITEM_PROPERTY],l.item_info=r,l[ITEM_PROPERTY][ISPROTECTED_PROPERTY]=!0,l[ITEM_PROPERTY][PWD_GEN_PWD_PROPERTY]=e;var c=JSON.stringify(l);i==this.EnObjectAction.Save?getProxyRfo().PutDataItem(c,function(e){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none";var t=JSON.parse(e);s.CheckGlobalErrorResponse(t)?$(MASTERPWDENTER_DLG_ERR_TD_ID).innerHTML=t.error.description:s.ShowStartPage()}):getProxyRfo().PutDataItem(c,function(e){s.ResponseCreateItem(e)});break;case this.EnObjectAction.Edit:a.used=!0;var _=JSON.stringify(a);getProxyRfo().GetDataItem(_,function(e){s.ResponseGetItemData(e)});break;case this.EnObjectAction.FillForms_ID:case this.EnObjectAction.FillSubmit_ID:this.FillIdentity(r,i!=this.EnObjectAction.FillForms_ID,i);break;case this.EnObjectAction.GotoNewTab:case this.EnObjectAction.GotoSameTab:a.bFill=!1,a.bNavigate=!0,a.bSubmit=!1,a.bNewWindow=action==this.EnObjectAction.GotoNewTab;_=JSON.stringify(a);getProxyRfo().NavigateFillSubmitAction(JSON.stringify(a),function(e){var t=JSON.parse(e);s.CheckGlobalErrorResponse(t)||s.ClosePopup(500)});break;case this.EnObjectAction.LoginSameWindow:case this.EnObjectAction.LoginNewWindow:case this.EnObjectAction.GoFill:case this.EnObjectAction.Goto:a.bFillOnlyEmptyFields=!0,a.bNavigate=!0,a.bNewWindow=i==this.EnObjectAction.LoginNewWindow,a.bFill=i!=this.EnObjectAction.Goto,a.bSubmit=!(i==this.EnObjectAction.Goto||i==this.EnObjectAction.GoFill),getProxyRfo().NavigateFillSubmitAction(JSON.stringify(a),function(e){var t=JSON.parse(e);s.CheckGlobalErrorResponse(t)||s.ClosePopup(500)})}}catch(e){Q("ERROR in SubmitMasterPasswordDialog: "+e.toString()),q(!1,MASTERPWDENTER_DLG_PRG_IND_DIV,[MASTERPWDENTER_DLG_SUBMITBTN_ID,MASTERPWDENTER_DLG_CANCELBTN_ID],null)}},e.prototype.ShowAccountSuspendedDialog=function(e){var t=this,n=new ViewItem("account_suspended_div",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Account was suspended",views:[i],context:e,initialize:function(e){t.InitAccountSuspendedDialog(e)},skip_navigation:!0})},e.prototype.AddAccountSuspendedListeners=function(){var e=this;$("account_suspended_closebtn").addEventListener("click",function(){e.CancelAccountSuspendedDialog()},!1)},e.prototype.InitAccountSuspendedDialog=function(e){this.AddAccountSuspendedListeners(),$("account_suspended_lbl").innerHTML=e.description,this.n_expdlg_close_seconds=this.EXPIRE_DLG_CLOSE_SECONDS;var t=this;this.n_closeexpireInter=setInterval(function(){t.AccountSuspendedDialogTimer()},1e3)},e.prototype.AccountSuspendedDialogTimer=function(){$("account_suspended_closebtn").value=localeString("Cmd_Close_Flat")+" ("+this.n_expdlg_close_seconds+")",0!=this.n_expdlg_close_seconds?this.n_expdlg_close_seconds--:this.ClearAccountSuspendedInterval()},e.prototype.CancelAccountSuspendedDialog=function(){this.ClearAccountSuspendedInterval()},e.prototype.ClearAccountSuspendedInterval=function(){0!=this.n_closeexpireInter&&(clearInterval(this.n_closeexpireInter),this.n_closeexpireInter=0),$("account_suspended_div").style.display="none",this.ClosePopup(100)},e.prototype.ShowSessionExpiredDialog=function(){var e=this,t=new ViewItem("session_timeout_div",void 0,"dialog"),n=e.CreateUIItem(t);e.m_navigator.Navigate({name:"Session Expired",views:[n],initialize:function(t){e.InitSessionExpiredDialog(t)},skip_navigation:!0})},e.prototype.AddSessionExpiredListeners=function(){var e=this;$(SESSIONEXP_DLG_CLOSEBTN_ID).addEventListener("click",function(){e.CancelSessionExpiredDialog()},!1)},e.prototype.InitSessionExpiredDialog=function(){this.AddSessionExpiredListeners(),this.n_expdlg_close_seconds=this.EXPIRE_DLG_CLOSE_SECONDS;var e=this;this.n_closeexpireInter=setInterval(function(){e.SessionExpiredDialogTimer()},1e3)},e.prototype.SessionExpiredDialogTimer=function(){$(SESSIONEXP_DLG_CLOSEBTN_ID).value=localeString("Cmd_Close_Flat")+" ("+this.n_expdlg_close_seconds+")",0!=this.n_expdlg_close_seconds?this.n_expdlg_close_seconds--:this.ClearSessionExpiredInterval()},e.prototype.CancelSessionExpiredDialog=function(){this.ClearSessionExpiredInterval()},e.prototype.ClearSessionExpiredInterval=function(){0!=this.n_closeexpireInter&&(clearInterval(this.n_closeexpireInter),this.n_closeexpireInter=0),$("session_timeout_div").style.display="none",this.ClosePopup(100)},e.prototype.ShowCreateFolderDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-item-title"),i=e.bShared?e.bGroup?localeString("Cmd_CreateGroup_Key"):localeString("NewSharedFolder_WindowTitle"):localeString("Cmd_NewFolder_Title");n.m_oContext={title:i};var o=t.CreateUIItem(n),a=new ViewItem("rffolder_create_div",void 0,"dialog"),r=t.CreateUIItem(a);t.m_navigator.Navigate({name:"Create Folder Dialog",views:[o,r],context:{item_info:e},initialize:function(e){t.InitCreateFolderDialog(e)}})},e.prototype.AddCreateFolderListeners=function(){var e=this;$(CREATEFLD_DLG_CNCL_BTN).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(CREATEFLD_DLG_OK_BTN).addEventListener("click",function(){e.SubmitCreateFolderDialog()},!1),$(CREATEFLD_DLG_INPUT_ID).addEventListener("keypress",function(t){e.GlobalInputKeyHandler(t)},!1)},e.prototype.InitCreateFolderDialog=function(e){var t=this,n=t.m_navigator.GetCurrentContext().item_info;t.AddCreateFolderListeners(),$(CREATEFLD_DLG_ERR_LBL_ID).innerHTML="",$(CREATEFLD_DLG_INPUT_ID).value="";var i=t.CheckLicenseIsExpired();$("createfolder_license_btn_td").style.display=i&&n.bShared?"table-cell":"none",$("createfolder_ok_btn_td").style.display=i&&n.bShared?"none":"table-cell",i&&n.bShared?$(CREATEFLD_DLG_INPUT_ID).setAttribute("disabled","disabled"):$(CREATEFLD_DLG_INPUT_ID).removeAttribute("disabled"),setTimeout(function(){i&&n.bShared?$("createfolder_license_btn").focus():$(CREATEFLD_DLG_INPUT_ID).focus()},200),i&&n.bShared&&($("createfolder_license_btn").value=t.m_bTrialLicense?localeString("ProAd_UpgradeNow_Button"):localeString("LicenseExpirationWarning_RenewLink"),$("createfolder_license_btn").addEventListener("click",function(){t.GetServerLicenseUrlandNavigate($(CREATEFLD_DLG_ERR_LBL_ID))},!1),$(CREATEFLD_DLG_ERR_LBL_ID).innerHTML=t.m_bTrialLicense?localeString("LicenseExpirationWarning_TrialExpired_Title"):localeString("LicenseExpirationWarning_LicenseExpired_Title"),$(CREATEFLD_DLG_ERR_LBL_ID).style.color="red")},e.prototype.SubmitCreateFolderDialog=function(){if(this.Popup_Dialog_CheckNameValid(CREATEFLD_DLG_ERR_LBL_ID,CREATEFLD_DLG_INPUT_ID)){var e=this.m_navigator.GetCurrentContext().item_info,t=$(CREATEFLD_DLG_INPUT_ID).value,n=e[PATH_PROPERTY];n.endsWith("/")||(n+="/"),n+=t,q(!0,void 0,[CREATEFLD_DLG_OK_BTN,CREATEFLD_DLG_CNCL_BTN],CREATEFLD_DLG_LABEL_ID);var i=this,o={};e.bShared?(o.name=t,e.bGroup&&(o.company=GetAdminCompanyName(i.m_oAccountInfo)),setTimeout(function(){var e=JSON.stringify(o);getProxyRfo().CreateSharedAccount(e,function(e){visibilityEffect($(MAINSCREEN_DIV),[7,10]),$("loading_circle").style.display="none",i.ResponseCreateFolder(e)},i.ShowProgressIndicator)},10)):(o[PATH_PROPERTY]=n,setTimeout(function(){var e=JSON.stringify(o);getProxyRfo().CreateFolder(e,function(e){visibilityEffect($(MAINSCREEN_DIV),[7,10]),$("loading_circle").style.display="none",i.ResponseCreateFolder(e)},i.ShowProgressIndicator)},10))}},e.prototype.ResponseCreateFolder=function(e){q(!1,void 0,[CREATEFLD_DLG_OK_BTN,CREATEFLD_DLG_CNCL_BTN],CREATEFLD_DLG_LABEL_ID);var t=JSON.parse(e);if(this.CheckGlobalErrorResponse(t))$(CREATEFLD_DLG_INPUT_ID)&&($(CREATEFLD_DLG_INPUT_ID).focus(),$(CREATEFLD_DLG_ERR_LBL_ID).innerHTML=t.error.description);else{var n=this;setTimeout(function(){n.m_navigator.GoBack();var e=n.m_navigator.GetCurrentContext(),t=e.types,i=e.path,o=e.title,a=e.match;n.m_navigator.RemoveBackEntry(),n.ShowItemsListScreen(t,i,o,void 0,a)},100)}},e.prototype.ShowCreateItemDialog=function(e){var t=this,n=new ViewItem("rfcreate_object_dialog",void 0,"dialog"),i=t.CreateUIItem(n);t.m_navigator.Navigate({name:"Create Item Dialog",views:[i],context:{item_info:e},initialize:function(e){t.InitCreateItemDialog(e)}})},e.prototype.CreateCountriesList=function(){for(var e=document.getElementById(CREATEOBJ_DLG_COUNTRY_SEL_ID),t=IDENTITY_RESOURCES.RFB_COUNTRIES,n=0;n<t.length;n++){var i=t[n],o=document.createElement("option");o.setAttribute("label",i[0]),o.setAttribute("value",i[0]),o.text=i[0],e.add(o,null)}e.selectedIndex=0},e.prototype.InitCreateItemDialog=function(e){this.AddCreateItemListeners();var t,n=e.item_info;$(CREATEOBJ_DLG_OK_BTN_ID).style.visibility="",$(CREATEOBJ_DLG_CANCELBTN_ID).value=localeString("Cmd_Cancel_Flat"),$(CREATEOBJ_DLG_INPUT_ID).style.display="",$(CREATEOBJ_DLG_TOPTXT_ID).innerHTML="",$(CREATEOBJ_DLG_ERR_TD_ID).innerHTML="",$(CREATEOBJ_DLG_ERR_OVERWRITE_CHK).checked=!1,$(CREATEOBJ_DLG_ERR_OVERWRITE_ID).style.display="none",$(CREATEOBJ_DLG_TEXTAREA_ID).value="",$(CREATEOBJ_DLG_INPUT_ID).value="",$(CREATEOBJ_DLG_NOTETR_ID).style.display="none",$(CREATEOBJ_DLG_NOTETR2_ID).style.display="none",$(CREATEOBJ_DLG_COUNTRYTR_ID).style.display="none",$(CREATEOBJ_DLG_COUNTRYTR2_ID).style.display="none";var i=$("rf_createobj_newname_td");switch(n[RFTYPE_PROPERTY]){case EnRfDataItemType.RfItemType_Safenote:$(CREATEOBJ_DLG_NOTETR_ID).style.display="table-row",$(CREATEOBJ_DLG_NOTETR2_ID).style.display="table-row",t=IMG_SAFENOTE_48,i.innerHTML=localeString("SaveDlg_Name_Text"),$(CREATEOBJ_DLG_TOPTXT_ID).innerHTML=localeString("SaveDlg_NewSafenote_Title2");break;case EnRfDataItemType.RfItemType_Identity:this.CreateCountriesList(),$(CREATEOBJ_DLG_COUNTRYTR_ID).style.display="table-row",$(CREATEOBJ_DLG_COUNTRYTR2_ID).style.display="table-row",t=IMG_IDENTITY_48,i.innerHTML=localeString("Reg_Name_Prompt").replace(new RegExp("&","g"),""),$(CREATEOBJ_DLG_TOPTXT_ID).innerHTML=localeString("FirstIdentity_Prompt");break;case EnRfDataItemType.RfItemType_Contact:this.CreateCountriesList(),$(CREATEOBJ_DLG_COUNTRYTR_ID).style.display="table-row",$(CREATEOBJ_DLG_COUNTRYTR2_ID).style.display="table-row",t=IMG_CONTACT_48,i.innerHTML=localeString("SaveDlg_Name_Text"),$(CREATEOBJ_DLG_TOPTXT_ID).innerHTML=localeString("Contacts_Cmd_New_Tip");break;default:return}$(CREATEOBJ_DLG_OBJIMG_ID).innerHTML="<img id='rf_create_obj_img' src='"+t+"' />",setTimeout(function(){$(CREATEOBJ_DLG_INPUT_ID).focus()},200)},e.prototype.AddCreateItemListeners=function(){var e=this;$(CREATEOBJ_DLG_CANCELBTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(CREATEOBJ_DLG_OK_BTN_ID).addEventListener("click",function(){e.SubmitCreateItemDialog()},!1)},e.prototype.SubmitCreateItemDialog=function(){try{if($(CREATEOBJ_DLG_ERR_OVERWRITE_ID).style.display="none",!this.Popup_Dialog_CheckNameValid(CREATEOBJ_DLG_ERR_TD_ID,CREATEOBJ_DLG_INPUT_ID))return;var e=this.m_navigator.GetCurrentContext().item_info,t=e[RFTYPE_PROPERTY],n=e[PATH_PROPERTY],i=$(CREATEOBJ_DLG_INPUT_ID).value;q(!0,void 0,[CREATEOBJ_DLG_OK_BTN_ID,CREATEOBJ_DLG_CANCELBTN_ID],CREATEOBJ_DLG_OK_BTN_ID);var o={};o[RFTYPE_PROPERTY]=t;var a=RfapiJS.utils.FileTypeToExt(t),r={},s=0;switch(n.endsWith("/")||(n+="/"),o[PATH_PROPERTY]=n+i+a,e[RFTYPE_PROPERTY]){case EnRfDataItemType.RfItemType_Safenote:r[ITEM_NAME_PROP]=$(CREATEOBJ_DLG_TEXTAREA_ID).value,s=this.EnObjectAction.CreateSafenote;break;case EnRfDataItemType.RfItemType_Identity:case EnRfDataItemType.RfItemType_Contact:var l={};l["World Regions"]=$(CREATEOBJ_DLG_COUNTRY_SEL_ID).value,l["Use for Form Filling"]=e[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Identity?"+":"",r[ID_OPTIONS_PROP]=l,s=e[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Identity?this.EnObjectAction.CreateIdentity:this.EnObjectAction.CreateContact}o[ITEM_PROPERTY]=r,o[ITEM_PROPERTY][ISPROTECTED_PROPERTY]=!0,o[ITEM_PROPERTY][PWD_GEN_PWD_PROPERTY]=getProxyRfo().GetMasterPassword();var c={};c.type=t,c.path=o.path,o.item_info=c,o.action=s,o.bNewItem=!0,o.bOverwrite=!!$(CREATEOBJ_DLG_ERR_OVERWRITE_CHK).checked,o.used=!0;var _=this;setTimeout(function(){var e=JSON.stringify(o);getProxyRfo().PutDataItem(e,function(e){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none",_.ResponseCreateItem(e)},_.ShowProgressIndicator)},0)}catch(e){q(!1,CREATEOBJ_DLG_PRG_IND_ID,[CREATEOBJ_DLG_OK_BTN_ID,CREATEOBJ_DLG_CANCELBTN_ID],CREATEOBJ_DLG_INPUT_ID),Q("EXCEPTION in SubmitCreateItemDialog:"+e.toString())}},e.prototype.ResponseCreateItem=function(e){var t=JSON.parse(e);if(q(!1,CREATEOBJ_DLG_PRG_IND_ID,[CREATEOBJ_DLG_OK_BTN_ID,CREATEOBJ_DLG_CANCELBTN_ID],null),this.CheckGlobalErrorResponse(t)){var n=t[JSON_MSG_ERROR];return $(CREATEOBJ_DLG_ERR_TD_ID)&&($(CREATEOBJ_DLG_ERR_TD_ID).innerHTML=n[JSON_MSG_DESCRIPTION]),void(n[JSON_MSG_CODE]&&n[JSON_MSG_CODE]==ERR_OBJECT_ALREADY_EXISTS&&$(CREATEOBJ_DLG_ERR_OVERWRITE_ID)&&($(CREATEOBJ_DLG_ERR_OVERWRITE_ID).style.display="inline"))}var i=this;setTimeout(function(){q(!1,MASTERPWDENTER_DLG_PRG_IND_DIV,[MASTERPWDENTER_DLG_SUBMITBTN_ID,MASTERPWDENTER_DLG_CANCELBTN_ID],null);var e=t.context.item_info;switch(e[RFTYPE_PROPERTY]){case EnRfDataItemType.RfItemType_Safenote:case EnRfDataItemType.RfItemType_Identity:case EnRfDataItemType.RfItemType_Contact:i.m_navigator.current.skip_navigation&&i.m_navigator.GoBack(),i.m_navigator.GoBack();var n=i.m_navigator.GetCurrentContext();if(n&&n.types){var o=n.types,a=n.path,r=n.title;i.m_navigator.RemoveBackEntry(),i.ShowItemsListScreen(o,a,r,function(){e[RFTYPE_PROPERTY]!=EnRfDataItemType.RfItemType_Safenote&&i.EditItem(e)})}}},10)},e.prototype.ManualSaveAction=function(){var e=this;getBG().Proxy_SaveItemManualy(function(t){var n=t.item_data[RfapiJS.ITEM_MATCHURL_PROP];getBG().g_policySet.IsRoboFormEnabledOnUrl(n)&&e.ShowManualSaveDialog(t)})},e.prototype.ShowManualSaveDialog=function(e){var t=this,n=new ViewItem(void 0,void 0,"header-simple-title");n.m_oContext={title:localeString("Cmd_SaveForms_Flat")};var i=t.CreateUIItem(n),o=new ViewItem("manual-save-dialog",void 0,"dialog"),a=t.CreateUIItem(o);t.m_navigator.Navigate({name:"Manual Save",views:[i,a],context:e,initialize:function(e){t.InitManualSaveDialog(e)}})},e.prototype.AddManualSaveListeners=function(e){var n=this;$("save-show-folder-div").addEventListener("click",C,!1),$("save-save-button").addEventListener("click",function(){n.OnSaveClick()},!1),$("save-cancel-button").addEventListener("click",function(){n.OnCloseClick()},!1),$("file-name-div").addEventListener("mousedown",D,!1),$("file-name-arrow-wrapper").addEventListener("mousedown",A,!1);var i=$("file-name-input");i.addEventListener("keypress",function(e){n.FileNameKeypress(e)},!1),i.addEventListener("blur",R,!1),i.addEventListener("input",v,!1),$("folder-name-div").addEventListener("mousedown",H,!1),$("folder-name-arrow-wrapper").addEventListener("mousedown",H,!1),$("folder-name-input").addEventListener("blur",U,!1);var o=$("new-folder-name-input");o.addEventListener("keypress",function(e){n.NewFolderNameKeypress(e)},!1),o.addEventListener("input",J,!1),$("folder-tree").addEventListener("mousedown",X,!1),$("create-folder-button").addEventListener("mousedown",S),$("new-folder-cancel").addEventListener("mousedown",f),$("new-folder-ok").addEventListener("mousedown",function(){n.NewFolderOk()},!1),$("unblock-autosave").addEventListener("click",E),$("unblock-auto-save-confirmation-no").addEventListener("click",_),$("unblock-auto-save-confirmation-yes").addEventListener("click",d),e.disableLogins||e.disableBookmarks||$("switch-bookmark-button").addEventListener("click",t,!1)},e.prototype.InitManualSaveDialog=function(e){this.AddManualSaveListeners(e),function(e){RemoveChilds("file-name-dropdown"),RemoveChilds("folder-tree");var t=e.name_suggestions,n=e.replace_items,i=e.folders,o=e.disableLogins,a=e.disableBookmarks;$("save-question-div").innerHTML=o?localeString("SaveDlg_SaveBookmarkQuestion_Text"):localeString("SaveDlg_SaveLoginQuestion_Text"),o&&($("switch-login-button").className="switch-round-text",$("switch-bookmark-button").className="switch-round-button");$("switch-bookmark-button").innerText=a?"":localeString("SaveDlg_SaveAs_Bookmark_Text"),$("switch-login-button").innerText=o?"":localeString("SaveDlg_SaveAs_Login_Text"),s=e.sDomainUrl,G("suggestions_section",localeString("SaveDlg_New_Login_Selector"));for(var r=0;r<t.length;r++){var l=w(t[r]);0==r&&O(l)}if(n.length>0)for(G("replace_section",localeString("SaveDlg_Existing_Passcards").replace(new RegExp("&","g"),"")),r=0;r<n.length;r++){var _=n[r],d=_.type,E=_.path,u=GetDisplayPath(E),p=d==EnRfDataItemType.RfItemType_Login?LOGIN_IMAGE:BOOKMARK_IMAGE;x(u,p,d)}!function(e){var t=K("Home");t.dataset.fullPath="";for(var n=0;n<e.length;n++)for(var i=e[n],o=i.path,a=o.split("/").filter(function(e){return e}),r=t,s=0;s<a.length;s++)!function(){var e=a[s],t=j(r),n=t.find(function(t){return k(t)===e});n?r=n:(r=K(e,r)).dataset.fullPath=o}()}(i);var m=V(GetSetting("sa-auto-save","rf_current_selected_folder",""));if(m)B(m);else{var g=$("folder-tree").getElementsByClassName("tree-root")[0];B(g)}z("save-dialog"),c(),$("createFolderDiv").style.display="none",h(GetSetting("sa-auto-save","rf_show_folder_field_in_dialog",!0)),$("file-name-dropdown").style.display="none",setTimeout(function(){$("file-name-input").focus()},100)}(e),T()},e.prototype.SubmitManualSaveDialog=function(){};var o,a=!1,r=!1,s=void 0,l=void 0;function c(){var e=GetSetting("sa-auto-save","blocking",[]).indexOf(s)>=0;$("unblock-autosave").style.display=e?"inline-block":"none"}function _(){z("save-dialog")}function d(){$("do-not-show-again-unblock").checked&&PutSetting("sa-auto-save","rf_show_auto_save_unblocking_confirm",!1),u(),z("save-dialog")}function E(){GetSetting("sa-auto-save","rf_show_auto_save_unblocking_confirm",!0)?z("unblock-auto-save-confirmation-dialog"):u()}function u(){var e=GetSetting("sa-auto-save","blocking",[]),t=e.indexOf(s);t>=0&&e.splice(t,1),PutSetting("sa-auto-save","blocking",e),c()}function p(e){$("auto-error-message")&&($("auto-error-message").innerText=e),$("auto-error-message-div")&&($("auto-error-message-div").style.display="block")}function g(){$("auto-error-message").innerText="",$("auto-error-message-div").style.display="none"}function I(e){$("auto-warning-message").innerText=e,$("auto-warning-message-div").style.display="block"}function T(){$("page-mask").style.display="none",$("progress-dialog").style.display="none"}function S(){var e=$("new-folder-name-input");e.value="New Folder",$("createFolderDiv").style.display="table-row",setTimeout(function(){e.focus()},100)}function f(){$("createFolderDiv").style.display="none",g()}function h(e){$("save-select-folder-div").style.display=e?"table-row":"none",$("save-folder-img").src=browser.runtime.getURL(e?"autosave_show_folder_open.ico":"autosave_show_folder.ico")}function C(){$("createFolderDiv").style.display="none";var e=!GetSetting("sa-auto-save","rf_show_folder_field_in_dialog",!0);PutSetting("sa-auto-save","rf_show_folder_field_in_dialog",e),h(e)}function v(){N(),g(),$("auto-warning-message").innerText="",$("auto-warning-message-div").style.display="none";var e=$("file-name-input"),t=e.value,i=SibNormalizeFileName(t);if(i){var o=n();!function(e){var t=$("replace_section");if(t)for(var n=t.getElementsByClassName("dropdown-name"),i=0;i<n.length;i++){var o=n[i],a=o.getAttribute("type");o.style.display=a==e?"block":"none"}}(o);var a=Y()+"/"+i,r=L(GetDisplayPath(a),o);if(r)return I("This "+(_=o==EnRfDataItemType.RfItemType_Login?localeString("SaveDlg_SaveAs_Login_Text"):localeString("SaveDlg_SaveAs_Bookmark_Text"))+" info will replace an existing "+_+" '"+i+"'"),M("custom-name"),b(r),void(e.value=t);if(r=function(e){for(var t=$("suggestions_section").getElementsByClassName("dropdown-name"),n=0;n<t.length;n++){var i=t[n];if(i.textContent===e)return i}}(t))return M("custom-name"),void P(r);if(l)for(var s=a.trim().toLowerCase(),c=0;c<l.length;++c){var _,d=l[c].trim().toLowerCase(),E=1,u=d.indexOf(".rfp");if(-1===u&&(u=d.indexOf(".rfb"),E=2),u>=0&&(d=d.substring(0,u)),s===d&&E==o)return void I("This "+(_=o==EnRfDataItemType.RfItemType_Login?localeString("SaveDlg_SaveAs_Login_Text"):localeString("SaveDlg_SaveAs_Bookmark_Text"))+" info will replace an existing "+_+": '"+i+"'")}M("custom-name"),P(r=w(t,"custom-name"))}else{p("Login name '"+t+"' cannot be empty and it cannot contain characters \\ / : * ? \" < > |")}}function R(){a=!1,F()}function D(e){a||A(e)}function A(e){e.preventDefault(),e.stopPropagation(),a=!a,F()}function y(e){$("file-name-input").focus(),e.preventDefault(),e.stopPropagation()}function N(){for(var e=$("save-file-name-select").getElementsByClassName("dropdown-name-selected"),t=0;t<e.length;t++){var n=e[t];RemoveClass(n,"dropdown-name-selected")}}function L(e,t){var n=$("replace_section");if(n)for(var i=n.getElementsByClassName("dropdown-name"),o=0;o<i.length;o++){var a=i[o],r=a.getAttribute("type");if(a.textContent===e&&r==t)return a}}function P(e){N(),AddClass(e,"dropdown-name-selected")}function O(e){var t=$("file-name-input");t.value=e.textContent,t.focus(),P(e)}function b(e){for(var t=$("file-name-input"),n=e.textContent.split("\\"),i=n[n.length-1],o="",a=0;a<n.length-1;a++)o+="/"+n[a];t.value=i,t.focus(),P(e);var r=V(o);r&&B(r)}function G(e,t){var n=document.createElement("div");n.id=e,n.className="dropdown-section";var i=document.createElement("div");i.className="dropdown-section-name",i.innerText=t,i.addEventListener("mousedown",y,!0),n.appendChild(i),$("file-name-dropdown").appendChild(n)}function M(e){var t=$(e);t&&$("suggestions_section").removeChild(t)}function w(e,t){var n=document.createElement("div");if(t&&(n.id=t),e)return n.innerHTML+=e,n.addEventListener("mousedown",function(){O(this)},!0),n.className="dropdown-name",$("suggestions_section").appendChild(n),n}function x(e,t,n){var i=document.createElement("div");if(t){var o=document.createElement("img");o.className="dropdown-name-icon",o.src=t,i.appendChild(o)}return i.innerHTML+=e,i.setAttribute("type",n),i.setAttribute("title",e),i.addEventListener("mousedown",function(){b(this)},!0),i.className="dropdown-name",$("replace_section").appendChild(i),i}function F(){var e=$("file-name-arrow");if(e){if(e.className=a?"name-arrow-opened":"name-arrow-closed",$("file-name-div").className=a?"name-wrapper-opened":"name-wrapper-closed",$("file-name-dropdown").style.display=a?"block":"none",a)$("file-name-input").focus();v()}}function k(e){if(e){var t=e.getElementsByClassName("tree-node-content")[0];if(t)return t.innerHTML}}function B(e){if(o!==e){l=void 0;var t=e.dataset.fullPath;o=e,function(){for(var e=$("folder-name-dropdown").getElementsByClassName("dropdown-name-selected"),t=0;t<e.length;t++){var n=e[t];RemoveClass(n,"dropdown-name-selected")}}(),function e(t){t&&(1===t.nodeType&&HasClass(t,"tree-node")&&(HasClass(t,"tree-node-expand-closed")&&ReplaceClass(t,"tree-node-expand-closed","tree-node-expand-open"),HasClass(t,"tree-root"))||e(t.parentNode))}(e);var n=e.getElementsByClassName("tree-node-header")[0];AddClass(n,"dropdown-name-selected"),W(),v();var i={path:t,type:[EnRfDataItemType.RfItemType_Login,EnRfDataItemType.RfItemType_Bookmark]};getProxyRfo().GetItemsForFolder(JSON.stringify(i),function(e){if((e=JSON.parse(e))&&e.items){var t=Array.from(e.items,function(e){return e.path});T(),l=t,v()}})}}function H(e){e.preventDefault(),e.stopPropagation(),r=!r,W()}function U(){r=!1,W()}function W(){$("folder-name-arrow").className=r?"name-arrow-opened":"name-arrow-closed",$("folder-name-div").className=r?"name-wrapper-opened":"name-wrapper-closed",$("folder-name-dropdown").style.display=r?"block":"none";var e=Y();e=e?e.substring(1):"Home";var t=$("folder-name-input");if(t.value=e,r){var n=$("folder-tree").getBoundingClientRect();$("folder-tree").scrollTop=o.offsetTop-n.height/2,t.focus()}}function V(e){return function e(t,n){if(t&&t.dataset.fullPath.toLowerCase()===n.toLowerCase())return t;for(var i=j(t),o=0;o<i.length;++o){var a=e(i[o],n);if(a)return a}}($("folder-tree").getElementsByClassName("tree-root")[0],e)}function Y(){return o?o.dataset.fullPath:""}function J(){var e=$("new-folder-name-input").value;SibNormalizeFileName(e)?g():p("Folder name '"+e+"' cannot be empty and it cannot contain characters \\ / : * ? \" < > |")}function X(e){var t=(e=e||window.event).target||e.srcElement;if(!HasClass(t,"tree-node-expand"))return HasClass(t,"tree-node-content")?void B(t.parentNode.parentNode):void 0;var n=t.parentNode.parentNode;HasClass(n,"tree-node-leaf")||(HasClass(n,"tree-node-expand-open")?ReplaceClass(n,"tree-node-expand-open","tree-node-expand-closed"):ReplaceClass(n,"tree-node-expand-closed","tree-node-expand-open"),e.preventDefault(),e.stopPropagation())}function j(e){if(!e)return[];var t=e.getElementsByClassName("tree-node-container")[0];if(t){for(var n=t.childNodes,i=[],o=0;o<n.length;o++)n[o].nodeType===Node.ELEMENT_NODE&&i.push(n[o]);return i}return[]}function K(e,t){var n=document.createElement("li");AddClass(n,["tree-node","tree-node-leaf"]);var i=document.createElement("div");AddClass(i,["tree-node-header"]);var o=document.createElement("div");AddClass(o,"tree-node-expand");var a=document.createElement("div");AddClass(a,"tree-node-content"),a.innerText=e,i.appendChild(o),i.appendChild(a),n.appendChild(i);var r=$("folder-tree");if(!t&&!(t=r.getElementsByClassName("tree-root")[0])){AddClass(n,["tree-root","tree-node-expand-open"]);var s=r.getElementsByClassName("tree-node-container")[0];return s||(s=document.createElement("ul"),AddClass(s,"tree-node-container"),r.appendChild(s)),s.appendChild(n),n}var l=t.getElementsByClassName("tree-node-container")[0];return l||(l=document.createElement("ul"),AddClass(l,"tree-node-container"),t.appendChild(l)),RemoveClass(t,["tree-node-leaf"]),HasClass(t,"tree-node-expand-open")||AddClass(t,["tree-node-expand-closed"]),l.appendChild(n),n}function z(e){for(var t=$("manual-save-dialog").childNodes,n=0;n<t.length;n++){var i=t[n];i.nodeType===Node.ELEMENT_NODE&&(i.id===e?(i.style.display="block",$("manual-save-dialog").style.width=window.getComputedStyle(i).getPropertyValue("width")):i.style.display="none")}}e.prototype.OnCloseClick=function(){this.m_navigator.GoBack()},e.prototype.NewFolderOk=function(){var e=$("new-folder-name-input").value,t=SibNormalizeFileName(e);if(t){g();var n=Y()+"/"+t,i=V(n);if(i)return B(i),void f();f();var a=JSON.stringify({path:n});getProxyRfo().CreateFolder(a,function(e){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none";var i=(e=JSON.parse(e))[JSON_MSG_ERROR];if(i)p(i.description);else{var a=K(t,o);a.dataset.fullPath=n,B(a),T()}},this.ShowProgressIndicator)}else{p("Folder name '"+e+"' cannot be empty and it cannot contain characters \\ / : * ? \" < > |")}},e.prototype.OnSaveClick=function(){var e=this,t=$("file-name-input").value,i=SibNormalizeFileName(t);if(i){g();var o=e.m_navigator.GetCurrentContext().item_data;if(o){var a=n(),r=L(GetDisplayPath(Y()+"/"+i),a),s={};s[ITEM_PROPERTY]=o,s[RFTYPE_PROPERTY]=a;var l=RfapiJS.utils.FileTypeToExt(s[RFTYPE_PROPERTY]);s[PATH_PROPERTY]=Y()+"/"+i+l,s.action=e.EnObjectAction.Save,s.used=!0,s.bNewItem=!r;var c=JSON.stringify(s);setTimeout(function(){getProxyRfo().PutDataItem(c,function(t){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none";var n=JSON.parse(t);e.CheckGlobalErrorResponse(n)?p(n.error.description):e.ShowStartPage()},e.ShowProgressIndicator)},10)}}else{p("Login name '"+t+"' cannot be empty and it cannot contain characters \\ / : * ? \" < > |")}},e.prototype.FileNameKeypress=function(e){(e=e||window.event).target?e.target:e.scrElement;13==(e.charCode?e.charCode:e.which?e.which:e.keyCode)&&($("save-save-button").focus(),this.OnSaveClick())},e.prototype.NewFolderNameKeypress=function(e){(e=e||window.event).target?e.target:e.scrElement;13==(e.charCode?e.charCode:e.which?e.which:e.keyCode)&&($("new-folder-ok").focus(),this.NewFolderOk())};function q(e,t,n,i){try{t&&$(t)&&($(t).style.display=1==e?"block":"none"),i&&e&&$(i)&&e&&$(i).focus();for(var o=0;o<n.length;o++)$(n[o])&&(1==e?$(n[o]).setAttribute("disabled","true"):$(n[o]).removeAttribute("disabled"))}catch(e){Q("EXCEPTION in SetControlsState:"+e.toString())}}e.prototype.ShowIdenticalFilesDialog=function(e,t,n,i){var o=this,a=new ViewItem(void 0,void 0,"header-item-title");a.m_oContext={title:"Identical RoboForm Files Detected"};var r=o.CreateUIItem(a),s=new ViewItem("identicalfiles_div",void 0,"dialog"),l=o.CreateUIItem(s),c={};c.files=e,c.data=t,c.action=n,o.m_navigator.Navigate({name:"Identical Files",views:[r,l],context:c,initialize:function(e){o.InitIdenticalFilesDialog(e)}})},e.prototype.InitIdenticalFilesDialog=function(e){var t=this;t.AddIdenticalFilesListeners(),$("identicalfiles_progress_div").style.display="none",$("identicalfiles_errmsg").innerHTML="",$("identicalfiles_update_btn").setAttribute("disabled","disabled");var n=e.files,i="",o=e.action,a=$("identicalfiles_filestable");RemoveChilds("identicalfiles_filestable");for(var r=0;r<n.length;r++){var s=n[r],l=s.path,c=!!s.readOnly,_=!!s.current;if(!c&&!_){var d=getImageForType(s),E=t.createElement("tr",{}),u=t.createElement("td",{width:"16px"}),p=t.createElement("img",{class:"identicalFiles_img",src:d});u.appendChild(p),E.appendChild(u);var m=t.createElement("td",{}),g=t.createElement("input",{type:"checkbox",path:l});g.addEventListener("click",function(){t.SetButtonStateIdenticalFiles()}),i=(i=l.substr(l.lastIndexOf("/")+1)).substr(0,i.lastIndexOf("."));var I=t.createElement("div",{class:"identicalFiles_text_label",title:l.substr(0,l.lastIndexOf("."))});if(I.innerText=l.substr(0,l.lastIndexOf(".")),m.appendChild(g),m.appendChild(I),E.appendChild(m),!(_||o==t.EnObjectAction.Delete)){var T=t.createElement("td",{width:"35px"}),S=t.createElement("label",{class:"identicalFiles_Deleteimg",delete:"0",path:l});S.textContent="delete",T.appendChild(S),E.appendChild(T)}a.appendChild(E)}}switch(o){case t.EnObjectAction.Edit:$("identicalfiles_toptext").innerHTML='You have updated <b>"'+i+'".</b> Do you want to apply these changes to the identical files listed below? You may also delete the unnecessary copies.';break;case t.EnObjectAction.Rename:$("identicalfiles_toptext").innerHTML='You have renamed <b>"'+i+'"</b> to <b>"'+e.data+'"</b>. Do you want to rename the identical files listed below? You may also delete the unnecessary copies.';break;case t.EnObjectAction.Delete:$("identicalfiles_toptext").innerHTML='You have deleted <b>"'+i+'".</b> Do you want to delete the identical files listed below?'}for(var f=a.getElementsByTagName("label"),h=0;h<f.length;h++){var C=f[h];C.getAttribute("delete")&&C.addEventListener("click",function(){var e=this.getAttribute("delete");"1"==e?this.setAttribute("delete","0"):this.setAttribute("delete","1"),e=this.getAttribute("delete"),this.textContent="1"==e?"keep":"delete",this.style.opacity="1"==e?"1.0":"0.8";var n=this.parentElement.previousSibling.children[1],i=this.parentElement.previousSibling.children[0];n&&(n.style.textDecoration="1"==e?"line-through":"none",n.style.color="1"==e?"grey":"black"),i&&("1"==e?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"),"1"==e&&(i.checked=!1)),t.SetButtonStateIdenticalFiles()})}},e.prototype.SetButtonStateIdenticalFiles=function(){var e=this.GetCheckedIdenticalFiles(),t=this.GetIdenticalFilesToDelete();e.length||t.length?$("identicalfiles_update_btn").removeAttribute("disabled"):$("identicalfiles_update_btn").setAttribute("disabled","disabled")},e.prototype.AddIdenticalFilesListeners=function(){var e=this;$("identicalfiles_update_btn").addEventListener("click",function(){e.UpdateIdenticalFilesOnClick()},!1),$("identicalfiles_cancel_btn").addEventListener("click",function(t){switch(e.m_navigator.GetCurrentContext().action){case e.EnObjectAction.Edit:e.m_navigator.GoBack();break;case e.EnObjectAction.Rename:case e.EnObjectAction.Delete:e.RenameDeleteRefreshItemsList()}},!1)},e.prototype.GetCheckedIdenticalFiles=function(){var e=[],t=$("identicalfiles_filestable").getElementsByTagName("input");for(i=0;i<t.length;i++)t[i].checked&&e.push(t[i].getAttribute("path"));return e},e.prototype.GetIdenticalFilesToDelete=function(){for(var e=[],t=$("identicalfiles_filestable").getElementsByTagName("label"),n=0;n<t.length;n++){var i=t[n].getAttribute("delete");i&&"0"!=i&&e.push(t[n].getAttribute("path"))}return e},e.prototype.UpdateIdenticalFilesOnClick=function(){var e=this,t=e.m_navigator.GetCurrentContext(),n=e.GetCheckedIdenticalFiles(),i=e.GetIdenticalFilesToDelete();if(n.length||i.length){q(!1,void 0,["identicalfiles_update_btn","identicalfiles_cancel_btn"],"identicalfiles_update_btn");var o={};o.itemsUpdate=n,o.itemsDelete=t.action==this.EnObjectAction.Delete?n:i,o.data=t.data,o.action=t.action,setTimeout(function(){var t=JSON.stringify(o);getProxyRfo().PutIdenticalFiles(t,function(t){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none",e.ResponseUpdateIdenticalFiles(t)},e.ShowProgressIndicator)},10)}else e.m_navigator.GoBack()},e.prototype.ResponseUpdateIdenticalFiles=function(e){$("identicalfiles_errmsg").innerHTML="";var t=JSON.parse(e);if(this.CheckGlobalErrorResponse(t))$("identicalfiles_errmsg").innerHTML=t.error.description;else{var n=t.context.action,i=this;setTimeout(function(){switch(i.m_navigator.GoBack(),n){case i.EnObjectAction.Edit:break;case i.EnObjectAction.Rename:case i.EnObjectAction.Delete:i.RenameDeleteRefreshItemsList()}},10)}},e.prototype.EditItem=function(e){try{var t=this;setTimeout(function(){e[PATH_PROPERTY],e[RFTYPE_PROPERTY];var n={};n.item_info=JSON.stringify(e),n.action=t.EnObjectAction.Edit,n.used=!0;var i=JSON.stringify(n);getProxyRfo().GetDataItem(i,function(e){t.ResponseGetItemData(e)})},0)}catch(e){Q("EXCEPTION in EditItem:"+e.toString())}},e.prototype.ResponseGetItemData=function(e){var t=this;setTimeout(function(){var n=JSON.parse(e);if(!t.CheckGlobalErrorResponse(n)){q(!1,MASTERPWDENTER_DLG_PRG_IND_DIV,[MASTERPWDENTER_DLG_SUBMITBTN_ID,MASTERPWDENTER_DLG_CANCELBTN_ID],null);var i=n.context.item_info,o=JSON.parse(i),a=n.item_data,r={item_info:o,item_data:a,item_data_initial:JSON.stringify(a)};o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Login||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_SearchCard||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Bookmark||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_BlockingPasscard||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Safenote?t.ShowItemEditor(r):t.ShowIdentityEditor(r)}},0)},e.prototype.GetIconUrl=function(e,t){return GetSetting("internal","icon-server")+"/icons/?domain="+e+"&def="+t},e.prototype.ShowItemEditor=function(e){var t=this,n=e.item_info,i=n.type,o=null;if(n.gotoUrl&&(m=n.gotoUrl.match(new RegExp("^http(s)?://([^/:]+)")))){var a=i==EnRfDataItemType.RfItemType_Login?"rfp.ico":"rfb.ico";o=this.GetIconUrl(m[2],a)}else o=n.error?OBJECT_WRONGFORMAT:getImageForType(n);var r=new ViewItem(void 0,void 0,"header-item-title");r.m_oContext={image_data:o,title:getTextForItem(n)};var s=t.CreateUIItem(r),l=new ViewItem("logineditor_div",void 0,"dialog"),c=t.CreateUIItem(l);t.m_navigator.Navigate({name:"Item Editor",views:[s,c],context:e,initialize:function(e){t.InitItemEditor(e)}})},e.prototype.AddItemEditorListeners=function(){var e=this;$(LOGINEDITOR_DLG_CANCEL_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(LOGINEEDITOR_DLG_SAVEBTN_ID).addEventListener("click",function(){e.SaveItemEditor()},!1)},e.prototype.InitItemEditor=function(e){this.AddItemEditorListeners();var t=e.item_info,n=e.item_data,i=(t.s||t.isShared,t.readOnly);if($(LOGINEEDITOR_DLG_SAVEBTN_ID).style.visibility=i?"hidden":"",$(LOGINEDITOR_DLG_CANCEL_ID).value=i?localeString("Cmd_Close_Flat"):localeString("Cmd_Cancel_Flat"),void 0!==n.showPasswords&&!n.showPasswords)return $("logineditor_err_msg").innerHTML=localeString("Android_received_has_no_permissions"),void($(LOGINEEDITOR_DLG_SAVEBTN_ID).style.visibility="hidden");if(n.dp&&n.l&&3==n.l)return $("logineditor_err_msg").innerHTML=localeString("Android_received_has_no_permissions"),$(LOGINEEDITOR_DLG_SAVEBTN_ID).style.visibility="hidden",void($(LOGINEDITOR_DLG_CANCEL_ID).value=localeString("Cmd_Close_Flat"));$("logineditor_err_msg").innerHTML="";var o=t[RFTYPE_PROPERTY];switch($(LOGINEDITOR_DLG_GOTOINPUT_ID).value=o==EnRfDataItemType.RfItemType_Login||o==EnRfDataItemType.RfItemType_SearchCard||o==EnRfDataItemType.RfItemType_Bookmark?n[RfapiJS.ITEM_GOTOURL_PROP]:o==EnRfDataItemType.RfItemType_BlockingPasscard?n[RfapiJS.ITEM_MATCHURL_PROP]:"",i?$(LOGINEDITOR_DLG_GOTOINPUT_ID).setAttribute("readonly","readoly"):$(LOGINEDITOR_DLG_GOTOINPUT_ID).removeAttribute("readonly"),$(LOGINEDITOR_DLG_URLDIV_ID).style.display=o==EnRfDataItemType.RfItemType_Login||o==EnRfDataItemType.RfItemType_BlockingPasscard||o==EnRfDataItemType.RfItemType_SearchCard||o==EnRfDataItemType.RfItemType_Bookmark?"block":"none",i?$(LOGINEDITOR_DLG_URLDIV_ID).setAttribute("readonly","readoly"):$(LOGINEDITOR_DLG_URLDIV_ID).removeAttribute("readonly"),$("logineditor_fields_fieldset").style.display=$(LOGINEDITOR_DLG_FIELDSDIV_ID).style.display=o==EnRfDataItemType.RfItemType_Login||o==EnRfDataItemType.RfItemType_BlockingPasscard||o==EnRfDataItemType.RfItemType_SearchCard?"block":"none",i?$("logineditor_fields_fieldset").setAttribute("readonly","readoly"):$("logineditor_fields_fieldset").removeAttribute("readonly"),$(LOGINEDITOR_DLG_NOTEDIV_ID).style.display="block",i?$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).setAttribute("readonly","readoly"):$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).removeAttribute("readonly"),o){case EnRfDataItemType.RfItemType_Safenote:$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.height=$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.minHeight=$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.maxHeight="335px";break;case EnRfDataItemType.RfItemType_BlockingPasscard:case EnRfDataItemType.RfItemType_SearchCard:case EnRfDataItemType.RfItemType_Login:$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.height=$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.minHeight=$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.maxHeight="50px";break;case EnRfDataItemType.RfItemType_Bookmark:$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.height=$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.minHeight=$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).style.maxHeight="175px"}$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).value=n[RfapiJS.ITEM_NOTE_PROP]?n[RfapiJS.ITEM_NOTE_PROP]:"",$("logineditor_fields_legend").style.background="url('/fields.png') no-repeat 0px 1px";var a=this,r=0;if(o==EnRfDataItemType.RfItemType_Login||o==EnRfDataItemType.RfItemType_BlockingPasscard||o==EnRfDataItemType.RfItemType_SearchCard){for(var s=$(LOGINEDITOR_DLG_FIELDS_TABLE);s.rows.length;)s.deleteRow(0);var l=n[RfapiJS.ITEMDATA_FIELDS_PROP];l&&(r=l.length),s.setAttribute(PCARD_LAST_FIELDINDEX_ATTR,r-1+"");for(var c=0;c<r;++c)this.EditItemDlg_CreateHtmlField(s,n[RfapiJS.ITEMDATA_FIELDS_PROP][c],c);for(var _=document.getElementsByTagName("img"),d=0;d<_.length;d++)!function(){var e=_[d],t=e.getAttribute("class");t&&"show_pwd_img"==t&&e.addEventListener("click",function(){a.ShowPasswordClick(e)},!1)}();if(i){var E=s.getElementsByTagName("input");for(d=0;d<E.length;d++)E[d].setAttribute("readonly","readonly")}}},e.prototype.EditItemDlg_CreateHtmlField=function(e,t,n){for(var i="black",o=!1,a=0;a<SPECIAL_PCARD_FIELDS.length;++a)-1!=t[ITEM_NAME_PROP].toString().toLowerCase().indexOf(SPECIAL_PCARD_FIELDS[a])&&(i="grey",o=!0);t[ITEM_NAME_PROP].toString().toLowerCase()!=RFNAME_NOTE_SPECIAL&&this.EditItemDlg_CreateTableRow(e,t,n,i,o)},e.prototype.EditItemDlg_CreateTableRow=function(e,t,n,i,o){try{var a=!1,r=void 0===t[ITEM_NAME_PROP]?"":t[ITEM_NAME_PROP],s=void 0===t[FIELD_VALUE_PROP]?"":t[FIELD_VALUE_PROP],l=void 0===t[FIELD_CAPTION_PROP]?"":t[FIELD_CAPTION_PROP],c=void 0===t[FIELD_ORDER_JSON]?0:t[FIELD_ORDER_JSON],_=void 0===t[FIELD_ID_JSON]?"":t[FIELD_ID_JSON],d=void 0!==t[ITEM_ISDEFAULT_PROP]&&t[ITEM_ISDEFAULT_PROP],E=void 0===t[FIELD_TYPE_PROP]?1:t[FIELD_TYPE_PROP],u=document.createElement("tr");u.setAttribute(FIELD_NAME_ATTR,r),u.setAttribute(FIELD_CAPTION_ATTR,l),u.setAttribute(FIELD_ID_ATTR,_),u.setAttribute(FIELD_TYPE_ATTR,E.toString()),u.setAttribute(FIELD_INDEX_ATTR,n),u.setAttribute(FIELD_ORDER_ATTR,c.toString()),u.setAttribute(FIELD_ISDEFVALUE_ATTR,d.toString());var p=document.createElement("td");p.className="rf_passcard_table_td_capton",p.setAttribute("width","100px");var m=r;m+=0==c?"":"["+c+"]";var g=parseInt(E);switch(g){case 0:m+="";break;case 1:m+=":txt";break;case 2:m+=":pwd",a=!0;break;case 3:m+=":chk";break;case 4:m+=":rch";break;case 5:m+=":rad";break;case 6:m+=":are";break;case 7:m+=":sel";break;default:m+=":unk"}var I=document.createElement("div");I.className="rf_passfields_table_td_caption_div",I.innerText=m,p.appendChild(I),g==RfFieldType.RfFieldTextArea&&(p.style.verticalAlign="top"),p.style.color=i,p.title=m,u.appendChild(p);var T=document.createElement("td");if(T.setAttribute("align","left"),T.className="rf_passfields_table_td_value",g!=RfFieldType.RfFieldTextArea){var S=document.createElement("input");o&&S.setAttribute("readonly",!0),S.className=EDITPASS_INPUT_CLASSNAME,S.setAttribute(FIELD_NAME_ATTR,r),S.setAttribute(FIELD_INDEX_ATTR,n),S.setAttribute(RFTYPE_PROPERTY,"text"),a&&S.setAttribute(RFTYPE_PROPERTY,"password"),S.setAttribute("value",s),S.style.color=i,T.appendChild(S)}else{var f=document.createElement("textarea");o&&f.setAttribute("readonly",o),f.setAttribute(FIELD_NAME_ATTR,r),f.setAttribute(FIELD_INDEX_ATTR,n),f.className=EDITPASS_TEXTAREA_CLASSNAME,f.style.color=i,f.value=s,f.innerText=s,T.appendChild(f)}u.appendChild(T);var h=document.createElement("td");if(h.setAttribute("width","18px"),h.setAttribute("align","right"),h.className="rf_passfields_table_td_pwdshow",a&&!getBG().g_policySet.GetConfigValue(ConfigShowPasswordsAsStarsInEditor)){var C=document.createElement("div");C.className="rf_passfields_table_td_pwd_div",C.innerHTML="<img id='rf_passfields_table_td_pwd_img"+n+"' style='cursor: pointer;' show_symbols_as='stars' class='show_pwd_img' width='16' height='16'  src='"+IMG_SWITCH_PWD+"' title='"+localeString("PassCards_Button_PasswordValuesAsStars_Tip")+"' />",h.appendChild(C)}return u.appendChild(h),e.appendChild(u),u}catch(e){Q("EXCEPTION in EditItemDlg_CreateTableRow:"+e.toString())}},e.prototype.ShowPasswordClick=function(e){var t=e.getAttribute("show_symbols_as"),n=e.parentNode.parentNode.previousSibling,i=n.firstChild,o=i.value;n.removeChild(i);var a="text";"symbols"==t?(a="password",e.setAttribute("show_symbols_as","stars")):e.setAttribute("show_symbols_as","symbols");var r=document.createElement("input");r.className=EDITPASS_INPUT_CLASSNAME,r.setAttribute(RFTYPE_PROPERTY,a),r.setAttribute("value",o),r.style.color="black",n.appendChild(r),"text"==a&&r.addEventListener("dblclick",function(e){e.target.select()},!1)},e.prototype.SaveItemEditor=function(){$("logineditor_err_msg").innerHTML="",q(!1,void 0,[LOGINEEDITOR_DLG_SAVEBTN_ID,LOGINEDITOR_DLG_CANCEL_ID],void 0);var e=this.m_navigator.GetCurrentContext(),t=e.item_info,n=e.item_data,i=e.item_data_initial;if(n[RfapiJS.ITEMDATA_FIELDS_PROP]){var o=[];for(var a in n[RfapiJS.ITEMDATA_FIELDS_PROP])o.push(n[RfapiJS.ITEMDATA_FIELDS_PROP][a]);n[RfapiJS.ITEMDATA_FIELDS_PROP]=o}if(t[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_BlockingPasscard||t[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Login||t[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_SearchCard){var r=$(LOGINEDITOR_DLG_FIELDS_TABLE);if(r&&r.rows.length){var s=r.getAttribute(PCARD_LAST_FIELDINDEX_ATTR),l=r.rows.length,c=n[RfapiJS.ITEMDATA_FIELDS_PROP].length;if(l!=c||s!=c-1);else for(var _=0;_<l;_++)for(var d=r.rows[_],E=d.getAttribute(FIELD_NAME_ATTR),u=d.getAttribute(FIELD_ORDER_ATTR),p=d.firstChild.nextSibling.firstChild,m="input"==p.tagName.toLowerCase()?p.value:p.innerText,g=0;g<c;g++){var I=n[RfapiJS.ITEMDATA_FIELDS_PROP][g];if(I[ITEM_NAME_PROP].toLowerCase()==E.toLowerCase())if((void 0===I[FIELD_ORDER_JSON]?"0":I[FIELD_ORDER_JSON])==u){n[RfapiJS.ITEMDATA_FIELDS_PROP][g][FIELD_VALUE_PROP]=m;break}}}}switch(n[RfapiJS.ITEM_NOTE_PROP]=$(LOGINEDITOR_DLG_NOTETEXTAREA_ID).value,t[RFTYPE_PROPERTY]){case EnRfDataItemType.RfItemType_Bookmark:n[RfapiJS.ITEM_GOTOURL_PROP]=$(LOGINEDITOR_DLG_GOTOINPUT_ID).value;break;case EnRfDataItemType.RfItemType_BlockingPasscard:n[RfapiJS.ITEM_MATCHURL_PROP]=$(LOGINEDITOR_DLG_GOTOINPUT_ID).value;break;case EnRfDataItemType.RfItemType_Login:n[RfapiJS.ITEM_GOTOURL_PROP]=$(LOGINEDITOR_DLG_GOTOINPUT_ID).value,n[RfapiJS.ITEM_MATCHURL_PROP]=$(LOGINEDITOR_DLG_GOTOINPUT_ID).value;break;case EnRfDataItemType.RfItemType_SearchCard:n[RfapiJS.ITEM_GOTOURL_PROP]=$(LOGINEDITOR_DLG_GOTOINPUT_ID).value}var T=this;q(!0,void 0,[LOGINEEDITOR_DLG_SAVEBTN_ID,LOGINEDITOR_DLG_CANCEL_ID],LOGINEEDITOR_DLG_SAVEBTN_ID);var S={};S.fileData=JSON.parse(i),S[ITEM_PROPERTY]=n,S[RFTYPE_PROPERTY]=t[RFTYPE_PROPERTY],S[PATH_PROPERTY]=t[PATH_PROPERTY],S.used=!0,setTimeout(function(){var e=JSON.stringify(S);getProxyRfo().PutDataItem(e,function(e){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none",T.ResponseSaveItem(e,"logineditor_err_msg",LOGINEEDITOR_DLG_SAVEBTN_ID,LOGINEDITOR_DLG_CANCEL_ID)},T.ShowProgressIndicator)},10)},e.prototype.ShowIdentityEditor=function(e){var t=this,n=e.item_info,i=(n.type,new ViewItem(void 0,void 0,"header-item-title"));i.m_oContext={image_data:getImageForType(n),title:getTextForItem(n)};var o=t.CreateUIItem(i),a=new ViewItem("rfIdentitysection_div",void 0,"dialog"),r=t.CreateUIItem(a);t.m_navigator.Navigate({name:"Identity Editor",views:[o,r],context:e,initialize:function(e){t.InitIdentityEditor(e)}})},e.prototype.AddIdentityEditorListeners=function(){var e=this;$(IDENTITY_DLG_CANCELBTN_ID).addEventListener("click",function(){e.m_navigator.GoBack()},!1),$(IDENTITY_DLG_OKBTN_ID).addEventListener("click",function(){e.SaveIdentity()},!1)},e.prototype.AddEditIdentityListeners=function(){var e,t=this;for(e=0;e<this.local_tabs_arr.length;e++)!function(){var n=t.local_tabs_arr[e].toLowerCase();n=n.split(" ").join("_");var i=$("tab"+n);i.addEventListener("click",function(){t.ShowIdentityEditorTab("tab"+n)},!1),i.addEventListener("mouseover",function(){i.getAttribute("id")!=t.g_ff_selectedtabid&&(i.style.backgroundColor="#eee")},!1),i.addEventListener("mouseout",function(){i.getAttribute("id")!=t.g_ff_selectedtabid&&(i.style.backgroundColor="#DCDFE6")},!1)}();var n=$(IDENTITY_DLG_PAGECONTDIV_ID),i=n.getElementsByTagName("select");for(e=0;e<i.length;e++){var o=i[e];o.selectedIndex=o.getAttribute("setSelectedIndex")}for(var a=n.getElementsByTagName("textarea"),r=0;r<a.length;r++){var s=a[r];s.value=s.getAttribute("value")}},e.prototype.InitIdentityEditor=function(e){this.AddIdentityEditorListeners();var t=e.item_info,n=e.item_data,i=(t.s||t.isShared,t.readOnly);if($(IDENTITY_DLG_OKBTN_ID).style.visibility=i?"hidden":"",$(IDENTITY_DLG_CANCELBTN_ID).value=i?localeString("Cmd_Close_Flat"):localeString("Cmd_Cancel_Flat"),n.dp&&n.l&&3==n.l)return $("rfIdentitysection_err_msg").innerHTML=localeString("Android_received_has_no_permissions"),$(IDENTITY_DLG_OKBTN_ID).style.visibility="hidden",void($(IDENTITY_DLG_CANCELBTN_ID).value=localeString("Cmd_Close_Flat"));var o=this.LoadIdentityWithIntellect(n,t);if(this.IdentityEditorBuildView(o),this.AddEditIdentityListeners(),$("rfIdentitysection_err_msg").innerHTML="",i){for(var a=$("ff_content"),r=a.getElementsByTagName("input"),s=0;s<r.length;s++)r[s].setAttribute("readonly","readonly");var l=a.getElementsByTagName("select");for(s=0;s<l.length;s++)l[s].setAttribute("readonly","readonly");var c=a.getElementsByTagName("textarea");for(s=0;s<c.length;s++)c[s].setAttribute("readonly","readonly")}var _=this;setTimeout(function(){_.ShowIdentityEditorTab("tabperson")},100)},e.prototype.HideAuthGroup=function(e,t){for(var n=!0,i=t.GetInstancesForGroup(e.m_sName),o=0;o<i.length;o++)for(var a=0;a<e.m_lFields.length;++a){var r=e.m_lFields[a],s=t.LookupStandard(r);if(s)if(!s.m_FieldFormat.GetComputable())if(s.GetValue(t,i[o])){n=!1;break}}return n},e.prototype.IdentityEditorBuildView=function(e){this.g_ff_selectedtabid="",this.local_tabs_arr.length=0;for(var t=e.getFields(),n=t.m_lStandardGroups,i=0;i<n.length;++i)if("Default Password"==n[i].m_sName){this.HideAuthGroup(n[i],t)&&n.splice(i,1);break}for(var o=0;o<n.length;o++)this.local_tabs_arr.push(n[o].m_sName);void 0!==t.m_customGroup&&t.m_customGroup&&this.local_tabs_arr.push("Custom");for(var a=$(ID_DLG_TABS_DIV);a.childNodes.length;)a.removeChild(a.childNodes[0]);for(i=0;i<this.local_tabs_arr.length;i++){var r=this.IdentityEditorBuildTab(this.local_tabs_arr[i]);a.appendChild(r),this.local_tabs_arr.length>9&&(r.style.width="12px")}var s=this.createElement("div",{});s.style.clear="both",a.appendChild(s);for(var l=$("ff_content");l.childNodes.length;)l.removeChild(l.childNodes[0]);for(var c=0;c<this.local_tabs_arr.length;c++){var _=this.local_tabs_arr[c].toLowerCase();_=_.split(" ").join("_");var d=this.createElement("div",{id:"pane"+_,class:"rf_pane",groupname:_});l.appendChild(d)}for(var E=0;E<n.length;++E){var u=n[E],p=u.m_sName,m=t.GetInstancesForGroup(p);m.length;for(var g=0;g<m.length;g++)this.IdentityEditorAddGroup(u,m[g],t,m.length)}void 0!==t.m_customGroup&&t.m_customGroup&&this.IdentityEditorAddGroup(t.m_customGroup,"Main",t,1)},e.prototype.IdentityEditorBuildTab=function(e){var t=this.GetGroupLocaleText(e),n="custom"!=(e=(e=e.toLowerCase()).split(" ").join("_"))?"group_"+e+"16.png":"group_custom16.png",i=this.createElement("div",{id:"tab"+e,class:"rf_tab",title:t,groupname:e});return i.innerHTML="<img class='identitytab_img' src='"+n+"'>",i},e.prototype.IdentityEditorAddGroup=function(e,t,n,i){try{var o=e.m_sName,a=null,r=this.createElement("fieldset",{class:"rf_identity_groupfieldset"}),s=this.createElement("legend",{class:"rf_identity_grouplegend"}),l=i>1?" - "+t:"";s.innerText=this.GetGroupLocaleText(o)+l;var c=o.toLowerCase();o.replace(" ","_");c=c.replace(" ","_"),s.style.background="url('"+IMG_GR_INSTANCE+"') no-repeat",a=$("pane"+c),r.appendChild(s);var _=this.createElement("fieldset",{class:"rf_identity_table_innerset"});r.appendChild(_);var d=document.createElement("legend");_.appendChild(d);var E=this.createElement("table",{class:"rf_identity_table",cellpadding:0,cellspacing:"2",border:0});"Custom"==o&&(E.id=IDENTITY_DLG_CUSTOM_TBL_ID);for(var u=null,p="",m=null,g=0;g<e.m_lFields.length;++g){var I=e.m_lFields[g],T=n.LookupStandard(I);if(T){var S=T.m_FieldFormat;if("Location"==o&&"Country"==I)!0;else if(S.GetComputable())continue;var f=S.m_sCaption;if("Location"==o&&"Country"==I&&(f="Country"),f.length&&"$Note$"==f)p=T.GetValue(n,t),(m=document.createElement("textarea")).setAttribute("multiline","true"),m.setAttribute("class","identity_field_notearea"),m.setAttribute("value",p),m.value=p,m.setAttribute(IDFIELD_CUSTOM_ATTR,"false"),m.setAttribute(IDFIELD_NAME_ATTR,I),m.setAttribute(IDFIELD_VALUE_ATTR,p),m.setAttribute(IDFIELD_INDEX_ATTR,T.m_nFieldIndex),m.setAttribute(IDFIELD_GROUPTYPE_ATTR,o),m.setAttribute(IDFIELD_INSTANCE_ATTR,t);else{var h=!1;f.length&&"_"==f[0]?(h=!0,f=f.substr(1)):u=null;f.length&&":"==f[0]&&(!0,f=f.substr(1));f.length&&f.match(new RegExp("^(.*)\\@(\\d+)(.*)$"))&&(parseInt(RegExp.$2),f=RegExp.$1+RegExp.$3);var C="";f.length&&f.match(new RegExp("^\\s*(.*)\\^(.*)$"))&&(C=RegExp.$2,f=RegExp.$1||RegExp.$2),f.length&&0==f.indexOf("#")&&(f=f.substr(1));var v=T.GetValue(n,t);if(h){if(!u)throw"There is No Prev TABLE!";var R=u.rows[0];"credit card"==o.toLowerCase()?u.style.width="25%":u.style.width="Age"==I||"Birth Year"==I?"20%":"Middle Initial"==I||"Last Name"==I||"Name Suffix"==I?"97%":"80%";var D=u.rows[1],A=!1;if(f&&C&&f!=C&&(A=!0),C&&D){var y=document.createElement("td");if(A){var N=document.createElement("td");D.appendChild(N)}y.className="rf_identity_lower_row_td",y.style.paddingLeft="3px",y.innerText=C,D.appendChild(y),u.style.marginBottom="3px"}if(f&&f!=C){var L=document.createElement("td");L.className="rf_identity_table_td_capton_next";var P=document.createElement("div");P.className="rf_identity_table_td_div_capton_next",C&&"/"==f&&(P.style.marginLeft="1px",P.style.width="5px"),P.innerText=f||T.FieldName,P.setAttribute("title",f||T.FieldName),L.appendChild(P),R.appendChild(L)}var O=document.createElement("td");if(O.style.paddingLeft="3px",S&&1==S.m_VType){var b=this.EditIdentityDlg_CreateHtmlElement("select","rf_identity_table_select",o,I,v,t,T);O.appendChild(b),this.EditIdentityDlg_SelectSetValue(b,v)}else{var G=this.EditIdentityDlg_CreateHtmlElement("input","rf_identity_table_input",o,I,v,t,T);if(S.m_nMaxLength>0){var M=S.m_nMaxLength*SYMBOL_WIDTH+2;O.style.width=M+"px"}O.appendChild(G)}R.appendChild(O)}else{var w=this.createElement("tr",{});E.appendChild(w);var x=this.createElement("td",{class:"rf_identity_table_td_capton"}),F=this.createElement("div",{class:"rf_identity_table_td_div_capton"});"Location"==o&&"Country"==I&&(F.style.color="Grey"),F.innerText=f||T.FieldName,F.setAttribute("title",f||T.FieldName),x.appendChild(F),w.appendChild(x);var k=this.createElement("tr",{}),B=this.createElement("td",{class:"rf_identity_table_td_value"}),H=this.createElement("table",{class:"rf_identity_td_value_innerTable",cellpadding:0,cellspacing:0});B.appendChild(H),u=H;var U=this.createElement("tr",{class:"rf_identity_upper_row"});if(H.appendChild(U),C){var W=this.createElement("tr",{class:"rf_identity_lower_row"});H.appendChild(W);var V=this.createElement("td",{class:"rf_identity_lower_row_td"});V.innerText=C,W.appendChild(V)}var Y=document.createElement("td");if(S&&1==S.m_VType)if("Location"==o&&"Country"==I){G=this.EditIdentityDlg_CreateHtmlElement("input","rf_identity_table_input",o,I,v,t,T);Y.appendChild(G)}else{b=this.EditIdentityDlg_CreateHtmlElement("select","rf_identity_table_select",o,I,v,t,T);Y.appendChild(b),this.EditIdentityDlg_SelectSetValue(b,v)}else{G=this.EditIdentityDlg_CreateHtmlElement("input","rf_identity_table_input",o,I,v,t,T);if(S.m_nMaxLength>0){M=S.m_nMaxLength*SYMBOL_WIDTH+10;Y.style.width=M+"px"}Y.appendChild(G)}U.appendChild(Y),k.appendChild(B),E.appendChild(k)}}}}if(m){var J=document.createElement("tr");(x=document.createElement("td")).className="rf_identity_table_td_capton",(F=document.createElement("div")).className="rf_identity_table_td_div_capton",F.innerText=localeString("PassCards_Note"),F.setAttribute("title",localeString("PassCards_Note")),x.appendChild(F),J.appendChild(x);var X=document.createElement("tr"),j=document.createElement("td");j.className="rf_identity_table_td_value",j.appendChild(m),X.appendChild(j),E.appendChild(J),E.appendChild(X)}if("Custom"==o){var K=n.GetCustomValuesCount(),z=document.createElement("tr");z.id="identity_customfieldsRow_labels";var q=document.createElement("td");q.innerText=localeString("HtmlControl_FieldMatch_ColumnHeader"),z.appendChild(q),(q=document.createElement("td")).innerText=localeString("HtmlControl_FieldValue_ColumnHeader"),z.appendChild(q),(q=document.createElement("td")).innerText=localeString("HtmlControl_FieldMatchStrings_ColumnHeader"),z.appendChild(q),E.appendChild(z);for(var Z=K<MIN_CUSTOM_FIELDS_COUNT?MIN_CUSTOM_FIELDS_COUNT:K+1,ee=0;ee<Z;ee++){var te=ee<K?n.GetCustomField(ee):null;this.EditIdentityDlg_CreateCustomFieldRow(te,E,n)}}_.appendChild(E),a&&a.appendChild(r)}catch(e){Q("EXCEPTION in IdentityEditorAddGroup:"+e.toString())}},e.prototype.EditIdentityDlg_SelectSetValue=function(e,t){for(var n=-1,i=0;i<e.options.length;i++){if(e.options[i].value==t){n=i;break}}e.selectedIndex=n,e.setAttribute("setSelectedIndex",n+"")},e.prototype.EditIdentityDlg_AddCustomField_Click=function(){var e=$(IDENTITY_DLG_CUSTOM_TBL_ID);if(!(e.rows.length>MAX_CUSTOM_FIELDS_COUNT)){var t=$("#"+IDENTITY_DLG_PAGECONTDIV_ID).data("rfObject");this.EditIdentityDlg_CreateCustomFieldRow(null,e,t.m_FieldSet)}},e.prototype.EditIdentityDlg_CreateCustomFieldRow=function(e,t,n){var i=this.createElement("tr",{class:"custom_field_row"}),o=this.createElement("td",{}),a=e?e.FieldName:"",r=this.createElement("input",{value:a,class:"custom_field_singletextbox",isCustom:"true"});r.value=a,o.appendChild(r),i.appendChild(o),o=this.createElement("td",{});var s=e?e.GetValue(n,"Main"):"",l=this.createElement("input",{value:a,class:"custom_field_singletextbox",isCustom:"true"});l.value=s,o.appendChild(l),i.appendChild(o);var c=e?e.GetFieldFormat().GetMatchesString():"";c=c.split("; ").join("\n"),o=this.createElement("td",{colspan:"1"});var _=this.createElement("textarea",{multiline:"true",class:"custom_field_multitextbox",isCustom:"true",flex:"1",value:c});o.appendChild(_),i.appendChild(o),t.appendChild(i)},e.prototype.EditIdentityDlg_CreateHtmlElement=function(e,t,n,i,o,a,r){var s=r.m_FieldFormat,l=document.createElement(e);if("input"==e||"select"==e)if(l.setAttribute(IDFIELD_NAME_ATTR,i),l.setAttribute(IDFIELD_VALUE_ATTR,o),l.setAttribute(IDFIELD_INDEX_ATTR,r.m_nFieldIndex),l.setAttribute(IDFIELD_GROUPTYPE_ATTR,n),l.setAttribute(IDFIELD_INSTANCE_ATTR,a),l.setAttribute(IDFIELD_CUSTOM_ATTR,"false"),l.className=t,"Location"==n&&"Country"==i&&(l.setAttribute("readonly",!0),l.style.color="Grey"),"input"==e){if(l.setAttribute("value",o),s.m_nMaxLength>0){var c=s.m_nMaxLength*SYMBOL_WIDTH;l.style.width=c+"px",l.style.minWidth=c+"px",l.setAttribute("maxlength",s.m_nMaxLength)}}else{var _=document.createElement("option");_.setAttribute("label",""),_.setAttribute("value",""),_.setAttribute("class","identity_field_select_option"),_.text="",l.add(_,null);for(var d=0;d<s.m_lOptions.length;d++){var E=document.createElement("option"),u=s.m_lOptions[d].m_sMainValue;u="{UserDefinedShort}"==(u="{UserDefined}"==u?"(Unlisted)":u)?"(Unl)":u,E.setAttribute("label",u),E.setAttribute("value",u),E.setAttribute("class","identity_field_select_option"),E.text=u,l.add(E,null)}}return l},e.prototype.ShowIdentityEditorTab=function(e){var t,n,i=$(e.replace(new RegExp("pane"),"tab")),o=$(ID_DLG_TABS_DIV);for(t=0;t<o.childNodes.length;t++)(n=o.childNodes[t]).getAttribute("class")&&this.SetElementStyles(n,{background:"#DCDFE6",border:"1px solid #aaa","border-bottom":"1px solid grey"});this.SetElementStyles(i,{background:"#fff",border:"1px solid grey","border-bottom":"1px solid white"});var a=$("ff_content");for(t=0;t<a.childNodes.length;t++)n=a.childNodes[t],this.SetElementStyles(n,{display:"none"});var r=i.getAttribute("groupname");return $("pane"+r).style.display="block",this.g_ff_selectedtabid=e,!1},e.prototype.SetElementStyles=function(e,t){return t?(forEachOwnProp(t,function(t,n){e.style[n]=t}),e):e},e.prototype.LoadIdentityWithIntellect=function(e,t){for(var n,i,o,a,r,s,l=e[ID_OPTIONS_PROP],c=(t[RFTYPE_PROPERTY],EnRfDataItemType.RfItemType_Contact,new RfapiJS.CIdentity(l)),_=e[ID_GROUPS_PROP],d=0;d<_.length;++d){var E=_[d],u=E[ITEM_NAME_PROP],p=E[ID_INSTANCES_PROP];if(u==GROUP_CUSTOMFIELDS)for(i=(n=p[0])[ITEMDATA_FIELDS_PROP],o=0;o<i.length;o++){r=(a=i[o])[ITEM_NAME_PROP],s=a[FIELD_VALUE_PROP];var m=a[ID_OPTIONS_PROP],g=-1!=m.indexOf(";");c.AddCustomFieldValue(r,m,s,g)}else{for(var I=!1,T=0;T<p.length;T++){var S=(n=p[T])[ITEM_NAME_PROP];if("Main"==S&&(I=!0),i=n[ITEMDATA_FIELDS_PROP],n.d&&c.SetDefaultInstanceName(u,S),i.length)for(o=0;o<i.length;o++)r=(a=i[o])[ITEM_NAME_PROP],s=a[FIELD_VALUE_PROP],c.AddStandardFieldValue(r,s,S,u);else c.AddInstanceForGroup(u,S)}I||c.RemoveInstanceForGroup(u,"Main")}}return c},e.prototype.SaveIdentity=function(){$("rfIdentitysection_err_msg").innerHTML="";var e=this.m_navigator.GetCurrentContext(),t=e.item_info,n=e.item_data,i=e.item_data_initial;ObjectToArray(n);var o,a=$("page_content_div"),r=a.getElementsByTagName("select");for(o=0;o<r.length;o++)this.PutIdentityValues(r[o],n);var s=a.getElementsByTagName("input");for(o=0;o<s.length;o++)this.PutIdentityValues(s[o],n);var l,c=a.getElementsByTagName("textarea");for(o=0;o<c.length;o++)this.PutIdentityValues(c[o],n);if(t[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Identity){var _,d=!1;for(o=0;o<n[ID_GROUPS_PROP].length;o++)if((l=n[ID_GROUPS_PROP][o])[ITEM_NAME_PROP]==GROUP_CUSTOMFIELDS){d=!0,l[ID_INSTANCES_PROP][0][ITEMDATA_FIELDS_PROP]=[],_=o;break}if(!d){var E={};E[ITEM_NAME_PROP]=GROUP_CUSTOMFIELDS,E[ID_INSTANCES_PROP]=[];var u={};u[ITEMDATA_FIELDS_PROP]=[],E[ID_INSTANCES_PROP].push(u),n[ID_GROUPS_PROP].push(E)}for(_=-1,o=0;o<n[ID_GROUPS_PROP].length;o++)if((l=n[ID_GROUPS_PROP][o])[ITEM_NAME_PROP]==GROUP_CUSTOMFIELDS){_=o;break}var p=$(IDENTITY_DLG_CUSTOM_TBL_ID);if(p){var m=p.rows;for(o=0;o<m.length;o++){var g=m[o];if(!g.getAttribute("id")||"identity_customfieldsRow_labels"!=g.getAttribute("id")){var I=g.children,T=I[0].firstChild.value,S=I[1].firstChild.value,f=I[2].firstChild.value;f=f.split(String.fromCharCode(10)).join("; ");var h={};h[ITEM_NAME_PROP]=T,h[FIELD_VALUE_PROP]=S,h[ID_OPTIONS_PROP]=f,""!=T&&""!=S&&n[ID_GROUPS_PROP][_][ID_INSTANCES_PROP][0][ITEMDATA_FIELDS_PROP].push(h)}}}}var C=this;q(!0,void 0,[IDENTITY_DLG_OKBTN_ID,IDENTITY_DLG_CANCELBTN_ID],IDENTITY_DLG_OKBTN_ID);var v={};v.fileData=JSON.parse(i),v[ITEM_PROPERTY]=n,v[RFTYPE_PROPERTY]=t[RFTYPE_PROPERTY],v[PATH_PROPERTY]=t[PATH_PROPERTY],v.used=!0,setTimeout(function(){var e=JSON.stringify(v);getProxyRfo().PutDataItem(e,function(e){visibilityEffect($(MAINSCREEN_DIV),[5,7,10]),$("loading_circle").style.display="none",C.ResponseSaveItem(e,"rfIdentitysection_err_msg",IDENTITY_DLG_OKBTN_ID,IDENTITY_DLG_CANCELBTN_ID)},C.ShowProgressIndicator)},10)},e.prototype.PutIdentityValues=function(e,t){var n;if("true"==e.getAttribute(IDFIELD_CUSTOM_ATTR))return!1;if(!(n=e.getAttribute(IDFIELD_NAME_ATTR)))return!1;var i=e.value;if(e.getAttribute(IDFIELD_VALUE_ATTR)==i)return!1;n=e.getAttribute(IDFIELD_NAME_ATTR);for(var o,a,r=e.getAttribute(IDFIELD_INSTANCE_ATTR),s=e.getAttribute(IDFIELD_GROUPTYPE_ATTR),l=t[ID_GROUPS_PROP],c=!1,_=-1,d=-1,E=0;E<l.length;E++){var u=l[E];if(s==u[ITEM_NAME_PROP]){_=E;for(var p=u[ID_INSTANCES_PROP],m=0;m<p.length;m++){if(r==(o=p[m])[ITEM_NAME_PROP]){d=m;for(var g=o[ITEMDATA_FIELDS_PROP],I=0;I<g.length;I++){var T=g[I];if(n==T[ITEM_NAME_PROP]){c=!0,T[FIELD_VALUE_PROP]=i;break}}}}}}if(!c)if(-1!=_)(a={})[ITEM_NAME_PROP]=n,a[FIELD_VALUE_PROP]=i,t[ID_GROUPS_PROP][_][ID_INSTANCES_PROP][d][ITEMDATA_FIELDS_PROP].push(a);else{var S={};S[ITEM_NAME_PROP]=s,S[ID_INSTANCES_PROP]=[],(o={})[ITEM_NAME_PROP]="Main",o[ITEM_ISDEFAULT_PROP]=!0,o[ITEMDATA_FIELDS_PROP]=[],(a={})[ITEM_NAME_PROP]=n,a[FIELD_VALUE_PROP]=i,o[ITEMDATA_FIELDS_PROP].push(a),S[ID_INSTANCES_PROP].push(o),t[ID_GROUPS_PROP].push(S)}return!0},e.prototype.ResponseSaveItem=function(e,t,n,i){var o=this;$(t).innerHTML="";var a=JSON.parse(e);q(!1,void 0,[n,i],null),o.CheckGlobalErrorResponse(a)?$(t).innerHTML=a.error.description:setTimeout(function(){if(o.m_oAccountInfo&&o.m_oAccountInfo.oneFile){var e={},n=a[CONTEXT_PROPERTY].fileData;e.fileData=n,e[PATH_PROPERTY]=a[CONTEXT_PROPERTY][PATH_PROPERTY],e[ITEM_PROPERTY]=a[CONTEXT_PROPERTY][ITEM_PROPERTY],setTimeout(function(){var n=JSON.stringify(e);getProxyRfo().GetIdenticalFiles(n,function(e){var n=JSON.parse(e);if(o.CheckGlobalErrorResponse(n))$(t).innerHTML=n.error.description;else{var i=n[ITEMS_PROPERTY];!i||!i.length||1==i.length&&i[0].current?o.m_navigator.GoBack():(o.m_navigator.GoBack(),o.ShowIdenticalFilesDialog(n[ITEMS_PROPERTY],n[CONTEXT_PROPERTY][ITEM_PROPERTY],o.EnObjectAction.Edit))}})},10)}else o.m_navigator.GoBack()},10)},e.prototype.ShowPasswordGeneratorDialog=function(){var e=this,t=new ViewItem(void 0,void 0,"header-simple-title");t.m_oContext={title:localeString("ContextMenuAndShortcuts_RunPassGen_Text")};var n=e.CreateUIItem(t),i=new ViewItem("rfpassword_generator_div",void 0,"dialog"),o=e.CreateUIItem(i);e.m_navigator.Navigate({name:"Password Generator",views:[n,o],initialize:function(t){e.InitPasswordGeneratorDialog(t)}})},e.prototype.AddPasswordGeneratorListeners=function(){$(PWGGEN_GENERATE_BTN_ID)&&$(PWGGEN_GENERATE_BTN_ID).addEventListener("click",function(){PassGenDlg_SaveDlgSettings(),PassGenDlg_GeneratePassword(!0)},!1),$(PWDGEN_COPYBTN_ID)&&$(PWDGEN_COPYBTN_ID).addEventListener("click",function(){PassGenDlg_SaveDlgSettings(),PassGenDlg_CopyToClipboard()},!1),$(PWDGEN_FILLBTN_ID)&&$(PWDGEN_FILLBTN_ID).addEventListener("click",function(){PassGenDlg_SaveDlgSettings(),PassGenDlg_FillPassword()},!1),$(PWGGEN_SYMBNUMBER_ID),$(PWGGEN_UPPERCASE_CHK_ID)&&$(PWGGEN_UPPERCASE_CHK_ID).addEventListener("click",PassGenDlg_CheckBoxOnClick,!1),$(PWGGEN_LOWERCASE_CHK_ID)&&$(PWGGEN_LOWERCASE_CHK_ID).addEventListener("click",PassGenDlg_CheckBoxOnClick,!1),$(PWGGEN_DIGITS_CHK_ID)&&$(PWGGEN_DIGITS_CHK_ID).addEventListener("click",PassGenDlg_CheckBoxOnClick,!1),$(PWGGEN_SPECSYMBOLS_CHK_ID)&&$(PWGGEN_SPECSYMBOLS_CHK_ID).addEventListener("click",PassGenDlg_SpecCharsCheckBoxOnClick,!1),$(PWGGEN_SPECSYMBOLS_TEXT_ID)&&($(PWGGEN_SPECSYMBOLS_TEXT_ID).addEventListener("keydown",PassGenDlg_CharsInputOnKeyDown,!1),$(PWGGEN_SPECSYMBOLS_TEXT_ID).addEventListener("paste",PassGenDlg_CharsInput_Paste,!1)),$(PWGGEN_HEX_CHECK_ID)&&$(PWGGEN_HEX_CHECK_ID).addEventListener("click",PassGenDlg_HexCheckBoxOnClick,!1),$(PWGGEN_PWDVALUE_TEXT_ID).addEventListener("change",function(e){PassGenDlg_SelectOnChange(e)},!1),$("rf_passgen_advanced_details").addEventListener("toggle",function(e){var t=$("rf_passgen_advanced_details").getAttribute("open");PutSetting("sa-generator","rf_pwd_generate_avdsection_open",null!=t)},!1)},e.prototype.InitPasswordGeneratorDialog=function(){try{GetSetting("sa-generator","rf_pwd_generate_avdsection_open")?$("rf_passgen_advanced_details").setAttribute("open","open"):$("rf_passgen_advanced_details").removeAttribute("open"),this.AddPasswordGeneratorListeners(),$(PWGGEN_ERRORMSG_TD_ID).innerHTML="";var e=GetSetting("sa-generator","rf_pwd_generate_special_chars");e=e||"!@#$%^&",$(PWGGEN_SYMBNUMBER_ID).value=parseInt(GetSetting("sa-generator","rf_pwd_generate_number_symbols")),$(PWGGEN_UPPERCASE_CHK_ID).checked=parseInt(GetSetting("sa-generator","rf_pwd_generate_upper_chk")),$(PWGGEN_LOWERCASE_CHK_ID).checked=parseInt(GetSetting("sa-generator","rf_pwd_generate_lower_chk")),$(PWGGEN_DIGITS_CHK_ID).checked=parseInt(GetSetting("sa-generator","rf_pwd_generate_digits_chk")),$(PWGGEN_SPECSYMBOLS_CHK_ID).checked=parseInt(GetSetting("sa-generator","rf_pwd_generate_specialsymb_chk")),$(PWGGEN_SIMILAR_CHECK_ID).checked=parseInt(GetSetting("sa-generator","rf_pwd_generate_excludesimilar_chk")),$(PWGGEN_HEX_CHECK_ID).checked=parseInt(GetSetting("sa-generator","rf_pwd_generate_onlyhexvalues_chk")),$(PWGGEN_SPECSYMBOLS_TEXT_ID).value=e,PassGenDlg_SpecCharsCheckBoxOnClick(),$(PWGGEN_COPY_CLIP_CHK_ID).checked=GetSetting("sa-generator","rf_pwd_generate_copycliboardp_chk"),$(PWGGEN_GENERATE_BTN_ID).removeAttribute("disabled"),PassGenDlg_HexCheckBoxOnClick(),PassGenDlg_GeneratePassword(!1)}catch(e){Q("EXCEPTION in InitPasswordGeneratorDialog:"+e)}};function Q(){console_output("PT: "+format_log_args(Q.caller,arguments))}return e}();Clipboard={},Clipboard.createTextArea=function(e){try{var t=document.createElement("textarea");return t.style.position="absolute",t.style.left="-100%",null!=e&&(t.innerText=e),document.body.appendChild(t),t}catch(e){return log("EXCEPTION in Clipboard.createTextArea:"+e.toString()),null}},Clipboard.copy=function(e){try{if(null==e)return;""==e&&(e=" ");var t=Clipboard.createTextArea(e);if(null==t)return;t.select(),document.execCommand("Copy"),document.body.removeChild(t)}catch(e){log("EXCEPTION in Clipboard.copy:"+e.toString())}},Clipboard.paste=function(){try{var e=Clipboard.createTextArea();if(null==e)return null;e.focus(),document.execCommand("Paste");var t=e.innerText;return document.body.removeChild(e),t}catch(e){return log("EXCEPTION in Clipboard.paste:"+e.toString()),null}};
//# sourceMappingURL=popup-sa.js.map