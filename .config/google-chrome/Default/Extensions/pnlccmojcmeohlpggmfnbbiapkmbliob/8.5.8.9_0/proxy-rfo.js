// Copyright (C) 1999-2019 Siber Systems Inc. All Rights Reserved.
function ProxyRfo(){this.g_username=void 0,this.g_accountpwd=void 0,this.g_masterpwd=void 0,this.m_aAccountMode=RfapiJS.accountMode,this.g_list_updating=!1,this.m_cache=new RFCacheManager,this.m_proxy=void 0,this.m_bLocal=!1,this.m_bRfApi=!1,this.m_domain_match=void 0,this.m_options=void 0,this.m_bCompanyAdmin=!1,this.m_bOneFile=!1,this.m_bEnterprise=!1}ProxyRfo.prototype.LoadUserData=function(){var e=GetSetting("sa-user","rf_username");this.g_username=e,this.g_accountpwd=decryptAccountPwd(GetSetting("sa-user","rf_accpwd"),e),this.g_masterpwd=decryptAccountPwd(GetSetting("sa-user","rf_masterpwd"),e)},ProxyRfo.prototype.GetReceivedData=function(e,t){var r=JSON.parse(e);getReceivedData_async({},function(e){var o={};o.receivedData=e,o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.CreateSharedAccount=function(e,t){var r=JSON.parse(e);createSharedAccount_async(r,function(e){var o={};o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.AcceptSharedAccount=function(e,t){var r=JSON.parse(e),o=r.sharedAccountId,n={};n.sharedAccountId=o,acceptSharedAccount_async(n,function(e,o){var n={};n[CONTEXT_PROPERTY]=r,n.accounts=o,t(JSON.stringify(n))},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r,t(JSON.stringify(i))})},ProxyRfo.prototype.RejectSharedAccount=function(e,t){var r=JSON.parse(e),o=r.sharedAccountId,n={};n.sharedAccountId=o,rejectSharedAccount_async(n,function(e,o){var n={};n[CONTEXT_PROPERTY]=r,n.accounts=o,t(JSON.stringify(n))},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r,t(JSON.stringify(i))})},ProxyRfo.prototype.GrantSharedAccount=function(e,t){var r=JSON.parse(e);grantSharedAccount_async(r,function(e){var o={};o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.RevokeSharedAccount=function(e,t){var r=JSON.parse(e),o=r.sharedAccountId,n=r.recipient,i=r.bKeep,a={};a.sharedAccountId=o,a.recipient=n,a.bKeep=i;revokeSharedAccount_async(a,function(e){var o={};o[CONTEXT_PROPERTY]=r,t(JSON.stringify(o))},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r,t(JSON.stringify(i))})},ProxyRfo.prototype.GetRecipientsForSharedAccount=function(e,t){var r=JSON.parse(e),o={};o.sharedAccountId=r.sharedAccountId;getRecipientsForSharedAccount_async(o,function(e){var o={};o[ITEMS_PROPERTY]=e,o[CONTEXT_PROPERTY]=r,t(JSON.stringify(o))},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r,t(JSON.stringify(i))})},ProxyRfo.prototype.GrantFile=function(e,t){var r=JSON.parse(e);grantSharedFile_async(r,function(e,o){var n={};n[CONTEXT_PROPERTY]=r,o&&(n.fileId=o);var i=JSON.stringify(n);t(i)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.GetSharedFileUsers=function(e,t){var r=JSON.parse(e);getSharedFileUsersInfo_async(r,function(e){var o={};o[CONTEXT_PROPERTY]=r,o[ITEMS_PROPERTY]=e;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.GetSharedFiles=function(e,t){var r=JSON.parse(e);getSharedFiles_async(r,function(e){var o={};o[CONTEXT_PROPERTY]=r,o[ITEMS_PROPERTY]=e;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.RevokeSharedFile=function(e,t){var r=JSON.parse(e);revokeSharedFile_async(r,function(e){var o={};o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.RejectSharedFile=function(e,t){var r=JSON.parse(e);rejectSharedFile_async(r,function(e){var o={};o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.AcceptSharedFile=function(e,t){var r=JSON.parse(e);acceptSharedFile_async(r,function(e){var o={};o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})},ProxyRfo.prototype.GetIdenticalFiles=function(e,t,r){var o=JSON.parse(e);getIdenticalFiles_async(o,function(e){var r={};r[CONTEXT_PROPERTY]=o,r[ITEMS_PROPERTY]=e;var n=JSON.stringify(r);t(n)},function(e,r,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,i[CONTEXT_PROPERTY]=o;var a=JSON.stringify(i);t(a)},r)},ProxyRfo.prototype.PutIdenticalFiles=function(e,t,r){var o=JSON.parse(e),n=this;putIdenticalFiles_async(o,function(e){var r=o.itemsDelete;if(r.length){n.m_cache.ClearSearchList();for(var i=r[0].substr(r[0].lastIndexOf(".")),a=RfapiJS.utils.FileExtToType(i),s=0;s<r.length;s++){var p={};p.path=r[s],p.type=a,g_HistoryMgr.removeItem(p)}}switch(o.action){case 0:case 2:break;case 1:n.m_cache.ClearSearchList();var c=o.itemsUpdate;i=c[0].substr(c[0].lastIndexOf("."));if((a=RfapiJS.utils.FileExtToType(i))==EnRfDataItemType.RfItemType_Login||a==EnRfDataItemType.RfItemType_Bookmark||a==EnRfDataItemType.RfItemType_Contact||a==EnRfDataItemType.RfItemType_Identity||a==EnRfDataItemType.RfItemType_Safenote)for(s=0;s<c.length;s++){var f={};f.path=c[s],f.type=a,g_HistoryMgr.removeItem(f);var _=c[s].substr(0,c[s].lastIndexOf("/")+1)+o.data+i,R={};R.path=_,R.type=a,g_HistoryMgr.pushItem(R)}}var m={};m[CONTEXT_PROPERTY]=o;var u=JSON.stringify(m);t(u)},function(e,r,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,i[CONTEXT_PROPERTY]=o;var a=JSON.stringify(i);t(a)},r)},ProxyRfo.prototype.JoinCompany=function(e){return new Promise(function(t,r){g_jsApiMgr.JoinCompany(e.companyId,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.LeaveCompany=function(e){return new Promise(function(t,r){g_jsApiMgr.LeaveCompany(e.companyId,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.GetLicenseUrl=function(e){return new Promise(function(t,r){g_jsApiMgr.GetLicensingUrlFromServer(e,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.InviteEmergencyContact=function(e){return new Promise(function(t,r){g_jsApiMgr.InviteEmergencyContact(e.contact,e.timeoutDays,function(e){t(e)},function(e){r(e)},e.timeoutSecs,e.note,e.invite)})},ProxyRfo.prototype.UpdateEmergencyContact=function(e){return new Promise(function(t,r){g_jsApiMgr.UpdateEmergencyContactInfo(e.contact,function(e){t(e)},function(e){r(e)},e.timeoutDays,e.timeoutSecs,e.note)})},ProxyRfo.prototype.RevokeEmergencyContact=function(e){return new Promise(function(t,r){g_jsApiMgr.RevokeEmergencyContact(e.contact,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.GetEmergencyContacts=function(){return new Promise(function(e,t){g_jsApiMgr.GetEmergencyContacts(function(t){e(t)},function(e){t(e)})})},ProxyRfo.prototype.GetTestators=function(){return new Promise(function(e,t){g_jsApiMgr.GetTestators(function(t){e(t)},function(e){t(e)})})},ProxyRfo.prototype.AcceptEmergencyContactInvitation=function(e){return new Promise(function(t,r){g_jsApiMgr.AcceptEmergencyContactInvitation(e.testator,function(e){t(e)},function(e){r(e)},e.acceptCode)})},ProxyRfo.prototype.RejectEmergencyContactInvitation=function(e){return new Promise(function(t,r){g_jsApiMgr.RejectEmergencyContactInvitation(e.testator,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.RevokeEmergencyAccess=function(e){return new Promise(function(t,r){g_jsApiMgr.RevokeEmergencyAccess(e.contact,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.GrantEmergencyAccess=function(e){return new Promise(function(t,r){g_jsApiMgr.GrantEmergencyAccess(e.contact,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.RejectEmergencyAccess=function(e){return new Promise(function(t,r){g_jsApiMgr.RejectEmergencyAccess(e.owner,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.RequestEmergencyAccess=function(e){return new Promise(function(t,r){g_jsApiMgr.RequestEmergencyAccess(e.owner,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.GetTrustedUserData=function(e){return new Promise(function(t,r){g_jsApiMgr.GetTrustedUserData(e.owner,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.PutDataToFolder=function(e){return new Promise(function(t,r){g_jsApiMgr.PutDataToFolder(e.data,e.path,function(e,r){t({status:e,report:r})},function(e){r(e)})})},ProxyRfo.prototype.GetUserCompanies=function(){return new Promise(function(e,t){g_jsApiMgr.GetCompanies(function(t){e(t)},function(e){t(e)})})},ProxyRfo.prototype.GetCompanyMembers=function(e){return new Promise(function(t,r){g_jsApiMgr.GetCompanyUsers(e.company,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.GetUserCompaniesMembers=function(){var e=this;return new Promise(function(t,r){e.GetUserCompanies().then(function(r){var o=r.companies,n=[];0===o.length&&t(n);for(var i=[],a=0;a<o.length;a++)i.push(e.GetCompanyMembers({company:o[a].companyId}));Promise.all(i).then(function(e){for(var r=0;r<e.length;r++)n=n.concat(e[r].users);t(n)})}).catch(function(e){r(e)})})},ProxyRfo.prototype.GetSecurityInfo=function(e){return new Promise(function(t,r){g_jsApiMgr.GetAccountSecurityInfo(e,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.LoginToRFOAccount=function(e){var t=this,r=GetSetting("internal","active-server");FindTabWithUrl(e?r+"/site/account*":r+"/login?authReturnUrl=rfss",function(o){if(o)ActivateTab(o);else{var n=e?r+"/login":r+"/login?authReturnUrl=rfss&lang="+window.navigator.language,i={};i[RfapiJS.ITEM_GOTOURL_PROP]=n,i[RfapiJS.ITEM_MATCHURL_PROP]=n;var a=[],s={};s[RfapiJS.ITEM_NAME_PROP]="username",s.i=0,s[RfapiJS.FIELD_TYPE_PROP]=1,s[RfapiJS.ITEM_ISDEFAULT_PROP]=!1,s[RfapiJS.FIELD_CAPTION_PROP]="",s.id="username",s[RfapiJS.FIELD_VALUE_PROP]=t.g_username,a.push(s);var p={};p[RfapiJS.ITEM_NAME_PROP]="password",p.i=0,p[RfapiJS.FIELD_TYPE_PROP]=2,p[RfapiJS.ITEM_ISDEFAULT_PROP]=!1,p[RfapiJS.FIELD_CAPTION_PROP]="",p.id="password",p[RfapiJS.FIELD_VALUE_PROP]=t.g_accountpwd,a.push(p),i[RfapiJS.ITEMDATA_FIELDS_PROP]=a,FindTabWithUrl(n,function(e){e?ActivateTab(e).then(function(e){var t=RfMakeFillerDataJSON(null,i,!0,!1,!1,!0,!0,!0,!0),r=JSON.stringify(t),o=getRF().FindTabBrowser(e.id);o&&o.forEachGoodFrame(function(e){e.FillFormsInFrame(r)})}):(t.m_cache.ClearGoFillGlobal(),t.m_cache.SetGoFillGlobal(!0,!0,n,"",1,i),OpenRoboFormURL(n))})}})},ProxyRfo.prototype.CheckUserStatus=function(){var e=this;return new Promise(function(t,r){if(!e.g_username){var o={};return o[JSON_MSG_CODE]=401,o[JSON_MSG_DESCRIPTION]="",void r(o)}var n={};n[USERNAME_PROPERTY]=e.g_username,checkLoginDataStatus_async(n,function(r){var o={};o.accountInfo=r;var n=r&&r.oneFile,i=r&&r.email;e.Init(r),e.g_masterpwd&&n&&i&&SetTimeout(function(){updateSecurityScore_async(r,function(e){},function(e){})},2e3);var a=JSON.stringify(o);t(a)},function(t,o,i){if(t==Err_NeedOTP&&e.g_username&&e.g_accountpwd)return(a={}).user=e.g_username,a.password=e.g_accountpwd,a.otp_channel="-",void loginToAccount_async(a,function(){},function(e,t,o){var i={};i[JSON_MSG_CODE]=e,i[JSON_MSG_DESCRIPTION]=t,i.params=n,o&&(o.Channel&&(i.params.Channel=o.Channel),void 0!==o.Memorize&&(i.params.Memorize=o.Memorize)),r(i)});var a,s={};s[JSON_MSG_CODE]=t,s[JSON_MSG_DESCRIPTION]=o,s.params=n,i&&i.Channel&&(s.params.Channel=i.Channel),r(s)})})},ProxyRfo.prototype.GetUserName=function(){return this.g_username},ProxyRfo.prototype.GetMasterPassword=function(){return this.g_masterpwd},ProxyRfo.prototype.GetAccountPassword=function(){return this.g_accountpwd},ProxyRfo.prototype.IsMasterPasswordCorrect=function(e){if(g_jsApiMgr.getAccountMode()==this.m_aAccountMode.MULTIFILE)return{result:!0};var t=!0,r="",o=e.length,n=g_policySet.GetConfigValue(ConfigMasterPasswordMinLength),i=g_policySet.GetConfigValue(ConfigMasterPasswordMaxLength);(o<n||o>i)&&(r=format(localeString("MasterPass_New_Length_Error"),n,i),t=!1),e.trim()||(r+=(""==r?"":"<br/>")+localeString("MasterPass_New_BlanksOnly_Error"),t=!1);for(var a=0,s=0,p=0,c=0;c<o;c++)e[c]>="0"&&e[c]<="9"&&p++,IsLetter(e[c])&&(IsWCharUpper(e[c])&&a++,IsWCharLower(e[c])&&s++);var f=g_policySet.GetConfigValue(ConfigMasterPasswordMinUpperCaseChars),_=g_policySet.GetConfigValue(ConfigMasterPasswordMinLowerCaseChars),R=g_policySet.GetConfigValue(ConfigMasterPasswordMinDigitChars),m=g_policySet.GetConfigValue(ConfigMasterPasswordMinNonNumChars);return a<f&&(r+=(""==r?"":"<br/>")+format(localeString("MasterPass_New_UpperCaseChars_Error"),f),t=!1),s<_&&(r+=(""==r?"":"<br/>")+format(localeString("MasterPass_New_LowerCaseChars_Error"),_),t=!1),p<R&&(r+=(""==r?"":"<br/>")+format(localeString("MasterPass_New_DigitChars_Error"),R),t=!1),o-p<m&&(r+=(""==r?"":"<br/>")+format(localeString("MasterPass_New_NonNumChars_Error"),m),t=!1),t?{result:t}:{result:t,reason:r}},ProxyRfo.prototype.ChangeAccountPassword=function(e,t,r,o){var n=this,i=JSON.parse(e),a=i[USERNAME_PROPERTY];changeAccountPassword_async(i,function(){g_jsApiMgr.GetAccountInfo(a,function(e){if(e.syncAllowed){var o=e.oneFile;g_policySet.ParseBlob(e.policies),g_policySet.g_passwordExpired=!!e.passwordExpired&&e.passwordExpired,g_policySet.g_forcePasswordChange=!!e.forcePasswordChange&&e.forcePasswordChange,g_policySet.g_passwordAgeDays=void 0!==e.passwordAgeDays?e.passwordAgeDays:-1,g_policySet.g_passwordDaysLeft=void 0!==e.passwordDaysLeft?e.passwordDaysLeft:1e4,o=void 0!==o&&o,g_jsApiMgr.setAccountMode(o?n.m_aAccountMode.OFS:n.m_aAccountMode.MULTIFILE);var i=JSON.stringify({});t(i)}else r({code:ERR_SYNC_NOT_ALLOWED,description:n.GetLicenseNotificationStatus(e)})},function(e){var t=JSON.stringify(e);r(t)})},function(e,t,o){var n={};n[JSON_MSG_ERROR]={},n[JSON_MSG_ERROR][JSON_MSG_CODE]=e,n[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=t,n.params=o;var i=JSON.stringify(n);r(i)},o)},ProxyRfo.prototype.GetLicenseNotificationStatus=function(e){e&&e.oneFile;if(e.suspended)return format(localeString("RFOSetup_SuspendedAccount_Error"),e.accountId)+". "+localeString("LicenseExpirationWarning_SelfAdv_EnterpriseCaption");if(e.enterpriseLicenseExpired)return localeString("LicenseExpirationWarning_EnterpriseExpired_Title")+". "+localeString("LicenseExpirationWarning_SelfAdv_EnterpriseCaption");if(e.enterpriseLicenseExceeded)return localeString("LicenseExceededWarning_EnterpriseExceeded_Title")+". "+localeString("LicenseExpirationWarning_SelfAdv_EnterpriseCaption");if(e.licenseExpired){var t=e.licenseExpiresInDays?e.licenseExpiresInDays:"";return format(localeString("AccountLicenseStatus_LicenseExpired"),t)}return localeString("LicenseExpirationWarning_SyncIsNotAllowedByLicense")+" "+localeString("LicenseExpirationWarning_SelfAdv_EnterpriseCaption")},ProxyRfo.prototype.CheckDisableNonGroupData=function(){return!!this.m_bOneFile&&(!!this.m_bEnterprise&&(!this.m_bCompanyAdmin&&g_policySet.GetConfigValue(ConfigDisableNonGroupData)))},ProxyRfo.prototype.Init=function(e){var t=void 0!==e.oneFile&&e.oneFile;this.m_bCompanyAdmin=!!t&&CheckIsCompanyAdmin(e),this.m_bOneFile=t,this.m_bEnterprise=void 0!==e.enterprise&&e.enterprise,this.m_bLicenseExpired=void 0!==e.licenseExpired&&e.licenseExpired,(!t||t&&this.g_accountpwd)&&g_HistoryMgr.Initialize(t)},ProxyRfo.prototype.LoginToAccount=function(e,t){var r=this,o=JSON.parse(e),n=o[USERNAME_PROPERTY];o[ACCOUNTPWD_PROPERTY],o.otp_password;loginToAccount_async(o,function(){r.m_cache.ResetLists(),g_jsApiMgr.GetAccountInfo(n,function(e){if(!e.syncAllowed){var o={};return o[JSON_MSG_ERROR]={code:ERR_SYNC_NOT_ALLOWED,description:r.GetLicenseNotificationStatus(e)},void t(JSON.stringify(o))}var n=e.oneFile;g_policySet.ParseBlob(e.policies),g_policySet.g_passwordExpired=!!e.passwordExpired&&e.passwordExpired,g_policySet.g_forcePasswordChange=!!e.forcePasswordChange&&e.forcePasswordChange,g_policySet.g_passwordAgeDays=void 0!==e.passwordAgeDays?e.passwordAgeDays:-1,g_policySet.g_passwordDaysLeft=void 0!==e.passwordDaysLeft?e.passwordDaysLeft:1e4,n=void 0!==n&&n,g_jsApiMgr.setAccountMode(n?r.m_aAccountMode.OFS:r.m_aAccountMode.MULTIFILE),r.Init(e);var i={};i.accountInfo=e;var a=JSON.stringify(i);t(a)},function(e){var r=JSON.stringify(e);t(r)})},function(e,r,o){var n={};n[JSON_MSG_ERROR]={},n[JSON_MSG_ERROR][JSON_MSG_CODE]=e,n[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,n.params=o;var i=JSON.stringify(n);t(i)})},ProxyRfo.prototype.LogOffAccount=function(e){logOffFromAccount_async(function(){var t=JSON.stringify({});e(t)},function(t,r){var o={};o[JSON_MSG_ERROR]={},o[JSON_MSG_ERROR][JSON_MSG_CODE]=t,o[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r;var n=JSON.stringify(o);e(n)})},ProxyRfo.prototype.CreateAccount=function(e,t){var r=JSON.parse(e),o=void 0===r.boneFile||!r.boneFile,n=this;createAccount_async(r,function(){if(o){var e={};e[PWD_GEN_PWD_PROPERTY]=r.master_password,n.Bg_CreateMasterPasswordProxy(e,function(e){var o={};o[CONTEXT_PROPERTY]=r,e[JSON_MSG_ERROR]&&(o[JSON_MSG_ERROR]={},o[JSON_MSG_ERROR][JSON_MSG_CODE]=e[JSON_MSG_ERROR].Code,o[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=e[JSON_MSG_ERROR].Description);var n=JSON.stringify(o);t(n)})}else{var i={};i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)}},function(e){var o={};o[JSON_MSG_ERROR]={},o[CONTEXT_PROPERTY]=r,o[JSON_MSG_ERROR][JSON_MSG_CODE]=e.Code;var n="";if(e.oException){var i=e.oException;if(i.status==JSON_MSG_ERROR){var a=i.fields;if(a){var s=a[0];s.error?n+="  "+s.error:s.exists?n+=s.name+"  '"+s.value+"'  already exists":n+=" Field '"+s.name+"' with value='"+s.value+"'  exists="+s.exists}}o[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=n}else o[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=e.Description;var p=JSON.stringify(o);t(p)})},ProxyRfo.prototype.PutDataItem=function(e,t,r){try{var o=JSON.parse(e);if(o[ITEM_PROPERTY][RfapiJS.ITEMDATA_FIELDS_PROP]){var n=[];for(var i in o[ITEM_PROPERTY][RfapiJS.ITEMDATA_FIELDS_PROP])n.push(o[ITEM_PROPERTY][RfapiJS.ITEMDATA_FIELDS_PROP][i]);o[ITEM_PROPERTY][RfapiJS.ITEMDATA_FIELDS_PROP]=n}var a=void 0!==o.bNewItem&&o.bNewItem,s=void 0!==o.bOverwrite&&o.bOverwrite,p=this;function c(e,r){var n={};n[JSON_MSG_ERROR]={},n[JSON_MSG_ERROR][JSON_MSG_CODE]=e,n[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,n[CONTEXT_PROPERTY]=o;var i=JSON.stringify(n);t(i)}function f(){putDataItem_async(o,function(){p.m_cache.ClearSearchList();var e=GetParentFolderPath(o.path),r=p.m_cache.getRootFolder(),n=p.m_cache.getFolderByPath(r,e,RF_ROOT_FOLDER_URL),i=p.m_cache.GetItemFromCache(o.path,o.type,!1);n&&!i&&delete n.c,o.type==EnRfDataItemType.RfItemType_Login&&p.m_cache.ClearDomainLogins(),o.type==EnRfDataItemType.RfItemType_Identity&&p.m_cache.ClearIdentitiesList();var a={};a.path=o.path,a.type=o.type,g_HistoryMgr.pushItem(a);var s={};s[CONTEXT_PROPERTY]=o;var c=JSON.stringify(s);t(c)},function(e,t,r){c(e,t)},function(e){r&&r(e)})}function _(){var e={};e[ITEMINFO_PATH_PROP]=o[PATH_PROPERTY],e[ITEMINFO_TYPE_PROP]=o[RFTYPE_PROPERTY],getItemInfo_async(e,function(e){c(ERR_OBJECT_ALREADY_EXISTS,"Item with the same name already exists.")},function(e){if(e&&e.sibErr&&"NotFound"==e.sibErr){if(p.CheckDisableNonGroupData())return t=GetParentFolderPath(o[PATH_PROPERTY]),(r={})[ITEMINFO_PATH_PROP]=t,r[ITEMINFO_TYPE_PROP]=EnRfDataItemType.RfItemType_Folder,void getItemInfo_async(r,function(e){IsItemFromGroup(e)?f():c(ERR_NOT_ALLOWED,localeString("Policy_DisableNonGroupData_Message"))},function(e){c(e.Code,e.Description)});f()}else c(e.Code,e.Description);var t,r})}a?this.m_bOneFile?this.m_bCompanyAdmin?s?f():_():g_jsApiMgr.GetAccountInfo(p.g_username,function(e){g_policySet.ParseBlob(e.policies),o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Safenote&&g_policySet.GetConfigValue(ConfigDisableCreateSafenotes)||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Contact&&g_policySet.GetConfigValue(ConfigDisableCreateContacts)||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Identity&&g_policySet.GetConfigValue(ConfigDisableCreateIdentities)||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Login&&g_policySet.GetConfigValue(ConfigDisableCreateLogins)||o[RFTYPE_PROPERTY]==EnRfDataItemType.RfItemType_Bookmark&&g_policySet.GetConfigValue(ConfigDisableCreateBookmarks)?c(403,localeString("Policy_CommandDisabled_Message")):s?f():_()},function(e){var r=JSON.stringify(e);t(r)}):s?f():_():f()}catch(e){log("EXCEPTION in PutDataItem:"+e.toString())}},ProxyRfo.prototype.GetDataItem=function(e,t){try{var r=this,o=JSON.parse(e),n=o[ITEMINFO_PROPERTY],i=o.action,a=o.pwd,s=o.cachepwd,p=JSON.parse(n),c={};c.item_info=p,c.action=i,c.pwd=a,c.cachepwd=s,c.allFields=o.allFields,c.options=o.options,c.used=o.used,c.favorite=o.favorite,getDataItem_async({context:c},function(e){var i=JSON.parse(n);g_HistoryMgr.pushItem(i);var a={};if(a[CONTEXT_PROPERTY]=o,a.item_data=e,p[ITEMINFO_TYPE_PROP]==EnRfDataItemType.RfItemType_Identity&&r.m_bOneFile)r.GetUsageInfo({list:EnUsageInfoList.identitiesGroupInstances}).then(function(e){if(e&&e.length){for(var r=0;r<e.length;r++){var o=e[r];if(o[ITEMINFO_PATH_PROP]==p[ITEMINFO_PATH_PROP]){a.list=o.list;break}}n=JSON.stringify(a);t(n)}else{var n=JSON.stringify(a);t(n)}});else{var s=JSON.stringify(a);t(s)}},function(e,r,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,i[CONTEXT_PROPERTY]=o;var a=JSON.stringify(i);t(a)})}catch(e){log("EXCEPTION in GetDataItem:"+e.toString())}},ProxyRfo.prototype.DeleteItem=function(e,t,r){var o=JSON.parse(e),n=o[ITEM_PROPERTY],i=JSON.parse(n),a={};a[ITEM_PROPERTY]=i,a.bDeleteShared=o.bDeleteShared;var s=this;deleteItem_async(a,function(){var e=JSON.parse(n);s.m_cache.DeleteItemFromCache(e),g_HistoryMgr.removeItem(e),s.m_cache.ClearSearchList();var r={};r[CONTEXT_PROPERTY]=o;var i=JSON.stringify(r);t(i)},function(e,r,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,i[CONTEXT_PROPERTY]=o;var a=JSON.stringify(i);t(a)},function(e){r&&r(e)})},ProxyRfo.prototype.MoveItem=function(e,t,r){var o,n=JSON.parse(e),i=n.oldPath,a=n.oldType,s=n.newPath,p=n.newType,c=void 0!==n.bOverwrite&&n.bOverwrite,f=this;function _(){var e={};e.oldPath=i,e.oldType=a,e.newPath=s,e.newType=p,moveItem_async(e,function(){var e=f.m_cache.getRootFolder(),r=GetParentFolderPath(i),o=f.m_cache.getFolderByPath(e,r,RF_ROOT_FOLDER_URL);o&&delete o.c,f.m_cache.ClearSearchList();var c=GetParentFolderPath(s);if(c!=r){var _=f.m_cache.getFolderByPath(e,c,RF_ROOT_FOLDER_URL);_&&delete _.c}a==EnRfDataItemType.RfItemType_Identity&&f.m_cache.ClearIdentitiesList(),a==EnRfDataItemType.RfItemType_Folder&&f.m_cache.ClearFoldersList(),a!=EnRfDataItemType.RfItemType_Login&&a!=EnRfDataItemType.RfItemType_Bookmark||f.m_cache.ClearDomainLogins();var R={};R.path=i,R.type=a,g_HistoryMgr.removeItem(R);var m={};m.path=s,m.type=p,g_HistoryMgr.pushItem(m);var u={};u[CONTEXT_PROPERTY]=n;var y=JSON.stringify(u);t(y)},function(e,r,o){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,i[CONTEXT_PROPERTY]=n;var a=JSON.stringify(i);t(a)},function(e){r&&r(e)})}c?_():((o={})[ITEMINFO_PATH_PROP]=s,o[ITEMINFO_TYPE_PROP]=p,getItemInfo_async(o,function(e){var r={};r[JSON_MSG_ERROR]={},r[JSON_MSG_ERROR][JSON_MSG_CODE]=ERR_OBJECT_ALREADY_EXISTS,r[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]="Item with the same name already exists.",r[CONTEXT_PROPERTY]=n;var o=JSON.stringify(r);t(o)},function(e){if(e&&e.sibErr&&"NotFound"==e.sibErr)_();else{var r={};r[JSON_MSG_ERROR]={},r[JSON_MSG_ERROR][JSON_MSG_CODE]=e.Code,r[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=e.Description,r[CONTEXT_PROPERTY]=n;var o=JSON.stringify(r);t(o)}}))},ProxyRfo.prototype.CreateFolder=function(e,t,r){var o,n,i=JSON.parse(e),a=i[PATH_PROPERTY],s=this;function p(e,r){var o={};o[JSON_MSG_ERROR]={},o[JSON_MSG_ERROR][JSON_MSG_CODE]=e,o[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=r,o[CONTEXT_PROPERTY]=i;var n=JSON.stringify(o);t(n)}function c(){var e={};e[PATH_PROPERTY]=a,createFolder_async(e,function(){s.m_cache.ClearFoldersList();var e=GetParentFolderPath(a),r=s.m_cache.getRootFolder(),o=s.m_cache.getFolderByPath(r,e,RF_ROOT_FOLDER_URL);o&&delete o.c;var n={};n[CONTEXT_PROPERTY]=i;var p=JSON.stringify(n);t(p)},function(e,t,r){p(e,t)},function(e){r&&r(e)})}if(this.CheckDisableNonGroupData())return o=GetParentFolderPath(a),(n={})[ITEMINFO_PATH_PROP]=o,n[ITEMINFO_TYPE_PROP]=EnRfDataItemType.RfItemType_Folder,void getItemInfo_async(n,function(e){IsItemFromGroup(e)?c():p(ERR_NOT_ALLOWED,localeString("Policy_DisableNonGroupData_Message"))},function(e){p(ERR_IN_EXT_SOURCES,"error")});c()},ProxyRfo.prototype.GetItemsForFolder=function(e,t){try{var r=JSON.parse(e),o=r[PATH_PROPERTY],n=r[RFTYPE_PROPERTY];if(this.m_cache.GetFolderFromCache(o)){var i=this.m_cache.GetList(o,n);i.length;var a={};a[ITEMS_PROPERTY]=i,a[CONTEXT_PROPERTY]=r;var s=JSON.stringify(a);return void t(s)}var p={};p[PATH_PROPERTY]=o,p.parts=r.parts,p.icon=r.icon;var c=this;getItemsInfoList_async(p,function(e){c.m_cache.CacheFolderChilds(e,o);for(var i=[],a=0;a<e.length;a++){var s=e[a];ArrayInclude(n,s[RFTYPE_PROPERTY])&&i.push(s)}var p={};p[ITEMS_PROPERTY]=i,p[CONTEXT_PROPERTY]=r;var f=JSON.stringify(p);t(f)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})}catch(e){log("EXCEPTION in GetItemsForFolder:"+e.toString())}},ProxyRfo.prototype.GetIdentitiesList=function(e){var t=this;return new Promise(function(r,o){if(!t.m_bLocal){var n=t.m_cache.GetIdentitiesList();if(n)return void r(n)}var i={};i[PATH_PROPERTY]=RF_ROOT_FOLDER_URL,i.type=EnRfDataItemType.RfItemType_Identity,i.deep=!0,i.bExcludeShared=!0,getItemsInfoList_async(i,function(e){if(t.m_bLocal)r(e);else{for(var o=[],n=0;n<e.length;n++)RfUtils.insertToSortedArray(e[n],o,["path"],2);t.m_cache.SetIdentitiesList(o),r(o)}},function(e,t,r){var n={};n[JSON_MSG_ERROR]={},n[JSON_MSG_ERROR][JSON_MSG_CODE]=e,n[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=t;var i={};i.accountMode="undefined"!=typeof g_jsApiMgr?g_jsApiMgr.getAccountMode():1,n[CONTEXT_PROPERTY]=i,o(n)},function(t){e&&e(t)})})},ProxyRfo.prototype.GetFoldersList=function(e,t){var r=JSON.parse(e),o=this.m_cache.GetFoldersList();if(o){var n={};n[ITEMS_PROPERTY]=o,n[CONTEXT_PROPERTY]=r;var i=JSON.stringify(n);t(i)}else{var a={};a[PATH_PROPERTY]=RF_ROOT_FOLDER_URL,a.type=EnRfDataItemType.RfItemType_Folder,a.deep=!0;var s=this;getItemsInfoList_async(a,function(e){s.m_cache.SetFoldersList(e);var o={};o[ITEMS_PROPERTY]=e,o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})}},ProxyRfo.prototype.GetMatchingItems=function(){var e=this;return new Promise(function(t,r){GetSelectedTab(null,function(o){var n=o.id,i={};i.tab_id=n,i[ITEMS_PROPERTY]=[],getRF().GetTabUrls(n,function(o){if(0!==o.length){var a={bExcludeShared:!0};if(a.type=EnRfDataItemType.RfItemType_Login,e.m_bLocal){a.url=o,a.parts=EnDataItemInfoParts.enUrls,(s=e.RfApiGetMatchingPasscards(a)).tab_id=n,t(s)}else{a.matchLevelMin=RfapiJS.RfUrlMatchLevel.RF_MATCH_TYPE_UNKNOWN,a.parts=EnDataItemInfoParts.enUrls;var s,p=e.m_cache.GetDomainLogins(o[0]);if(p)return(s={}).tab_id=n,s[ITEMS_PROPERTY]=p,void t(s);a.url=o,getDomainLoginsWithEquiv_async(a,function(r){e.m_bLocal||e.m_cache.SetDomainLogins(o[0],r);var i={};i.tab_id=n,i[ITEMS_PROPERTY]=r,t(i)},function(t,n){e.m_bLocal||e.m_cache.SetDomainLogins(o[0],[]);var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=t,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=n,r(i)})}}else t(i)})})})},ProxyRfo.prototype.NavigateFillSubmitAction=function(e,t){var r=JSON.parse(e),o=r[ITEMINFO_PROPERTY],n=r.bNavigate,i=r.bFill,a=r.bSubmit,s=r.bNewWindow,p=void 0!==r.bFillOnlyEmptyFields&&r.bFillOnlyEmptyFields,c=r.instances;r.used=!0;var f=o[PATH_PROPERTY],_=o[RFTYPE_PROPERTY];r[PWD_GEN_PWD_PROPERTY]||(r[PWD_GEN_PWD_PROPERTY]=this.g_masterpwd);var R=null,m=null,u=function(e){var t,r=e.split("/");if(r.length>0){var o=(t=r[r.length-1]).lastIndexOf(".");o>=0&&(t=t.substr(o+1))}return t}(f),y=this.m_cache.GetItemFromCache(o[ITEMINFO_PATH_PROP],o[ITEMINFO_TYPE_PROP],!0);g_HistoryMgr.pushItem(o),this.m_cache.ClearGoFillGlobal();var l=this;function P(e){if(n){var r=e[RfapiJS.ITEM_GOTOURL_PROP];if(!g_policySet.IsRoboFormEnabledOnUrl(r))return;if(l.m_cache.SetGoFillGlobal(i,a,r,f,_,e),t){var o=JSON.stringify({});t(o)}Bg_OpenPage(r,s)}else{"rfp"==u?m=e:R=e;var y=RfMakeFillerDataJSON(R,m,!0,!1,!1,a,p,!0,!0,c);!function(e){GetSelectedTab(null,function(r){var o=r.id,n=getRF().FindTabBrowser(o);if(n){if(n.forEachGoodFrame(function(t){g_policySet.IsRoboFormEnabledOnUrl(t.m_url)&&t.FillFormsInFrame(e)}),t){var i=JSON.stringify({});t(i)}}else log("!!! no browser")})}(JSON.stringify(y))}}y?P(y.b):getDataItem_async({context:r},P,function(e,o){var n={};if(n[JSON_MSG_ERROR]={},n[JSON_MSG_ERROR][JSON_MSG_CODE]=e,n[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,n[CONTEXT_PROPERTY]=r,t){var i=JSON.stringify(n);t(i)}})},ProxyRfo.prototype.ClearGeneratedPwdList=function(){return g_generatedPwdList.clearList(),g_generatedPwdList.getList()},ProxyRfo.prototype.GetGeneratedPwdList=function(){return g_generatedPwdList.getList()},ProxyRfo.prototype.AddItemToGeneratedPwdList=function(e){return g_generatedPwdList.pushItem(e),g_generatedPwdList.getList()},ProxyRfo.prototype.GetUsageInfo=function(e){return new Promise(function(t,r){g_jsApiMgr.GetUsageInfo(e,function(e){t(e)},function(e){r(e)})})},ProxyRfo.prototype.GetHistoryList=function(e,t){var r=JSON.parse(e),o=r.types;g_HistoryMgr.GetListAsync(o).then(function(e){var o={};o[ITEMS_PROPERTY]=e,o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)}).catch(function(e){})},ProxyRfo.prototype.ClearHistoryList=function(e,t){var r=JSON.parse(e),o=r.types;g_HistoryMgr.ClearListAsync(o).then(function(){var e={};e[ITEMS_PROPERTY]=[],e[CONTEXT_PROPERTY]=r;var o=JSON.stringify(e);t(o)}).catch(function(e){})},ProxyRfo.prototype.GetSearchItemsInfo=function(){if(!this.g_list_updating)if(this.g_list_updating=!0,this.m_cache.GetSearchList())this.g_list_updating=!1;else{var e={};e[PATH_PROPERTY]="",e.deep=!0,e.type=[EnRfDataItemType.RfItemType_Login,EnRfDataItemType.RfItemType_Bookmark,EnRfDataItemType.RfItemType_Identity,EnRfDataItemType.RfItemType_Contact,EnRfDataItemType.RfItemType_Safenote],e.parts=EnDataItemInfoParts.enUrls|EnDataItemInfoParts.enIcon,e.icon=!0;var t=this;getItemsInfoList_async(e,function(e){for(var r=[],o=0;o<e.length;o++)RfUtils.insertToSortedArray(e[o],r,["path"],1);t.m_cache.SetSearchList(r),t.g_list_updating=!1},function(e,r,o){t.g_list_updating=!1})}},ProxyRfo.prototype.ClearSearchItemsInfo=function(){this.g_list_updating=!1},ProxyRfo.prototype.UpdateSearchList=function(e,t){var r=JSON.parse(e),o=[];if(GetSetting("sa-search","rf_search_roboform_chk")){var n=r.search.toLowerCase(),i=this.m_cache.GetSearchList();void 0!==i&&(o=this.FilterSearchList(i,n)),t(JSON.stringify(o))}else t(JSON.stringify(o))},ProxyRfo.prototype.FilterSearchList=function(e,t){for(var r=[],o=!1,n=0;n<e.length;n++){var i=e[n],a=getTextForItem(i);if(a=a.toLowerCase(),t.length<=2){if(-1==a.lastIndexOf(t))continue;if(0!=a.indexOf(t))continue}else{if(-1==GetDisplayPath(i.path).toLowerCase().indexOf(t))continue}o||1!==i.isDefault?r.unshift(i):(o=!0,r.push(i))}if(t.length<=2)return r;var s=[];for(n=0;n<r.length;n++)RfUtils.insertToSortedArray(r[n],s,["path"],1,t);r=[];for(n=0;n<s.length;n++)r.unshift(s[n]);return r},ProxyRfo.prototype.Search_Items=function(e,t){try{var r=JSON.parse(e),o=r.search;if(o=o.toLowerCase(),!GetSetting("sa-search","rf_search_roboform_chk")){var n={};n[ITEMS_PROPERTY]=[],n[CONTEXT_PROPERTY]=r;var i=JSON.stringify(n);return void t(i)}var a=this.m_cache.GetSearchList();if(a){var s={};s[ITEMS_PROPERTY]=this.FilterSearchList(a,o),s[CONTEXT_PROPERTY]=r;var p=JSON.stringify(s);return void t(p)}var c={};c.search=o,searchItems_async(c,function(e){var o={};o[ITEMS_PROPERTY]=e,o[CONTEXT_PROPERTY]=r;var n=JSON.stringify(o);t(n)},function(e,o,n){var i={};i[JSON_MSG_ERROR]={},i[JSON_MSG_ERROR][JSON_MSG_CODE]=e,i[JSON_MSG_ERROR][JSON_MSG_DESCRIPTION]=o,i[CONTEXT_PROPERTY]=r;var a=JSON.stringify(i);t(a)})}catch(e){log("EXCEPTION in Search_Items:"+e.toString())}},ProxyRfo.prototype.ClearFields=function(){GetSelectedTab(null,function(e){var t=e.id,r=getRF().FindTabBrowser(t);r?r.ClearFields():log("!!! no browser")})},ProxyRfo.prototype.ResetFields=function(){GetSelectedTab(null,function(e){var t=e.id,r=getRF().FindTabBrowser(t);r?r.ResetFields():log("!!! no browser")})};var SETFIELDS_FIELD="set fields value";ProxyRfo.prototype.SetFields=function(){var e=this;e.GetIdentitiesList().then(function(t){if(t&&t.length){for(var r=[],o=0;o<t.length;o++)RfUtils.insertToSortedArray(t[o],r,["path"],1);var n=r[0],i={};i.item_info=JSON.stringify(n),e.GetDataItem(JSON.stringify(i),function(e){var t=JSON.parse(e).item_data;if(t){for(var r,o=GetIdentityFromGetDataItem2Response(t,5).m_lGroups,n=void 0,i=0;i<o.length;i++){var a=o[i];if("Custom"==a.m_sName)for(var s=a.instances[0].m_lFields,p=0;p<s.length;p++){var c=s[p];c.m_sName==SETFIELDS_FIELD&&((n={}).bSetValue=!0,n.sSetValue=c.m_sValue);break}}n&&(r=JSON.stringify(n),GetSelectedTab(null,function(e){var t=e.id,o=getRF().FindTabBrowser(t);o?o.SetFields(r):log("!!! no browser")}))}})}}).catch(function(e){})},ProxyRfo.prototype.FillPasswordField=function(e){var t={bActuallyFill:!0,m_nStopAfterMatchingFields:!1,bSubmit:!1,bFillInvisibleFields:!0,m_bFillNonemptyFields:!0,m_bUseEnglishSelectValues:!0,m_bCountFields:!1},r={m_sGotoURL:"",m_sMatchURL:""},o=[],n={m_sName:"Password$",m_nOrderIndex:0,m_field_type:2,m_bDefaultValue:!1,m_sCaption:"",m_sId:""};n.m_sValue=e[PWD_GEN_PWD_PROPERTY],o.push(n),r.m_lFields=o,t.m_pPasscard=r;var i=JSON.stringify(t);GetSelectedTab(null,function(e){var t=e.id,r=getRF().FindTabBrowser(t);r?r.forEachGoodFrame(function(e){g_policySet.IsRoboFormEnabledOnUrl(e.m_url)&&e.FillFormsInFrame(i)}):log("!!! no browser")})},ProxyRfo.prototype.OpenPage=function(e,t){Bg_OpenPage(e.url,e.bNewWindow,e.bActivateIfExists)},ProxyRfo.prototype.Bg_CreateMasterPasswordProxy=function(e,t){var r={};r[ITEM_PROPERTY]={},r[PATH_PROPERTY]="/Contact Info.rfp",r[RFTYPE_PROPERTY]=EnRfDataItemType.RfItemType_Login,r[ITEM_PROPERTY][RfapiJS.ITEM_GOTOURL_PROP]=RF_SUPPORT_URL,r[ITEM_PROPERTY][RfapiJS.ITEM_MATCHURL_PROP]=RF_SUPPORT_URL,r[ITEM_PROPERTY][ISPROTECTED_PROPERTY]=!0,r[ITEM_PROPERTY][PWD_GEN_PWD_PROPERTY]=e[PWD_GEN_PWD_PROPERTY];var o=this;putDataItem_async(r,function(){var n=GetParentFolderPath(r[PATH_PROPERTY]),i=o.m_cache.getRootFolder(),a=o.m_cache.getFolderByPath(i,n,RF_ROOT_FOLDER_URL);a&&delete a.c,Bg_SaveMasterPassword(e[PWD_GEN_PWD_PROPERTY]),t(e)},function(r,o){var n={};n.Code=r,n.Description=o,e[JSON_MSG_ERROR]=n,t(e)})},ProxyRfo.prototype.GetFolderStats=function(e){var t=this;return new Promise(function(r,o){var n=[],i={path:e,parts:1,deep:!0,bExcludeShared:!0};i.type=[EnRfDataItemType.RfItemType_Login,EnRfDataItemType.RfItemType_Bookmark,EnRfDataItemType.RfItemType_SearchCard,EnRfDataItemType.RfItemType_BlockingPasscard],n.push(t.m_proxy.Count(i)),i.type=[EnRfDataItemType.RfItemType_Identity,EnRfDataItemType.RfItemType_Contact],n.push(t.m_proxy.Count(i)),i.type=[EnRfDataItemType.RfItemType_Safenote],n.push(t.m_proxy.Count(i)),i.type=[EnRfDataItemType.RfItemType_Generic],n.push(t.m_proxy.Count(i)),Promise.all(n).then(function(e){var t={};t[EnRfDataItemType.RfItemType_Login]=e[0].count,t[EnRfDataItemType.RfItemType_Identity]=e[1].count,t[EnRfDataItemType.RfItemType_Safenote]=e[2].count,t[EnRfDataItemType.RfItemType_Generic]=e[3].count,r(t)}).catch(function(e){o(e)})})},ProxyRfo.prototype.GetCachedDomainLogins=function(e){return this.m_cache.GetDomainLogins(e)},ProxyRfo.prototype.SetCachedDomainLogins=function(e,t){this.m_cache.SetDomainLogins(e,t)},ProxyRfo.prototype.ClearCachedDomainLogins=function(e){this.m_cache.ClearDomainLogins(e)},ProxyRfo.prototype.GetCachedFoldersList=function(){return this.m_cache.GetFoldersList()},ProxyRfo.prototype.SetCachedFoldersList=function(e){this.m_cache.SetFoldersList(e)},ProxyRfo.prototype.GetCachedRootFolder=function(){return this.m_cache.getRootFolder()},ProxyRfo.prototype.GetCachedFolderByPath=function(e,t,r){return this.m_cache.getFolderByPath(e,t,r)},ProxyRfo.prototype.ClearCachedSearchList=function(){this.m_cache.ClearSearchList()},ProxyRfo.prototype.GetCachedGoFillGlobal=function(e){this.m_cache.GetGoFillGlobal(e)},ProxyRfo.prototype.ClearCachedGoFillGlobal=function(){this.m_cache.ClearGoFillGlobal()},ProxyRfo.prototype.ResetCachedLists=function(e){this.m_cache.ResetLists(e)},ProxyRfo.prototype.Initialize=function(e,t,r,o,n){var i=this,a=new NMProxy(function(e){i.onDataChanged(e)});a.Initialize(e,t,function(){i.m_proxy=a,i.m_bLocal=!0,i.m_bRfApi=!1,i.m_bRfApi=a.m_bRfApi,r()},function(){i.m_bLocal=!1,i.m_bRfApi=!0,i.InitializeStandAlone(),o()},n)},ProxyRfo.prototype.InitializeStandAlone=function(){this.m_proxy=new RfoProxy,this.m_bLocal=!1,this.m_bRfApi=!0},ProxyRfo.prototype.IsLocal=function(){return this.m_bLocal},ProxyRfo.prototype.IsRfApi=function(){return this.m_bRfApi},ProxyRfo.prototype.GetNativeProxy=function(){return this.m_proxy},ProxyRfo.prototype.onDataChanged=function(e){if(0!=e.length)for(var t=0;t<e.length;t++){switch(e[t].eventType){case RfChangeEventType.FullUpdate:case RfChangeEventType.SettingChange:return this.m_options=void 0,void(this.m_domain_match=void 0)}}},ProxyRfo.prototype.RfApiCheckPwd=function(e){return"pwd"in e?this.m_proxy.CheckPwd(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiLogin=function(e){return"pwd"in e?this.m_proxy.Login(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiCacheMasterPassword=function(e){return"pwd"in e?this.m_proxy.CacheMasterPassword(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiLogoff=function(){return this.m_proxy.Logoff()},ProxyRfo.prototype.RfApiGetDataStatus=function(e){return"accountId"in e?this.m_proxy.GetDataStatus(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiGetInfo=function(e){return"path"in e?this.m_proxy.GetInfo(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiList=function(e){if(!("path"in e))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));if(this.IsLocal())return this.m_proxy.List(e);var t;if(t=void 0===e.type?void 0:Array.isArray(e.type)?e.type:[e.type],this.m_cache.GetFolderFromCache(e.path)){var r=this.m_cache.GetList(e.path,t);return Promise.resolve({items:r})}var o=this;return this.m_proxy.List(e).then(function(r){var n=r;if(e.type||o.m_cache.CacheFolderChilds(n,e.path),!t)return{items:n};for(var i=[],a=0;a<n.length;a++){var s=n[a];ArrayInclude(t,s.type)&&i.push(s)}return{items:i}})},ProxyRfo.prototype.RfApiCount=function(e){return"path"in e?this.m_proxy.Count(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiGetMatchingPasscards=function(e){return"url"in e?this.m_proxy.GetMatchingPasscards(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiGetDomainPasscards=function(e){return"url"in e?this.m_proxy.GetDomainPasscards(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiUpdateStatus=function(){return this.m_proxy.UpdateStatus()},ProxyRfo.prototype.RfApiDelete=function(e){if(!("path"in e&&"type"in e))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));var t=this;return this.m_proxy.Delete(e).then(function(r){return t.IsLocal()?r:(t.m_cache.DeleteItemFromCache(e),g_HistoryMgr.removeItem(e),r)})},ProxyRfo.prototype.RfApiRename=function(e){return"path"in e&&"type"in e?this.m_proxy.Rename(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiMove=function(e){if(!("from"in e&&"path"in e.from&&"type"in e.from&&"to"in e&&"path"in e.to&&"type"in e.to))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));var t=this;return this.m_proxy.Move(e).then(function(r){if(t.IsLocal())return r;var o=t.m_cache.getRootFolder(),n=GetParentFolderPath(e.from.path),i=t.m_cache.getFolderByPath(o,n,RF_ROOT_FOLDER_URL);i&&delete i.c,t.m_cache.ClearSearchList();var a=GetParentFolderPath(e.to.path);if(a!=n){var s=t.m_cache.getFolderByPath(o,a,RF_ROOT_FOLDER_URL);s&&delete s.c}e.from.type==EnRfDataItemType.RfItemType_Identity&&t.m_cache.ClearIdentitiesList(),e.from.type==EnRfDataItemType.RfItemType_Folder&&t.m_cache.ClearFoldersList(),e.from.type!=EnRfDataItemType.RfItemType_Login&&e.from.type!=EnRfDataItemType.RfItemType_Bookmark||t.m_cache.ClearDomainLogins();var p={};p.path=e.from.path,p.type=e.from.type,g_HistoryMgr.removeItem(p);var c={};return c.path=e.to.path,c.type=e.to.type,g_HistoryMgr.pushItem(c),r})},ProxyRfo.prototype.RfApiCopy=function(e){if(!("from"in e&&"path"in e.from&&"type"in e.from&&"to"in e&&"path"in e.to&&"type"in e.to))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));var t=this;return this.m_proxy.Copy(e).then(function(r){if(t.IsLocal())return r;var o=t.m_cache.getRootFolder();GetParentFolderPath(e.from.path);t.m_cache.ClearSearchList();var n=GetParentFolderPath(e.to.path),i=t.m_cache.getFolderByPath(o,n,RF_ROOT_FOLDER_URL);i&&delete i.c,e.from.type==EnRfDataItemType.RfItemType_Identity&&t.m_cache.ClearIdentitiesList(),e.from.type==EnRfDataItemType.RfItemType_Folder&&t.m_cache.ClearFoldersList(),e.to.type!=EnRfDataItemType.RfItemType_Login&&e.to.type!=EnRfDataItemType.RfItemType_Bookmark||t.m_cache.ClearDomainLogins();var a={};return a.path=e.to.path,a.type=e.to.type,g_HistoryMgr.pushItem(a),r})},ProxyRfo.prototype.RfApiCreateFolder=function(e){if(!("folder"in e||"path"in e))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));var t=this;return this.m_proxy.CreateFolder(e).then(function(r){if(t.IsLocal())return r;var o;t.m_cache.ClearFoldersList(),o="folder"in e?e.folder:e.path;var n=GetParentFolderPath(o),i=t.m_cache.getRootFolder(),a=t.m_cache.getFolderByPath(i,n,RF_ROOT_FOLDER_URL);return a&&delete a.c,r})},ProxyRfo.prototype.RfApiGetDataItem=function(e){if(!("path"in e&&"type"in e))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));var t=this;return e.level&&(e.pwd=e.pwd?e.pwd:this.g_masterpwd),this.m_proxy.GetDataItem(e).then(function(r){if(t.IsLocal())return{data:r};var o=GetDataItemFromGetDataItem2Response(r,e.type);if(o)return t.IsLocal()?{data:o}:(g_HistoryMgr.pushItem({path:e.path,type:e.type}),{data:o});throw new RfApiError(void 0,"bad data",void 0,void 0,RfapiJS.SibErrType.SibTErr_LocalErr)})},ProxyRfo.prototype.RfApiPutDataItem=function(e){if(!("path"in e&&"type"in e&&"data"in e))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));var t=this;return this.m_proxy.PutDataItem(e).then(function(r){if(t.IsLocal())return r;t.m_cache.ClearSearchList();var o=GetParentFolderPath(e.path),n=t.m_cache.getRootFolder(),i=t.m_cache.getFolderByPath(n,o,RF_ROOT_FOLDER_URL),a=t.m_cache.GetItemFromCache(e.path,e.type,!1);return i&&!a&&delete i.c,e.type==EnRfDataItemType.RfItemType_Login&&t.m_cache.ClearDomainLogins(),e.type==EnRfDataItemType.RfItemType_Identity&&t.m_cache.ClearIdentitiesList(),r})},ProxyRfo.prototype.RfApiCreateDataItem=function(e){return"type"in e?this.m_proxy.CreateDataItem(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiCreateDataItem2=function(e){return"type"in e?this.m_proxy.CreateDataItem2(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiGetUsageInfo=function(e){return"list"in e&&"type"in e?this.m_proxy.GetUsageInfo(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiSetUsageInfo=function(e){return"list"in e&&"path"in e&&"type"in e?this.m_proxy.SetUsageInfo(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiSetUsageInfoList=function(e){return"list"in e&&"items"in e?this.m_proxy.SetUsageInfoList(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiGetOptions=function(){if(!this.IsLocal())return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"));var e=this;return this.m_options?Promise.resolve(e.m_options):this.m_proxy.GetOptions().then(function(t){return e.m_options=t.options,e.m_options})},ProxyRfo.prototype.RfApiSetOptions=function(e){if(!this.IsLocal())return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"));if(!("options"in e))return Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"));var t=this;return this.m_proxy.SetOptions(e).then(function(e){return t.m_options=options,e})},ProxyRfo.prototype.RfApiPutFile=function(e){return"path"in e&&"content"in e?this.m_proxy.PutFile(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiGetFile=function(e){return"path"in e?this.m_proxy.GetFile(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.RfApiChangePassword=function(e){return"path"in e&&"type"in e&&"from"in e&&"to"in e?this.m_proxy.ChangePassword(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))},ProxyRfo.prototype.GetProfiles=function(){return this.m_bLocal?this.m_proxy.GetProfiles():Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},ProxyRfo.prototype.SetProfile=function(e){return this.m_bLocal?"path"in e?this.m_proxy.SetProfile(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter")):Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},ProxyRfo.prototype.GetProfileInfo=function(){return this.m_bLocal?this.m_proxy.GetProfileInfo():Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},ProxyRfo.prototype.SendMsg=function(e){return this.m_bLocal?"message"in e&&"data"in e?this.m_proxy.SendMsg(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter")):Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},ProxyRfo.prototype.GetBrowserTask=function(){return this.m_bLocal?this.m_proxy.GetBrowserTask():Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter"))};var EnBrowserTaskStatus={enInitial:0,enPaused:1,enRunning:2,enFinished:3,enCanceled:4};function RfGetDomainEquivLines(e){var t=0,r=RfGetOption(e,"DOMAINS EQUIV","DomEqCount","");r&&(t=parseInt(r),isNaN(t)&&(t=0));for(var o=[],n=0;n<t;n++){var i=RfGetOption(e,"DOMAINS EQUIV",n.toString(),"");i&&o.push(i)}return o}function RfGetOption(e,t,r,o){if(!e)return o;var n=e[t];if(!n)return o;var i=n[r];if(!i)return o;var a=i.value;if(null==a)return o;if(void 0===o)return a;switch(typeof o){case"boolean":return"0"!=a;case"number":var s=parseInt(a,10);return isNaN(s)?o:s;case"string":default:return a}}function RFCacheManager(){this.bOnline=!1,this.m_PasscardCacheDomain={},this.m_IdentitiesList={},this.m_FoldersList={},this.m_SearchList={},this.m_CachedTree={root:{}},this.CACHE_CHILDS_PROP="c"}function CRFSharedDataMain(){this.m_bGoFill=!1,this.m_bGoFillSubmit=!1,this.m_sGoFillUrl="",this.m_sPath="",this.m_nType=0,this.m_itemData=null}function GeneratedPasswordsList(){this.m_nItemsLimit=8,this.m_Objects=[]}function CRFRecenltyUsedAdapter(){this.m_nItemsLimit=30,this.m_Objects=[],this.m_bOneFileAccount=!1}function RfoProxy(){}function NMProxy(e){this.m_nm_connector=new CRfProxy,this.m_bRfApi=!1,this.m_data_generation_number=0,this.m_service_status={},this.m_changes=[],this.m_onDataChangedCallback=e}ProxyRfo.prototype.SetBrowserTask=function(e){return this.m_bLocal?"path"in e&&"type"in e&&"status"in e&&"fill"in e&&"submit"in e&&"url"in e?this.m_proxy.SetBrowserTask(e):Promise.reject(new RfApiError(RfErrType.RfErr_WrongParams,"missing parameter")):Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},ProxyRfo.prototype.CancelBrowserTask=function(){if(!this.m_bLocal){var e=this;return new Promise(function(t,r){e.ClearCachedGoFillGlobal(),t()})}return this.m_proxy.CancelBrowserTask()},ProxyRfo.prototype.showOptions=function(){this.m_bLocal&&this.m_proxy.showOptions()},ProxyRfo.prototype.setCurrentBrowser=function(e){this.m_bLocal&&this.m_proxy.setCurrentBrowser(e)},ProxyRfo.prototype.setUIItemsInfo=function(e,t){this.m_bLocal&&this.m_proxy.setUIItemsInfo(e,t)},ProxyRfo.prototype.initUI=function(){this.m_bLocal&&this.m_proxy.initUI()},ProxyRfo.prototype.addBrowser=function(e,t,r,o){this.m_bLocal&&this.m_proxy.addBrowser(e,t,r,o)},ProxyRfo.prototype.Uninitialize=function(){this.m_bLocal&&this.m_proxy.Uninitialize()},ProxyRfo.prototype.getProp=function(e,t){this.m_bLocal&&this.m_proxy.getProp(e,t)},ProxyRfo.prototype.ensureUptodate=function(e){this.m_bLocal&&this.m_proxy.ensureUptodate(e)},ProxyRfo.prototype.updateToolbarPosition=function(e,t,r,o){this.m_bLocal&&this.m_proxy.updateToolbarPosition(e,t,r,o)},ProxyRfo.prototype.onWindowRemoved=function(e){this.m_bLocal&&this.m_proxy.onWindowRemoved(e)},ProxyRfo.prototype.onFocusChanged=function(e){this.m_bLocal&&this.m_proxy.onFocusChanged(e)},ProxyRfo.prototype.onAuthRequired=function(e,t){this.m_bLocal&&this.m_proxy.onAuthRequired(e,t)},ProxyRfo.prototype.removeBrowser=function(e){this.m_bLocal&&this.m_proxy.removeBrowser(e)},ProxyRfo.prototype.addFrame=function(e,t,r,o,n,i){this.m_bLocal&&this.m_proxy.addFrame(e,t,r,o,n,i)},ProxyRfo.prototype.updateFrame=function(e,t,r,o){this.m_bLocal&&this.m_proxy.updateFrame(e,t,r,o)},ProxyRfo.prototype.removeFrame=function(e,t,r){this.m_bLocal&&this.m_proxy.removeFrame(e,t,r)},ProxyRfo.prototype.onMessage=function(e,t,r,o){this.m_bLocal&&this.m_proxy.onMessage(e,t,r,o)},ProxyRfo.prototype.setToolbarForPopupVisible=function(e){this.m_bLocal&&this.m_proxy.setToolbarForPopupVisible(e)},ProxyRfo.prototype.setToolbarVisible=function(e){this.m_bLocal&&this.m_proxy.setToolbarVisible(e)},ProxyRfo.prototype.setPopupToolbar=function(e){this.m_bLocal&&this.m_proxy.setPopupToolbar(e)},ProxyRfo.prototype.onUIEvent=function(e){this.m_bLocal&&this.m_proxy.onUIEvent(e)},ProxyRfo.prototype.updateNativeToolbar=function(e,t,r,o){this.m_bLocal&&this.m_proxy.updateNativeToolbar(e,t,r,o)},ProxyRfo.prototype.onActionButtonClick=function(){this.m_bLocal&&this.m_proxy.onActionButtonClick()},ProxyRfo.prototype.ActivateTesterMode=function(){this.m_bLocal&&this.m_proxy.ActivateTesterMode()},ProxyRfo.prototype.postMessage=function(e,t){this.m_bLocal&&this.m_proxy.postMessage(e,t)},ProxyRfo.prototype.sendMessage=function(e,t,r){this.m_bLocal&&this.m_proxy.sendMessage(e,t,r)},ProxyRfo.prototype.LogObjectUse=function(e,t,r){this.m_bLocal},ProxyRfo.prototype.ConvertIdentityToFillerFormat=function(e,t,r,o,n){var i=this,a=!!t;function s(){for(var s=e.m_lGroups,p=[],c=0;c<s.length;c++){var f,_=s[c],R=s[c].instances,m=_.m_sName,u=0;if(R.length>1)if(t?f=t[m]:_.currentInstance&&(f=_.currentInstance),f){for(var y=0;y<R.length;y++)if(R[y].m_sName==f){u=y;break}}else for(y=0;y<R.length;y++)if(R[y].isDefault){u=y;break}p.push({m_sName:"Main",m_sType:m,m_lFields:R[u].m_lFields})}var l=e.m_mOptionValues;r&&(l["Phone prefix mode"]=r);var P={};P.m_lGroups=p,P.m_mOptionValues=l,n(P),!i.IsLocal()&&i.m_bOneFile&&a&&window.setTimeout(function(){g_jsApiMgr.UpdateUsageInfo({list:EnUsageInfoList.identitiesGroupInstances,action:1,item:{path:o,type:5,groups:t}},function(e){},function(e){})},1e3)}i.IsLocal()||t||!i.m_bOneFile?s():i.GetUsageInfo({list:EnUsageInfoList.identitiesGroupInstances}).then(function(e){if(e&&e.length){for(var r=0;r<e.length;r++){var n=e[r];if(n[ITEMINFO_PATH_PROP]==o){t={};for(var i=n.list,a=0;a<i.length;a++){var p=i[a].group,c=i[a].instance;t[p]=c}break}}s()}else s()})},ProxyRfo.prototype.GetDomainMatch=function(){var e=this;if(this.m_domain_match)return Promise.resolve(e.m_domain_match);if(this.IsLocal())return this.RfApiGetOptions().then(function(t){var r=RfGetDomainEquivLines(t);return e.m_domain_match=new CRfDomainMatch,e.m_domain_match.Init(r),e.m_domain_match}).catch(function(t){return JSON.stringify(t),e.m_domain_match=new CRfDomainMatch,e.m_domain_match});var t=g_policySet.RfGetDomainEquivalenceLines();return this.m_domain_match=new CRfDomainMatch,this.m_domain_match.Init(t),Promise.resolve(e.m_domain_match)},ProxyRfo.prototype.GetOption=function(e,t,r){return this.IsLocal()?this.RfApiGetOptions().then(function(e){return e}).catch(function(e){}).then(function(o){return RfGetOption(o,e,t,r)}):Promise.resolve(r)},ProxyRfo.prototype.checkUptodate=function(e){return this.IsLocal()?this.m_proxy.checkUptodate(e):{uptodate:!0}},RFCacheManager.prototype.getRootFolder=function(){return this.m_CachedTree.root},RFCacheManager.prototype.getFolderByPath=function(e,t,r){if(r==t)return e;if(!e[this.CACHE_CHILDS_PROP])return null;var o=e[this.CACHE_CHILDS_PROP].length;if(o){for(var n=null,i=0;null==n&&i<o;i++){var a=e[this.CACHE_CHILDS_PROP][i];if(a[ITEMINFO_TYPE_PROP]==EnRfDataItemType.RfItemType_Folder){var s=a[RfapiJS.ITEMINFO_PATH_PROP];n=this.getFolderByPath(a,t,s)}}return n}return null},RFCacheManager.prototype.CacheFolderChilds=function(e,t){if(1!=g_jsApiMgr.getAccountMode()){t="/"==t?RF_ROOT_FOLDER_URL:t;var r=this.getFolderByPath(this.getRootFolder(),t,RF_ROOT_FOLDER_URL);if(r)if(!r[this.CACHE_CHILDS_PROP]){r[this.CACHE_CHILDS_PROP]=[];for(var o=0;o<e.length;o++)r[this.CACHE_CHILDS_PROP].push(e[o])}}},RFCacheManager.prototype.GetList=function(e,t){var r=[];e="/"==e?RF_ROOT_FOLDER_URL:e;var o=this.getFolderByPath(this.getRootFolder(),e,RF_ROOT_FOLDER_URL)[this.CACHE_CHILDS_PROP];if(!t)return o;for(var n=0;n<o.length;n++){var i=o[n];ArrayInclude(t,i[RfapiJS.ITEMINFO_TYPE_PROP])&&r.push(i)}return r},RFCacheManager.prototype.GetFolderFromCache=function(e){if(1!=g_jsApiMgr.getAccountMode()){e="/"==e?RF_ROOT_FOLDER_URL:e;var t=this.getFolderByPath(this.getRootFolder(),e,RF_ROOT_FOLDER_URL);return t&&t[this.CACHE_CHILDS_PROP]?t:null}},RFCacheManager.prototype.SetItemToCache=function(e,t,r){var o=this.getFolderByPath(this.getRootFolder(),GetParentFolderPath(e),RF_ROOT_FOLDER_URL);if(!o)return!1;if(!o[this.CACHE_CHILDS_PROP])return!1;var n=this.FindChildItemIndex(e,t,o[this.CACHE_CHILDS_PROP]);if(-1==n)return!1;var i=o[this.CACHE_CHILDS_PROP][n];return!!i&&(i.b=r,!0)},RFCacheManager.prototype.GetItemFromCache=function(e,t,r){var o=this.getFolderByPath(this.getRootFolder(),GetParentFolderPath(e),RF_ROOT_FOLDER_URL);if(!o)return null;if(!o[this.CACHE_CHILDS_PROP])return null;var n=this.FindChildItemIndex(e,t,o[this.CACHE_CHILDS_PROP]);if(-1==n)return null;var i=o[this.CACHE_CHILDS_PROP][n];return r&&!i.b?null:i},RFCacheManager.prototype.FindChildItemIndex=function(e,t,r){for(var o=-1,n=0;n<r.length;n++){var i=r[n];if(i[ITEMINFO_PATH_PROP]==e&&i[ITEMINFO_TYPE_PROP]==t){o=n;break}}return o},RFCacheManager.prototype.DeleteItemFromCache=function(e){var t=e[ITEMINFO_PATH_PROP],r=e[ITEMINFO_TYPE_PROP];switch(r){case EnRfDataItemType.RfItemType_Login:this.ClearDomainLogins(),this.ClearSearchList();break;case EnRfDataItemType.RfItemType_Identity:this.ClearIdentitiesList(),this.ClearSearchList();break;case EnRfDataItemType.RfItemType_Folder:this.ClearIdentitiesList(),this.ClearDomainLogins(),this.ClearFoldersList(),this.ClearSearchList()}if(this.GetItemFromCache(t,r,!1)){var o=this.getFolderByPath(this.getRootFolder(),GetParentFolderPath(t),RF_ROOT_FOLDER_URL);if(o){var n=this.FindChildItemIndex(t,r,o[this.CACHE_CHILDS_PROP]);-1!=n&&o[this.CACHE_CHILDS_PROP].splice(n,1)}}},RFCacheManager.prototype.SetGoFillGlobal=function(e,t,r,o,n,i){this.ClearGoFillGlobal(),g_SharedMgr.SetGoFill(e),g_SharedMgr.SetGoFillSubmit(t),g_SharedMgr.SetGoFillUrl(r),g_SharedMgr.SetInfoItem(o,n),g_SharedMgr.SetItemData(i)},RFCacheManager.prototype.GetGoFillGlobal=function(e){e.bGoFill=g_SharedMgr.GetGoFill(),e.bSubmit=g_SharedMgr.GetGoFillSubmit(),e.sUrl=g_SharedMgr.GetGoFillUrl();var t=g_SharedMgr.GetInfoItem();e[PATH_PROPERTY]=t[PATH_PROPERTY],e[RFTYPE_PROPERTY]=t[RFTYPE_PROPERTY],e.item_data=g_SharedMgr.GetItemData()},RFCacheManager.prototype.ClearGoFillGlobal=function(){g_SharedMgr.SetGoFill(!1),g_SharedMgr.SetGoFillSubmit(!1),g_SharedMgr.SetGoFillUrl(""),g_SharedMgr.ClearInfoItem(),g_SharedMgr.ClearItemData()},RFCacheManager.prototype.ResetLists=function(e){this.m_CachedTree={root:{}},this.m_PasscardCacheDomain={},this.m_IdentitiesList={},this.m_FoldersList={},this.m_SearchList={},0==arguments.length&&this.OnlineState(!1)},RFCacheManager.prototype.OnlineState=function(e){if(1==arguments.length&&(this.bOnline=e,g_ismaxthon)){var t=1==e?"icon":"icon_gray";window.external.mxGetRuntime().icon.setIconImage(t)}return this.bOnline},RFCacheManager.prototype.ClearDomainLogins=function(e){e?this.UpdateDomainLogins(e):this.m_PasscardCacheDomain={}},RFCacheManager.prototype.ClearIdentitiesList=function(){1!=g_jsApiMgr.getAccountMode()&&(this.m_IdentitiesList={})},RFCacheManager.prototype.ClearFoldersList=function(){1!=g_jsApiMgr.getAccountMode()&&(this.m_FoldersList={})},RFCacheManager.prototype.ClearSearchList=function(){this.m_SearchList={}},RFCacheManager.prototype.SetSearchList=function(e){this.m_SearchList.items=e},RFCacheManager.prototype.GetSearchList=function(){return this.m_SearchList.items},RFCacheManager.prototype.SetDomainLogins=function(e,t){if(1!=g_jsApiMgr.getAccountMode()){var r=RfUtils.DomainFromUrl(e);r&&(this.m_PasscardCacheDomain[r]=t)}},RFCacheManager.prototype.SetIdentitiesList=function(e){1!=g_jsApiMgr.getAccountMode()&&(this.m_IdentitiesList.items=e)},RFCacheManager.prototype.SetFoldersList=function(e){1!=g_jsApiMgr.getAccountMode()&&(this.m_FoldersList.items=e)},RFCacheManager.prototype.GetIdentitiesList=function(){if(1!=g_jsApiMgr.getAccountMode())return this.m_IdentitiesList.items},RFCacheManager.prototype.GetFoldersList=function(){if(1!=g_jsApiMgr.getAccountMode())return this.m_FoldersList.items},RFCacheManager.prototype.GetDomainLogins=function(e){if(1!=g_jsApiMgr.getAccountMode()){var t=RfUtils.DomainFromUrl(e);if(t)return this.m_PasscardCacheDomain[t]}},RFCacheManager.prototype.UpdateDomainLogins=function(e){if(1!=g_jsApiMgr.getAccountMode())if(e){var t=RfUtils.DomainFromUrl(e);if(t){this.m_PasscardCacheDomain[t];delete this.m_PasscardCacheDomain[t]}}else this.m_PasscardCacheDomain={}},CRFSharedDataMain.prototype.GetGoFill=function(){return this.m_bGoFill},CRFSharedDataMain.prototype.SetGoFill=function(e){this.m_bGoFill=e},CRFSharedDataMain.prototype.GetGoFillSubmit=function(){return this.m_bGoFillSubmit},CRFSharedDataMain.prototype.SetGoFillSubmit=function(e){this.m_bGoFillSubmit=e},CRFSharedDataMain.prototype.GetGoFillUrl=function(){return this.m_sGoFillUrl},CRFSharedDataMain.prototype.SetGoFillUrl=function(e){this.m_sGoFillUrl=e},CRFSharedDataMain.prototype.GetInfoItem=function(){return{path:this.m_sPath,type:this.m_nType}},CRFSharedDataMain.prototype.SetInfoItem=function(e,t){this.m_sPath=e,this.m_nType=t},CRFSharedDataMain.prototype.ClearInfoItem=function(){this.m_sPath="",this.m_nType=0},CRFSharedDataMain.prototype.SetItemData=function(e){this.m_itemData=e},CRFSharedDataMain.prototype.ClearItemData=function(){this.m_itemData=null},CRFSharedDataMain.prototype.GetItemData=function(){return this.m_itemData},GeneratedPasswordsList.prototype.clearList=function(){this.m_Objects.length=0},GeneratedPasswordsList.prototype.getList=function(){return this.m_Objects},GeneratedPasswordsList.prototype.pushItem=function(e){if(-1==this.getItemIndex(e))return this.m_Objects.unshift(e),this.m_Objects.length>this.m_nItemsLimit&&this.m_Objects.pop(),!0},GeneratedPasswordsList.prototype.getItemIndex=function(e){for(var t=-1,r=0;r<this.m_Objects.length;r++)if(e==this.m_Objects[r]){t=r;break}return t},CRFRecenltyUsedAdapter.prototype.Initialize=function(e){var t=this;t.m_bOneFileAccount=e;var r=[];if(t.m_bOneFileAccount)getProxyRfo().GetUsageInfo({list:0}).then(function(e){t.m_Objects=e});else{var o=GetSetting("recent","items");if(Array.isArray(o))for(var n=0;n<o.length;n++){var i={};i[ITEMINFO_CREATETIME_PROP]=i[ITEMINFO_MODTIME_PROP]=i[ITEMINFO_SIZE_PROP]=0;var a=o[n],s=a.substr(a.lastIndexOf(".")),p=RfapiJS.utils.FileExtToType(s);i[ITEMINFO_TYPE_PROP]=p,i[ITEMINFO_PATH_PROP]=a;var c=JSON.stringify(i);r.push(c)}t.m_Objects=r}},CRFRecenltyUsedAdapter.prototype.clearCache=function(){this.m_Objects.length=0},CRFRecenltyUsedAdapter.prototype.ClearListAsync=function(e){var t=this;return new Promise(function(r,o){var n=[];if(t.m_bOneFileAccount)g_jsApiMgr.UpdateUsageInfo({list:0,type:e,action:4},function(e){r()},function(e){o(e)});else{for(var i=0;i<t.m_Objects.length;i++){var a=JSON.parse(t.m_Objects[i]);ArrayInclude(e,a[RFTYPE_PROPERTY])||n.push(JSON.stringify(a))}t.m_Objects.length=0;for(i=0;i<n.length;i++)t.m_Objects.push(n[i]);t.applyToDatabase(),r()}})},CRFRecenltyUsedAdapter.prototype.GetListAsync=function(e){var t=this;return new Promise(function(r,o){var n=parseInt(GetSetting("sa-settings","MruMaxNumber")),i=[];if(t.m_bOneFileAccount)getProxyRfo().GetUsageInfo({list:0,type:e}).then(function(e){e.sort(function(e,t){return e.timestamp<t.timestamp?1:e.timestamp>t.timestamp?-1:0});for(var t=0;t<e.length&&(i.push(e[t]),i.length!=n);t++);r(i)}).catch(function(e){o(e)});else{for(var a=0;a<t.m_Objects.length;a++){var s=JSON.parse(t.m_Objects[a]);if(ArrayInclude(e,s[RFTYPE_PROPERTY])&&(i.push(s),i.length==n))break}r(i)}})},CRFRecenltyUsedAdapter.prototype.removeItem=function(e){if(this.m_bOneFileAccount)return!0;if(e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Login&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Bookmark&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Contact&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Identity&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Safenote)return!1;var t=this.getItemIndex(e);return-1!=t&&(this.m_Objects.splice(t,1),e[ITEMINFO_PATH_PROP],this.applyToDatabase(),!0)},CRFRecenltyUsedAdapter.prototype.getItemIndex=function(e){e[ITEMINFO_PATH_PROP];for(var t=-1,r=0;r<this.m_Objects.length;r++){var o=this.m_Objects[r],n=JSON.parse(o);if(void 0!==n[ITEMINFO_PATH_PROP]&&n[ITEMINFO_PATH_PROP]==e[ITEMINFO_PATH_PROP]){t=r;break}}return t},CRFRecenltyUsedAdapter.prototype.pushItem=function(e){if(this.m_bOneFileAccount)return!0;if(e[ITEMINFO_PATH_PROP],e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Login&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Bookmark&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Contact&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Identity&&e[ITEMINFO_TYPE_PROP]!=EnRfDataItemType.RfItemType_Safenote)return!1;var t=this.getItemIndex(e);-1!=t&&this.m_Objects.splice(t,1);var r=JSON.stringify(e);this.m_Objects.unshift(r);for(var o=e[ITEMINFO_TYPE_PROP],n=0,i=-1,a=0;a<this.m_Objects.length;a++){var s=this.m_Objects[a];if(!o!=JSON.parse(s)[ITEMINFO_TYPE_PROP]&&++n>this.m_nItemsLimit){i=a;break}}return-1!=i&&this.m_Objects.splice(i,1),this.applyToDatabase(),!0},CRFRecenltyUsedAdapter.prototype.applyToDatabase=function(){this.rfWriteRecentlyUsed()},CRFRecenltyUsedAdapter.prototype.rfWriteRecentlyUsed=function(){if(!this.m_bOneFileAccount){for(var e=[],t=0;t<this.m_Objects.length;t++){var r=this.m_Objects[t],o=JSON.parse(r);e.push(o[ITEMINFO_PATH_PROP])}PutSetting("recent","items",e)}},RfoProxy.prototype.CheckPwd=function(e){return new Promise(function(t,r){g_jsApiMgr.CheckPwd(e.pwd,function(e){t(e)},function(e){r(e)})})},RfoProxy.prototype.Login=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.CacheMasterPassword=function(e){return new Promise(function(t,r){g_jsApiMgr.CacheMasterPassword(e.pwd,function(e){t(e)},function(e){r(e)})})},RfoProxy.prototype.Logoff=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.GetDataStatus=function(e){return new Promise(function(t,r){g_jsApiMgr.GetDataStatus(e.accountId,function(e){t(e)},function(e){r(e)},e.listDir)})},RfoProxy.prototype.GetInfo=function(e){return new Promise(function(t,r){g_jsApiMgr.GetItemInfo(e.path,function(e){t(e)},function(e){r(e)},e.type,e.parts,e.iconMime)})},RfoProxy.prototype.List=function(e){return new Promise(function(t,r){g_jsApiMgr.GetItemsList(e.path,function(e){t(e)},function(e){r(e)},e.type,e.parts,e.deep,e.iconMime)})},RfoProxy.prototype.Count=function(e){return new Promise(function(t,r){g_jsApiMgr.GetItemsCount(e.path,function(e){t(e)},function(e){r(e)},e.type,e.parts,e.deep,e.bExcludeShared)})},RfoProxy.prototype.GetMatchingPasscards=function(e){return new Promise(function(t,r){g_jsApiMgr.GetMatchingPasscards(e.url,function(e){t(e)},function(e){r(e)},e.type,e.matchLevelMin,e.matchLevelMax,e.parts,e.bExcludeShared)})},RfoProxy.prototype.GetDomainPasscards=function(e){return new Promise(function(t,r){g_jsApiMgr.GetDomainPasscards(e.url,function(e){t(e)},function(e){r(e)},e.type,e.bExcludeShared)})},RfoProxy.prototype.UpdateStatus=function(e){return new Promise(function(e,t){g_jsApiMgr.UpdateStatus(function(t){e(t)},function(e){t(e)})})},RfoProxy.prototype.Delete=function(e){return new Promise(function(t,r){g_jsApiMgr.DeleteObject(e.path,e.type,function(e){t(e)},function(e){r(e)})})},RfoProxy.prototype.Rename=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.Move=function(e){return new Promise(function(t,r){g_jsApiMgr.MoveObject(e.from.path,e.from.type,e.to.path,e.to.type,function(e){t(e)},function(e){r(e)})})},RfoProxy.prototype.Copy=function(e){return new Promise(function(t,r){g_jsApiMgr.CopyObject(e.from.path,e.from.type,e.to.path,e.to.type,function(e){t(e)},function(e){r(e)})})},RfoProxy.prototype.CreateFolder=function(e){return new Promise(function(t,r){var o;o="folder"in e?e.folder:e.path,g_jsApiMgr.CreateFolder(o,function(e){t(e)},function(e){r(e)})})},RfoProxy.prototype.GetDataItem=function(e){return new Promise(function(t,r){g_jsApiMgr.GetDataItem(e.path,e.type,function(e){t(e)},function(e){r(e)},e.level,e.pwd,e.allFields,e.options,e.used,e.favorite)})},RfoProxy.prototype.PutDataItem=function(e){return new Promise(function(t,r){g_jsApiMgr.PutDataItem(e.path,e.type,e.data,function(e){t(e)},function(e){r(e)},e.used,e.favorite,e.sharedCode)})},RfoProxy.prototype.CreateDataItem=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.CreateDataItem2=function(e){return new Promise(function(t,r){g_jsApiMgr.CreateDataItem2(e.type,function(e){t(e)},function(e){r(e)},e.country,e.phonePrefixMode,e.appUpload)})},RfoProxy.prototype.GetUsageInfo=function(e){return new Promise(function(t,r){g_jsApiMgr.GetUsageInfo(e,function(e){t(e)},function(e){2!=g_jsApiMgr.getAccountMode()?r(e):t([])})})},RfoProxy.prototype.SetUsageInfo=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.SetUsageInfoList=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.GetOptions=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.SetOptions=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.PutFile=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},RfoProxy.prototype.GetFile=function(e){return new Promise(function(t,r){g_jsApiMgr.GetFile(e.path,function(e){t(e)},function(e){r(e)},e.used,e.favorite)})},RfoProxy.prototype.ChangePassword=function(e){return new Promise(function(t,r){g_jsApiMgr.ChangePassword(e.path,e.type,e.from,e.to,function(e){t(e)},function(e){r(e)},e.dp)})},NMProxy.prototype.CheckPwd=function(e){return this.callRfApi("checkpwd",e)},NMProxy.prototype.Login=function(e){return this.callRfApi("login",e)},NMProxy.prototype.CacheMasterPassword=function(e){return this.callRfApi("cachemp",e)},NMProxy.prototype.Logoff=function(){return this.callRfApi("logoff",{})},NMProxy.prototype.GetDataStatus=function(e){return Promise.reject(new RfApiError(RfErrType.RfErr_NotImplemented,"not implemented"))},NMProxy.prototype.GetInfo=function(e){return this.callRfApi("getinfo",e)},NMProxy.prototype.List=function(e){return this.callRfApi("list",e)},NMProxy.prototype.Count=function(e){return this.callRfApi("count",e)},NMProxy.prototype.GetMatchingPasscards=function(e){return this.callRfApi("getmatchingpasscards",e)},NMProxy.prototype.GetDomainPasscards=function(e){return this.callRfApi("getdomainpasscards",e)},NMProxy.prototype.UpdateStatus=function(){return this.callRfApi("updatestatus",{})},NMProxy.prototype.DeleteObject=function(e){return this.callRfApi("delete",e)},NMProxy.prototype.RenameObject=function(e){return this.callRfApi("rename",e)},NMProxy.prototype.MoveObject=function(e){return this.callRfApi("move",e)},NMProxy.prototype.CopyObject=function(e){return this.callRfApi("copy",e)},NMProxy.prototype.CreateFolder=function(e){return this.callRfApi("createfolder",e)},NMProxy.prototype.GetDataItem=function(e){return this.callRfApi("getdataitem",e)},NMProxy.prototype.GetDataItem2=function(e){return this.callRfApi("getdataitem2",e)},NMProxy.prototype.PutDataItem=function(e){return this.callRfApi("putdataitem",e)},NMProxy.prototype.CreateDataItem=function(e){return this.callRfApi("createdataitem",e)},NMProxy.prototype.CreateDataItem2=function(e){return this.callRfApi("createdataitem2",e)},NMProxy.prototype.GetUsageInfo=function(e){return this.callRfApi("getusageinfo",e)},NMProxy.prototype.SetUsageInfo=function(e){return this.callRfApi("setusageinfo",e)},NMProxy.prototype.SetUsageInfoList=function(e){return this.callRfApi("setusageinfo",e)},NMProxy.prototype.GetOptions=function(){return this.callRfApi("getoptions",{})},NMProxy.prototype.SetOptions=function(e){return this.callRfApi("setoptions",e)},NMProxy.prototype.PutFile=function(e){return this.callRfApi("putfile",e)},NMProxy.prototype.GetFile=function(e){return this.callRfApi("getfile",e)},NMProxy.prototype.ChangePassword=function(e){return this.callRfApi("changepwd",e)},NMProxy.prototype.GetProfiles=function(){return this.callRfApi("getprofiles",{})},NMProxy.prototype.SetProfile=function(e){return this.callRfApi("setprofile",e)},NMProxy.prototype.GetProfileInfo=function(e){return this.callRfApi("getprofileinfo",{})},NMProxy.prototype.SendMsg=function(e){return this.callRfApi("sendmessage",e)},NMProxy.prototype.GetBrowserTask=function(){return this.callRfApi("getbrowsertask",{})},NMProxy.prototype.SetBrowserTask=function(e){return this.callRfApi("setbrowsertask",e)},NMProxy.prototype.CancelBrowserTask=function(){return this.callRfApi("cancelbrowsertask",{})},NMProxy.prototype.getServiceStatus=function(){return this.m_service_status},NMProxy.prototype.checkUptodate=function(e){if(0==e)return 0==this.m_data_generation_number?{uptodate:!0}:{uptodate:!1,currentGenerationNumber:this.m_data_generation_number,isFullUpdateNeeded:!0};if(e==this.m_data_generation_number)return{uptodate:!0};for(var t=this.m_changes.length-1;t>=0;t--){var r=this.m_changes[t];if(r.generation==e)return{uptodate:!1,currentGenerationNumber:this.m_data_generation_number,isFullUpdateNeeded:!1,changes:this.m_changes.slice(t+1)};if(r.eventType==RfChangeEventType.FullUpdate||r.eventType==RfChangeEventType.Connect||r.eventType==RfChangeEventType.Disconnect)break}return{uptodate:!1,currentGenerationNumber:this.m_data_generation_number,isFullUpdateNeeded:!0}},NMProxy.prototype.callRfApi=function(e,t){var r={version:1,generation:this.m_data_generation_number,request:t},o=this;return this.sendRfApiRequest(e,r).then(function(e){var t={};if("object"==typeof e)t=e;else{if("string"!=typeof e)throw new RfApiError(void 0,"wrong rf-api response for function '"+functionName+"': wrong argument type",void 0,void 0,RfapiJS.SibErrType.SibTErr_ServerErr);t=JSON.parse(e)}if(void 0!==t.uptodate&&!t.uptodate){if(void 0===t.generation)throw new RfApiError(void 0,"wrong rf-api response for function '"+functionName+"': no generation",void 0,void 0,RfapiJS.SibErrType.SibTErr_ServerErr);o.m_data_generation_number=t.generation,o.m_data_generation_number,void 0!==t.status&&(o.m_service_status=t.status,o.m_service_status);var r=!1;if(void 0!==t.full&&(r=t.full),r)o.m_changes=[new RfChangeEvent(RfChangeEventType.FullUpdate,o.m_data_generation_number)],o.m_onDataChangedCallback&&o.m_onDataChangedCallback(o.m_changes);else if(void 0!==t.changes){var n=t.changes,i=[];n.length;for(var a=0;a<n.length;a++){var s=n[a];if(void 0===s.event)throw new RfApiError(void 0,"wrong rf-api response for function '"+functionName+"': no change event type",void 0,void 0,RfapiJS.SibErrType.SibTErr_ServerErr);if(void 0===s.gen)throw new RfApiError(void 0,"wrong rf-api response for function '"+functionName+"': no change event generation",void 0,void 0,RfapiJS.SibErrType.SibTErr_ServerErr);var p=s.event,c=s.gen;if(p==RfChangeEventType.FullUpdate){o.m_changes=[new RfChangeEvent(RfChangeEventType.FullUpdate,c)],i=[new RfChangeEvent(RfChangeEventType.FullUpdate,c)];break}if(void 0===s.path)var f=new RfChangeEvent(p,c);else if(void 0===s.to)f=new RfChangeEvent(p,c,RfGetPathStr(s.path,s.type));else{var _=s.to;f=new RfChangeEvent(p,c,RfGetPathStr(s.path,s.type),RfGetPathStr(_.path,_.type))}o.m_changes.push(f),i.push(f)}o.m_changes.length>128&&(o.m_changes.length,o.m_changes=o.m_changes.slice(o.m_changes.length-128,o.m_changes.length),o.m_changes[0].eventType=RfChangeEventType.FullUpdate),o.m_onDataChangedCallback&&o.m_onDataChangedCallback(i)}}var R=t.response;if(void 0===R)throw new RfApiError(void 0,"wrong rf-api response for function '"+functionName+"': no response property",void 0,void 0,RfapiJS.SibErrType.SibTErr_ServerErr);var m=R.status;if(void 0===m)throw new RfApiError(void 0,"wrong rf-api response for function '"+functionName+"': no response status",void 0,void 0,RfapiJS.SibErrType.SibTErr_ServerErr);if("ok"==m)return R;throw"error"==m?new RfApiError(R.code,R.description,void 0,void 0,R.sibError):new RfApiError(void 0,"wrong rf-api response for function '"+functionName+"': "+m,void 0,void 0,RfapiJS.SibErrType.SibTErr_ServerErr)})},NMProxy.prototype.sendRfApiRequest=function(e,t){if(void 0===t.request)return Promise.reject(new RfApiError(RfapiJS.RfErrType.RfErr_WrongParams,"request is not specified",void 0,void 0,RfapiJS.SibErrType.SibTErr_LocalErr));t.request.function=e;var r=this;return new Promise(function(e,o){r.m_nm_connector.sendMessage("rf-api-request",{request:JSON.stringify(t)},function(t){e(t)})})},NMProxy.prototype.showOptions=function(){this.m_nm_connector.postMessage("showOptions",arguments)},NMProxy.prototype.setCurrentBrowser=function(){this.m_nm_connector.postMessage("setCurrentBrowser",arguments)},NMProxy.prototype.setUIItemsInfo=function(){this.m_nm_connector.postMessage("setUIItemsInfo",arguments)},NMProxy.prototype.initUI=function(){this.m_nm_connector.postMessage("initUI",arguments)},NMProxy.prototype.Initialize=function(e,t,r,o,n){var i=this;this.m_nm_connector.Connect(function(){i.m_nm_connector.sendMessage("Initialize",["rf-api",t],function(e){if("rf-api"===e||e){i.m_bRfApi="rf-api"===e;try{r()}catch(e){log(e),o()}}else o()})},o,n)},NMProxy.prototype.addBrowser=function(e,t){this.m_nm_connector.postMessage("addBrowser",[e])},NMProxy.prototype.Uninitialize=function(){this.m_nm_connector.postMessage("Uninitialize",arguments)},NMProxy.prototype.getProp=function(e,t){this.m_nm_connector.sendMessage("getProp",e,t)},NMProxy.prototype.ensureUptodate=function(e){this.m_nm_connector.sendMessage("ensureUptodate",void 0,e)},NMProxy.prototype.updateToolbarPosition=function(e,t,r,o){this.m_nm_connector.postMessage("updateToolbarPosition",arguments)},NMProxy.prototype.onWindowRemoved=function(e){this.m_nm_connector.postMessage("onWindowRemoved",arguments)},NMProxy.prototype.onFocusChanged=function(e){this.m_nm_connector.postMessage("onFocusChanged",arguments)},NMProxy.prototype.onAuthRequired=function(e,t){this.m_nm_connector.sendMessage("onAuthRequired",arguments,t)},NMProxy.prototype.removeBrowser=function(e){this.m_nm_connector.postMessage("removeBrowser",arguments)},NMProxy.prototype.addFrame=function(e,t,r,o,n,i){this.m_nm_connector.postMessage("addFrame",[e,t,r,o,n])},NMProxy.prototype.updateFrame=function(e,t,r,o){this.m_nm_connector.postMessage("updateFrame",arguments)},NMProxy.prototype.removeFrame=function(e,t,r){this.m_nm_connector.postMessage("removeFrame",arguments)},NMProxy.prototype.onMessage=function(e,t,r,o){this.m_nm_connector.postMessage("onMessage",arguments)},NMProxy.prototype.setToolbarForPopupVisible=function(){this.m_nm_connector.postMessage("setToolbarForPopupVisible",arguments)},NMProxy.prototype.setToolbarVisible=function(){this.m_nm_connector.postMessage("setToolbarVisible",arguments)},NMProxy.prototype.setPopupToolbar=function(){this.m_nm_connector.postMessage("setPopupToolbar",arguments)},NMProxy.prototype.onUIEvent=function(){this.m_nm_connector.postMessage("onUIEvent",arguments)},NMProxy.prototype.updateNativeToolbar=function(){this.m_nm_connector.postMessage("updateNativeToolbar",arguments)},NMProxy.prototype.onActionButtonClick=function(){this.m_nm_connector.postMessage("onActionButtonClick",arguments)},NMProxy.prototype.SetChromeV8Style=function(e){this.m_nm_connector.sendMessage("onUIEvent",[JSON.stringify({type:"chrome-set-V8-style"})],e)};var RF_InternalLabel_Bookmark="{Bookmark}",RF_InternalLabel_Offline="{Offline}";function GetPasscardFromGetDataItem2Response(e,t){var r={},o="l"in e?e.l:RfapiJS.EnDataPresenceLevel.enHaveAll;function n(e,t,o,n,i){r.m_bLoaded=e,r.m_bAllParsed=t,r.m_bNonSecretParsed=o,r.m_bExecuteOnly=n,r.m_bDecryptedOK=e&&(t||n),r.m_bPlainText=i}if(o==RfapiJS.EnDataPresenceLevel.enInitial)return n(!1,!1,!1,!1,!1),r;switch(t){case EnRfDataItemType.RfItemType_Bookmark:r.m_sGotoURL="g"in e?e.g:"";break;case EnRfDataItemType.RfItemType_Safenote:break;case EnRfDataItemType.RfItemType_Login:case EnRfDataItemType.RfItemType_SearchCard:r.m_sGotoURL="g"in e?e.g:"",r.m_sMatchURL="m"in e?e.m:"",r.m_nScriptsCount="s"in e?e.s:-1,r.m_nPriority="d"in e?e.d:0,r.m_tPwdChangeRemindNextTime="tc"in e?e.tc:0,r.m_tsPwdChangeRemindPeriod="tp"in e?e.tp:0;break;case EnRfDataItemType.RfItemType_BlockingPasscard:r.m_sGotoURL="g"in e?e.g:"",r.m_sMatchURL="m"in e?e.m:""}var i="p"in e&&e.p;if(r.m_bEncrypted=i,r.m_bDecryptedOK=!0,i){r.m_nCipherType="cipher"in e?e.cipher:EnCipherType.enCipher_AES;var a="dp"in e&&e.dp;r.m_nKeyScheme=a?EnCipherKeyScheme.enCipherKey_DualPassword:EnCipherKeyScheme.enCipherKey_Normal,r.m_bIsCipherTypeSpecified=!0,o>RfapiJS.EnDataPresenceLevel.enHaveUnprotectedPart&&(r.m_sPassword="pwd"in e?e.pwd:"")}var s="pt"in e&&e.pt;if(o<=RfapiJS.EnDataPresenceLevel.enHaveHeader)return n(!0,!1,!1,!1,s),r;switch(r.m_nMostPopular="po"in e?e.po:0,t){case EnRfDataItemType.RfItemType_Bookmark:case EnRfDataItemType.RfItemType_Login:case EnRfDataItemType.RfItemType_SearchCard:r.m_sPrompt="pr"in e?e.pr:"",r.m_sHash="h"in e?e.h:"",r.m_sFavIconURL="fu"in e?e.fu:"",r.m_sPasscardID="id"in e?e.id:"",r.m_sIconA="i"in e?e.i:""}function p(e,t,o,n,i,a,s){r.m_lFields.push({m_sName:e,m_sCaption:t,m_sId:o,m_sValue:n,m_nOrderIndex:i,m_field_type:a,m_bDefaultValue:s})}var c="n"in e?e.n:"",f=!1;if(r.m_lFields=[],(t==EnRfDataItemType.RfItemType_Login||t==EnRfDataItemType.RfItemType_SearchCard)&&"f"in e)for(var _=e.f,R=0;R<_.length;R++){var m=_[R],u="n"in m?m.n:"",y="i"in m?m.i:"",l="t"in m?m.t:RfFieldType.RfFieldText,P="d"in m&&m.d,h="c"in m?m.c:"",O="id"in m?m.id:"",E="";c&&"Note$"==u||"$Note$"==u?(E=c,f=!0):o>RfapiJS.EnDataPresenceLevel.enHaveUnprotectedPart&&(E="v"in m?m.v:""),p(u,h,O,E,y,l,P)}function d(e){p("Note$","","",e,0,RfFieldType.RfFieldText,!1)}switch(t){case EnRfDataItemType.RfItemType_Bookmark:r.m_sMatchURL=RF_InternalLabel_Bookmark,c&&d(c);break;case EnRfDataItemType.RfItemType_Safenote:r.m_sGotoURL=RF_InternalLabel_Offline,r.m_sMatchURL=RF_InternalLabel_Offline,p("","","",c,0,RfFieldType.RfField_None,!1),r.SetSafenote(c);break;case EnRfDataItemType.RfItemType_Login:case EnRfDataItemType.RfItemType_SearchCard:c&&!f&&d(c);break;case EnRfDataItemType.RfItemType_BlockingPasscard:var g="b"in e?e.b:0;p(RFNAME_NOAUTOFILLFROMIDENTITY,"","",g&RF_BLOCK_FILL_IDENTITY?"*":"",0,RfFieldType.RfField_None,!1),p(RFNAME_NOAUTOFILLFROMPASSCARD,"","",g&RF_BLOCK_FILL_PASSCARD?"*":"",RfFieldType.RfField_None,!1),p(RFNAME_NOAUTOSAVE,"","",g&RF_BLOCK_SAVE?"*":"",RfFieldType.RfField_None,!1),c&&!f&&d(c)}switch(o){default:case RfapiJS.EnDataPresenceLevel.enHaveUnprotectedPart:n(!0,!1,!0,!1,s);break;case RfapiJS.EnDataPresenceLevel.enExecuteOnly:n(!0,!0,!0,!0,s);break;case RfapiJS.EnDataPresenceLevel.enHaveAll:n(!0,!0,!0,!1,s)}return r}function GetIdentityFromGetDataItem2Response(e,t){var r={},o="l"in e?e.l:RfapiJS.EnDataPresenceLevel.enHaveAll;function n(e,t,o,n){r.m_bLoaded=e,r.m_bAllParsed=t,r.m_bNonSecretParsed=o,r.m_bExecuteOnly=n,r.m_bDecryptedOK=e&&(t||n)}if(o==RfapiJS.EnDataPresenceLevel.enInitial)return n(!1,!1,!1,!1),r;var i="p"in e&&e.p;if(r.m_bEncrypted=i,r.m_bDecryptedOK=!0,i){r.m_nCipherType="cipher"in e?e.cipher:EnCipherType.enCipher_AES;var a="dp"in e&&e.dp;r.m_nKeyScheme=a?EnCipherKeyScheme.enCipherKey_DualPassword:EnCipherKeyScheme.enCipherKey_Normal,r.m_bIsCipherTypeSpecified=!0,o>RfapiJS.EnDataPresenceLevel.enHaveUnprotectedPart&&(r.m_sPassword="pwd"in e?e.pwd:"")}if(o<=RfapiJS.EnDataPresenceLevel.enHaveHeader)return n(!0,!1,!1,!1),r;if(r.m_mOptionValues={},"c"in e){e.c;r.m_mOptionValues["World Regions"]=sCountry}if(t==EnRfDataItemType.RfItemType_Identity&&(r.m_mOptionValues["Use for Form Filling"]="+"),"o"in e){var s=e.o;for(var p in s)r.m_mOptionValues[p]=s[p]}if(r.m_lGroups=[],"g"in e)for(var c=e.g,f=0;f<c.length;f++){var _=c[f],R="n"in _?_.n:"",m="Custom"==R,u={m_sName:R,instances:[]};if("c"in _&&(u.currentInstance=_.c),"i"in _){for(var y=_.i,l="",P=0;P<y.length;P++){var h=y[P],O="n"in h?h.n:"",E="d"in h&&h.d;E&&(l=O);var d={m_sName:O,isDefault:E,m_lFields:[]};if("f"in h)for(var g=h.f,S=0;S<g.length;S++){var T=g[S],I="n"in T?T.n:"",v="v"in T?T.v:"";if(m){var N="o"in T?T.o:"";d.m_lFields.push({m_sName:I,m_sValue:v,m_sMatches:N})}else d.m_lFields.push({m_sName:I,m_sValue:v})}u.instances.push(d)}l&&(u.m_sDefaultInstanceName=l)}r.m_lGroups.push(u)}switch(o){default:case RfapiJS.EnDataPresenceLevel.enHaveUnprotectedPart:n(!0,!1,!0,!1);break;case RfapiJS.EnDataPresenceLevel.enExecuteOnly:n(!0,!0,!0,!0);break;case RfapiJS.EnDataPresenceLevel.enHaveAll:n(!0,!0,!0,!1)}return r}function GetDataItemFromGetDataItem2Response(e,t){return RfIsPasscard(t)?GetPasscardFromGetDataItem2Response(e,t):RfIsIdentity(t)?GetIdentityFromGetDataItem2Response(e,t):void 0}
//# sourceMappingURL=proxy-rfo.js.map